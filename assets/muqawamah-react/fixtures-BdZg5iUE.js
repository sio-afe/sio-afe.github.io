import{r as e,s as a,j as s,c as t,R as l}from"./supabaseClient-BTiblPWy.js";import{T as i}from"./TournamentNavbar-CIMgyTwX.js";import{F as r}from"./Footer-C_t3LNGD.js";import"./supabase-client-DmFmBHmJ.js";function n({onMatchClick:t}){const[l,n]=e.useState([]),[c,o]=e.useState(!0),[d,m]=e.useState(1),[h]=e.useState(window.location.pathname.includes("/u17/")?"u17":"open-age"),p=e=>{if(!e)return null;const a=e.toLowerCase();return"group"===a?"Group Stage":"quarter-final"===a||"quarterfinal"===a?"Quarter Final":"semi-final"===a||"semifinal"===a?"Semi Final":"final"===a?"Final":"third-place"===a||"thirdplace"===a?"3rd Place":e.charAt(0).toUpperCase()+e.slice(1)};e.useEffect(()=>{u()},[h]);const u=async()=>{try{o(!0);const{data:e,error:s}=await a.from("matches").select("\n          *,\n          home_team:teams!matches_home_team_id_fkey(id, name, crest_url),\n          away_team:teams!matches_away_team_id_fkey(id, name, crest_url)\n        ").eq("category",h).order("match_number",{ascending:!0}).order("scheduled_time",{ascending:!0});if(s)throw s;if(n(e||[]),e&&e.length>0){const a=[...new Set(e.map(e=>e.match_number).filter(Boolean))],s=e.filter(e=>"completed"===e.status).map(e=>e.match_number).sort((e,a)=>a-e)[0];if(s){const e=a.some(e=>e>s);m(e?s+1:s)}else m(a[0]||1)}}catch(e){}finally{o(!1)}},x=e.useMemo(()=>{const e={};return l.forEach(a=>{const s=a.match_number||1;e[s]||(e[s]=[]),e[s].push(a)}),e},[l]),y=e.useMemo(()=>[...new Set(l.map(e=>e.match_number).filter(Boolean))].sort((e,a)=>e-a),[l]);if(c)return s.jsxs(s.Fragment,{children:[s.jsx(i,{}),s.jsx("div",{className:"fixtures-loading",children:s.jsxs("div",{className:"fixtures-loading-content",children:[s.jsxs("div",{className:"logo-loader",children:[s.jsx("div",{className:"logo-ring"}),s.jsx("img",{src:"/assets/img/MuqawamaLogo.png",alt:"Muqawama",className:"logo-pulse"})]}),s.jsx("p",{children:"Loading fixtures..."})]})}),s.jsx(r,{edition:"2026"})]});const g=x[d]||[];return s.jsxs(s.Fragment,{children:[s.jsx(i,{}),s.jsx("div",{className:"fixtures-page-v2",children:s.jsxs("div",{className:"fixtures-container-v2",children:[s.jsxs("div",{className:"fixtures-header-v2",children:[s.jsx("h1",{children:"Fixtures & Results"}),s.jsx("hr",{className:"fixtures-divider"})]}),y.length>0&&s.jsx("div",{className:"matchday-tabs-v2",children:y.map(e=>s.jsx("button",{className:"matchday-tab-v2 "+(d===e?"active":""),onClick:()=>m(e),children:e},e))}),s.jsx("div",{className:"matches-list-v2",children:g.length>0?g.map(e=>{var a,l,i,r,n,c,o,d;const m="completed"===e.status,h="live"===e.status,u=m||h,x=e.home_score??0,y=e.away_score??0,g=(e=>{return"completed"===e.status?{label:"FT",className:"status-completed"}:"live"===e.status?{label:"LIVE",className:"status-live"}:"scheduled"===e.status?{label:(a=e.scheduled_time,a?a.length>=5?a.substring(0,5):a:"TBD"),className:"status-scheduled"}:{label:"TBD",className:"status-scheduled"};var a})(e);return s.jsxs("div",{className:"match-card-v2 clickable",onClick:()=>t&&t(e.id),style:{cursor:t?"pointer":"default"},children:[s.jsx("div",{className:"match-status-mobile",children:s.jsx("span",{className:`status-badge ${g.className}`,children:g.label})}),s.jsxs("div",{className:"match-row-v2",children:[s.jsx("div",{className:"match-status-desktop",children:s.jsx("span",{className:`status-badge ${g.className}`,children:g.label})}),s.jsxs("div",{className:"match-team-v2 home",children:[s.jsx("span",{className:"team-name-v2",children:(null==(a=e.home_team)?void 0:a.name)||"TBD"}),s.jsx("div",{className:"team-logo-v2",children:(null==(l=e.home_team)?void 0:l.crest_url)?s.jsx("img",{src:e.home_team.crest_url,alt:e.home_team.name,loading:"lazy"}):s.jsx("span",{children:(null==(r=null==(i=e.home_team)?void 0:i.name)?void 0:r.charAt(0))||"?"})})]}),s.jsx("div",{className:"match-score-v2",children:u?s.jsxs("span",{className:"score-display "+(h?"live":""),children:[x," - ",y]}):s.jsx("span",{className:"vs-display",children:"vs"})}),s.jsxs("div",{className:"match-team-v2 away",children:[s.jsx("div",{className:"team-logo-v2",children:(null==(n=e.away_team)?void 0:n.crest_url)?s.jsx("img",{src:e.away_team.crest_url,alt:e.away_team.name,loading:"lazy"}):s.jsx("span",{children:(null==(o=null==(c=e.away_team)?void 0:c.name)?void 0:o.charAt(0))||"?"})}),s.jsx("span",{className:"team-name-v2",children:(null==(d=e.away_team)?void 0:d.name)||"TBD"})]}),s.jsx("div",{className:"match-venue-desktop",children:s.jsxs("span",{children:[e.venue||"",e.venue&&p(e.match_type)&&" | ",p(e.match_type)]})})]}),s.jsx("div",{className:"match-venue-mobile",children:s.jsxs("span",{children:[e.venue||"",e.venue&&p(e.match_type)&&" | ",p(e.match_type)]})})]},e.id)}):s.jsxs("div",{className:"no-matches-v2",children:[s.jsx("i",{className:"fas fa-calendar-times"}),s.jsxs("p",{children:["No fixtures scheduled for Matchday ",d]})]})})]})}),s.jsx(r,{edition:"2026"})]})}function c({homePlayers:a=[],awayPlayers:t=[],homeTeam:l={},awayTeam:i={},goals:r=[],cards:n=[]}){const[c,o]=e.useState(null),[d,m]=e.useState(!0),[h,p]=e.useState(!1),u=a.filter(e=>!e.is_substitute&&"SUB"!==e.position).slice(0,7),x=t.filter(e=>!e.is_substitute&&"SUB"!==e.position).slice(0,7),y=e=>{if(!e)return{goalsScored:0,assists:0,yellowCards:0,redCards:0};let a=0,s=0,t=0,l=0;const i=e.name||e.player_name||"",c=e.registration_player_id;return r.forEach(e=>{var t,l;let r=!1,n=!1;if(c&&(e.scorer_id===c&&(r=!0),e.assister_id===c&&(n=!0)),!r&&!n){const a=(null==(t=e.scorer)?void 0:t.player_name)||"",s=(null==(l=e.assister)?void 0:l.player_name)||"";a&&i&&a.toLowerCase().trim()===i.toLowerCase().trim()&&(r=!0),s&&i&&s.toLowerCase().trim()===i.toLowerCase().trim()&&(n=!0)}r&&a++,n&&s++}),n&&n.length>0&&n.forEach(e=>{var a;let s=!1;if(c&&e.player_id===c&&(s=!0),!s){const t=(null==(a=e.player)?void 0:a.player_name)||"";t&&i&&t.toLowerCase().trim()===i.toLowerCase().trim()&&(s=!0)}s&&("yellow"===e.card_type&&t++,"red"===e.card_type&&l++)}),{goalsScored:a,assists:s,yellowCards:t,redCards:l}},g=(e,a)=>{o(e),m(a)},_=()=>{o(null)};if(!(u.length>0||x.length>0))return s.jsxs("div",{className:"match-formation-empty",children:[s.jsx("i",{className:"fas fa-users-slash"}),s.jsx("p",{children:"Formation not available"})]});const j=c?y(c):null,f=c?(e=>{if(!e)return null;const a=new Date(e),s=new Date;let t=s.getFullYear()-a.getFullYear();const l=s.getMonth()-a.getMonth();return(l<0||0===l&&s.getDate()<a.getDate())&&t--,t})(c.date_of_birth):null;return s.jsxs("div",{className:"match-formation-field",children:[s.jsx("div",{className:"formation-field-wrapper",children:s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 74 111",className:"match-field-svg",children:[s.jsx("rect",{width:"74",height:"111",fill:"#0d1117"}),s.jsxs("g",{fill:"none",stroke:"rgba(255,255,255,0.35)",strokeWidth:"0.5",transform:"translate(3 3)",children:[s.jsx("path",{d:"M 0 0 h 68 v 105 h -68 Z"}),s.jsx("path",{d:"M 0 52.5 h 68"}),s.jsx("circle",{r:"9.15",cx:"34",cy:"52.5"}),s.jsx("circle",{r:"0.75",cx:"34",cy:"52.5",fill:"rgba(255,255,255,0.35)",stroke:"none"}),s.jsxs("g",{children:[s.jsx("path",{d:"M 13.84 0 v 16.5 h 40.32 v -16.5"}),s.jsx("path",{d:"M 24.84 0 v 5.5 h 18.32 v -5.5"}),s.jsx("circle",{r:"0.75",cx:"34",cy:"10.94",fill:"rgba(255,255,255,0.35)",stroke:"none"}),s.jsx("path",{d:"M 26.733027 16.5 a 9.15 9.15 0 0 0 14.533946 0"})]}),s.jsxs("g",{transform:"rotate(180,34,52.5)",children:[s.jsx("path",{d:"M 13.84 0 v 16.5 h 40.32 v -16.5"}),s.jsx("path",{d:"M 24.84 0 v 5.5 h 18.32 v -5.5"}),s.jsx("circle",{r:"0.75",cx:"34",cy:"10.94",fill:"rgba(255,255,255,0.35)",stroke:"none"}),s.jsx("path",{d:"M 26.733027 16.5 a 9.15 9.15 0 0 0 14.533946 0"})]}),s.jsx("path",{d:"M 0 2 a 2 2 0 0 0 2 -2M 66 0 a 2 2 0 0 0 2 2M 68 103 a 2 2 0 0 0 -2 2M 2 105 a 2 2 0 0 0 -2 -2"})]}),u.map(e=>{var a,t,l,i;const r=(e=>({x:"number"==typeof e.position_x?e.position_x:50,y:4+(100-("number"==typeof e.position_y?e.position_y:50))/100*44}))(e),n=3+r.x/100*68,c=3+r.y/100*105,o=y(e),d=o.goalsScored>0,m=o.yellowCards>0,h=o.redCards>0;return s.jsxs("g",{transform:`translate(${n}, ${c})`,style:{cursor:"pointer"},onClick:()=>g(e,!0),role:"button",tabIndex:0,onKeyDown:a=>{"Enter"!==a.key&&" "!==a.key||g(e,!0)},children:[s.jsx("circle",{r:"3.8",fill:"none",stroke:"#4a90e2",strokeWidth:"0.3"}),s.jsx("circle",{r:"3",fill:"#1e2a38",stroke:"none"}),e.player_image?s.jsxs(s.Fragment,{children:[s.jsx("defs",{children:s.jsx("clipPath",{id:`clip-home-${e.id}`,children:s.jsx("circle",{r:"3",cx:"0",cy:"0"})})}),s.jsx("image",{href:e.player_image,x:"-3",y:"-3",width:"6",height:"6",clipPath:`url(#clip-home-${e.id})`,preserveAspectRatio:"xMidYMid slice"})]}):s.jsx("text",{x:"0",y:"1",textAnchor:"middle",fill:"#4a90e2",fontSize:"2.2",fontWeight:"700",children:e.position||"?"}),s.jsx("text",{x:"0",y:"6.5",textAnchor:"middle",fill:"#4a90e2",fontSize:"1.8",fontWeight:"600",children:(null==(t=null==(a=e.name)?void 0:a.split(" ")[0])?void 0:t.substring(0,8))||(null==(i=null==(l=e.player_name)?void 0:l.split(" ")[0])?void 0:i.substring(0,8))||""}),d&&s.jsxs("g",{transform:"translate(2.7, -2.7)",children:[s.jsx("circle",{r:"1.2",fill:"#fff",opacity:"0.98"}),s.jsx("image",{href:"/assets/img/Muqawama/ball.svg",x:"-1.2",y:"-1.2",width:"2.4",height:"2.4",preserveAspectRatio:"xMidYMid meet"}),o.goalsScored>1&&s.jsxs("g",{children:[s.jsx("circle",{cx:"0.9",cy:"-0.9",r:"0.65",fill:"#fff",stroke:"#000",strokeWidth:"0.18"}),s.jsx("text",{x:"0.9",y:"-0.75",textAnchor:"middle",fontSize:"0.75",fill:"#000",fontWeight:"700",children:o.goalsScored})]})]}),m&&s.jsx("g",{transform:"translate(-2.7, -2.7)",children:s.jsx("image",{href:"/assets/img/Muqawama/Yellow_card.svg",x:"-1.2",y:"-1.2",width:"2.4",height:"2.4",preserveAspectRatio:"xMidYMid meet"})}),h&&s.jsx("g",{transform:"translate(2.7, 2.7)",children:s.jsx("image",{href:"/assets/img/Muqawama/Red_card.svg",x:"-1.2",y:"-1.2",width:"2.4",height:"2.4",preserveAspectRatio:"xMidYMid meet"})})]},`home-${e.id}`)}),x.map(e=>{var a,t,l,i;const r=(e=>({x:"number"==typeof e.position_x?e.position_x:50,y:52+("number"==typeof e.position_y?e.position_y:50)/100*44}))(e),n=3+r.x/100*68,c=3+r.y/100*105,o=y(e),d=o.goalsScored>0,m=o.yellowCards>0,h=o.redCards>0;return s.jsxs("g",{transform:`translate(${n}, ${c})`,style:{cursor:"pointer"},onClick:()=>g(e,!1),role:"button",tabIndex:0,onKeyDown:a=>{"Enter"!==a.key&&" "!==a.key||g(e,!1)},children:[s.jsx("circle",{r:"3.8",fill:"none",stroke:"#e63946",strokeWidth:"0.3"}),s.jsx("circle",{r:"3",fill:"#2a1e1e",stroke:"none"}),e.player_image?s.jsxs(s.Fragment,{children:[s.jsx("defs",{children:s.jsx("clipPath",{id:`clip-away-${e.id}`,children:s.jsx("circle",{r:"3",cx:"0",cy:"0"})})}),s.jsx("image",{href:e.player_image,x:"-3",y:"-3",width:"6",height:"6",clipPath:`url(#clip-away-${e.id})`,preserveAspectRatio:"xMidYMid slice"})]}):s.jsx("text",{x:"0",y:"1",textAnchor:"middle",fill:"#e63946",fontSize:"2.2",fontWeight:"700",children:e.position||"?"}),s.jsx("text",{x:"0",y:"6.5",textAnchor:"middle",fill:"#e63946",fontSize:"1.8",fontWeight:"600",children:(null==(t=null==(a=e.name)?void 0:a.split(" ")[0])?void 0:t.substring(0,8))||(null==(i=null==(l=e.player_name)?void 0:l.split(" ")[0])?void 0:i.substring(0,8))||""}),d&&s.jsxs("g",{transform:"translate(2.7, -2.7)",children:[s.jsx("circle",{r:"1.2",fill:"#fff",opacity:"0.98"}),s.jsx("image",{href:"/assets/img/Muqawama/ball.svg",x:"-1.2",y:"-1.2",width:"2.4",height:"2.4",preserveAspectRatio:"xMidYMid meet"}),o.goalsScored>1&&s.jsxs("g",{children:[s.jsx("circle",{cx:"0.9",cy:"-0.9",r:"0.65",fill:"#fff",stroke:"#000",strokeWidth:"0.18"}),s.jsx("text",{x:"0.9",y:"-0.75",textAnchor:"middle",fontSize:"0.75",fill:"#000",fontWeight:"700",children:o.goalsScored})]})]}),m&&s.jsx("g",{transform:"translate(-2.7, -2.7)",children:s.jsx("image",{href:"/assets/img/Muqawama/Yellow_card.svg",x:"-1.2",y:"-1.2",width:"2.4",height:"2.4",preserveAspectRatio:"xMidYMid meet"})}),h&&s.jsx("g",{transform:"translate(2.7, 2.7)",children:s.jsx("image",{href:"/assets/img/Muqawama/Red_card.svg",x:"-1.2",y:"-1.2",width:"2.4",height:"2.4",preserveAspectRatio:"xMidYMid meet"})})]},`away-${e.id}`)})]})}),s.jsxs("div",{className:"formation-legend",children:[s.jsxs("div",{className:"legend-item home",children:[s.jsx("span",{className:"legend-dot home"}),s.jsxs("span",{children:[l.name||"Home"," ",l.formation&&`(${l.formation})`]})]}),s.jsxs("div",{className:"legend-item away",children:[s.jsx("span",{className:"legend-dot away"}),s.jsxs("span",{children:[i.name||"Away"," ",i.formation&&`(${i.formation})`]})]})]}),c&&s.jsx("div",{className:"player-modal-overlay",onClick:_,children:s.jsxs("div",{className:"player-modal-card",onClick:e=>e.stopPropagation(),children:[s.jsx("button",{className:"player-modal-close",onClick:_,children:s.jsx("i",{className:"fas fa-times"})}),s.jsxs("div",{className:"player-modal-header "+(d?"home":"away"),children:[s.jsxs("div",{className:"player-modal-image",children:[c.player_image?s.jsx("img",{src:c.player_image,alt:c.name||c.player_name}):s.jsx("div",{className:"player-modal-placeholder",children:s.jsx("i",{className:"fas fa-user"})}),s.jsx("div",{className:"player-modal-ring "+(d?"home":"away")})]}),s.jsx("h3",{className:"player-modal-name",children:c.name||c.player_name}),s.jsx("p",{className:"player-modal-team",children:d?l.name:i.name})]}),s.jsx("div",{className:"player-modal-stats",children:s.jsx("table",{className:"player-stats-table-modal",children:s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{className:"stat-label",children:"Position"}),s.jsx("td",{className:"stat-value",children:c.position||"N/A"})]}),f&&s.jsxs("tr",{children:[s.jsx("td",{className:"stat-label",children:"Age"}),s.jsxs("td",{className:"stat-value",children:[f," years"]})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"stat-label",children:"Goals"}),s.jsx("td",{className:"stat-value stat-highlight goals",children:(null==j?void 0:j.goalsScored)||0})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"stat-label",children:"Assists"}),s.jsx("td",{className:"stat-value stat-highlight assists",children:(null==j?void 0:j.assists)||0})]}),(null==j?void 0:j.yellowCards)>0&&s.jsxs("tr",{children:[s.jsx("td",{className:"stat-label",children:"Yellow Cards"}),s.jsx("td",{className:"stat-value stat-highlight yellow-card",children:j.yellowCards})]}),(null==j?void 0:j.redCards)>0&&s.jsxs("tr",{children:[s.jsx("td",{className:"stat-label",children:"Red Cards"}),s.jsx("td",{className:"stat-value stat-highlight red-card",children:j.redCards})]})]})})}),s.jsx("button",{className:"player-modal-view-btn",disabled:h,onClick:async()=>{if(!h){p(!0);try{const e=window.location.pathname.includes("/u17/")?"u17":"open-age";window.location.href=`/muqawamah/2026/${e}/players/?player=${c.id}`}catch(e){p(!1)}}},children:h?"Loading...":"View Full Details"})]})})]})}function o({matchId:t,onBack:l}){var n,o,d,m,h,p,u,x,y,g,_,j;const[f,w]=e.useState(null),[v,N]=e.useState([]),[b,M]=e.useState([]),[S,C]=e.useState([]),[q,k]=e.useState([]),[$,A]=e.useState(!0),[L,T]=e.useState(0),[D,E]=e.useState(null),[F,R]=e.useState([]),[B,P]=e.useState(null),[U,Y]=e.useState(!1),[z,I]=e.useState(!1),[W,G]=e.useState(null),[O,H]=e.useState({home:0,draw:0,away:0}),[V,K]=e.useState(!1),[Q,Z]=e.useState(null);e.useEffect(()=>{(()=>{let e=localStorage.getItem("user_identifier");if(!e){const a=document.createElement("canvas"),s=a.getContext("2d");s.textBaseline="top",s.font="14px Arial",s.fillText("Fingerprint",2,2);const t=a.toDataURL();e=btoa(navigator.userAgent+navigator.language+screen.width+screen.height+(new Date).getTimezoneOffset()+t).substring(0,32),localStorage.setItem("user_identifier",e)}E(e)})()},[]),e.useEffect(()=>{t&&J()},[t]),e.useEffect(()=>{t&&D&&f&&X()},[t,D,f]),e.useEffect(()=>{f&&"completed"!==f.status&&"live"!==f.status&&f.home_team_id&&f.away_team_id&&ae()},[f]),e.useEffect(()=>{if(f&&"completed"===f.status&&null!==f.home_score&&null!==f.away_score){const e=f.home_score??0,a=f.away_score??0;if(e!==a){const s=e>a?f.home_team:f.away_team;Z(s),K(!0);const t=setTimeout(()=>{K(!1)},5e3);return()=>clearTimeout(t)}}},[f]);const J=async()=>{var e,s;try{A(!0);const{data:l,error:i}=await a.from("matches").select("\n          *,\n          home_team:teams!matches_home_team_id_fkey(*),\n          away_team:teams!matches_away_team_id_fkey(*)\n        ").eq("id",t).single();if(i)throw i;w(l);const{data:r}=await a.from("goals").select("\n          id,\n          match_id,\n          team_id,\n          scorer_id,\n          assister_id,\n          minute,\n          goal_type,\n          scorer:team_players!goals_scorer_id_fkey(id, player_name, player_image),\n          assister:team_players!goals_assister_id_fkey(id, player_name, player_image)\n        ").eq("match_id",t).order("minute",{ascending:!0});if(r){const e=await Promise.all(r.map(async e=>{var s,t,l,i;let r=(null==(s=e.scorer)?void 0:s.player_name)||null,n=(null==(t=e.assister)?void 0:t.player_name)||null,c=(null==(l=e.scorer)?void 0:l.player_image)||null,o=(null==(i=e.assister)?void 0:i.player_image)||null;if(e.scorer_id&&!r){const{data:s}=await a.from("players").select("name, player_image").eq("registration_player_id",e.scorer_id).maybeSingle();s&&(r=s.name||s.player_name,c=s.player_image||c)}if(e.assister_id&&!n){const{data:s}=await a.from("players").select("name, player_image").eq("registration_player_id",e.assister_id).maybeSingle();s&&(n=s.name||s.player_name,o=s.player_image||o)}return{...e,scorer:r?{player_name:r,player_image:c}:null,assister:n?{player_name:n,player_image:o}:null}}));C(e)}const{data:n}=await a.from("cards").select("\n          id,\n          match_id,\n          team_id,\n          player_id,\n          card_type,\n          minute,\n          player:team_players!cards_player_id_fkey(id, player_name, player_image)\n        ").eq("match_id",t).order("minute",{ascending:!0});if(n){const e=await Promise.all(n.map(async e=>{var s;let t=(null==(s=e.player)?void 0:s.player_name)||null;if(e.player_id&&!t){const{data:s}=await a.from("players").select("name, player_image").eq("registration_player_id",e.player_id).maybeSingle();s&&(t=s.name||s.player_name)}return{...e,player:t?{player_name:t}:null}}));k(e)}if(null==(e=l.home_team)?void 0:e.id){const{data:e}=await a.from("players").select("*").eq("team_id",l.home_team.id).order("position");e&&N(e)}if(null==(s=l.away_team)?void 0:s.id){const{data:e}=await a.from("players").select("*").eq("team_id",l.away_team.id).order("position");e&&M(e)}}catch(l){}finally{A(!1)}},X=async()=>{if(t&&D&&f)try{const{data:e}=await a.from("match_likes").select("id").eq("match_id",t);T(e?e.length:0);const{data:s}=await a.from("match_predictions").select("prediction").eq("match_id",t);if(s){const e={home:s.filter(e=>"home"===e.prediction).length,draw:s.filter(e=>"draw"===e.prediction).length,away:s.filter(e=>"away"===e.prediction).length};H(e);const{data:l}=await a.from("match_predictions").select("prediction").eq("match_id",t).eq("user_identifier",D).maybeSingle();l&&G(l.prediction)}}catch(e){}},ee=async e=>{if(t&&D&&f)try{const{data:s}=await a.from("match_predictions").select("id, prediction").eq("match_id",t).eq("user_identifier",D).maybeSingle();if(s)if(s.prediction===e){await a.from("match_predictions").delete().eq("id",s.id),G(null);const t={...O};t[e]=Math.max(0,t[e]-1),H(t)}else{await a.from("match_predictions").update({prediction:e}).eq("id",s.id),G(e);const t={...O};t[s.prediction]=Math.max(0,t[s.prediction]-1),t[e]=(t[e]||0)+1,H(t)}else{await a.from("match_predictions").insert({match_id:t,user_identifier:D,prediction:e}),G(e);const s={...O};s[e]=(s[e]||0)+1,H(s)}await X()}catch(s){}},ae=async()=>{if(f&&f.home_team_id&&f.away_team_id){Y(!0);try{const{data:e}=await a.from("teams").select("*").eq("id",f.home_team_id).single(),{data:s}=await a.from("teams").select("*").eq("id",f.away_team_id).single();if(!e||!s)return void Y(!1);const{data:t}=await a.from("matches").select("home_score, away_score, home_team_id, away_team_id").or(`home_team_id.eq.${f.home_team_id},away_team_id.eq.${f.home_team_id}`).eq("status","completed").order("match_date",{ascending:!1}).limit(2),{data:l}=await a.from("matches").select("home_score, away_score, home_team_id, away_team_id").or(`home_team_id.eq.${f.away_team_id},away_team_id.eq.${f.away_team_id}`).eq("status","completed").order("match_date",{ascending:!1}).limit(2);let i=0,r=0,n=0;t&&t.length>0&&t.forEach(e=>{e.home_team_id===f.home_team_id?(i+=e.home_score||0,r+=e.away_score||0,n++):(i+=e.away_score||0,r+=e.home_score||0,n++)});let c=0,o=0,d=0;l&&l.length>0&&l.forEach(e=>{e.home_team_id===f.away_team_id?(c+=e.home_score||0,o+=e.away_score||0,d++):(c+=e.away_score||0,o+=e.home_score||0,d++)});const{data:m}=await a.from("teams").select("goals_for, goals_against, played").eq("category",f.category||"open-age").gt("played",0);let h=1.5,p=1.5;if(m&&m.length>0){const e=m.reduce((e,a)=>e+(a.goals_for||0),0),a=m.reduce((e,a)=>e+(a.goals_against||0),0),s=m.reduce((e,a)=>e+(a.played||0),0);s>0&&(h=e/s,p=a/s)}const u=n>0?i/n:e.played>0?(e.goals_for||0)/e.played:h,x=n>0?r/n:e.played>0?(e.goals_against||0)/e.played:p,y=d>0?c/d:s.played>0?(s.goals_for||0)/s.played:h,g=d>0?o/d:s.played>0?(s.goals_against||0)/s.played:p,_=0===n&&0===e.played?1:h>0?u/h:1,j=0===n&&0===e.played?1:p>0?x/p:1,w=0===d&&0===s.played?1:h>0?y/h:1,v=0===d&&0===s.played?1:p>0?g/p:1,N=_*(1/v)*h*1.12,b=w*(1/j)*h,M=Math.round(N),S=Math.round(b),C=(e,a)=>{if(e<=0)return 0===a?1:0;let s=-e+a*Math.log(e);for(let t=2;t<=a;t++)s-=Math.log(t);return Math.exp(s)};let q=0,k=0,$=0;for(let a=0;a<=5;a++)for(let e=0;e<=5;e++){const s=C(N,a)*C(b,e);a>e?q+=s:a===e?k+=s:$+=s}const A=q+k+$;A>0?(q=q/A*100,k=k/A*100,$=$/A*100):(q=33.33,k=33.33,$=33.34),P({homeScore:Math.max(0,M),awayScore:Math.max(0,S),homeWinProb:Math.round(q),drawProb:Math.round(k),awayWinProb:Math.round($),homeTeam:e.name,awayTeam:s.name})}catch(e){}finally{Y(!1)}}},se=(e,a)=>{const s=Date.now()+Math.random()+e,t={id:s,horizontalOffset:e/a*20-10,delay:.15*e};R(e=>[...e,t]),setTimeout(()=>{R(e=>e.filter(e=>e.id!==s))},3e3)},te=e=>{const a=["GK","CB","LB","RB","CDM","CM","CAM","LM","RM","CF","ST","SUB"];return[...e].sort((e,s)=>{const t=a.indexOf(e.position),l=a.indexOf(s.position);return(-1===t?99:t)-(-1===l?99:l)})},le=e=>{if(!e)return{goalsScored:0,assists:0,yellowCards:0,redCards:0};let a=0,s=0,t=0,l=0;const i=e.name||e.player_name||"",r=e.registration_player_id;return S.forEach(e=>{var t,l;let n=!1,c=!1;if(r&&(e.scorer_id===r&&(n=!0),e.assister_id===r&&(c=!0)),!n&&!c){const a=(null==(t=e.scorer)?void 0:t.player_name)||"",s=(null==(l=e.assister)?void 0:l.player_name)||"";a&&i&&a.toLowerCase().trim()===i.toLowerCase().trim()&&(n=!0),s&&i&&s.toLowerCase().trim()===i.toLowerCase().trim()&&(c=!0)}n&&a++,c&&s++}),q&&q.length>0&&q.forEach(e=>{var a;let s=!1;if(r&&e.player_id===r&&(s=!0),!s){const t=(null==(a=e.player)?void 0:a.player_name)||"";t&&i&&t.toLowerCase().trim()===i.toLowerCase().trim()&&(s=!0)}s&&("yellow"===e.card_type&&t++,"red"===e.card_type&&l++)}),{goalsScored:a,assists:s,yellowCards:t,redCards:l}};if($)return s.jsxs(s.Fragment,{children:[s.jsx(i,{}),s.jsx("div",{className:"match-detail-loading",children:s.jsxs("div",{className:"fixtures-loading-content",children:[s.jsxs("div",{className:"logo-loader",children:[s.jsx("div",{className:"logo-ring"}),s.jsx("img",{src:"/assets/img/MuqawamaLogo.png",alt:"Muqawama",className:"logo-pulse"})]}),s.jsx("p",{children:"Loading match details..."})]})}),s.jsx(r,{edition:"2026"})]});if(!f)return s.jsxs(s.Fragment,{children:[s.jsx(i,{}),s.jsxs("div",{className:"match-detail-error",children:[s.jsx("i",{className:"fas fa-exclamation-triangle"}),s.jsx("p",{children:"Match not found"})]}),s.jsx(r,{edition:"2026"})]});const ie="completed"===f.status,re="live"===f.status,ne=ie||re;(()=>{const e={};S.forEach(a=>{var s,t;if(null==(s=a.scorer)?void 0:s.player_name){const s=a.scorer.player_name;e[s]||(e[s]={name:s,goals:0,assists:0,team_id:a.team_id}),e[s].goals+=1}if(null==(t=a.assister)?void 0:t.player_name){const s=a.assister.player_name;e[s]||(e[s]={name:s,goals:0,assists:0,team_id:a.team_id}),e[s].assists+=1}}),Object.values(e).sort((e,a)=>a.goals!==e.goals?a.goals-e.goals:a.assists-e.assists)})();const ce="completed"===f.status?{label:"FULL TIME",className:"status-completed"}:"live"===f.status?{label:"LIVE",className:"status-live"}:"scheduled"===f.status?{label:"SCHEDULED",className:"status-scheduled"}:{label:"UPCOMING",className:"status-scheduled"};return s.jsxs(s.Fragment,{children:[s.jsx(i,{}),s.jsxs("div",{className:"match-detail-page",children:[s.jsxs("button",{className:"match-like-button-sticky",onClick:async()=>{if(!t||!D)return;const e=3+Math.floor(3*Math.random());for(let a=0;a<e;a++)setTimeout(()=>{se(a,e)},80*a);T(e=>e+1);try{await a.from("match_likes").insert({match_id:t,user_identifier:D})}catch(s){}},title:"Show your support for this match",children:[s.jsx("i",{className:"fas fa-heart"}),L>0&&s.jsx("span",{className:"like-count-badge",children:L})]}),s.jsx("div",{className:"flying-hearts-container",children:F.map(e=>s.jsx("div",{className:"flying-heart",style:{"--horizontal-offset":`${e.horizontalOffset||0}px`,"--delay":`${e.delay||0}s`},children:s.jsx("i",{className:"fas fa-heart"})},e.id))}),s.jsx("section",{className:"match-header-section",children:s.jsxs("div",{className:"match-header-content",children:[s.jsxs("div",{className:"match-datetime",children:[s.jsx("p",{className:"match-date",children:(e=>{if(!e)return"TBD";return new Date(e).toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long"}).toUpperCase()})(f.match_date)}),s.jsx("p",{className:"match-time",children:(oe=f.scheduled_time,oe?oe.substring(0,5):"TBD")})]}),s.jsxs("div",{className:"match-teams-header",children:[s.jsxs("div",{className:"header-team home",children:[s.jsx("div",{className:"team-logo-large",children:(null==(n=f.home_team)?void 0:n.crest_url)?s.jsx("img",{src:f.home_team.crest_url,alt:f.home_team.name,loading:"lazy"}):s.jsx("span",{children:(null==(d=null==(o=f.home_team)?void 0:o.name)?void 0:d.charAt(0))||"?"})}),s.jsx("h4",{className:"team-name-header",children:(null==(m=f.home_team)?void 0:m.name)||"TBD"})]}),s.jsxs("div",{className:"match-score-header",children:[ne?s.jsxs("span",{className:"score-big "+(re?"live":""),children:[f.home_score??0," - ",f.away_score??0]}):s.jsx("span",{className:"score-vs",children:"VS"}),s.jsx("span",{className:"match-type-label",children:(()=>{var e;const a=null==(e=f.match_type)?void 0:e.toLowerCase();return a&&"group"!==a?"quarter-final"===a||"quarterfinal"===a?"Quarter Final":"semi-final"===a||"semifinal"===a?"Semi Final":"final"===a?"Final":"third-place"===a||"thirdplace"===a?"3rd Place":a.charAt(0).toUpperCase()+a.slice(1):"Group Stage"})()}),s.jsx("span",{className:`match-status-badge-detail ${ce.className}`,children:ce.label})]}),s.jsxs("div",{className:"header-team away",children:[s.jsx("div",{className:"team-logo-large",children:(null==(h=f.away_team)?void 0:h.crest_url)?s.jsx("img",{src:f.away_team.crest_url,alt:f.away_team.name,loading:"lazy"}):s.jsx("span",{children:(null==(u=null==(p=f.away_team)?void 0:p.name)?void 0:u.charAt(0))||"?"})}),s.jsx("h4",{className:"team-name-header",children:(null==(x=f.away_team)?void 0:x.name)||"TBD"})]})]}),ie&&V&&Q&&s.jsxs("div",{className:"winner-celebration",children:[s.jsx("div",{className:"firecrackers-container",children:[...Array(50)].map((e,a)=>{const t=360*Math.random()*(Math.PI/180),l=150+200*Math.random(),i=Math.cos(t)*l,r=Math.sin(t)*l,n=.5*Math.random(),c=1.5+.5*Math.random();return s.jsx("div",{className:"firecracker-spark",style:{left:30+40*Math.random()+"%",bottom:15+15*Math.random()+"%","--animation-delay":`${n}s`,"--animation-duration":`${c}s`,"--spark-x":`${i}px`,"--spark-y":-r+"px","--spark-color":a%5==0?"#ff6b6b":a%5==1?"#4ecdc4":a%5==2?"#ffe66d":a%5==3?"#ff9ff3":"#95e1d3"}},a)})}),s.jsxs("div",{className:"winner-announcement",children:[s.jsx("div",{className:"winner-trophy",children:s.jsx("i",{className:"fas fa-trophy"})}),s.jsx("h2",{className:"winner-text",children:Q.name}),s.jsx("p",{className:"winner-subtitle",children:"WINNER"})]})]}),!ie&&s.jsx("div",{className:"match-prediction-bar",children:s.jsx("div",{className:"prediction-content",children:s.jsx("div",{className:"prediction-bars-compact",children:(()=>{var e,a,t,l,i,r;const n=O.home+O.draw+O.away,c=n>0?Math.round(O.home/n*100):0,o=n>0?Math.round(O.draw/n*100):0,d=n>0?Math.round(O.away/n*100):0;return s.jsxs("div",{className:"prediction-bar-item",children:[s.jsxs("div",{className:"prediction-bar-label",children:[s.jsx("i",{className:"fas fa-users"}),s.jsx("span",{children:"Community Predictions"})]}),s.jsxs("div",{className:"user-prediction-probability-bar compact",children:[s.jsx("div",{className:"user-prob-segment home-win",style:{width:`${c}%`},title:`${(null==(e=f.home_team)?void 0:e.name)||"Home"} ${c}%${n>0?` (${O.home} votes)`:""}`,children:c>10&&s.jsxs("span",{className:"user-prob-label",children:[c,"%"]})}),s.jsx("div",{className:"user-prob-segment draw",style:{width:`${o}%`},title:`Draw ${o}%${n>0?` (${O.draw} votes)`:""}`,children:o>10&&s.jsxs("span",{className:"user-prob-label",children:[o,"%"]})}),s.jsx("div",{className:"user-prob-segment away-win",style:{width:`${d}%`},title:`${(null==(a=f.away_team)?void 0:a.name)||"Away"} ${d}%${n>0?` (${O.away} votes)`:""}`,children:d>10&&s.jsxs("span",{className:"user-prob-label",children:[d,"%"]})})]}),!W&&s.jsxs("div",{className:"user-prediction-buttons-compact",style:{marginTop:"12px"},children:[s.jsxs("button",{className:"user-pred-btn-compact home",onClick:()=>ee("home"),title:`${(null==(t=f.home_team)?void 0:t.name)||"Home"} to win`,children:[s.jsx("i",{className:"fas fa-trophy"}),s.jsx("span",{children:(null==(l=f.home_team)?void 0:l.name)||"Home"})]}),s.jsxs("button",{className:"user-pred-btn-compact draw",onClick:()=>ee("draw"),title:"Draw",children:[s.jsx("i",{className:"fas fa-equals"}),s.jsx("span",{children:"Draw"})]}),s.jsxs("button",{className:"user-pred-btn-compact away",onClick:()=>ee("away"),title:`${(null==(i=f.away_team)?void 0:i.name)||"Away"} to win`,children:[s.jsx("i",{className:"fas fa-trophy"}),s.jsx("span",{children:(null==(r=f.away_team)?void 0:r.name)||"Away"})]})]})]})})()})})}),s.jsxs("div",{className:"match-meta",children:[s.jsxs("p",{className:"matchday-label",children:["MATCHDAY ",f.match_number||1]}),f.venue&&s.jsx("p",{className:"venue-label",children:f.venue})]})]})}),s.jsx("section",{className:"match-detail-content",children:s.jsxs("div",{className:"match-detail-single-column",children:[s.jsxs("div",{className:"goals-panel-compact",children:[s.jsxs("h3",{className:"panel-title-compact",children:[s.jsx("i",{className:"fas fa-futbol"}),"Goals & Highlights"]}),S.length>0||q.length>0?s.jsx("div",{className:"goals-list-compact",children:[...S.map(e=>({...e,type:"goal"})),...q.map(e=>({...e,type:"card"}))].sort((e,a)=>(e.minute||0)-(a.minute||0)).map((e,a)=>{var t,l,i,r,n,c,o;if("goal"===e.type){const n=e.team_id===f.home_team_id;return s.jsxs("div",{className:"goal-row-compact "+(n?"home":"away"),children:[s.jsxs("span",{className:"goal-minute-compact",children:[e.minute,"'"]}),s.jsx("span",{className:"goal-icon-compact",children:s.jsx("i",{className:"fas fa-futbol"})}),s.jsx("span",{className:"goal-scorer-compact",children:(null==(t=e.scorer)?void 0:t.player_name)||"Unknown"}),(null==(l=e.assister)?void 0:l.player_name)&&s.jsxs("span",{className:"goal-assist-compact",children:["(",e.assister.player_name,")"]}),s.jsx("span",{className:"goal-team-compact",children:n?null==(i=f.home_team)?void 0:i.name:null==(r=f.away_team)?void 0:r.name})]},`goal-${e.id||a}`)}{const t=e.team_id===f.home_team_id;return s.jsxs("div",{className:"card-row-compact "+(t?"home":"away"),children:[s.jsxs("span",{className:"goal-minute-compact",children:[e.minute,"'"]}),s.jsx("span",{className:`card-icon-compact ${e.card_type}`,children:"yellow"===e.card_type?s.jsx("i",{className:"fas fa-square",style:{color:"#ffd700"}}):s.jsx("i",{className:"fas fa-square",style:{color:"#ff0000"}})}),s.jsx("span",{className:"goal-scorer-compact",children:(null==(n=e.player)?void 0:n.player_name)||"Unknown"}),s.jsx("span",{className:"goal-team-compact",children:t?null==(c=f.home_team)?void 0:c.name:null==(o=f.away_team)?void 0:o.name})]},`card-${e.id||a}`)}})}):s.jsx("p",{className:"no-goals-compact",children:ie?"No events":"Events will appear here"})]}),s.jsxs("div",{className:"formation-section",children:[s.jsx("h3",{className:"panel-title",children:"FORMATIONS"}),s.jsx(c,{homePlayers:v,awayPlayers:b,homeTeam:f.home_team,awayTeam:f.away_team,goals:S,cards:q})]}),s.jsxs("div",{className:"squads-section",children:[s.jsx("h3",{className:"panel-title",children:"SQUADS"}),s.jsxs("div",{className:"squads-grid",children:[s.jsxs("div",{className:"squad-column home",children:[s.jsxs("div",{className:"squad-header",children:[(null==(y=f.home_team)?void 0:y.crest_url)&&s.jsx("img",{src:f.home_team.crest_url,alt:"",className:"squad-team-logo",loading:"lazy"}),s.jsx("span",{children:null==(g=f.home_team)?void 0:g.name})]}),s.jsxs("div",{className:"squad-list",children:[te(v).map((e,a)=>{const t=le(e);return s.jsxs("div",{className:"squad-player-row "+("SUB"===e.position||e.is_substitute?"substitute":""),children:[s.jsx("span",{className:"player-name",children:e.name||e.player_name||"Unknown"}),s.jsxs("div",{className:"player-stats-icons",children:[t.goalsScored>0&&s.jsxs("span",{className:"stat-icon goal-icon",title:`${t.goalsScored} goal${t.goalsScored>1?"s":""}`,children:[s.jsx("span",{className:"ball-icon-wrapper",children:s.jsx("img",{src:"/assets/img/Muqawama/ball.svg",alt:"Goal",style:{width:"16px",height:"16px"}})}),t.goalsScored>1&&s.jsx("span",{className:"stat-count-badge",children:t.goalsScored})]}),t.yellowCards>0&&s.jsxs("span",{className:"stat-icon yellow-card-icon",title:`${t.yellowCards} yellow card${t.yellowCards>1?"s":""}`,children:[s.jsx("img",{src:"/assets/img/Muqawama/Yellow_card.svg",alt:"Yellow Card",style:{width:"14px",height:"14px"}}),t.yellowCards>1&&s.jsx("span",{className:"stat-count-badge",children:t.yellowCards})]}),t.redCards>0&&s.jsxs("span",{className:"stat-icon red-card-icon",title:`${t.redCards} red card${t.redCards>1?"s":""}`,children:[s.jsx("img",{src:"/assets/img/Muqawama/Red_card.svg",alt:"Red Card",style:{width:"14px",height:"14px"}}),t.redCards>1&&s.jsx("span",{className:"stat-count-badge",children:t.redCards})]})]})]},e.id)}),0===v.length&&s.jsx("p",{className:"no-squad",children:"Squad not available"})]})]}),s.jsxs("div",{className:"squad-column away",children:[s.jsxs("div",{className:"squad-header away",children:[s.jsx("span",{children:null==(_=f.away_team)?void 0:_.name}),(null==(j=f.away_team)?void 0:j.crest_url)&&s.jsx("img",{src:f.away_team.crest_url,alt:"",className:"squad-team-logo",loading:"lazy"})]}),s.jsxs("div",{className:"squad-list",children:[te(b).map((e,a)=>{const t=le(e);return s.jsxs("div",{className:"squad-player-row "+("SUB"===e.position||e.is_substitute?"substitute":""),children:[s.jsx("span",{className:"player-name",children:e.name||e.player_name||"Unknown"}),s.jsxs("div",{className:"player-stats-icons",children:[t.goalsScored>0&&s.jsxs("span",{className:"stat-icon goal-icon",title:`${t.goalsScored} goal${t.goalsScored>1?"s":""}`,children:[s.jsx("span",{className:"ball-icon-wrapper",children:s.jsx("img",{src:"/assets/img/Muqawama/ball.svg",alt:"Goal",style:{width:"16px",height:"16px"}})}),t.goalsScored>1&&s.jsx("span",{className:"stat-count-badge",children:t.goalsScored})]}),t.yellowCards>0&&s.jsxs("span",{className:"stat-icon yellow-card-icon",title:`${t.yellowCards} yellow card${t.yellowCards>1?"s":""}`,children:[s.jsx("img",{src:"/assets/img/Muqawama/Yellow_card.svg",alt:"Yellow Card",style:{width:"14px",height:"14px"}}),t.yellowCards>1&&s.jsx("span",{className:"stat-count-badge",children:t.yellowCards})]}),t.redCards>0&&s.jsxs("span",{className:"stat-icon red-card-icon",title:`${t.redCards} red card${t.redCards>1?"s":""}`,children:[s.jsx("img",{src:"/assets/img/Muqawama/Red_card.svg",alt:"Red Card",style:{width:"14px",height:"14px"}}),t.redCards>1&&s.jsx("span",{className:"stat-count-badge",children:t.redCards})]})]})]},e.id)}),0===b.length&&s.jsx("p",{className:"no-squad",children:"Squad not available"})]})]})]})]})]})}),s.jsx("div",{className:"match-detail-footer"})]}),s.jsx(r,{edition:"2026"})]});var oe}function d(){const[a,t]=e.useState("list"),[l,i]=e.useState(null);e.useEffect(()=>{const e=new URLSearchParams(window.location.search).get("match");return e&&(i(e),t("detail")),window.addEventListener("popstate",r),()=>window.removeEventListener("popstate",r)},[]);const r=()=>{const e=new URLSearchParams(window.location.search).get("match");e?(i(e),t("detail")):(t("list"),i(null))},c=()=>{const e=window.location.pathname;window.history.pushState({},"",e),t("list"),i(null)};return"detail"===a&&l?s.jsx(o,{matchId:l,onBack:c}):s.jsx(n,{onMatchClick:e=>{const a=`${window.location.pathname}?match=${e}`;window.history.pushState({matchId:e},"",a),i(e),t("detail"),window.scrollTo(0,0)}})}t.createRoot(document.getElementById("fixtures-root")).render(s.jsx(l.StrictMode,{children:s.jsx(d,{})}));
