import{s as a}from"./supabaseClient-BTiblPWy.js";async function e(e,t=null){try{let r=a.from("teams").select("*").eq("category",e);t&&(r=r.eq("tournament_group",t));const{data:o,error:n}=await r;if(n)throw n;const c=await Promise.all((o||[]).map(async t=>{const r=await async function(e,t){try{const{data:r,error:o}=await a.from("cards").select("\n        card_type,\n        match:matches!cards_match_id_fkey(match_type, category)\n      ").eq("team_id",e);if(o)throw o;const n=(r||[]).filter(a=>{var e,r;return"group"===(null==(e=a.match)?void 0:e.match_type)&&(null==(r=a.match)?void 0:r.category)===t});return{yellow_cards:n.filter(a=>"yellow"===a.card_type).length,red_cards:n.filter(a=>"red"===a.card_type).length}}catch(r){return{yellow_cards:0,red_cards:0}}}(t.id,e);return{...t,yellow_cards:t.yellow_cards||r.yellow_cards,red_cards:t.red_cards||r.red_cards,goal_difference:(t.goals_for||0)-(t.goals_against||0)}})),s=c.map(a=>a.id),i=await async function(e,t){try{const{data:r,error:o}=await a.from("matches").select("home_team_id, away_team_id, home_score, away_score, status").eq("category",t).eq("match_type","group").eq("status","completed").or(e.map(a=>`home_team_id.eq.${a}`).join(",")+","+e.map(a=>`away_team_id.eq.${a}`).join(","));if(o)throw o;const n={};return(r||[]).forEach(a=>{if(e.includes(a.home_team_id)&&e.includes(a.away_team_id)){const e=`${a.home_team_id}_${a.away_team_id}`;let t=null;a.home_score>a.away_score?t=a.home_team_id:a.away_score>a.home_score&&(t=a.away_team_id),n[e]={home_score:a.home_score,away_score:a.away_score,winner:t}}}),n}catch(r){return{}}}(s,e),_={};return c.forEach(a=>{const e=a.tournament_group||"Ungrouped";_[e]||(_[e]=[]),_[e].push(a)}),Object.keys(_).forEach(a=>{_[a].sort((a,e)=>function(a,e,t=null){if(a.points!==e.points)return e.points-a.points;const r=(a.goals_for||0)-(a.goals_against||0),o=(e.goals_for||0)-(e.goals_against||0);if(r!==o)return o-r;if((a.goals_for||0)!==(e.goals_for||0))return(e.goals_for||0)-(a.goals_for||0);if(t){const r=`${a.id}_${e.id}`,o=`${e.id}_${a.id}`;if(t[r]){const o=t[r];if(o.winner===a.id)return-1;if(o.winner===e.id)return 1}else if(t[o]){const r=t[o];if(r.winner===a.id)return-1;if(r.winner===e.id)return 1}}const n=a.yellow_cards||0,c=e.yellow_cards||0;if(n!==c)return n-c;const s=a.red_cards||0,i=e.red_cards||0;return s!==i?s-i:(a.name||"").localeCompare(e.name||"")}(a,e,i)),_[a]=_[a].map((a,e)=>({...a,group_position:e+1}))}),_}catch(r){return{}}}async function t(e){try{const{data:t,error:r}=await a.from("tournament_settings").select("*").eq("category",e).single();if(r&&"PGRST116"!==r.code)throw r;return t||{total_groups:4,teams_per_group:3,teams_qualifying_per_group:2,knockout_format:"quarter-final",group_stage_complete:!1}}catch(t){return{total_groups:4,teams_per_group:3,teams_qualifying_per_group:2,knockout_format:"quarter-final",group_stage_complete:!1}}}async function r(e){try{const{data:t,error:r}=await a.from("knockout_bracket").select("\n        *,\n        home_team:teams!knockout_bracket_home_team_id_fkey(id, name, crest_url),\n        away_team:teams!knockout_bracket_away_team_id_fkey(id, name, crest_url),\n        match:matches!knockout_bracket_match_id_fkey(\n          id, home_score, away_score, status, match_date, scheduled_time\n        )\n      ").eq("category",e).order("round").order("match_number");if(r)throw r;const o={"quarter-final":[],"semi-final":[],"third-place":[],final:[]};return(t||[]).forEach(a=>{o[a.round]&&o[a.round].push(a)}),o}catch(t){return{"quarter-final":[],"semi-final":[],"third-place":[],final:[]}}}const o={quarterFinals:[{match:1,home:"A1",away:"B2"},{match:2,home:"B1",away:"A2"},{match:3,home:"C1",away:"D2"},{match:4,home:"D1",away:"C2"}],semiFinals:[{match:1,home:"QF1",away:"QF3"},{match:2,home:"QF2",away:"QF4"}],final:{home:"SF1",away:"SF2"},thirdPlace:{home:"SF1L",away:"SF2L"}};async function n(e){try{const{data:t,error:r}=await a.from("matches").select("id, status").eq("category",e).eq("match_type","group");if(r)throw r;const o=t||[],n=o.filter(a=>"completed"===a.status);return{total:o.length,completed:n.length,isComplete:o.length>0&&n.length===o.length}}catch(t){return{total:0,completed:0,isComplete:!1}}}export{o as S,e as a,r as b,t as g,n as i};
