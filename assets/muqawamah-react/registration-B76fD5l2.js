import{r as e,j as a,s,R as t,c as i}from"./supabaseClient-y7L7r4ir.js";import{a as n,p as l,F as r,c,g as o}from"./Registration-BDl0QEOt.js";/* empty css            */import"./supabase-client-FID_-7ME.js";function m({onSuccess:t}){const[i,n]=e.useState(""),[l,r]=e.useState(!1);return a.jsx("div",{className:"auth-modal",children:a.jsxs("div",{className:"auth-card",children:[a.jsx("div",{className:"auth-logo",children:a.jsx("img",{src:"/assets/img/title.png",alt:"Muqawama 2026"})}),a.jsx("h2",{children:"Welcome to Muqawama 2026"}),a.jsx("p",{className:"auth-subtitle",children:"Sign in with your Google account to register your team and manage your registration."}),i&&a.jsx("p",{className:"auth-error",children:i}),a.jsx("div",{className:"auth-alternative",children:a.jsx("button",{type:"button",className:"auth-oauth-btn google-btn",onClick:async()=>{n(""),r(!0);try{const{data:e,error:a}=await s.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.origin+"/muqawamah/2026/register/"}});if(a)throw a}catch(e){n(`Google sign-in failed: ${e.message}. Please contact support.`),r(!1)}},disabled:l,children:l?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"spinner-small"})," Signing in..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fab fa-google"})," Continue with Google"]})})}),a.jsxs("p",{className:"auth-note",children:[a.jsx("i",{className:"fas fa-info-circle"})," Your Google account will be used to authenticate and save your team registration."]})]})})}const d=e.createContext(null),h=()=>{const a=e.useContext(d);if(!a)throw new Error("useRegistration must be used within RegistrationProvider");return a},u=()=>[...["GK","CB","LB","RB","CM","LM","ST"].map((e,a)=>({id:`${e}-${a}`,name:"",age:"",aadhar_no:"",position:e,isSubstitute:!1,image:null,x:50,y:50})),...["SUB1","SUB2","SUB3","SUB4"].map((e,a)=>({id:`${e}-${a}`,name:"",age:"",aadhar_no:"",position:"SUB",isSubstitute:!0,image:null,x:10+20*a,y:90}))],p={teamName:"",category:"open-age",teamLogo:null,teamLogoFileName:null,captainName:"",captainEmail:"",captainPhone:"",formation:"1-3-2-1"},x=({children:t})=>{const[i,n]=e.useState(1),[l,r]=e.useState(p),[c,o]=e.useState(u()),[m,h]=e.useState(!1),[x,g]=e.useState(!1),[j,f]=e.useState(null),[N,y]=e.useState(null),[v,b]=e.useState(null),[w,S]=e.useState(!1),[_,P]=e.useState(null),[C,k]=e.useState(null),[q,T]=e.useState(0),L=()=>{r(p),o(u()),y(null),b(null),P(null),k(null),T(0),n(1)},F=e.useCallback(async e=>{g(!0),f(null);try{const{data:{user:a}}=await s.auth.getUser();if(!a)throw new Error("You must be logged in to save your progress.");let t=v;const i={user_id:a.id,team_name:l.teamName||"Draft Team",category:l.category,team_logo:l.teamLogo,captain_name:l.captainName,captain_email:l.captainEmail||a.email,captain_phone:l.captainPhone,formation:l.formation,status:"submitted",last_saved_step:e,submitted_at:(new Date).toISOString()};if(v){const{error:e}=await s.from("team_registrations").update(i).eq("id",v);if(e)throw e}else{const{data:e,error:a}=await s.from("team_registrations").insert(i).select().single();if(a)throw a;t=e.id,b(t)}const n=c.filter(e=>e.name&&""!==e.name.trim());if(n.length>0&&t){await s.from("team_players").delete().eq("team_id",t);const e=n.map(e=>({team_id:t,player_name:e.name,player_age:e.age?parseInt(e.age):null,aadhar_no:e.aadhar_no||null,position:e.position||"SUB",is_substitute:e.isSubstitute||!1,player_image:e.image||null,position_x:"number"!=typeof e.x||isNaN(e.x)?50:e.x,position_y:"number"!=typeof e.y||isNaN(e.y)?50:e.y})),{error:a}=await s.from("team_players").insert(e);if(a)throw a}return T(e),{success:!0,teamId:t}}catch(a){return f(a.message),{success:!1,error:a.message}}finally{g(!1)}},[v,l,c]),E=e.useMemo(()=>({step:i,setStep:n,teamData:l,setTeamData:r,players:c,setPlayers:o,loading:m,setLoading:h,saving:x,setSaving:g,error:j,setError:f,successTeamId:N,setSuccessTeamId:y,existingTeamId:v,setExistingTeamId:b,readOnlyMode:w,setReadOnlyMode:S,paymentStatus:_,setPaymentStatus:P,transactionId:C,setTransactionId:k,lastSavedStep:q,setLastSavedStep:T,resetForm:L,saveProgress:F}),[i,l,c,m,x,j,N,v,w,_,C,q,F]);return a.jsx(d.Provider,{value:E,children:t})};function g(){const{players:s,setPlayers:t,teamData:i,setTeamData:c,setStep:o,saveProgress:m,saving:d,error:u}=h(),p=e.useRef(null),[x,g]=e.useState(null),[j,f]=e.useState(!1),N=e.useCallback((e,a,i)=>{const n="number"!=typeof a||isNaN(a)?50:a,l="number"!=typeof i||isNaN(i)?50:i,r=s.find(a=>a.id===e);"GK"!==(null==r?void 0:r.position)&&t(a=>a.map(a=>a.id===e?{...a,x:n,y:l}:a))},[t,s]),y=e.useCallback((e,a)=>{const t=s.find(e=>e.id===a);"GK"!==(null==t?void 0:t.position)&&g(a)},[s]),v=e.useCallback(e=>{const a=p.current;if(!x||!a)return;e.preventDefault();const s=a.querySelector("svg");if(!s)return;const t=s.getBoundingClientRect(),i=e.touches?e.touches[0].clientX:e.clientX,n=e.touches?e.touches[0].clientY:e.clientY,l=(i-t.left)/t.width*100,r=(n-t.top)/t.height*100,c=Math.min(Math.max(l,0),100),o=Math.min(Math.max(r,0),100);N(x,c,o)},[x,N]),b=e.useCallback(()=>{g(null)},[]);e.useEffect(()=>{if(!j&&i.formation&&s.length>0){const e=n(s,i.formation);t(e),f(!0)}},[]);return a.jsxs("form",{className:"registration-form",onSubmit:async e=>{e.preventDefault();(await m(3)).success&&o(4)},children:[a.jsx("h3",{children:"Step 3 · Formation & Positions"}),a.jsx("p",{className:"step-description",children:"Choose a preset formation below, then drag players to customize positions."}),a.jsxs("div",{className:"formation-instruction-box",children:[a.jsx("div",{className:"instruction-icon",children:a.jsx("i",{className:"fas fa-hand-pointer"})}),a.jsxs("div",{className:"instruction-content",children:[a.jsx("strong",{className:"instruction-title",children:"Interactive Field"}),a.jsx("p",{className:"instruction-text",children:"Click and drag any player to reposition them (GK is locked)"})]})]}),a.jsxs("div",{className:"formation-presets-section",children:[a.jsxs("div",{className:"presets-header",children:[a.jsx("i",{className:"fas fa-chess-board"}),a.jsx("span",{className:"presets-title",children:"Choose Formation"})]}),a.jsx("div",{className:"formation-buttons-grid",children:l.map(e=>a.jsx("button",{type:"button",className:"formation-preset-btn "+(i.formation===e?"active":""),onClick:()=>(e=>{t(a=>n(a,e)),c(a=>({...a,formation:e}))})(e),children:a.jsx("span",{className:"formation-name",children:e})},e))})]}),a.jsx("div",{ref:p,className:"formation-field-container",children:a.jsx(r,{players:s.filter(e=>!e.isSubstitute),editable:!0,onDragStart:y,onDrag:v,onDragEnd:b})}),u&&a.jsx("p",{className:"auth-error",children:u}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"secondary-btn",onClick:()=>o(2),disabled:d,children:"Back"}),a.jsx("button",{type:"submit",className:"primary-btn",disabled:d,children:d?a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-spinner fa-spin"})," Saving..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-save"})," Save & Review"]})})]})]})}function j(){const{teamData:t,resetForm:i,paymentStatus:n,successTeamId:l,setPaymentStatus:r}=h(),[c,o]=e.useState(!0);e.useEffect(()=>{(async()=>{if(l)try{const{data:e,error:a}=await s.from("team_registrations").select("status, payment_status").eq("id",l).single();if(a)throw a;e&&("confirmed"===e.status||"confirmed"===e.payment_status?r("confirmed"):e.payment_status&&r(e.payment_status))}catch(e){}finally{o(!1)}else o(!1)})()},[l,r]);const m="confirmed"===n;return c?a.jsx("div",{className:"registration-form registration-complete",children:a.jsx("div",{className:"complete-container",children:a.jsxs("div",{className:"loading-content",children:[a.jsx("div",{className:"spinner"}),a.jsx("p",{children:"Loading registration status..."})]})})}):a.jsx("div",{className:"registration-form registration-complete",children:a.jsxs("div",{className:"complete-container",children:[a.jsx("div",{className:"complete-icon",children:a.jsx("div",{className:"icon-circle "+(m?"confirmed":"pending"),children:a.jsx("i",{className:"fas "+(m?"fa-check":"fa-clock")})})}),a.jsx("h2",{children:m?"Registration Confirmed!":"Registration Submitted!"}),a.jsxs("div",{className:"complete-team-info",children:[t.teamLogo&&a.jsx("img",{src:t.teamLogo,alt:t.teamName,className:"complete-team-logo"}),a.jsx("h3",{children:t.teamName}),a.jsxs("span",{className:"complete-category",children:["open-age"===t.category?"Open Age":"Under 17"," Category"]})]}),a.jsx("div",{className:"complete-message",children:m?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"confirmation-badge",children:[a.jsx("i",{className:"fas fa-check-circle"}),a.jsx("span",{children:"Payment Verified"})]}),a.jsxs("p",{className:"main-message",children:["Your registration for ",a.jsx("strong",{children:"Muqawama 2026"})," has been confirmed!"]}),a.jsx("p",{className:"sub-message",children:"Welcome to the tournament! Your team is now officially registered."})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"verification-badge",children:[a.jsx("i",{className:"fas fa-hourglass-half"}),a.jsx("span",{children:"Payment Verification Pending"})]}),a.jsxs("p",{className:"main-message",children:["Your registration for ",a.jsx("strong",{children:"Muqawama 2026"})," has been submitted successfully!"]}),a.jsxs("p",{className:"sub-message",children:["We have received your payment screenshot and it is being verified by our team. You will receive confirmation within ",a.jsx("strong",{children:"24 hours"}),"."]})]})}),a.jsxs("div",{className:"complete-details",children:[a.jsx("h4",{children:"What Happens Next?"}),a.jsxs("ul",{className:"next-steps-list",children:[!m&&a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-search-dollar"}),a.jsx("span",{children:"Our team will verify your payment within 24 hours"})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-phone"}),a.jsx("span",{children:"The organisers will get in touch with you soon"})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-calendar-check"}),a.jsx("span",{children:"Fixture details will be shared before the tournament"})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-id-card"}),a.jsx("span",{children:"Player ID cards will be issued at the venue"})]})]})]}),a.jsxs("div",{className:"complete-contact",children:[a.jsx("p",{children:"Questions? Reach out to us:"}),a.jsxs("div",{className:"contact-links",children:[a.jsxs("a",{href:"mailto:muqawamah@sio-abulfazal.org",children:[a.jsx("i",{className:"fas fa-envelope"})," muqawamah@sio-abulfazal.org"]}),a.jsxs("a",{href:"https://instagram.com/muqawama2026",target:"_blank",rel:"noopener noreferrer",children:[a.jsx("i",{className:"fab fa-instagram"})," @muqawama2026"]})]})]}),a.jsx("div",{className:"complete-actions",children:a.jsxs("button",{type:"button",className:"primary-btn",onClick:()=>{i(),window.location.href="/muqawamah/2026/"},children:[a.jsx("i",{className:"fas fa-home"})," Back to Tournament Page"]})})]})})}const f={"open-age":{label:"Open Age",amount:2e3,qrCode:"/assets/img/Muqawama/qr-2000.svg"},u17:{label:"Under 17",amount:1800,qrCode:"/assets/img/Muqawama/qr-1800.svg"}};function N(){const{teamData:t,players:i,setStep:n,loading:l,setLoading:r,error:m,setError:d,existingTeamId:u,setExistingTeamId:p,setSuccessTeamId:x,paymentStatus:g,setPaymentStatus:N}=h(),[y,v]=e.useState(null),[b,w]=e.useState(null),[S,_]=e.useState(0),[P,C]=e.useState(!1),[k,q]=e.useState(!1),T=e.useRef(null),L=t.category||"open-age",F=f[L],E=F.amount;return"success"===g||"pending_verification"===g||"confirmed"===g?a.jsx(j,{}):a.jsxs("div",{className:"registration-form payment-checkout",children:[a.jsx("h3",{children:"Step 5 · Payment"}),a.jsx("p",{className:"step-description",children:"Scan the QR code, pay and upload the screenshot."}),a.jsxs("section",{className:"checkout-section",children:[a.jsxs("h4",{children:[a.jsx("i",{className:"fas fa-receipt"})," Order Summary"]}),a.jsxs("div",{className:"order-summary-card",children:[a.jsxs("div",{className:"order-item",children:[a.jsxs("div",{className:"order-item-info",children:[a.jsx("span",{className:"item-name",children:"Team Registration"}),a.jsxs("span",{className:"item-detail",children:[t.teamName," • ",F.label]})]}),a.jsxs("span",{className:"item-price",children:["₹",F.amount]})]}),a.jsxs("div",{className:"order-total",children:[a.jsx("span",{children:"Total Amount"}),a.jsxs("span",{className:"total-price",children:["₹",E]})]})]})]}),a.jsxs("section",{className:"checkout-section qr-section",children:[a.jsxs("h4",{children:[a.jsx("i",{className:"fas fa-qrcode"})," Scan & Pay"]}),a.jsxs("div",{className:"qr-payment-container",children:[a.jsx("div",{className:"qr-code-wrapper",children:a.jsx("img",{src:F.qrCode,alt:`Pay ₹${E} via UPI`,className:"qr-code-image"})}),a.jsxs("a",{href:F.qrCode,download:`muqawama-payment-qr-${E}.svg`,className:"download-qr-btn",children:[a.jsx("i",{className:"fas fa-download"})," Download QR Code"]}),a.jsxs("div",{className:"qr-instructions",children:[a.jsxs("div",{className:"instruction-step",children:[a.jsx("span",{className:"step-number",children:"1"}),a.jsx("span",{children:"Open any UPI app (GPay, PhonePe, Paytm, etc.)"})]}),a.jsxs("div",{className:"instruction-step",children:[a.jsx("span",{className:"step-number",children:"2"}),a.jsxs("span",{children:["Scan the QR code and pay ",a.jsxs("strong",{children:["₹",E]})]})]}),a.jsxs("div",{className:"instruction-step",children:[a.jsx("span",{className:"step-number",children:"3"}),a.jsx("span",{children:"Take a screenshot of the payment confirmation"})]}),a.jsxs("div",{className:"instruction-step",children:[a.jsx("span",{className:"step-number",children:"4"}),a.jsx("span",{children:"Upload the screenshot below"})]})]})]})]}),a.jsxs("section",{className:"checkout-section",children:[a.jsxs("h4",{children:[a.jsx("i",{className:"fas fa-upload"})," Upload Payment Screenshot"]}),a.jsxs("div",{className:"screenshot-upload-container",children:[a.jsx("input",{type:"file",ref:T,onChange:async e=>{const a=e.target.files[0];if(a)if(a.type.startsWith("image/"))if(a.size>5242880)d("Image size should be less than 5MB");else try{d(null);const e=await c(a,{maxWidth:1200,maxHeight:1200,quality:.85,outputFormat:"image/webp"});o(e),Math.round(a.size/1024);v(e),w(e)}catch(s){d("Failed to process image. Please try another file.")}else d("Please upload an image file (JPG, PNG, etc.)")},accept:"image/*",style:{display:"none"}}),b?a.jsxs("div",{className:"screenshot-preview",children:[a.jsx("img",{src:b,alt:"Payment Screenshot"}),a.jsxs("button",{type:"button",className:"remove-screenshot-btn",onClick:()=>{v(null),w(null),T.current&&(T.current.value="")},children:[a.jsx("i",{className:"fas fa-times"})," Remove"]})]}):a.jsxs("div",{className:"screenshot-dropzone",onClick:()=>{var e;return null==(e=T.current)?void 0:e.click()},children:[a.jsx("i",{className:"fas fa-cloud-upload-alt"}),a.jsx("p",{children:"Click to upload payment screenshot"}),a.jsx("span",{children:"JPG, PNG up to 5MB"})]})]}),S>0&&S<100&&a.jsxs("div",{className:"upload-progress",children:[a.jsx("div",{className:"progress-bar",children:a.jsx("div",{className:"progress-fill",style:{width:`${S}%`}})}),a.jsxs("span",{children:["Uploading... ",S,"%"]})]})]}),a.jsxs("section",{className:"checkout-section",children:[a.jsxs("h4",{children:[a.jsx("i",{className:"fas fa-users"})," Registration Details"]}),a.jsxs("div",{className:"checkout-team-summary",children:[a.jsxs("div",{className:"team-mini-card",children:[t.teamLogo&&a.jsx("img",{src:t.teamLogo,alt:t.teamName,className:"team-mini-logo"}),a.jsxs("div",{className:"team-mini-info",children:[a.jsx("span",{className:"team-mini-name",children:t.teamName}),a.jsxs("span",{className:"team-mini-category",children:[F.label," • ",i.length," Players"]})]})]}),a.jsxs("div",{className:"captain-info",children:[a.jsxs("span",{children:[a.jsx("i",{className:"fas fa-user"})," ",t.captainName]}),a.jsxs("span",{children:[a.jsx("i",{className:"fas fa-envelope"})," ",t.captainEmail]})]})]})]}),m&&a.jsxs("p",{className:"auth-error",children:[a.jsx("i",{className:"fas fa-exclamation-circle"})," ",m]}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"secondary-btn",onClick:()=>n(4),disabled:l,children:"Back to Review"}),a.jsx("button",{type:"button",className:"primary-btn pay-btn",onClick:()=>C(!0),disabled:l||!y,children:l?a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-spinner fa-spin"})," Submitting..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-check-circle"})," Submit Registration"]})})]}),a.jsxs("p",{className:"terms-note",children:[a.jsx("i",{className:"fas fa-info-circle"})," Your registration will be verified within 24 hours after payment confirmation."]}),P&&a.jsx("div",{className:"terms-modal-overlay",onClick:()=>C(!1),children:a.jsxs("div",{className:"terms-modal",onClick:e=>e.stopPropagation(),children:[a.jsxs("div",{className:"terms-modal-header",children:[a.jsx("i",{className:"fas fa-file-contract"}),a.jsx("h3",{children:"Confirm Registration"})]}),a.jsxs("div",{className:"terms-modal-content",children:[a.jsx("p",{children:"By submitting this registration, you confirm that:"}),a.jsxs("ul",{className:"terms-checklist",children:[a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-check"}),a.jsx("span",{children:"All information provided is accurate and complete"})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-check"}),a.jsxs("span",{children:["You agree to the ",a.jsx("a",{href:"/muqawamah/terms-and-conditions/",target:"_blank",rel:"noopener noreferrer",children:"Terms & Conditions"})]})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-check"}),a.jsxs("span",{children:["You agree to the ",a.jsx("a",{href:"/muqawamah/privacy-policy/",target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})]})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-check"}),a.jsx("span",{children:"You consent to AI-enhanced player images"})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-check"}),a.jsxs("span",{children:["You understand the ",a.jsx("a",{href:"/muqawamah/refund-policy/",target:"_blank",rel:"noopener noreferrer",children:"Refund Policy"})]})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-check"}),a.jsx("span",{children:"All players meet the category age requirements"})]})]}),a.jsxs("div",{className:"terms-checkbox-label "+(k?"checked":""),onClick:()=>q(!k),children:[a.jsx("div",{className:"custom-checkbox",children:k&&a.jsx("i",{className:"fas fa-check"})}),a.jsx("span",{children:"I accept all the above terms and conditions"})]})]}),a.jsxs("div",{className:"terms-modal-actions",children:[a.jsx("button",{type:"button",className:"secondary-btn",onClick:()=>{C(!1),q(!1)},children:"Cancel"}),a.jsx("button",{type:"button",className:"primary-btn",disabled:!k||l,onClick:()=>{C(!1),(async()=>{if(y){r(!0),d(null),_(10);try{const{data:{user:e}}=await s.auth.getUser();if(!e)throw new Error("You must be logged in to proceed.");_(20);const a=y;_(40);let l=u;if(u){const{error:e}=await s.from("team_registrations").update({team_name:t.teamName,category:t.category,team_logo:t.teamLogo,captain_name:t.captainName,captain_email:t.captainEmail,captain_phone:t.captainPhone,formation:t.formation,status:"pending_verification",payment_amount:E,payment_screenshot:a,payment_status:"pending_verification",submitted_at:(new Date).toISOString()}).eq("id",u);if(e)throw e}else{const{data:i,error:n}=await s.from("team_registrations").insert({user_id:e.id,team_name:t.teamName,category:t.category,team_logo:t.teamLogo,captain_name:t.captainName,captain_email:t.captainEmail,captain_phone:t.captainPhone,formation:t.formation,status:"pending_verification",payment_amount:E,payment_screenshot:a,payment_status:"pending_verification",submitted_at:(new Date).toISOString()}).select().single();if(n)throw n;l=i.id,p(l)}_(60),await s.from("team_players").delete().eq("team_id",l);const r=i.map(e=>({team_id:l,player_name:e.name||"",player_age:e.age?parseInt(e.age):null,aadhar_no:e.aadhar_no||null,position:e.position||"SUB",is_substitute:e.isSubstitute||!1,player_image:e.image||null,position_x:"number"!=typeof e.x||isNaN(e.x)?50:e.x,position_y:"number"!=typeof e.y||isNaN(e.y)?50:e.y}));_(80);const{error:c}=await s.from("team_players").insert(r);if(c)throw c;_(100),x(l),N("pending_verification"),n(6)}catch(e){d(e.message)}finally{r(!1),_(0)}}else d("Please upload the payment screenshot")})()},children:l?a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-spinner fa-spin"})," Submitting..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-check-circle"})," Confirm & Submit"]})})]})]})})]})}const y=["GK","CB","LB","RB","CDM","CM","CAM","LM","RM","CF","ST"];function v(){const{players:s,setPlayers:t,setStep:i,saveProgress:n,saving:l,error:r,teamData:m}=h(),[d,u]=e.useState(null),p="open-age"===m.category;e.useEffect(()=>{m.captainName&&s[0]&&!s[0].name&&t(e=>e.map((e,a)=>0===a?{...e,name:m.captainName}:e))},[m.captainName,t]);const x=(e,a,s)=>{t(t=>t.map((t,i)=>i===e?{...t,[a]:s}:t))},g=s.filter(e=>!e.isSubstitute),j=s.filter(e=>e.isSubstitute),f=g[0],N=g.slice(1),v=(e,s,t=!1)=>{const i=e.isSubstitute,n=i&&e.name,l=!i||n;return a.jsxs("div",{className:`player-card ${t?"captain-card":""} ${i?"substitute-card":""}`,children:[t&&a.jsxs("div",{className:"captain-badge",children:[a.jsx("i",{className:"fas fa-star"})," Team Captain"]}),i&&!n&&a.jsxs("div",{className:"optional-badge",children:[a.jsx("i",{className:"fas fa-plus-circle"})," Optional"]}),a.jsxs("label",{children:[t?"Captain Name":"Player Name",a.jsx("input",{type:"text",value:e.name,onChange:e=>x(s,"name",e.target.value),placeholder:t?m.captainName||"Captain Name":i?"Substitute Name (optional)":`${e.position} Player`,required:!i})]}),a.jsxs("label",{children:["Age",a.jsx("input",{type:"number",value:e.age||"",onChange:e=>x(s,"age",e.target.value),placeholder:"e.g., 22",min:"10",max:"60",required:l})]}),!p&&a.jsxs("label",{children:["Aadhar Number",a.jsx("input",{type:"text",value:e.aadhar_no||"",onChange:e=>{const a=e.target.value.replace(/\D/g,"");a.length<=12&&x(s,"aadhar_no",a)},placeholder:"12-digit Aadhar number",maxLength:"12",pattern:"[0-9]{12}",required:l}),a.jsx("span",{className:"input-hint",children:"Enter 12-digit Aadhar number (required for U17)"})]}),!e.isSubstitute&&a.jsxs("label",{children:["Position",a.jsx("select",{value:e.position,onChange:e=>x(s,"position",e.target.value),children:y.map(e=>a.jsx("option",{value:e,children:e},e))})]}),a.jsxs("label",{className:"file-label",children:["Player Photo",d===s&&a.jsxs("div",{className:"compressing-indicator",children:[a.jsx("i",{className:"fas fa-spinner fa-spin"}),a.jsx("span",{children:"Compressing image..."})]}),e.image&&d!==s&&a.jsxs("div",{className:"uploaded-photo-preview",children:[a.jsxs("div",{className:"photo-preview-container",children:[a.jsx("img",{src:e.image,alt:"Player photo",className:"photo-preview"}),a.jsx("div",{className:"photo-overlay",children:a.jsx("i",{className:"fas fa-check-circle"})})]}),a.jsxs("div",{className:"uploaded-file-info",children:[a.jsx("i",{className:"fas fa-check-circle"}),a.jsxs("span",{className:"file-name-text",children:[a.jsx("strong",{children:"Uploaded:"})," ",e.imageFileName||"Photo uploaded"]}),a.jsx("span",{className:"file-change-hint",children:"(Click to change)"})]})]}),a.jsx("input",{type:"file",accept:"image/*",onChange:e=>{var a;return(async(e,a)=>{if(a)if(a.size>2097152)alert("Player photo must be under 2MB");else try{u(e);const s=await c(a,{maxWidth:600,maxHeight:600,quality:.85,outputFormat:"image/webp"});o(s),Math.round(a.size/1024),x(e,"image",s),x(e,"imageFileName",a.name.replace(/\.(jpg|jpeg|png)$/i,".webp"))}catch(s){alert("Failed to process image. Please try another file.")}finally{u(null)}})(s,null==(a=e.target.files)?void 0:a[0])},disabled:d===s}),!e.image&&d!==s&&a.jsx("span",{className:"input-hint",children:i?"JPG/PNG up to 2MB. Optional.":"JPG/PNG up to 2MB. Required."})]})]},e.id)};return a.jsxs("form",{className:"registration-form",onSubmit:async e=>{if(e.preventDefault(),!(()=>{const e=g.every(e=>{const a=e.name&&e.age&&e.position&&e.image;return p?a:a&&e.aadhar_no&&12===e.aadhar_no.length}),a=j.filter(e=>e.name).every(e=>{const a=e.name&&e.age&&e.image;return p?a:a&&e.aadhar_no&&12===e.aadhar_no.length});return e&&a})()){return void alert(`Please fill out all required fields including name, age${p?"":", Aadhar number,"} and photo for all main players. Substitutes are optional.`)}(await n(2)).success&&i(3)},children:[a.jsx("h3",{children:"Step 2 · Players"}),a.jsx("p",{className:"step-description",children:"Start with the captain, then add 6 more players and 4 substitutes."}),a.jsx("h4",{children:"Captain"}),a.jsx("div",{className:"captain-section",children:f&&v(f,s.indexOf(f),!0)}),a.jsx("h4",{children:"Other Main Players"}),a.jsx("div",{className:"players-grid",children:N.map(e=>v(e,s.indexOf(e)))}),a.jsxs("h4",{children:["Substitutes ",a.jsx("span",{className:"optional-label",children:"(Optional)"})]}),a.jsx("p",{className:"step-description",style:{marginTop:"-10px",marginBottom:"15px"},children:"Add 1-4 substitutes as needed. You can leave any substitute cards empty if you don't have players."}),a.jsx("div",{className:"players-grid",children:j.map(e=>v(e,s.indexOf(e)))}),r&&a.jsx("p",{className:"auth-error",children:r}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"secondary-btn",onClick:()=>i(1),disabled:l,children:"Back"}),a.jsx("button",{type:"submit",className:"primary-btn",disabled:l,children:l?a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-spinner fa-spin"})," Saving..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-save"})," Save & Continue"]})})]})]})}function b({readOnly:e=!1}){const{teamData:s,players:t,setStep:i,existingTeamId:n}=h();return a.jsxs("div",{className:"registration-form",children:[a.jsxs("h3",{children:["Step 4 · Review & ",n?"Update":"Submit"]}),a.jsxs("p",{className:"step-description",children:["Verify everything looks good before ",n?"updating":"submitting"," your team."]}),a.jsxs("section",{className:"summary-section",children:[a.jsx("h4",{children:"Team Information"}),a.jsxs("div",{className:"team-info-card",children:[a.jsxs("div",{className:"team-info-header",children:[a.jsx("div",{className:"team-logo-large",children:s.teamLogo?a.jsx("img",{src:s.teamLogo,alt:`${s.teamName} logo`}):a.jsx("div",{className:"team-logo-placeholder-large",children:a.jsx("i",{className:"fas fa-shield-alt"})})}),a.jsxs("div",{className:"team-info-main",children:[a.jsx("h3",{className:"team-name-display",children:s.teamName}),a.jsxs("span",{className:"team-category-badge",children:[a.jsx("i",{className:"fas fa-trophy"})," ","open-age"===s.category?"Open Age":"Under 17"]})]})]}),a.jsxs("div",{className:"team-info-details",children:[a.jsxs("div",{className:"info-row",children:[a.jsxs("div",{className:"info-item",children:[a.jsx("i",{className:"fas fa-user-tie"}),a.jsxs("div",{className:"info-content",children:[a.jsx("span",{className:"info-label",children:"Captain"}),a.jsx("span",{className:"info-value",children:s.captainName})]})]}),a.jsxs("div",{className:"info-item",children:[a.jsx("i",{className:"fas fa-envelope"}),a.jsxs("div",{className:"info-content",children:[a.jsx("span",{className:"info-label",children:"Email"}),a.jsx("span",{className:"info-value",children:s.captainEmail})]})]})]}),s.captainPhone&&a.jsxs("div",{className:"info-row",children:[a.jsxs("div",{className:"info-item",children:[a.jsx("i",{className:"fas fa-phone"}),a.jsxs("div",{className:"info-content",children:[a.jsx("span",{className:"info-label",children:"Phone"}),a.jsx("span",{className:"info-value",children:s.captainPhone})]})]}),a.jsxs("div",{className:"info-item",children:[a.jsx("i",{className:"fas fa-futbol"}),a.jsxs("div",{className:"info-content",children:[a.jsx("span",{className:"info-label",children:"Formation"}),a.jsx("span",{className:"info-value",children:s.formation})]})]})]}),!s.captainPhone&&a.jsx("div",{className:"info-row",children:a.jsxs("div",{className:"info-item",children:[a.jsx("i",{className:"fas fa-futbol"}),a.jsxs("div",{className:"info-content",children:[a.jsx("span",{className:"info-label",children:"Formation"}),a.jsx("span",{className:"info-value",children:s.formation})]})]})})]})]})]}),a.jsxs("section",{className:"summary-section",children:[a.jsx("h4",{children:"Players"}),a.jsx("div",{className:"player-card-grid",children:t.filter(e=>e.name&&""!==e.name.trim()).map((e,t)=>{var i,n;return a.jsxs("div",{className:"player-card-badge simple "+(e.isSubstitute?"substitute":""),children:[a.jsxs("div",{className:"badge-header",children:[a.jsxs("div",{className:"badge-team",children:[a.jsx("div",{className:"team-logo",children:s.teamLogo?a.jsx("img",{src:s.teamLogo,alt:`${s.teamName} logo`}):a.jsx("div",{className:"team-logo-placeholder",children:(null==(n=null==(i=s.teamName)?void 0:i.charAt(0))?void 0:n.toUpperCase())||"T"})}),a.jsxs("div",{className:"team-meta",children:[a.jsx("span",{className:"team-name",children:s.teamName||"Team name"}),a.jsx("span",{className:"player-role",children:e.isSubstitute?"Substitute":e.position||"Player"})]})]}),a.jsx("div",{className:"muqawama-logo",children:a.jsx("img",{src:"/assets/img/MuqawamaLogo.png",alt:"Muqawama 2026"})})]}),a.jsx("div",{className:"badge-photo",children:e.image?a.jsx("img",{src:e.image,alt:e.name||e.position}):a.jsx("div",{className:"badge-photo-placeholder",children:a.jsx("i",{className:"fas fa-user"})})}),a.jsx("div",{className:"badge-player-info",children:a.jsx("span",{className:"player-name",children:e.name})})]},e.id||t)})})]}),a.jsxs("section",{className:"summary-section",children:[a.jsx("h4",{children:"Formation Preview"}),a.jsx("div",{children:a.jsx(r,{players:t.filter(e=>!e.isSubstitute),editable:!1,showDownload:!0})})]}),!e&&a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"secondary-btn",onClick:()=>i(3),children:"Back"}),a.jsx("button",{type:"button",className:"primary-btn",onClick:()=>{i(5)},children:"Proceed to Payment"})]})]})}const w=[{value:"open-age",label:"Open Age"},{value:"u17",label:"Under 17"}];function S(){const{teamData:s,setTeamData:t,setStep:i,saveProgress:n,saving:r,error:m}=h(),d=e.useRef(null),[u,p]=e.useState(!1),x=e=>{const{name:a,value:s}=e.target;t(e=>({...e,[a]:s}))};return a.jsxs("form",{className:"registration-form",onSubmit:async e=>{var a;if(e.preventDefault(),!s.teamLogo)return void alert("Please upload a team logo");if(10!==((null==(a=s.captainPhone)?void 0:a.replace(/\s/g,""))||"").length)return void alert("Please enter a valid 10-digit mobile number");(await n(1)).success&&i(2)},children:[a.jsx("h3",{children:"Step 1 · Team Details"}),a.jsx("p",{className:"step-description",children:"Tell us about your team and captain information."}),a.jsxs("label",{children:["Team Name",a.jsx("input",{type:"text",name:"teamName",value:s.teamName,onChange:x,placeholder:"e.g., Rising Stars",required:!0})]}),a.jsxs("label",{children:["Category",a.jsx("select",{name:"category",value:s.category,onChange:x,children:w.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))})]}),a.jsxs("label",{className:"file-label",children:["Team Logo",u&&a.jsxs("div",{className:"compressing-indicator",children:[a.jsx("i",{className:"fas fa-spinner fa-spin"}),a.jsx("span",{children:"Compressing image..."})]}),s.teamLogo&&!u&&a.jsxs("div",{className:"uploaded-photo-preview",children:[a.jsxs("div",{className:"photo-preview-container",children:[a.jsx("img",{src:s.teamLogo,alt:"Team logo",className:"photo-preview"}),a.jsx("div",{className:"photo-overlay",children:a.jsx("i",{className:"fas fa-check-circle"})})]}),a.jsxs("div",{className:"uploaded-file-info",children:[a.jsx("i",{className:"fas fa-check-circle"}),a.jsx("span",{children:s.teamLogoFileName?`Uploaded: ${s.teamLogoFileName}`:"Logo uploaded"}),a.jsx("span",{className:"file-change-hint",children:"(Click to change)"})]})]}),a.jsx("input",{type:"file",accept:"image/*",ref:d,onChange:async e=>{var a;const s=null==(a=e.target.files)?void 0:a[0];if(s){if(s.size>2097152)return alert("Logo size must be under 2MB"),void(d.current.value="");try{p(!0);const e=await c(s,{maxWidth:800,maxHeight:800,quality:.85,outputFormat:"image/webp"});o(e),Math.round(s.size/1024);t(a=>({...a,teamLogo:e,teamLogoFileName:s.name.replace(/\.(jpg|jpeg|png)$/i,".webp")}))}catch(i){alert("Failed to process image. Please try another file."),d.current.value=""}finally{p(!1)}}},disabled:u}),!s.teamLogo&&!u&&a.jsx("span",{className:"input-hint",children:"JPG/PNG up to 2MB. Displayed across the tournament site."})]}),a.jsxs("label",{children:["Preferred Formation",a.jsx("select",{name:"formation",value:s.formation,onChange:x,children:l.map(e=>a.jsx("option",{value:e,children:e},e))}),a.jsx("span",{className:"input-hint",children:"This will be the starting layout in Step 3. You can still adjust players later."})]}),a.jsxs("div",{className:"grid-2",children:[a.jsxs("label",{children:["Captain Name",a.jsx("input",{type:"text",name:"captainName",value:s.captainName,onChange:x,required:!0})]}),a.jsxs("label",{children:["Captain Email",a.jsx("input",{type:"email",name:"captainEmail",value:s.captainEmail,onChange:x,required:!0})]})]}),a.jsxs("label",{children:["Captain Phone",a.jsx("input",{type:"tel",name:"captainPhone",value:s.captainPhone||"",onChange:e=>{const a=e.target.value.replace(/\D/g,"");let s="";a&&(s=a.length<=5?a:`${a.slice(0,5)} ${a.slice(5,10)}`),t(e=>({...e,captainPhone:s}))},placeholder:"98765 43210",pattern:"[0-9\\s]{10,12}",maxLength:11,onInvalid:e=>{var a;const t=e.target;((null==(a=s.captainPhone)?void 0:a.replace(/\s/g,""))||"").length<10?t.setCustomValidity("Please enter a valid 10-digit mobile number"):t.setCustomValidity("")},onInput:e=>{e.target.setCustomValidity("")},required:!0}),a.jsxs("span",{className:"input-hint",children:[a.jsx("i",{className:"fas fa-info-circle"})," 10-digit mobile number (e.g., 98765 43210)"]})]}),m&&a.jsx("p",{className:"auth-error",children:m}),a.jsx("div",{className:"form-actions",children:a.jsx("button",{type:"submit",className:"primary-btn",disabled:r,children:r?a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-spinner fa-spin"})," Saving..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-save"})," Save & Continue"]})})})]})}const _=[{id:1,label:"Team"},{id:2,label:"Players"},{id:3,label:"Formation"},{id:4,label:"Review"},{id:5,label:"Payment"},{id:6,label:"Complete"}];function P(){const{step:e}=h(),s=_.slice(0,5);return 6===e?null:a.jsx("div",{className:"registration-stepper",children:s.map((s,t)=>a.jsxs("div",{className:`step ${e===s.id?"active":""} ${e>s.id?"complete":""}`,children:[a.jsx("span",{className:"step-number",children:t+1}),a.jsx("span",{className:"step-label",children:s.label})]},s.id))})}function C(){const{step:i,setStep:n,setTeamData:l,setPlayers:r,setExistingTeamId:c,readOnlyMode:o,setReadOnlyMode:d,resetForm:x,existingTeamId:f,setPaymentStatus:y,setLastSavedStep:w}=h(),[_,C]=e.useState(null),[k,q]=e.useState(!0),[T,L]=e.useState(""),[F,E]=e.useState(!1),M=t.useRef(!1);e.useEffect(()=>{const e=new URLSearchParams(window.location.search).get("payment");"success"===e?(y("success"),n(5),window.history.replaceState({},"",window.location.pathname)):"failed"===e&&(y("failed"),n(5),window.history.replaceState({},"",window.location.pathname))},[]),e.useEffect(()=>{let e=!0;L("");(async()=>{try{const{data:a,error:t}=await Promise.race([s.auth.getUser(),new Promise((e,a)=>setTimeout(()=>a(new Error("getUser timeout")),3e3))]);if(!e)return;if(t){if("getUser timeout"===t.message)return C(null),x(),void q(!1);if("Auth session missing!"!==t.message)throw t}const i=(null==a?void 0:a.user)??null;i?(C(i),await R(i,{force:!0})):(C(null),x())}catch(a){e&&(C(null),x())}finally{e&&q(!1)}})();const{data:a}=s.auth.onAuthStateChange(async(a,s)=>{if(!e)return;["TOKEN_REFRESHED","USER_UPDATED"].includes(a)||("SIGNED_OUT"!==a&&(null==s?void 0:s.user)?"SIGNED_IN"===a&&(null==s?void 0:s.user)&&(M.current||(C(s.user),q(!0),await R(s.user,{force:!0}),q(!1))):(C(null),x(),n(1),M.current=!1))});return()=>{e=!1,a.subscription.unsubscribe()}},[]);const R=async(e,{force:a=!1}={})=>{if(!M.current||a){M.current=!0,E(!0),L("");try{const{data:a,error:t}=await s.from("team_registrations").select("*, team_players(*)").eq("user_id",e.id).maybeSingle();if(t&&"PGRST116"!==t.code)throw t;if(a){c(a.id),d(!1),l({teamName:a.team_name||"",category:a.category||"open-age",teamLogo:a.team_logo,captainName:a.captain_name||"",captainEmail:a.captain_email||e.email||"",captainPhone:a.captain_phone?a.captain_phone.replace(/^\+91\s?/,"").trim():"",formation:a.formation||"1-3-2-1"});const s=a.team_players&&a.team_players.length>0?a.team_players.map((e,a)=>({id:e.id||`player-${a}`,name:e.player_name||"",age:e.player_age||"",aadhar_no:e.aadhar_no||"",position:e.position||"SUB",isSubstitute:e.is_substitute,image:e.player_image,x:e.position_x??50,y:e.position_y??50})):u();if(r(s),"confirmed"===a.status)y("confirmed"),n(6);else if("pending_verification"===a.status)y("pending_verification"),n(6);else if("pending_payment"===a.status)n(4);else{const e=a.last_saved_step||1;w(e);n(e>=3?4:e+1)}}else c(null),d(!1),l({...p,captainEmail:e.email||""}),r(u()),n(1)}catch(t){L("Could not load your saved registration. You can continue and submitting will overwrite the previous data."),c(null),d(!1),l({...p,captainEmail:e.email||""}),r(u()),n(1)}finally{E(!1)}}};return k?a.jsx("div",{className:"loading-screen",children:a.jsxs("div",{className:"loading-content",children:[a.jsxs("div",{className:"logo-loader",children:[a.jsx("div",{className:"logo-ring"}),a.jsx("img",{src:"/assets/img/MuqawamaLogo.png",alt:"Muqawama",className:"logo-pulse"})]}),a.jsx("p",{children:"Loading your registration..."})]})}):_?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"header-actions",children:[a.jsx("span",{className:"user-email",children:_.email}),a.jsxs("button",{type:"button",className:"logout-btn",onClick:async()=>{await s.auth.signOut(),C(null),n(1)},children:[a.jsx("i",{className:"fas fa-sign-out-alt"})," Logout"]})]}),a.jsx("div",{className:"registration-header",children:a.jsxs("div",{className:"registration-header-logo",children:[a.jsx("img",{src:"/assets/img/title.png",alt:"Muqawama 2026"}),a.jsx("h2",{className:"registration-header-title",children:"Team Registration"}),a.jsx("p",{children:f?"Edit your team registration and update any details.":"Complete all steps to confirm your team registration."})]})}),T&&a.jsx("p",{className:"auth-error",children:T}),a.jsx(P,{}),(()=>{switch(i){case 1:default:return a.jsx(S,{});case 2:return a.jsx(v,{});case 3:return a.jsx(g,{});case 4:return a.jsx(b,{});case 5:return a.jsx(N,{});case 6:return a.jsx(j,{})}})()]}):a.jsx(m,{onSuccess:C})}function k(){return e.useEffect(()=>(document.body.classList.add("registration-body"),()=>document.body.classList.remove("registration-body")),[]),a.jsx(x,{children:a.jsx("div",{className:"registration-container",children:a.jsx(C,{})})})}i.createRoot(document.getElementById("registration-root")).render(a.jsx(t.StrictMode,{children:a.jsx(k,{})}));
