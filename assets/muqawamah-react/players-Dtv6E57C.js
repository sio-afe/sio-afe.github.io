import{r as e,s as a,j as s,R as t,c as l}from"./supabaseClient-y7L7r4ir.js";import{F as r}from"./Footer-Cjjkr2XU.js";import{T as i}from"./TournamentNavbar-CJHVAkqk.js";import{P as n,a as c}from"./ShareableCard-Cttp4vpW.js";import{S as o}from"./SmartImg-mv2gJrPZ.js";import"./supabase-client-FID_-7ME.js";import"./index-3r6UxFjv.js";const d={GK:"Goalkeeper",CB:"Defender",LB:"Defender",RB:"Defender",CDM:"Midfielder",CM:"Midfielder",CAM:"Midfielder",LM:"Midfielder",RM:"Midfielder",CF:"Forward",ST:"Forward",SUB:"Substitute"},m={Goalkeeper:"Goalkeepers",Defender:"Defenders",Midfielder:"Midfielders",Forward:"Forwards",Substitute:"Substitutes"};function h({src:a,alt:t,className:l,style:r,preset:i}){const[n,c]=e.useState(!1),[d,m]=e.useState(!1),h=e.useRef(null);e.useEffect(()=>{if(!h.current)return;const e=new IntersectionObserver(a=>{a.forEach(a=>{a.isIntersecting&&(m(!0),e.unobserve(a.target))})},{rootMargin:"50px",threshold:.01});return e.observe(h.current),()=>{h.current&&e.unobserve(h.current)}},[]);const p=a;return s.jsx("div",{ref:h,style:{width:"100%",height:"100%",...r},children:d&&p&&s.jsx(o,{src:p,preset:i,alt:t,className:l,loading:"lazy",decoding:"async",onLoad:()=>c(!0),style:{opacity:n?1:0,transition:"opacity 0.3s ease-in-out"}})})}function p({playerId:t,onBack:l,onNavigateToPlayer:o,onNavigateToMatch:p}){var u;const[g,x]=e.useState(null),[j,y]=e.useState([]),[f,v]=e.useState([]),[N,_]=e.useState([]),[w,b]=e.useState(null),[S,M]=e.useState(!0),[k,C]=e.useState(1),[L,P]=e.useState("completed"),[q,D]=e.useState(!1);e.useEffect(()=>{t&&F()},[t]);const F=async()=>{try{const{data:e,error:s}=await a.from("players").select("id, name, player_image, position, is_substitute, team_id, registration_player_id").eq("id",t).single();if(s)throw s;let l=null;if(null==e?void 0:e.team_id){const{data:s}=await a.from("teams").select("id, name, crest_url").eq("id",e.team_id).single();l=s}if(x({...e,team:l}),null==e?void 0:e.team_id){const{data:s}=await a.from("players").select("id, name, player_image, position").eq("team_id",e.team_id).order("name",{ascending:!0});if(s){const e=s.findIndex(e=>e.id===t);C(e>=0?e+1:1),y(s.filter(e=>e.id!==t))}const l=e.team_id;b(l);const{data:r,error:i}=await a.from("matches").select("\n            id, \n            match_number,\n            match_date, \n            scheduled_time,\n            home_team_id, \n            away_team_id, \n            home_score, \n            away_score,\n            status,\n            home_team:teams!matches_home_team_id_fkey(id, name),\n            away_team:teams!matches_away_team_id_fkey(id, name)\n          ").or(`home_team_id.eq.${l},away_team_id.eq.${l}`).order("match_date",{ascending:!1});i||r&&v(r);const n=e.registration_player_id;if(n){const{data:e}=await a.from("goals").select("\n              id,\n              match_id,\n              team_id,\n              scorer_id,\n              assister_id,\n              minute,\n              goal_type,\n              scorer:team_players!goals_scorer_id_fkey(id, player_name),\n              assister:team_players!goals_assister_id_fkey(id, player_name)\n            ").or(`scorer_id.eq.${n},assister_id.eq.${n}`).order("minute",{ascending:!0});e&&_(e)}}}catch(e){}finally{M(!1)}},R=e=>d[e]||e||"Unknown";if(S)return s.jsx("div",{className:"player-detail-loading",children:s.jsxs("div",{className:"players-loading-content",children:[s.jsxs("div",{className:"logo-loader",children:[s.jsx("div",{className:"logo-ring"}),s.jsx("img",{src:"/assets/img/muq_invert.png",alt:"Muqawama",className:"logo-pulse"})]}),s.jsx("p",{children:"Loading player..."})]})});if(!g)return s.jsxs("div",{className:"player-detail-error",children:[s.jsx("i",{className:"fas fa-exclamation-triangle"}),s.jsx("p",{children:"Player not found"})]});const I=g.team,T=R(g.position),$=(()=>{const e={};return j.forEach(a=>{const s=R(a.position),t=m[s]||"Others";e[t]||(e[t]=[]),e[t].push(a)}),e})(),E=g.registration_player_id,B={apps:f.filter(e=>"completed"===e.status).length,goals:N.filter(e=>e.scorer_id===E).length,assists:N.filter(e=>e.assister_id===E).length},U=f.map(e=>{var a,s;const t=String(e.home_team_id)===String(w),l=t?null==(a=e.away_team)?void 0:a.name:null==(s=e.home_team)?void 0:s.name,r=t?e.home_score:e.away_score,i=t?e.away_score:e.home_score;let n="-";"completed"===e.status&&(n=r>i?"W":r<i?"L":"D");const c=N.filter(a=>a.match_id===e.id&&a.scorer_id===E).length;return{matchId:e.id,matchweek:e.match_number||"-",date:e.match_date?new Date(e.match_date).toLocaleDateString("en-GB",{day:"2-digit",month:"short"}):"-",opponent:l||"TBD",result:n,score:"completed"===e.status?`${r}-${i}`:"vs",minutes:"completed"===e.status?"90":"-",goals:c,status:e.status}}),G=U.filter(e=>"completed"===e.status),A=U.filter(e=>"completed"!==e.status);return s.jsxs(s.Fragment,{children:[s.jsx(i,{}),s.jsxs("div",{className:"bls-player-page",children:[s.jsxs("div",{className:"player-hero-wrapper",children:[s.jsxs("div",{className:"player-hero-card",children:[s.jsx("div",{className:"team-logo-badge",children:(null==I?void 0:I.crest_url)?s.jsx(h,{src:I.crest_url,alt:null==I?void 0:I.name,preset:"crestMd"}):s.jsx("span",{className:"team-initial",children:(null==(u=null==I?void 0:I.name)?void 0:u.charAt(0))||"?"})}),s.jsx("div",{className:"muqawama-logo-badge",children:s.jsx("img",{src:"/assets/img/muq_invert.png",alt:"Muqawama"})}),s.jsxs("div",{className:"player-photo-main",children:[g.player_image?s.jsx(h,{src:g.player_image,alt:g.name,preset:"playerCard"}):s.jsx("div",{className:"player-photo-placeholder",children:s.jsx("i",{className:"fas fa-user"})}),s.jsx("div",{className:"player-info-gradient"}),s.jsxs("div",{className:"player-info-overlay",children:[s.jsxs("div",{className:"player-name-position",children:[s.jsx("h1",{className:"player-name-hero",children:g.name}),s.jsxs("span",{className:"player-position-hero",children:["Position: ",T]})]}),k&&s.jsxs("span",{className:"player-number-hero",children:["#",k]})]})]})]}),s.jsxs("div",{className:"bls-content-wrapper",children:[s.jsxs("div",{className:"bls-stats-grid",children:[s.jsxs("div",{className:"bls-main-stats",children:[s.jsxs("div",{className:"bls-quick-stats",children:[s.jsxs("div",{className:"bls-stat-box",children:[s.jsx("div",{className:"bls-stat-value",children:B.goals}),s.jsx("span",{children:"Goals"})]}),s.jsxs("div",{className:"bls-stat-box",children:[s.jsx("div",{className:"bls-stat-value",children:B.assists}),s.jsx("span",{children:"Assists"})]})]}),s.jsxs("div",{className:"bls-match-log",children:[s.jsx("h4",{children:"Match Log"}),s.jsx("div",{className:"match-log-toggle-container",children:s.jsxs("button",{className:"match-log-toggle-btn",onClick:()=>P("completed"===L?"scheduled":"completed"),children:[s.jsxs("span",{className:"toggle-option "+("completed"===L?"active":""),children:["Completed (",G.length,")"]}),s.jsxs("span",{className:"toggle-option "+("scheduled"===L?"active":""),children:["Scheduled (",A.length,")"]}),s.jsx("span",{className:"toggle-slider",style:{transform:"scheduled"===L?"translateX(100%)":"translateX(0)"}})]})}),"completed"===L&&s.jsx(s.Fragment,{children:G.length>0?s.jsx("div",{className:"match-log-table-wrapper",children:s.jsxs("table",{className:"bls-match-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Match"}),s.jsx("th",{children:"Score"}),s.jsx("th",{children:"G"})]})}),s.jsx("tbody",{children:G.map((e,a)=>s.jsxs("tr",{onClick:()=>p&&p(e.matchId),className:"match-row-clickable",children:[s.jsx("td",{className:"opponent-name",children:e.opponent}),s.jsxs("td",{children:[s.jsx("span",{className:`bls-result bls-result-${e.result}`,children:e.result}),s.jsx("span",{className:"bls-score-text",children:e.score})]}),s.jsx("td",{children:e.goals})]},a))})]})}):s.jsx("p",{className:"bls-no-data",children:"No completed matches yet"})}),"scheduled"===L&&s.jsx(s.Fragment,{children:A.length>0?s.jsx("div",{className:"match-log-table-wrapper",children:s.jsxs("table",{className:"bls-match-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Match"}),s.jsx("th",{children:"Status"})]})}),s.jsx("tbody",{children:A.map((e,a)=>s.jsxs("tr",{onClick:()=>p&&p(e.matchId),className:"match-row-clickable",children:[s.jsx("td",{className:"opponent-name",children:e.opponent}),s.jsx("td",{children:s.jsx("span",{className:"match-scheduled-badge",children:"VS"})})]},a))})]})}):s.jsx("p",{className:"bls-no-data",children:"No scheduled matches"})})]})]}),s.jsxs("div",{className:"bls-teammates",children:[s.jsx("h4",{children:"Teammates"}),Object.entries($).map(([e,a])=>s.jsxs("div",{className:"bls-teammate-group",children:[s.jsx("h6",{children:e}),a.map((e,a)=>s.jsxs("a",{className:"bls-teammate-row",onClick:()=>o&&o(e.id,e.name),children:[s.jsx("div",{className:"bls-teammate-number",children:a+1}),s.jsx("div",{className:"bls-teammate-image",children:e.player_image?s.jsx(h,{src:e.player_image,alt:e.name,preset:"playerAvatar"}):s.jsx("i",{className:"fas fa-user"})}),s.jsx("div",{className:"bls-teammate-name",children:e.name})]},e.id))]},e))]})]}),s.jsx("div",{className:"bls-back-section"})]})]}),s.jsx("button",{className:"player-share-btn-fixed",onClick:()=>D(!0),title:"Share Player Card",children:s.jsx("i",{className:"fas fa-share-alt"})}),s.jsx(n,{player:{name:g.name,image:g.player_image,position:g.position,jersey_number:k,goals:B.goals,assists:B.assists,is_captain:g.is_captain},team:I}),q&&s.jsx(c,{player:{name:g.name,image:g.player_image,position:g.position,jersey_number:k,goals:B.goals,assists:B.assists,is_captain:g.is_captain},team:I,onClose:()=>D(!1)}),s.jsx(r,{edition:"2026"})]})]})}const u={GK:"Goalkeeper",CB:"Defender",LB:"Defender",RB:"Defender",CDM:"Midfielder",CM:"Midfielder",CAM:"Midfielder",LM:"Midfielder",RM:"Midfielder",CF:"Striker",ST:"Striker",SUB:"Substitute"},g={Goalkeeper:"#4CAF50",Defender:"#2196F3",Midfielder:"#FF9800",Striker:"#f44336",Substitute:"#9e9e9e"},x=e=>u[e]||e,j=t.memo(function({player:e,team:a,onClick:t,index:l}){var r;const i=x(e.position),n=g[i]||"#666",c=l<10;return s.jsxs("div",{className:"player-card-db",onClick:t,style:{cursor:"pointer"},children:[s.jsx("div",{className:"position-tag",style:{backgroundColor:n},children:i.toUpperCase()}),s.jsx("div",{className:"player-photo-container",children:e.player_image?s.jsx(o,{src:e.player_image,preset:"playerCard",alt:e.name,className:"player-photo",loading:c?"eager":"lazy",decoding:"async",fetchpriority:c?"high":"auto"}):s.jsx("img",{src:"/assets/img/player-placeholder.svg",alt:"",className:"player-photo player-photo-placeholder-img",loading:"lazy",decoding:"async"})}),s.jsxs("div",{className:"player-info-bar",children:[s.jsx("div",{className:"team-logo-small",children:(null==a?void 0:a.crest_url)?s.jsx(o,{src:a.crest_url,preset:"crestSm",alt:a.name,className:"team-logo-img",loading:c?"eager":"lazy",decoding:"async",fetchpriority:c?"high":"auto"}):s.jsx("span",{children:(null==(r=null==a?void 0:a.name)?void 0:r.charAt(0))||"?"})}),s.jsx("span",{className:"player-name-db",children:e.name})]})]})});function y(){const[t,l]=e.useState([]),[n,c]=e.useState([]),[o,d]=e.useState(!0),[m,h]=e.useState(""),[u,g]=e.useState("all"),[y,f]=e.useState("all"),[v,N]=e.useState(null),[_,w]=e.useState("list"),[b,S]=e.useState((()=>{try{const e=new URLSearchParams(window.location.search),a=parseInt(e.get("page")||"1",10);return Number.isFinite(a)&&a>0?a:1}catch{return 1}})()),[M]=e.useState(window.location.pathname.includes("/u17/")?"u17":"open-age");e.useEffect(()=>{try{const e=new URL(window.location.href),a=new URLSearchParams(window.location.search);a.get("player")||e.searchParams.get("page")||(e.searchParams.set("page",String(b||1)),window.history.replaceState({},"",e.toString()))}catch{}},[]),e.useEffect(()=>{const e=new URLSearchParams(window.location.search).get("player");return e?(N(e),w("detail"),d(!1)):C(),window.addEventListener("popstate",k),()=>window.removeEventListener("popstate",k)},[]);const k=()=>{const e=new URLSearchParams(window.location.search),a=e.get("player");if(a)N(a),w("detail");else{w("list"),N(null);const a=e.get("page");if(a){const e=parseInt(a,10);Number.isFinite(e)&&e>0&&S(e)}}},C=async()=>{try{const{data:e,error:s}=await a.from("teams").select("id, name, crest_url, category").eq("category",M).order("name",{ascending:!0});if(s)throw s;const{data:t,error:r}=await a.from("players").select("*, team:teams(id, name, crest_url, category)").order("name",{ascending:!0});if(r)throw r;const i=(t||[]).filter(e=>e.team&&e.team.category===M),n=(e||[]).map(e=>({id:e.id,team_name:e.name,team_logo:e.crest_url,category:e.category}));c(n),l(i)}catch(e){}finally{d(!1)}},L=()=>{const e=new URL(window.location.href);e.searchParams.delete("player"),e.searchParams.set("page",String(b||1)),window.history.pushState({},"",e.toString()),w("list"),N(null)},P=e.useMemo(()=>{const e=m.trim().toLowerCase();return t.filter(a=>{var s;const t=!e||(null==(s=a.name)?void 0:s.toLowerCase().includes(e)),l="all"===u||a.team_id===u,r=x(a.position);return t&&l&&("all"===y||r===y)})},[t,m,u,y]);e.useEffect(()=>{S(1);try{if(!new URLSearchParams(window.location.search).get("player")){const e=new URL(window.location.href);e.searchParams.set("page","1"),window.history.replaceState({},"",e.toString())}}catch{}},[m,u,y]);const q=e.useMemo(()=>Math.max(1,Math.ceil(P.length/15)),[P.length]),D=Math.min(Math.max(b,1),q);e.useEffect(()=>{b!==D&&S(D)},[D]);const F=e.useMemo(()=>{const e=15*(D-1);return P.slice(e,e+15)},[P,D]),R=e=>{const a=Math.min(Math.max(e,1),q);S(a);try{const e=new URL(window.location.href);e.searchParams.set("page",String(a)),window.history.replaceState({},"",e.toString())}catch{}window.scrollTo({top:0,behavior:"smooth"})};return o?s.jsx("div",{className:"players-loading",children:s.jsxs("div",{className:"players-loading-content",children:[s.jsxs("div",{className:"logo-loader",children:[s.jsx("div",{className:"logo-ring"}),s.jsx("img",{src:"/assets/img/muq_invert.png",alt:"Muqawama",className:"logo-pulse"})]}),s.jsx("p",{children:"Loading players..."})]})}):"detail"===_&&v?s.jsx(p,{playerId:v,onBack:L,onNavigateToPlayer:(e,a)=>{const s=`/muqawamah/2026/${M}/players/?player=${e}`;window.history.pushState({playerId:e},"",s),N(e),window.scrollTo(0,0)},onNavigateToMatch:e=>{window.location.href=`/muqawamah/2026/${M}/fixtures/?match=${e}`}}):s.jsxs(s.Fragment,{children:[s.jsx(i,{}),s.jsxs("div",{className:"player-database",children:[s.jsxs("div",{className:"player-database-header",children:[s.jsx("h1",{className:"player-database-title",children:"Player Database"}),s.jsxs("div",{className:"player-filters",children:[s.jsxs("div",{className:"search-box",children:[s.jsx("i",{className:"fas fa-search"}),s.jsx("input",{type:"text",placeholder:"Write a player name and hit enter...",value:m,onChange:e=>h(e.target.value)})]}),s.jsxs("div",{className:"filter-row",children:[s.jsxs("select",{value:u,onChange:e=>g(e.target.value),className:"filter-select",children:[s.jsx("option",{value:"all",children:"ALL TEAMS"}),n.map(e=>s.jsx("option",{value:e.id,children:e.team_name},e.id))]}),s.jsxs("select",{value:y,onChange:e=>f(e.target.value),className:"filter-select filter-select-wide",children:[s.jsx("option",{value:"all",children:"ALL POSITIONS"}),s.jsx("option",{value:"Goalkeeper",children:"Goalkeeper"}),s.jsx("option",{value:"Defender",children:"Defender"}),s.jsx("option",{value:"Midfielder",children:"Midfielder"}),s.jsx("option",{value:"Striker",children:"Striker"}),s.jsx("option",{value:"Substitute",children:"Substitute"})]}),s.jsx("button",{className:"reset-btn",onClick:()=>{h(""),g("all"),f("all")},children:"RESET"})]})]})]}),s.jsx("div",{className:"players-count",children:s.jsxs("span",{children:[P.length," players found"]})}),s.jsx("div",{className:"players-grid",children:F.map((e,a)=>s.jsx(j,{player:e,team:e.team,onClick:()=>(e=>{const a=`/muqawamah/2026/${M}/players/?player=${e.id}`;window.history.pushState({playerId:e.id},"",a),N(e.id),w("detail"),window.scrollTo(0,0)})(e),index:a},e.id))}),P.length>0&&s.jsxs("div",{className:"players-pagination",children:[s.jsx("button",{className:"pagination-btn",onClick:()=>R(D-1),disabled:D<=1,"aria-label":"Previous page",children:"«"}),(()=>{const e=[],a=a=>e.push(a);a(1);const s=Math.max(2,D-1),t=Math.min(q-1,D+1);s>2&&a("…");for(let l=s;l<=t;l++)a(l);return t<q-1&&a("…"),q>1&&a(q),e.filter((a,s)=>0===s||a!==e[s-1])})().map((e,a)=>"…"===e?s.jsx("span",{className:"pagination-ellipsis",children:"…"},`ellipsis-${a}`):s.jsx("button",{className:"pagination-btn "+(e===D?"active":""),onClick:()=>R(e),"aria-current":e===D?"page":void 0,children:e},`page-${e}`)),s.jsx("button",{className:"pagination-btn",onClick:()=>R(D+1),disabled:D>=q,"aria-label":"Next page",children:"»"})]}),0===P.length&&s.jsxs("div",{className:"no-players",children:[s.jsx("i",{className:"fas fa-users-slash"}),s.jsx("p",{children:"No players found matching your criteria"})]}),s.jsx(r,{edition:"2026"})]})]})}l.createRoot(document.getElementById("players-root")).render(s.jsx(t.StrictMode,{children:s.jsx(y,{})}));
