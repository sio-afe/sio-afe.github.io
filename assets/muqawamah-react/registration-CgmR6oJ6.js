import{r as e,j as a,s as t,R as s,c as n}from"./supabaseClient-Bdusv2SU.js";/* empty css            */function i({onSuccess:s}){const[n,i]=e.useState(""),[r,l]=e.useState(!1);return a.jsx("div",{className:"auth-modal",children:a.jsxs("div",{className:"auth-card",children:[a.jsx("div",{className:"auth-logo",children:a.jsx("img",{src:"/assets/img/title.png",alt:"Muqawama 2026"})}),a.jsx("h2",{children:"Welcome to Muqawama 2026"}),a.jsx("p",{className:"auth-subtitle",children:"Sign in with your Google account to register your team and manage your registration."}),n&&a.jsx("p",{className:"auth-error",children:n}),a.jsx("div",{className:"auth-alternative",children:a.jsx("button",{type:"button",className:"auth-oauth-btn google-btn",onClick:async()=>{i(""),l(!0);try{const{data:e,error:a}=await t.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.origin+"/muqawamah/2026/register/"}});if(a)throw a}catch(e){i(`Google sign-in failed: ${e.message}. Please contact support.`),l(!1)}},disabled:r,children:r?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"spinner-small"})," Signing in..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fab fa-google"})," Continue with Google"]})})}),a.jsxs("p",{className:"auth-note",children:[a.jsx("i",{className:"fas fa-info-circle"})," Your Google account will be used to authenticate and save your team registration."]})]})})}const r=e.createContext(null),l=()=>{const a=e.useContext(r);if(!a)throw new Error("useRegistration must be used within RegistrationProvider");return a},o=()=>[...["GK","CB","LB","RB","CM","LM","ST"].map((e,a)=>({id:`${e}-${a}`,name:"",age:"",aadhar_no:"",position:e,isSubstitute:!1,image:null,x:50,y:50})),...["SUB1","SUB2","SUB3","SUB4"].map((e,a)=>({id:`${e}-${a}`,name:"",age:"",aadhar_no:"",position:"SUB",isSubstitute:!0,image:null,x:10+20*a,y:90}))],c={teamName:"",category:"open-age",teamLogo:null,teamLogoFileName:null,captainName:"",captainEmail:"",captainPhone:"",formation:"1-3-2-1"},m=({children:s})=>{const[n,i]=e.useState(1),[l,m]=e.useState(c),[d,u]=e.useState(o()),[h,p]=e.useState(!1),[f,g]=e.useState(!1),[x,j]=e.useState(null),[y,N]=e.useState(null),[v,w]=e.useState(null),[b,S]=e.useState(!1),[P,C]=e.useState(null),[_,E]=e.useState(null),[M,k]=e.useState(0),T=()=>{m(c),u(o()),N(null),w(null),C(null),E(null),k(0),i(1)},R=e.useCallback(async e=>{g(!0),j(null);try{const{data:{user:a}}=await t.auth.getUser();if(!a)throw new Error("You must be logged in to save your progress.");let s=v;const n={user_id:a.id,team_name:l.teamName||"Draft Team",category:l.category,team_logo:l.teamLogo,captain_name:l.captainName,captain_email:l.captainEmail||a.email,captain_phone:l.captainPhone,formation:l.formation,status:"submitted",last_saved_step:e,submitted_at:(new Date).toISOString()};if(v){const{error:e}=await t.from("team_registrations").update(n).eq("id",v);if(e)throw e}else{const{data:e,error:a}=await t.from("team_registrations").insert(n).select().single();if(a)throw a;s=e.id,w(s)}if(d.filter(e=>e.name||e.image).length>0&&s){await t.from("team_players").delete().eq("team_id",s);const e=d.map(e=>({team_id:s,player_name:e.name,player_age:e.age?parseInt(e.age):null,aadhar_no:e.aadhar_no||null,position:e.position,is_substitute:e.isSubstitute,player_image:e.image,position_x:e.x,position_y:e.y})),{error:a}=await t.from("team_players").insert(e);if(a)throw a}return k(e),{success:!0,teamId:s}}catch(a){return j(a.message),{success:!1,error:a.message}}finally{g(!1)}},[v,l,d]),L=e.useMemo(()=>({step:n,setStep:i,teamData:l,setTeamData:m,players:d,setPlayers:u,loading:h,setLoading:p,saving:f,setSaving:g,error:x,setError:j,successTeamId:y,setSuccessTeamId:N,existingTeamId:v,setExistingTeamId:w,readOnlyMode:b,setReadOnlyMode:S,paymentStatus:P,setPaymentStatus:C,transactionId:_,setTransactionId:E,lastSavedStep:M,setLastSavedStep:k,resetForm:T,saveProgress:R}),[n,l,d,h,f,x,y,v,b,P,_,M,R]);return a.jsx(r.Provider,{value:L,children:s})};const d=(()=>{let e=0;return()=>(e+=1,`u${`0000${(Math.random()*36**4|0).toString(36)}`.slice(-4)}${e}`)})();function u(e){const a=[];for(let t=0,s=e.length;t<s;t++)a.push(e[t]);return a}let h=null;function p(e={}){return h||(e.includeStyleProperties?(h=e.includeStyleProperties,h):(h=u(window.getComputedStyle(document.documentElement)),h))}function f(e,a){const t=(e.ownerDocument.defaultView||window).getComputedStyle(e).getPropertyValue(a);return t?parseFloat(t.replace("px","")):0}function g(e,a={}){return{width:a.width||function(e){const a=f(e,"border-left-width"),t=f(e,"border-right-width");return e.clientWidth+a+t}(e),height:a.height||function(e){const a=f(e,"border-top-width"),t=f(e,"border-bottom-width");return e.clientHeight+a+t}(e)}}const x=16384;function j(e){return new Promise((a,t)=>{const s=new Image;s.onload=()=>{s.decode().then(()=>{requestAnimationFrame(()=>a(s))})},s.onerror=t,s.crossOrigin="anonymous",s.decoding="async",s.src=e})}async function y(e,a,t){const s="http://www.w3.org/2000/svg",n=document.createElementNS(s,"svg"),i=document.createElementNS(s,"foreignObject");return n.setAttribute("width",`${a}`),n.setAttribute("height",`${t}`),n.setAttribute("viewBox",`0 0 ${a} ${t}`),i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("externalResourcesRequired","true"),n.appendChild(i),i.appendChild(e),async function(e){return Promise.resolve().then(()=>(new XMLSerializer).serializeToString(e)).then(encodeURIComponent).then(e=>`data:image/svg+xml;charset=utf-8,${e}`)}(n)}const N=(e,a)=>{if(e instanceof a)return!0;const t=Object.getPrototypeOf(e);return null!==t&&(t.constructor.name===a.name||N(t,a))};function v(e,a,t,s){const n=`.${e}:${a}`,i=t.cssText?function(e){const a=e.getPropertyValue("content");return`${e.cssText} content: '${a.replace(/'|"/g,"")}';`}(t):function(e,a){return p(a).map(a=>`${a}: ${e.getPropertyValue(a)}${e.getPropertyPriority(a)?" !important":""};`).join(" ")}(t,s);return document.createTextNode(`${n}{${i}}`)}function w(e,a,t,s){const n=window.getComputedStyle(e,t),i=n.getPropertyValue("content");if(""===i||"none"===i)return;const r=d();try{a.className=`${a.className} ${r}`}catch(o){return}const l=document.createElement("style");l.appendChild(v(r,t,n,s)),a.appendChild(l)}const b="application/font-woff",S="image/jpeg",P={woff:b,woff2:b,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:S,jpeg:S,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function C(e){const a=function(e){const a=/\.([^./]*?)$/g.exec(e);return a?a[1]:""}(e).toLowerCase();return P[a]||""}function _(e){return-1!==e.search(/^(data:)/)}async function E(e,a,t){const s=await fetch(e,a);if(404===s.status)throw new Error(`Resource "${s.url}" not found`);const n=await s.blob();return new Promise((e,a)=>{const i=new FileReader;i.onerror=a,i.onloadend=()=>{try{e(t({res:s,result:i.result}))}catch(n){a(n)}},i.readAsDataURL(n)})}const M={};async function k(e,a,t){const s=function(e,a,t){let s=e.replace(/\?.*/,"");return t&&(s=e),/ttf|otf|eot|woff2?/i.test(s)&&(s=s.replace(/.*\//,"")),a?`[${a}]${s}`:s}(e,a,t.includeQueryParams);if(null!=M[s])return M[s];let n;t.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime());try{const s=await E(e,t.fetchRequestInit,({res:e,result:t})=>(a||(a=e.headers.get("Content-Type")||""),function(e){return e.split(/,/)[1]}(t)));n=function(e,a){return`data:${a};base64,${e}`}(s,a)}catch(i){n=t.imagePlaceholder||"";let a=`Failed to fetch resource: ${e}`;i&&(a="string"==typeof i?i:i.message)}return M[s]=n,n}async function T(e,a){return N(e,HTMLCanvasElement)?async function(e){const a=e.toDataURL();return"data:,"===a?e.cloneNode(!1):j(a)}(e):N(e,HTMLVideoElement)?async function(e,a){if(e.currentSrc){const a=document.createElement("canvas"),t=a.getContext("2d");return a.width=e.clientWidth,a.height=e.clientHeight,null==t||t.drawImage(e,0,0,a.width,a.height),j(a.toDataURL())}const t=e.poster,s=C(t);return j(await k(t,s,a))}(e,a):N(e,HTMLIFrameElement)?async function(e,a){var t;try{if(null===(t=null==e?void 0:e.contentDocument)||void 0===t?void 0:t.body)return await F(e.contentDocument.body,a,!0)}catch(s){}return e.cloneNode(!1)}(e,a):e.cloneNode(L(e))}const R=e=>null!=e.tagName&&"SLOT"===e.tagName.toUpperCase(),L=e=>null!=e.tagName&&"SVG"===e.tagName.toUpperCase();function D(e,a,t){return N(a,Element)&&(function(e,a,t){const s=a.style;if(!s)return;const n=window.getComputedStyle(e);n.cssText?(s.cssText=n.cssText,s.transformOrigin=n.transformOrigin):p(t).forEach(t=>{let i=n.getPropertyValue(t);if("font-size"===t&&i.endsWith("px")){const e=Math.floor(parseFloat(i.substring(0,i.length-2)))-.1;i=`${e}px`}N(e,HTMLIFrameElement)&&"display"===t&&"inline"===i&&(i="block"),"d"===t&&a.getAttribute("d")&&(i=`path(${a.getAttribute("d")})`),s.setProperty(t,i,n.getPropertyPriority(t))})}(e,a,t),function(e,a,t){w(e,a,":before",t),w(e,a,":after",t)}(e,a,t),function(e,a){N(e,HTMLTextAreaElement)&&(a.innerHTML=e.value),N(e,HTMLInputElement)&&a.setAttribute("value",e.value)}(e,a),function(e,a){if(N(e,HTMLSelectElement)){const t=a,s=Array.from(t.children).find(a=>e.value===a.getAttribute("value"));s&&s.setAttribute("selected","")}}(e,a)),a}async function F(e,a,t){return t||!a.filter||a.filter(e)?Promise.resolve(e).then(e=>T(e,a)).then(t=>async function(e,a,t){var s,n;if(L(a))return a;let i=[];return i=R(e)&&e.assignedNodes?u(e.assignedNodes()):N(e,HTMLIFrameElement)&&(null===(s=e.contentDocument)||void 0===s?void 0:s.body)?u(e.contentDocument.body.childNodes):u((null!==(n=e.shadowRoot)&&void 0!==n?n:e).childNodes),0===i.length||N(e,HTMLVideoElement)||await i.reduce((e,s)=>e.then(()=>F(s,t)).then(e=>{e&&a.appendChild(e)}),Promise.resolve()),a}(e,t,a)).then(t=>D(e,t,a)).then(e=>async function(e,a){const t=e.querySelectorAll?e.querySelectorAll("use"):[];if(0===t.length)return e;const s={};for(let i=0;i<t.length;i++){const n=t[i].getAttribute("xlink:href");if(n){const t=e.querySelector(n),i=document.querySelector(n);t||!i||s[n]||(s[n]=await F(i,a,!0))}}const n=Object.values(s);if(n.length){const a="http://www.w3.org/1999/xhtml",t=document.createElementNS(a,"svg");t.setAttribute("xmlns",a),t.style.position="absolute",t.style.width="0",t.style.height="0",t.style.overflow="hidden",t.style.display="none";const s=document.createElementNS(a,"defs");t.appendChild(s);for(let e=0;e<n.length;e++)s.appendChild(n[e]);e.appendChild(t)}return e}(e,a)):null}const $=/url\((['"]?)([^'"]+?)\1\)/g,I=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,A=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;async function B(e,a,t,s,n){try{const i=t?function(e,a){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;const t=document.implementation.createHTMLDocument(),s=t.createElement("base"),n=t.createElement("a");return t.head.appendChild(s),t.body.appendChild(n),a&&(s.href=a),n.href=e,n.href}(a,t):a,r=C(a);let l;return n||(l=await k(i,r,s)),e.replace(function(e){const a=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${a})(['"]?\\))`,"g")}(a),`$1${l}$3`)}catch(i){}return e}function q(e){return-1!==e.search($)}async function O(e,a,t){if(!q(e))return e;const s=function(e,{preferredFontFormat:a}){return a?e.replace(A,e=>{for(;;){const[t,,s]=I.exec(e)||[];if(!s)return"";if(s===a)return`src: ${t};`}}):e}(e,t),n=function(e){const a=[];return e.replace($,(e,t,s)=>(a.push(s),e)),a.filter(e=>!_(e))}(s);return n.reduce((e,s)=>e.then(e=>B(e,s,a,t)),Promise.resolve(s))}async function U(e,a,t){var s;const n=null===(s=a.style)||void 0===s?void 0:s.getPropertyValue(e);if(n){const s=await O(n,null,t);return a.style.setProperty(e,s,a.style.getPropertyPriority(e)),!0}return!1}async function H(e,a){N(e,Element)&&(await async function(e,a){await U("background",e,a)||await U("background-image",e,a),await U("mask",e,a)||await U("-webkit-mask",e,a)||await U("mask-image",e,a)||await U("-webkit-mask-image",e,a)}(e,a),await async function(e,a){const t=N(e,HTMLImageElement);if((!t||_(e.src))&&(!N(e,SVGImageElement)||_(e.href.baseVal)))return;const s=t?e.src:e.href.baseVal,n=await k(s,C(s),a);await new Promise((s,i)=>{e.onload=s,e.onerror=a.onImageErrorHandler?(...e)=>{try{s(a.onImageErrorHandler(...e))}catch(t){i(t)}}:i;const r=e;r.decode&&(r.decode=s),"lazy"===r.loading&&(r.loading="eager"),t?(e.srcset="",e.src=n):e.href.baseVal=n})}(e,a),await async function(e,a){const t=u(e.childNodes).map(e=>H(e,a));await Promise.all(t).then(()=>e)}(e,a))}const G={};async function V(e){let a=G[e];if(null!=a)return a;const t=await fetch(e);return a={url:e,cssText:await t.text()},G[e]=a,a}async function W(e,a){let t=e.cssText;const s=/url\(["']?([^"')]+)["']?\)/g,n=(t.match(/url\([^)]+\)/g)||[]).map(async n=>{let i=n.replace(s,"$1");return i.startsWith("https://")||(i=new URL(i,e.url).href),E(i,a.fetchRequestInit,({result:e})=>(t=t.replace(n,`url(${e})`),[n,e]))});return Promise.all(n).then(()=>t)}function z(e){if(null==e)return[];const a=[];let t=e.replace(/(\/\*[\s\S]*?\*\/)/gi,"");const s=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const e=s.exec(t);if(null===e)break;a.push(e[0])}t=t.replace(s,"");const n=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,i=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let e=n.exec(t);if(null===e){if(e=i.exec(t),null===e)break;n.lastIndex=i.lastIndex}else i.lastIndex=n.lastIndex;a.push(e[0])}return a}async function Y(e,a){if(null==e.ownerDocument)throw new Error("Provided element is not within a Document");const t=u(e.ownerDocument.styleSheets),s=await async function(e,a){const t=[],s=[];return e.forEach(t=>{if("cssRules"in t)try{u(t.cssRules||[]).forEach((e,n)=>{if(e.type===CSSRule.IMPORT_RULE){let i=n+1;const r=V(e.href).then(e=>W(e,a)).then(e=>z(e).forEach(e=>{try{t.insertRule(e,e.startsWith("@import")?i+=1:t.cssRules.length)}catch(a){}})).catch(e=>{});s.push(r)}})}catch(n){const i=e.find(e=>null==e.href)||document.styleSheets[0];null!=t.href&&s.push(V(t.href).then(e=>W(e,a)).then(e=>z(e).forEach(e=>{i.insertRule(e,i.cssRules.length)})).catch(e=>{}))}}),Promise.all(s).then(()=>(e.forEach(e=>{if("cssRules"in e)try{u(e.cssRules||[]).forEach(e=>{t.push(e)})}catch(a){}}),t))}(t,a);return function(e){return e.filter(e=>e.type===CSSRule.FONT_FACE_RULE).filter(e=>q(e.style.getPropertyValue("src")))}(s)}function K(e){return e.trim().replace(/["']/g,"")}async function X(e,a){const t=await Y(e,a),s=function(e){const a=new Set;return function e(t){(t.style.fontFamily||getComputedStyle(t).fontFamily).split(",").forEach(e=>{a.add(K(e))}),Array.from(t.children).forEach(a=>{a instanceof HTMLElement&&e(a)})}(e),a}(e);return(await Promise.all(t.filter(e=>s.has(K(e.style.fontFamily))).map(e=>{const t=e.parentStyleSheet?e.parentStyleSheet.href:null;return O(e.cssText,t,a)}))).join("\n")}async function J(e,a={}){const{width:t,height:s}=g(e,a),n=await F(e,a,!0);await async function(e,a){const t=null!=a.fontEmbedCSS?a.fontEmbedCSS:a.skipFonts?null:await X(e,a);if(t){const a=document.createElement("style"),s=document.createTextNode(t);a.appendChild(s),e.firstChild?e.insertBefore(a,e.firstChild):e.appendChild(a)}}(n,a),await H(n,a),function(e,a){const{style:t}=e;a.backgroundColor&&(t.backgroundColor=a.backgroundColor),a.width&&(t.width=`${a.width}px`),a.height&&(t.height=`${a.height}px`);const s=a.style;null!=s&&Object.keys(s).forEach(e=>{t[e]=s[e]})}(n,a);return await y(n,t,s)}async function Q(e,a={}){const{width:t,height:s}=g(e,a),n=await J(e,a),i=await j(n),r=document.createElement("canvas"),l=r.getContext("2d"),o=a.pixelRatio||function(){let e,a;try{a=process}catch(s){}const t=a&&a.env?a.env.devicePixelRatio:null;return t&&(e=parseInt(t,10),Number.isNaN(e)&&(e=1)),e||window.devicePixelRatio||1}(),c=a.canvasWidth||t,m=a.canvasHeight||s;return r.width=c*o,r.height=m*o,a.skipAutoScale||function(e){(e.width>x||e.height>x)&&(e.width>x&&e.height>x?e.width>e.height?(e.height*=x/e.width,e.width=x):(e.width*=x/e.height,e.height=x):e.width>x?(e.height*=x/e.width,e.width=x):(e.width*=x/e.height,e.height=x))}(r),r.style.width=`${c}`,r.style.height=`${m}`,a.backgroundColor&&(l.fillStyle=a.backgroundColor,l.fillRect(0,0,r.width,r.height)),l.drawImage(i,0,0,r.width,r.height),r}const Z=s.forwardRef(({children:e,...t},s)=>a.jsxs("svg",{ref:s,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 74 111",className:"field-svg",...t,children:[a.jsx("rect",{width:"74",height:"111",fill:"#ffffff"}),a.jsxs("g",{fill:"none",stroke:"#000",strokeWidth:"0.5",transform:"translate(3 3)",children:[a.jsx("path",{d:"M 0 0 h 68 v 105 h -68 Z"}),a.jsx("path",{d:"M 0 52.5 h 68"}),a.jsx("circle",{r:"9.15",cx:"34",cy:"52.5"}),a.jsx("circle",{r:"0.75",cx:"34",cy:"52.5",fill:"#000",stroke:"none"}),a.jsxs("g",{children:[a.jsx("path",{d:"M 13.84 0 v 16.5 h 40.32 v -16.5"}),a.jsx("path",{d:"M 24.84 0 v 5.5 h 18.32 v -5.5"}),a.jsx("circle",{r:"0.75",cx:"34",cy:"10.94",fill:"#000",stroke:"none"}),a.jsx("path",{d:"M 26.733027 16.5 a 9.15 9.15 0 0 0 14.533946 0"})]}),a.jsxs("g",{transform:"rotate(180,34,52.5)",children:[a.jsx("path",{d:"M 13.84 0 v 16.5 h 40.32 v -16.5"}),a.jsx("path",{d:"M 24.84 0 v 5.5 h 18.32 v -5.5"}),a.jsx("circle",{r:"0.75",cx:"34",cy:"10.94",fill:"#000",stroke:"none"}),a.jsx("path",{d:"M 26.733027 16.5 a 9.15 9.15 0 0 0 14.533946 0"})]}),a.jsx("path",{d:"M 0 2 a 2 2 0 0 0 2 -2M 66 0 a 2 2 0 0 0 2 2M 68 103 a 2 2 0 0 0 -2 2M 2 105 a 2 2 0 0 0 -2 -2"})]}),e]}));function ee({players:t,editable:s=!1,onDragStart:n,onDrag:i,onDragEnd:r,showDownload:l=!1}){const o=e.useRef(null),c=e.useRef(null),[m,d]=e.useState(!1),[u,h]=e.useState(null),p=e.useMemo(()=>`muqawamah-formation-${(new Date).toISOString().split("T")[0]}.png`,[]),f=()=>{u&&(h(null),r&&r())};return a.jsxs("div",{className:"formation-preview-wrapper",children:[a.jsx("div",{className:"football-field-svg",ref:o,onMouseMove:e=>{u&&s&&o.current&&(e.preventDefault(),i&&i(e))},onMouseUp:f,onMouseLeave:f,onTouchMove:e=>{u&&s&&o.current&&(e.preventDefault(),i&&i(e))},onTouchEnd:()=>{u&&(h(null),r&&r())},children:a.jsx(Z,{ref:c,style:{width:"100%",height:"auto",maxWidth:"400px",display:"block",margin:"0 auto"},children:t.map(e=>{const t=3+e.x/100*68,i=3+e.y/100*105;return a.jsxs("g",{transform:`translate(${t}, ${i})`,className:s?"player-marker-draggable":"player-marker-static",style:{cursor:s?"move":"default"},onMouseDown:a=>((e,a)=>{s&&(e.preventDefault(),h(a.id),n&&n(e,a.id))})(a,e),onTouchStart:a=>((e,a)=>{s&&(h(a.id),n&&n(e,a.id))})(a,e),children:[a.jsx("circle",{r:"3",fill:"#4a90e2",stroke:"#fff",strokeWidth:"0.5"}),e.image?a.jsx("image",{href:e.image,x:"-3",y:"-3",width:"6",height:"6",clipPath:"circle(3px at center)",style:{borderRadius:"50%"}}):a.jsx("text",{x:"0",y:"1",textAnchor:"middle",fill:"#fff",fontSize:"2.5",fontWeight:"600",children:e.position}),a.jsx("text",{x:"0",y:"5.5",textAnchor:"middle",fill:"#000",fontSize:"1.8",fontWeight:"600",children:e.name||"Player"}),a.jsx("text",{x:"0",y:"7.5",textAnchor:"middle",fill:"#666",fontSize:"1.5",fontWeight:"400",children:e.position})]},e.id)})})}),l&&a.jsxs("button",{type:"button",className:"download-formation-btn",onClick:async()=>{if(o.current)try{d(!0);const e=await async function(e,a={}){return(await Q(e,a)).toDataURL()}(o.current,{cacheBust:!0,pixelRatio:window.devicePixelRatio||2,backgroundColor:"#ffffff"}),a=document.createElement("a");a.download=p,a.href=e,a.click()}catch(e){alert("Unable to download formation right now. Please try again.")}finally{d(!1)}},disabled:m,children:[a.jsx("i",{className:"fas fa-download"}),a.jsx("span",{children:m?"Preparing...":"Download Formation"})]})]})}Z.displayName="FootballFieldSVG";const ae=["1-3-2-1","1-2-3-1","1-2-2-2","1-3-1-2","1-4-1-1"],te=85,se=100,ne=(e,a)=>"GK"===e?Math.max(te,Math.min(se,a)):Math.max(0,Math.min(100,a)),ie={GK:50,CB:50,LB:25,RB:75,CDM:50,CM:50,CAM:50,LM:20,RM:80,CF:50,ST:50},re=e=>{const a=[...e],t=e.filter(e=>!e.isSubstitute),s={};return t.forEach(t=>{const n=t.position,i=s[n]||0;let r=ie[n]||50,l=POSITION_Y_MAP[n]||50;i>0&&("CB"===n||"CM"===n||"ST"===n||"CF"===n?r=1===i?30:2===i?70:50:"LB"===n?r=20-5*i:"RB"===n&&(r=80+5*i)),s[n]=i+1;const o=e.indexOf(t);a[o]={...t,x:r,y:l}}),a},le=(e,a)=>{if(!a)return re(e);const t=a.split("-").map(e=>parseInt(e,10)).filter(e=>!isNaN(e));if(0===t.length)return re(e);const s=[...e],n=[...e.filter(e=>!e.isSubstitute)].sort((e,a)=>"GK"===e.position?-1:"GK"===a.position?1:0),i=[92,78,55,35,15];let r=0;return t.forEach((a,t)=>{const l=i[t]||50;for(let i=0;i<a&&!(r>=n.length);i++){const t=n[r];let o;if(1===a)o=50;else if(2===a)o=0===i?30:70;else if(3===a)o=0===i?20:1===i?50:80;else if(4===a)o=[15,35,65,85][i];else if(5===a)o=[10,27.5,50,72.5,90][i];else{o=100/(a+1)*(i+1)}const c=ne(t.position,l),m=e.indexOf(t);s[m]={...t,x:o,y:c},r++}}),s};function oe(){const{players:t,setPlayers:s,teamData:n,setTeamData:i,setStep:r,saveProgress:o,saving:c,error:m}=l(),d=e.useRef(null),[u,h]=e.useState(null),[p,f]=e.useState(!1);e.useEffect(()=>{if(!p&&n.formation&&t.length>0){const e=le(t,n.formation);s(e),f(!0)}},[]);return a.jsxs("form",{className:"registration-form",onSubmit:async e=>{e.preventDefault();(await o(3)).success&&r(4)},children:[a.jsx("h3",{children:"Step 3 Â· Formation & Positions"}),a.jsx("p",{className:"step-description",children:"Choose a preset formation below, then drag players to customize positions."}),a.jsxs("div",{className:"formation-instruction-box",children:[a.jsx("div",{className:"instruction-icon",children:a.jsx("i",{className:"fas fa-hand-pointer"})}),a.jsxs("div",{className:"instruction-content",children:[a.jsx("strong",{className:"instruction-title",children:"Interactive Field"}),a.jsx("p",{className:"instruction-text",children:"Click and drag any player on the field to reposition them"})]})]}),a.jsxs("div",{className:"formation-presets-section",children:[a.jsxs("div",{className:"presets-header",children:[a.jsx("i",{className:"fas fa-chess-board"}),a.jsx("span",{className:"presets-title",children:"Choose Formation"})]}),a.jsx("div",{className:"formation-buttons-grid",children:ae.map(e=>a.jsx("button",{type:"button",className:"formation-preset-btn "+(n.formation===e?"active":""),onClick:()=>(e=>{s(a=>le(a,e)),i(a=>({...a,formation:e}))})(e),children:a.jsx("span",{className:"formation-name",children:e})},e))})]}),a.jsx("div",{ref:d,className:"formation-field-container",children:a.jsx(ee,{players:t.filter(e=>!e.isSubstitute),editable:!0,onDragStart:(e,a)=>{h(a)},onDrag:e=>{if(!u||!d.current)return;e.preventDefault();const a=d.current.querySelector("svg");if(!a)return;const t=a.getBoundingClientRect(),n=e.touches?e.touches[0].clientX:e.clientX,i=e.touches?e.touches[0].clientY:e.clientY,r=(n-t.left)/t.width*100,l=(i-t.top)/t.height*100,o=Math.min(Math.max(r,0),100),c=Math.min(Math.max(l,0),100);((e,a,t)=>{s(s=>s.map(s=>s.id===e?{...s,x:a,y:t}:s))})(u,o,c)},onDragEnd:()=>{h(null)}})}),m&&a.jsx("p",{className:"auth-error",children:m}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"secondary-btn",onClick:()=>r(2),disabled:c,children:"Back"}),a.jsx("button",{type:"submit",className:"primary-btn",disabled:c,children:c?a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-spinner fa-spin"})," Saving..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-save"})," Save & Review"]})})]})]})}function ce(){const{teamData:e,resetForm:t}=l();return a.jsx("div",{className:"registration-form registration-complete",children:a.jsxs("div",{className:"complete-container",children:[a.jsx("div",{className:"complete-icon",children:a.jsx("div",{className:"icon-circle success",children:a.jsx("i",{className:"fas fa-check"})})}),a.jsx("h2",{children:"Thank You for Registering!"}),a.jsxs("div",{className:"complete-team-info",children:[e.teamLogo&&a.jsx("img",{src:e.teamLogo,alt:e.teamName,className:"complete-team-logo"}),a.jsx("h3",{children:e.teamName}),a.jsxs("span",{className:"complete-category",children:["open-age"===e.category?"Open Age":"Under 17"," Category"]})]}),a.jsxs("div",{className:"complete-message",children:[a.jsxs("p",{className:"main-message",children:["Your registration for ",a.jsx("strong",{children:"Muqawama 2026"})," has been successfully submitted!"]}),a.jsx("p",{className:"sub-message",children:"Our team will shortly get in touch with you to follow up with the next steps. Please keep an eye on your email and phone for updates."})]}),a.jsxs("div",{className:"complete-details",children:[a.jsx("h4",{children:"What Happens Next?"}),a.jsxs("ul",{className:"next-steps-list",children:[a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-envelope"}),a.jsxs("span",{children:["You'll receive a confirmation email at ",a.jsx("strong",{children:e.captainEmail})]})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-phone"}),a.jsx("span",{children:"Our team will contact you within 24-48 hours"})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-calendar-check"}),a.jsx("span",{children:"Fixture details will be shared before the tournament"})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-id-card"}),a.jsx("span",{children:"Player ID cards will be issued at the venue"})]})]})]}),a.jsxs("div",{className:"complete-contact",children:[a.jsx("p",{children:"Questions? Reach out to us:"}),a.jsxs("div",{className:"contact-links",children:[a.jsxs("a",{href:"mailto:info@sio-abulfazal.org",children:[a.jsx("i",{className:"fas fa-envelope"})," info@sio-abulfazal.org"]}),a.jsxs("a",{href:"https://instagram.com/muqawama2026",target:"_blank",rel:"noopener noreferrer",children:[a.jsx("i",{className:"fab fa-instagram"})," @muqawama2026"]})]})]}),a.jsx("div",{className:"complete-actions",children:a.jsxs("button",{type:"button",className:"primary-btn",onClick:()=>{t(),window.location.href="/muqawamah/2026/"},children:[a.jsx("i",{className:"fas fa-home"})," Back to Tournament Page"]})})]})})}const me={"open-age":{label:"Open Age",amount:2500,earlyBird:2200,earlyBirdDeadline:"2025-12-15"},u17:{label:"Under 17",amount:2300,earlyBird:2e3,earlyBirdDeadline:"2025-12-15"}};function de(){const{teamData:e,players:s,setStep:n,loading:i,setLoading:r,error:o,setError:c,existingTeamId:m,setExistingTeamId:d,setSuccessTeamId:u,paymentStatus:h,setPaymentStatus:p}=l(),f=e.category||"open-age",g=me[f],x=new Date<new Date(g.earlyBirdDeadline),j=x?g.earlyBird:g.amount,y=Math.round(2.5*j/100),N=j+y;return"success"===h?a.jsx(ce,{}):a.jsxs("div",{className:"registration-form payment-checkout",children:[a.jsx("h3",{children:"Step 5 Â· Payment"}),a.jsx("p",{className:"step-description",children:"Complete your registration by making the payment."}),a.jsxs("section",{className:"checkout-section",children:[a.jsxs("h4",{children:[a.jsx("i",{className:"fas fa-receipt"})," Order Summary"]}),a.jsxs("div",{className:"order-summary-card",children:[a.jsxs("div",{className:"order-item",children:[a.jsxs("div",{className:"order-item-info",children:[a.jsx("span",{className:"item-name",children:"Team Registration"}),a.jsxs("span",{className:"item-detail",children:[e.teamName," â€¢ ",g.label]})]}),a.jsxs("span",{className:"item-price",children:["â‚¹",g.amount]})]}),x&&a.jsxs("div",{className:"order-item discount",children:[a.jsxs("div",{className:"order-item-info",children:[a.jsx("span",{className:"item-name",children:"ðŸŽ Early Bird Discount"}),a.jsxs("span",{className:"item-detail",children:["Valid until ",new Date(g.earlyBirdDeadline).toLocaleDateString()]})]}),a.jsxs("span",{className:"item-price",children:["-â‚¹",g.amount-g.earlyBird]})]}),a.jsxs("div",{className:"order-item subtotal",children:[a.jsx("span",{className:"item-name",children:"Subtotal"}),a.jsxs("span",{className:"item-price",children:["â‚¹",j]})]}),a.jsxs("div",{className:"order-item fee",children:[a.jsxs("div",{className:"order-item-info",children:[a.jsx("span",{className:"item-name",children:"Payment Gateway Fee"}),a.jsxs("span",{className:"item-detail",children:[2.5,"%"]})]}),a.jsxs("span",{className:"item-price",children:["â‚¹",y]})]}),a.jsxs("div",{className:"order-total",children:[a.jsx("span",{children:"Total Amount"}),a.jsxs("span",{className:"total-price",children:["â‚¹",N]})]})]})]}),a.jsxs("section",{className:"checkout-section",children:[a.jsxs("h4",{children:[a.jsx("i",{className:"fas fa-users"})," Registration Details"]}),a.jsxs("div",{className:"checkout-team-summary",children:[a.jsxs("div",{className:"team-mini-card",children:[e.teamLogo&&a.jsx("img",{src:e.teamLogo,alt:e.teamName,className:"team-mini-logo"}),a.jsxs("div",{className:"team-mini-info",children:[a.jsx("span",{className:"team-mini-name",children:e.teamName}),a.jsxs("span",{className:"team-mini-category",children:[g.label," â€¢ ",s.length," Players"]})]})]}),a.jsxs("div",{className:"captain-info",children:[a.jsxs("span",{children:[a.jsx("i",{className:"fas fa-user"})," ",e.captainName]}),a.jsxs("span",{children:[a.jsx("i",{className:"fas fa-envelope"})," ",e.captainEmail]})]})]})]}),a.jsxs("section",{className:"checkout-section",children:[a.jsxs("h4",{children:[a.jsx("i",{className:"fas fa-credit-card"})," Payment Methods"]}),a.jsxs("div",{className:"payment-methods",children:[a.jsxs("div",{className:"payment-method",children:[a.jsx("i",{className:"fas fa-mobile-alt"}),a.jsx("span",{children:"UPI"})]}),a.jsxs("div",{className:"payment-method",children:[a.jsx("i",{className:"fas fa-credit-card"}),a.jsx("span",{children:"Cards"})]}),a.jsxs("div",{className:"payment-method",children:[a.jsx("i",{className:"fas fa-university"}),a.jsx("span",{children:"Net Banking"})]}),a.jsxs("div",{className:"payment-method",children:[a.jsx("i",{className:"fas fa-wallet"}),a.jsx("span",{children:"Wallets"})]})]}),a.jsxs("p",{className:"payment-secure-note",children:[a.jsx("i",{className:"fas fa-lock"})," Secured by Easebuzz Payment Gateway"]})]}),o&&a.jsx("p",{className:"auth-error",children:o}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"secondary-btn",onClick:()=>n(4),disabled:i,children:"Back to Review"}),a.jsx("button",{type:"button",className:"primary-btn pay-btn",onClick:async()=>{r(!0),c(null);try{const{data:{user:a}}=await t.auth.getUser();if(!a)throw new Error("You must be logged in to proceed with payment.");let i=m;if(m){const{error:a}=await t.from("team_registrations").update({team_name:e.teamName,category:e.category,team_logo:e.teamLogo,captain_name:e.captainName,captain_email:e.captainEmail,captain_phone:e.captainPhone,formation:e.formation,status:"confirmed",payment_amount:N,submitted_at:(new Date).toISOString()}).eq("id",m);if(a)throw a}else{const{data:s,error:n}=await t.from("team_registrations").insert({user_id:a.id,team_name:e.teamName,category:e.category,team_logo:e.teamLogo,captain_name:e.captainName,captain_email:e.captainEmail,captain_phone:e.captainPhone,formation:e.formation,status:"confirmed",payment_amount:N,submitted_at:(new Date).toISOString()}).select().single();if(n)throw n;i=s.id,d(i)}await t.from("team_players").delete().eq("team_id",i);const r=s.map(e=>({team_id:i,player_name:e.name,player_age:e.age?parseInt(e.age):null,aadhar_no:e.aadhar_no||null,position:e.position,is_substitute:e.isSubstitute,player_image:e.image,position_x:e.x,position_y:e.y})),{error:l}=await t.from("team_players").insert(r);if(l)throw l;p("success"),n(6)}catch(a){c(a.message)}finally{r(!1)}},disabled:i,children:i?a.jsx(a.Fragment,{children:"Processing..."}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-lock"})," Pay â‚¹",N]})})]}),a.jsxs("p",{className:"terms-note",children:["By proceeding, you agree to our"," ",a.jsx("a",{href:"/muqawamah/terms-and-conditions/",target:"_blank",rel:"noreferrer",children:"Terms & Conditions"})," ","and"," ",a.jsx("a",{href:"/muqawamah/refund-policy/",target:"_blank",rel:"noreferrer",children:"Refund Policy"})]})]})}async function ue(e,a={}){const{maxWidth:t=800,maxHeight:s=800,quality:n=.8,outputFormat:i="image/jpeg"}=a;return new Promise((a,r)=>{const l=new FileReader;l.onerror=()=>r(new Error("Failed to read file")),l.onload=e=>{const l=new Image;l.onerror=()=>r(new Error("Failed to load image")),l.onload=()=>{try{let{width:e,height:r}=l;if(e>t||r>s){const a=Math.min(t/e,s/r);e=Math.floor(e*a),r=Math.floor(r*a)}const o=document.createElement("canvas");o.width=e,o.height=r;o.getContext("2d").drawImage(l,0,0,e,r);const c=o.toDataURL(i,n);a(c)}catch(e){r(new Error("Failed to compress image: "+e.message))}},l.src=e.target.result},l.readAsDataURL(e)})}function he(e){const a=e.length-(e.indexOf(",")+1);return Math.round(.75*a/1024)}const pe=["GK","CB","LB","RB","CDM","CM","CAM","LM","RM","CF","ST"];function fe(){const{players:t,setPlayers:s,setStep:n,saveProgress:i,saving:r,error:o,teamData:c}=l(),[m,d]=e.useState(null),u=(e,a,t)=>{s(s=>s.map((s,n)=>n===e?{...s,[a]:t}:s))},h=t.filter(e=>!e.isSubstitute),p=t.filter(e=>e.isSubstitute),f=h[0],g=h.slice(1),x=(e,t,s=!1)=>a.jsxs("div",{className:"player-card "+(s?"captain-card":""),children:[s&&a.jsxs("div",{className:"captain-badge",children:[a.jsx("i",{className:"fas fa-star"})," Team Captain"]}),a.jsxs("label",{children:[s?"Captain Name":"Player Name",a.jsx("input",{type:"text",value:e.name,onChange:e=>u(t,"name",e.target.value),placeholder:s?c.captainName||"Captain Name":e.isSubstitute?"Substitute Name":`${e.position} Player`,required:!0})]}),a.jsxs("label",{children:["Age",a.jsx("input",{type:"number",value:e.age||"",onChange:e=>u(t,"age",e.target.value),placeholder:"e.g., 22",min:"10",max:"60",required:!0})]}),a.jsxs("label",{children:["Aadhar Number",a.jsx("input",{type:"text",value:e.aadhar_no||"",onChange:e=>{const a=e.target.value.replace(/\D/g,"");a.length<=12&&u(t,"aadhar_no",a)},placeholder:"12-digit Aadhar number",maxLength:"12",pattern:"[0-9]{12}",required:!0}),a.jsx("span",{className:"input-hint",children:"Enter 12-digit Aadhar number"})]}),!e.isSubstitute&&a.jsxs("label",{children:["Position",a.jsx("select",{value:e.position,onChange:e=>u(t,"position",e.target.value),children:pe.map(e=>a.jsx("option",{value:e,children:e},e))})]}),a.jsxs("label",{className:"file-label",children:["Player Photo",m===t&&a.jsxs("div",{className:"compressing-indicator",children:[a.jsx("i",{className:"fas fa-spinner fa-spin"}),a.jsx("span",{children:"Compressing image..."})]}),e.image&&m!==t&&a.jsxs("div",{className:"uploaded-photo-preview",children:[a.jsxs("div",{className:"photo-preview-container",children:[a.jsx("img",{src:e.image,alt:"Player photo",className:"photo-preview"}),a.jsx("div",{className:"photo-overlay",children:a.jsx("i",{className:"fas fa-check-circle"})})]}),a.jsxs("div",{className:"uploaded-file-info",children:[a.jsx("i",{className:"fas fa-check-circle"}),a.jsx("span",{children:e.imageFileName?`Uploaded: ${e.imageFileName}`:"Photo uploaded"}),a.jsx("span",{className:"file-change-hint",children:"(Click to change)"})]})]}),a.jsx("input",{type:"file",accept:"image/*",onChange:e=>{var a;return(async(e,a)=>{if(a)if(a.size>2097152)alert("Player photo must be under 2MB");else try{d(e);const t=await ue(a,{maxWidth:600,maxHeight:600,quality:.85,outputFormat:"image/jpeg"});he(t),u(e,"image",t),u(e,"imageFileName",a.name)}catch(t){alert("Failed to process image. Please try another file.")}finally{d(null)}})(t,null==(a=e.target.files)?void 0:a[0])},disabled:m===t}),!e.image&&m!==t&&a.jsx("span",{className:"input-hint",children:"JPG/PNG up to 2MB. Required."})]})]},e.id);return a.jsxs("form",{className:"registration-form",onSubmit:async e=>{if(e.preventDefault(),!(()=>{const e=h.every(e=>e.name&&e.age&&e.aadhar_no&&12===e.aadhar_no.length&&e.position&&e.image),a=p.every(e=>e.name&&e.age&&e.aadhar_no&&12===e.aadhar_no.length&&e.image);return e&&a})())return void alert("Please fill out all required fields including name, age, Aadhar number, and photo for all players.");(await i(2)).success&&n(3)},children:[a.jsx("h3",{children:"Step 2 Â· Players"}),a.jsx("p",{className:"step-description",children:"Start with the captain, then add 6 more players and 4 substitutes."}),a.jsx("h4",{children:"Captain"}),a.jsx("div",{className:"captain-section",children:f&&x(f,t.indexOf(f),!0)}),a.jsx("h4",{children:"Other Main Players"}),a.jsx("div",{className:"players-grid",children:g.map(e=>x(e,t.indexOf(e)))}),a.jsx("h4",{children:"Substitutes"}),a.jsx("div",{className:"players-grid",children:p.map(e=>x(e,t.indexOf(e)))}),o&&a.jsx("p",{className:"auth-error",children:o}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"secondary-btn",onClick:()=>n(1),disabled:r,children:"Back"}),a.jsx("button",{type:"submit",className:"primary-btn",disabled:r,children:r?a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-spinner fa-spin"})," Saving..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-save"})," Save & Continue"]})})]})]})}function ge({readOnly:e=!1}){const{teamData:t,players:s,setStep:n,existingTeamId:i}=l();return a.jsxs("div",{className:"registration-form",children:[a.jsxs("h3",{children:["Step 4 Â· Review & ",i?"Update":"Submit"]}),a.jsxs("p",{className:"step-description",children:["Verify everything looks good before ",i?"updating":"submitting"," your team."]}),a.jsxs("section",{className:"summary-section",children:[a.jsx("h4",{children:"Team Information"}),a.jsxs("div",{className:"team-info-card",children:[a.jsxs("div",{className:"team-info-header",children:[a.jsx("div",{className:"team-logo-large",children:t.teamLogo?a.jsx("img",{src:t.teamLogo,alt:`${t.teamName} logo`}):a.jsx("div",{className:"team-logo-placeholder-large",children:a.jsx("i",{className:"fas fa-shield-alt"})})}),a.jsxs("div",{className:"team-info-main",children:[a.jsx("h3",{className:"team-name-display",children:t.teamName}),a.jsxs("span",{className:"team-category-badge",children:[a.jsx("i",{className:"fas fa-trophy"})," ","open-age"===t.category?"Open Age":"Under 17"]})]})]}),a.jsxs("div",{className:"team-info-details",children:[a.jsxs("div",{className:"info-row",children:[a.jsxs("div",{className:"info-item",children:[a.jsx("i",{className:"fas fa-user-tie"}),a.jsxs("div",{className:"info-content",children:[a.jsx("span",{className:"info-label",children:"Captain"}),a.jsx("span",{className:"info-value",children:t.captainName})]})]}),a.jsxs("div",{className:"info-item",children:[a.jsx("i",{className:"fas fa-envelope"}),a.jsxs("div",{className:"info-content",children:[a.jsx("span",{className:"info-label",children:"Email"}),a.jsx("span",{className:"info-value",children:t.captainEmail})]})]})]}),t.captainPhone&&a.jsxs("div",{className:"info-row",children:[a.jsxs("div",{className:"info-item",children:[a.jsx("i",{className:"fas fa-phone"}),a.jsxs("div",{className:"info-content",children:[a.jsx("span",{className:"info-label",children:"Phone"}),a.jsx("span",{className:"info-value",children:t.captainPhone})]})]}),a.jsxs("div",{className:"info-item",children:[a.jsx("i",{className:"fas fa-futbol"}),a.jsxs("div",{className:"info-content",children:[a.jsx("span",{className:"info-label",children:"Formation"}),a.jsx("span",{className:"info-value",children:t.formation})]})]})]}),!t.captainPhone&&a.jsx("div",{className:"info-row",children:a.jsxs("div",{className:"info-item",children:[a.jsx("i",{className:"fas fa-futbol"}),a.jsxs("div",{className:"info-content",children:[a.jsx("span",{className:"info-label",children:"Formation"}),a.jsx("span",{className:"info-value",children:t.formation})]})]})})]})]})]}),a.jsxs("section",{className:"summary-section",children:[a.jsx("h4",{children:"Players"}),a.jsx("div",{className:"player-card-grid",children:s.map((e,s)=>{var n,i;return a.jsxs("div",{className:"player-card-badge simple "+(e.isSubstitute?"substitute":""),children:[a.jsxs("div",{className:"badge-header",children:[a.jsxs("div",{className:"badge-team",children:[a.jsx("div",{className:"team-logo",children:t.teamLogo?a.jsx("img",{src:t.teamLogo,alt:`${t.teamName} logo`}):a.jsx("div",{className:"team-logo-placeholder",children:(null==(i=null==(n=t.teamName)?void 0:n.charAt(0))?void 0:i.toUpperCase())||"T"})}),a.jsxs("div",{className:"team-meta",children:[a.jsx("span",{className:"team-name",children:t.teamName||"Team name"}),a.jsx("span",{className:"player-role",children:e.isSubstitute?"Substitute":e.position||"Player"})]})]}),a.jsx("div",{className:"muqawama-logo",children:a.jsx("img",{src:"/assets/img/MuqawamaLogo.png",alt:"Muqawama 2026"})})]}),a.jsx("div",{className:"badge-photo",children:e.image?a.jsx("img",{src:e.image,alt:e.name||e.position}):a.jsx("div",{className:"badge-photo-placeholder",children:a.jsx("i",{className:"fas fa-user"})})}),a.jsx("div",{className:"badge-player-info",children:a.jsx("span",{className:"player-name",children:e.name||"Unnamed Player"})})]},e.id||s)})})]}),a.jsxs("section",{className:"summary-section",children:[a.jsx("h4",{children:"Formation Preview"}),a.jsx("div",{ref:fieldRef,children:a.jsx(ee,{players:s.filter(e=>!e.isSubstitute),editable:!1,showDownload:!0})})]}),!e&&a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"secondary-btn",onClick:()=>n(3),children:"Back"}),a.jsx("button",{type:"button",className:"primary-btn",onClick:()=>{n(5)},children:"Proceed to Payment"})]})]})}const xe=[{value:"open-age",label:"Open Age"},{value:"u17",label:"Under 17"}];function je(){const{teamData:t,setTeamData:s,setStep:n,saveProgress:i,saving:r,error:o}=l(),c=e.useRef(null),[m,d]=e.useState(!1),u=e=>{const{name:a,value:t}=e.target;s(e=>({...e,[a]:t}))};return a.jsxs("form",{className:"registration-form",onSubmit:async e=>{var a;if(e.preventDefault(),!t.teamLogo)return void alert("Please upload a team logo");if(10!==((null==(a=t.captainPhone)?void 0:a.replace(/\s/g,""))||"").length)return void alert("Please enter a valid 10-digit mobile number");(await i(1)).success&&n(2)},children:[a.jsx("h3",{children:"Step 1 Â· Team Details"}),a.jsx("p",{className:"step-description",children:"Tell us about your team and captain information."}),a.jsxs("label",{children:["Team Name",a.jsx("input",{type:"text",name:"teamName",value:t.teamName,onChange:u,placeholder:"e.g., Rising Stars",required:!0})]}),a.jsxs("label",{children:["Category",a.jsx("select",{name:"category",value:t.category,onChange:u,children:xe.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))})]}),a.jsxs("label",{className:"file-label",children:["Team Logo",m&&a.jsxs("div",{className:"compressing-indicator",children:[a.jsx("i",{className:"fas fa-spinner fa-spin"}),a.jsx("span",{children:"Compressing image..."})]}),t.teamLogo&&!m&&a.jsxs("div",{className:"uploaded-photo-preview",children:[a.jsxs("div",{className:"photo-preview-container",children:[a.jsx("img",{src:t.teamLogo,alt:"Team logo",className:"photo-preview"}),a.jsx("div",{className:"photo-overlay",children:a.jsx("i",{className:"fas fa-check-circle"})})]}),a.jsxs("div",{className:"uploaded-file-info",children:[a.jsx("i",{className:"fas fa-check-circle"}),a.jsx("span",{children:t.teamLogoFileName?`Uploaded: ${t.teamLogoFileName}`:"Logo uploaded"}),a.jsx("span",{className:"file-change-hint",children:"(Click to change)"})]})]}),a.jsx("input",{type:"file",accept:"image/*",ref:c,onChange:async e=>{var a;const t=null==(a=e.target.files)?void 0:a[0];if(t){if(t.size>2097152)return alert("Logo size must be under 2MB"),void(c.current.value="");try{d(!0);const e=await ue(t,{maxWidth:800,maxHeight:800,quality:.85,outputFormat:"image/jpeg"});he(e);s(a=>({...a,teamLogo:e,teamLogoFileName:t.name}))}catch(n){alert("Failed to process image. Please try another file."),c.current.value=""}finally{d(!1)}}},disabled:m}),!t.teamLogo&&!m&&a.jsx("span",{className:"input-hint",children:"JPG/PNG up to 2MB. Displayed across the tournament site."})]}),a.jsxs("label",{children:["Preferred Formation",a.jsx("select",{name:"formation",value:t.formation,onChange:u,children:ae.map(e=>a.jsx("option",{value:e,children:e},e))}),a.jsx("span",{className:"input-hint",children:"This will be the starting layout in Step 3. You can still adjust players later."})]}),a.jsxs("div",{className:"grid-2",children:[a.jsxs("label",{children:["Captain Name",a.jsx("input",{type:"text",name:"captainName",value:t.captainName,onChange:u,required:!0})]}),a.jsxs("label",{children:["Captain Email",a.jsx("input",{type:"email",name:"captainEmail",value:t.captainEmail,onChange:u,required:!0})]})]}),a.jsxs("label",{children:["Captain Phone",a.jsx("input",{type:"tel",name:"captainPhone",value:t.captainPhone||"",onChange:e=>{const a=e.target.value.replace(/\D/g,"");let t="";a&&(t=a.length<=5?a:`${a.slice(0,5)} ${a.slice(5,10)}`),s(e=>({...e,captainPhone:t}))},placeholder:"98765 43210",pattern:"[0-9\\s]{10,12}",maxLength:11,onInvalid:e=>{var a;const s=e.target;((null==(a=t.captainPhone)?void 0:a.replace(/\s/g,""))||"").length<10?s.setCustomValidity("Please enter a valid 10-digit mobile number"):s.setCustomValidity("")},onInput:e=>{e.target.setCustomValidity("")},required:!0}),a.jsxs("span",{className:"input-hint",children:[a.jsx("i",{className:"fas fa-info-circle"})," 10-digit mobile number (e.g., 98765 43210)"]})]}),o&&a.jsx("p",{className:"auth-error",children:o}),a.jsx("div",{className:"form-actions",children:a.jsx("button",{type:"submit",className:"primary-btn",disabled:r,children:r?a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-spinner fa-spin"})," Saving..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-save"})," Save & Continue"]})})})]})}const ye=[{id:1,label:"Team"},{id:2,label:"Players"},{id:3,label:"Formation"},{id:4,label:"Review"},{id:5,label:"Payment"},{id:6,label:"Complete"}];function Ne(){const{step:e}=l(),t=ye.slice(0,5);return 6===e?null:a.jsx("div",{className:"registration-stepper",children:t.map((t,s)=>a.jsxs("div",{className:`step ${e===t.id?"active":""} ${e>t.id?"complete":""}`,children:[a.jsx("span",{className:"step-number",children:s+1}),a.jsx("span",{className:"step-label",children:t.label})]},t.id))})}function ve(){const{step:n,setStep:r,setTeamData:m,setPlayers:d,setExistingTeamId:u,readOnlyMode:h,setReadOnlyMode:p,resetForm:f,existingTeamId:g,setPaymentStatus:x,setLastSavedStep:j}=l(),[y,N]=e.useState(null),[v,w]=e.useState(!0),[b,S]=e.useState(""),[P,C]=e.useState(!1),_=s.useRef(!1);e.useEffect(()=>{const e=new URLSearchParams(window.location.search).get("payment");"success"===e?(x("success"),r(5),window.history.replaceState({},"",window.location.pathname)):"failed"===e&&(x("failed"),r(5),window.history.replaceState({},"",window.location.pathname))},[]),e.useEffect(()=>{let e=!0;S("");(async()=>{try{const{data:a,error:s}=await Promise.race([t.auth.getUser(),new Promise((e,a)=>setTimeout(()=>a(new Error("getUser timeout")),3e3))]);if(!e)return;if(s){if("getUser timeout"===s.message)return N(null),f(),void w(!1);if("Auth session missing!"!==s.message)throw s}const n=(null==a?void 0:a.user)??null;n?(N(n),await E(n,{force:!0})):(N(null),f())}catch(a){e&&(N(null),f())}finally{e&&w(!1)}})();const{data:a}=t.auth.onAuthStateChange(async(e,a)=>{const t=(null==a?void 0:a.user)??null;t?"SIGNED_IN"===e&&(N(t),w(!0),await E(t,{force:!0}),w(!1)):(N(null),f(),r(1),_.current=!1)});return()=>{e=!1,a.subscription.unsubscribe()}},[]);const E=async(e,{force:a=!1}={})=>{if(!_.current||a){_.current=!0,C(!0),S("");try{const{data:a,error:s}=await t.from("team_registrations").select("*, team_players(*)").eq("user_id",e.id).maybeSingle();if(s&&"PGRST116"!==s.code)throw s;if(a){u(a.id),p(!1),m({teamName:a.team_name||"",category:a.category||"open-age",teamLogo:a.team_logo,captainName:a.captain_name||"",captainEmail:a.captain_email||e.email||"",captainPhone:a.captain_phone?a.captain_phone.replace(/^\+91\s?/,"").trim():"",formation:a.formation||"1-3-2-1"});const t=a.team_players&&a.team_players.length>0?a.team_players.map((e,a)=>({id:e.id||`player-${a}`,name:e.player_name||"",age:e.player_age||"",aadhar_no:e.aadhar_no||"",position:e.position||"SUB",isSubstitute:e.is_substitute,image:e.player_image,x:e.position_x??50,y:e.position_y??50})):o();if(d(t),"confirmed"===a.status)x("success"),r(6);else if("pending_payment"===a.status)r(4);else{const e=a.last_saved_step||1;j(e);r(e>=3?4:e+1)}}else u(null),p(!1),m({...c,captainEmail:e.email||""}),d(o()),r(1)}catch(s){S("Could not load your saved registration. You can continue and submitting will overwrite the previous data."),u(null),p(!1),m({...c,captainEmail:e.email||""}),d(o()),r(1)}finally{C(!1)}}};return v?a.jsx("div",{className:"loading-screen",children:a.jsxs("div",{className:"loading-content",children:[a.jsxs("div",{className:"logo-loader",children:[a.jsx("div",{className:"logo-ring"}),a.jsx("img",{src:"/assets/img/MuqawamaLogo.png",alt:"Muqawama",className:"logo-pulse"})]}),a.jsx("p",{children:"Loading your registration..."})]})}):y?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"header-actions",children:[a.jsx("span",{className:"user-email",children:y.email}),a.jsxs("button",{type:"button",className:"logout-btn",onClick:async()=>{await t.auth.signOut(),N(null),r(1)},children:[a.jsx("i",{className:"fas fa-sign-out-alt"})," Logout"]})]}),a.jsx("div",{className:"registration-header",children:a.jsxs("div",{className:"registration-header-logo",children:[a.jsx("img",{src:"/assets/img/title.png",alt:"Muqawama 2026"}),a.jsx("h2",{className:"registration-header-title",children:"Team Registration"}),a.jsx("p",{children:g?"Edit your team registration and update any details.":"Complete all steps to confirm your team registration."})]})}),b&&a.jsx("p",{className:"auth-error",children:b}),a.jsx(Ne,{}),(()=>{switch(n){case 1:default:return a.jsx(je,{});case 2:return a.jsx(fe,{});case 3:return a.jsx(oe,{});case 4:return a.jsx(ge,{});case 5:return a.jsx(de,{});case 6:return a.jsx(ce,{})}})()]}):a.jsx(i,{onSuccess:N})}function we(){return e.useEffect(()=>(document.body.classList.add("registration-body"),()=>document.body.classList.remove("registration-body")),[]),a.jsx(m,{children:a.jsx("div",{className:"registration-container",children:a.jsx(ve,{})})})}n.createRoot(document.getElementById("registration-root")).render(a.jsx(s.StrictMode,{children:a.jsx(we,{})}));
