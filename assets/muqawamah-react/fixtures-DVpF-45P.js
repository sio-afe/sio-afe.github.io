import{r as e,s as a,j as s,c as t,R as l}from"./supabaseClient-BTiblPWy.js";import{T as i}from"./TournamentNavbar-DI7qB3Bc.js";import{F as r}from"./Footer-C_t3LNGD.js";import"./supabase-client-DmFmBHmJ.js";function n({onMatchClick:t}){const[l,n]=e.useState([]),[c,o]=e.useState(!0),[d,m]=e.useState(1),[h]=e.useState(window.location.pathname.includes("/u17/")?"u17":"open-age"),p=e=>{if(!e)return null;const a=e.toLowerCase();return"group"===a?"Group Stage":"quarter-final"===a||"quarterfinal"===a?"Quarter Final":"semi-final"===a||"semifinal"===a?"Semi Final":"final"===a?"Final":"third-place"===a||"thirdplace"===a?"3rd Place":e.charAt(0).toUpperCase()+e.slice(1)};e.useEffect(()=>{u()},[h]);const u=async()=>{try{o(!0);const{data:e,error:s}=await a.from("matches").select("\n          *,\n          home_team:teams!matches_home_team_id_fkey(id, name, crest_url),\n          away_team:teams!matches_away_team_id_fkey(id, name, crest_url)\n        ").eq("category",h).order("match_number",{ascending:!0}).order("scheduled_time",{ascending:!0});if(s)throw s;if(n(e||[]),e&&e.length>0){const a=[...new Set(e.map(e=>e.match_number).filter(Boolean))],s=e.filter(e=>"completed"===e.status).map(e=>e.match_number).sort((e,a)=>a-e)[0];if(s){const e=a.some(e=>e>s);m(e?s+1:s)}else m(a[0]||1)}}catch(e){}finally{o(!1)}},y=e.useMemo(()=>{const e={};return l.forEach(a=>{const s=a.match_number||1;e[s]||(e[s]=[]),e[s].push(a)}),e},[l]),_=e.useMemo(()=>[...new Set(l.map(e=>e.match_number).filter(Boolean))].sort((e,a)=>e-a),[l]);if(c)return s.jsxs(s.Fragment,{children:[s.jsx(i,{}),s.jsx("div",{className:"fixtures-loading",children:s.jsxs("div",{className:"fixtures-loading-content",children:[s.jsxs("div",{className:"logo-loader",children:[s.jsx("div",{className:"logo-ring"}),s.jsx("img",{src:"/assets/img/muq_invert.png",alt:"Muqawama",className:"logo-pulse"})]}),s.jsx("p",{children:"Loading fixtures..."})]})}),s.jsx(r,{edition:"2026"})]});const x=y[d]||[];return s.jsxs(s.Fragment,{children:[s.jsx(i,{}),s.jsx("div",{className:"fixtures-page-v2",children:s.jsxs("div",{className:"fixtures-container-v2",children:[s.jsxs("div",{className:"fixtures-header-v2",children:[s.jsx("h1",{children:"Fixtures & Results"}),s.jsx("hr",{className:"fixtures-divider"})]}),_.length>0&&s.jsx("div",{className:"matchday-tabs-v2",children:_.map(e=>s.jsx("button",{className:"matchday-tab-v2 "+(d===e?"active":""),onClick:()=>m(e),children:e},e))}),s.jsx("div",{className:"matches-list-v2",children:x.length>0?x.map(e=>{var a,l,i,r,n,c,o,d;const m="completed"===e.status,h="live"===e.status,u=m||h,y=e.home_score??0,_=e.away_score??0,x=(e=>{return"completed"===e.status?{label:"FT",className:"status-completed"}:"live"===e.status?{label:"LIVE",className:"status-live"}:"scheduled"===e.status?{label:(a=e.scheduled_time,a?a.length>=5?a.substring(0,5):a:"TBD"),className:"status-scheduled"}:{label:"TBD",className:"status-scheduled"};var a})(e);return s.jsxs("div",{className:"match-card-v2 clickable",onClick:()=>t&&t(e.id),style:{cursor:t?"pointer":"default"},children:[s.jsx("div",{className:"match-status-mobile",children:s.jsx("span",{className:`status-badge ${x.className}`,children:x.label})}),s.jsxs("div",{className:"match-row-v2",children:[s.jsx("div",{className:"match-status-desktop",children:s.jsx("span",{className:`status-badge ${x.className}`,children:x.label})}),s.jsxs("div",{className:"match-team-v2 home",children:[s.jsx("span",{className:"team-name-v2",children:(null==(a=e.home_team)?void 0:a.name)||"TBD"}),s.jsx("div",{className:"team-logo-v2",children:(null==(l=e.home_team)?void 0:l.crest_url)?s.jsx("img",{src:e.home_team.crest_url,alt:e.home_team.name,loading:"lazy"}):s.jsx("span",{children:(null==(r=null==(i=e.home_team)?void 0:i.name)?void 0:r.charAt(0))||"?"})})]}),s.jsx("div",{className:"match-score-v2",children:u?s.jsxs("span",{className:"score-display "+(h?"live":""),children:[y," - ",_]}):s.jsx("span",{className:"vs-display",children:"vs"})}),s.jsxs("div",{className:"match-team-v2 away",children:[s.jsx("div",{className:"team-logo-v2",children:(null==(n=e.away_team)?void 0:n.crest_url)?s.jsx("img",{src:e.away_team.crest_url,alt:e.away_team.name,loading:"lazy"}):s.jsx("span",{children:(null==(o=null==(c=e.away_team)?void 0:c.name)?void 0:o.charAt(0))||"?"})}),s.jsx("span",{className:"team-name-v2",children:(null==(d=e.away_team)?void 0:d.name)||"TBD"})]}),s.jsx("div",{className:"match-venue-desktop",children:s.jsxs("span",{children:[e.venue||"",e.venue&&p(e.match_type)&&" | ",p(e.match_type)]})})]}),s.jsx("div",{className:"match-venue-mobile",children:s.jsxs("span",{children:[e.venue||"",e.venue&&p(e.match_type)&&" | ",p(e.match_type)]})})]},e.id)}):s.jsxs("div",{className:"no-matches-v2",children:[s.jsx("i",{className:"fas fa-calendar-times"}),s.jsxs("p",{children:["No fixtures scheduled for Matchday ",d]})]})})]})}),s.jsx(r,{edition:"2026"})]})}function c({homePlayers:t=[],awayPlayers:l=[],homeTeam:i={},awayTeam:r={},goals:n=[],cards:c=[]}){const[o,d]=e.useState(null),[m,h]=e.useState(!0),[p,u]=e.useState(!1),[y,_]=e.useState(null),[x,g]=e.useState(!1),f=t.filter(e=>!e.is_substitute&&"SUB"!==e.position).slice(0,7),j=l.filter(e=>!e.is_substitute&&"SUB"!==e.position).slice(0,7),w=e=>{if(!e)return{goalsScored:0,assists:0,yellowCards:0,redCards:0};let a=0,s=0,t=0,l=0;const i=e.name||e.player_name||"",r=e.registration_player_id;return n.forEach(e=>{var t,l;let n=!1,c=!1;if(r&&(e.scorer_id===r&&(n=!0),e.assister_id===r&&(c=!0)),!n&&!c){const a=(null==(t=e.scorer)?void 0:t.player_name)||"",s=(null==(l=e.assister)?void 0:l.player_name)||"";a&&i&&a.toLowerCase().trim()===i.toLowerCase().trim()&&(n=!0),s&&i&&s.toLowerCase().trim()===i.toLowerCase().trim()&&(c=!0)}n&&a++,c&&s++}),c&&c.length>0&&c.forEach(e=>{var a;let s=!1;if(r&&e.player_id===r&&(s=!0),!s){const t=(null==(a=e.player)?void 0:a.player_name)||"";t&&i&&t.toLowerCase().trim()===i.toLowerCase().trim()&&(s=!0)}s&&("yellow"===e.card_type&&t++,"red"===e.card_type&&l++)}),{goalsScored:a,assists:s,yellowCards:t,redCards:l}},v=(e,a)=>{d(e),h(a),_(null)};e.useEffect(()=>{(async()=>{if(o){g(!0);try{const e=o.name||o.player_name||"",s=o.registration_player_id;let t=[];if(s){const{data:e}=await a.from("goals").select("id, scorer_id, assister_id").eq("scorer_id",s),{data:l}=await a.from("goals").select("id, scorer_id, assister_id").eq("assister_id",s),i=new Map;(e||[]).forEach(e=>i.set(e.id,e)),(l||[]).forEach(e=>i.set(e.id,e)),t=Array.from(i.values())}if(e&&0===t.length){const{data:s}=await a.from("goals").select("\n              id,\n              scorer_id,\n              assister_id,\n              scorer:team_players!goals_scorer_id_fkey(player_name),\n              assister:team_players!goals_assister_id_fkey(player_name)\n            ");s&&(t=s.filter(a=>{var s,t;const l=(null==(s=a.scorer)?void 0:s.player_name)||"",i=(null==(t=a.assister)?void 0:t.player_name)||"";return l&&l.toLowerCase().trim()===e.toLowerCase().trim()||i&&i.toLowerCase().trim()===e.toLowerCase().trim()}))}let l=[];if(s){const{data:e}=await a.from("cards").select("id, player_id, card_type").eq("player_id",s);l=e||[]}if(e&&0===l.length){const{data:s}=await a.from("cards").select("\n              id,\n              player_id,\n              card_type,\n              player:team_players!cards_player_id_fkey(player_name)\n            ");s&&(l=s.filter(a=>{var s;const t=(null==(s=a.player)?void 0:s.player_name)||"";return t&&t.toLowerCase().trim()===e.toLowerCase().trim()}))}let i=0,r=0,n=0,c=0;t.forEach(a=>{var t,l;if(s)a.scorer_id===s&&i++,a.assister_id===s&&r++;else{const s=(null==(t=a.scorer)?void 0:t.player_name)||"",n=(null==(l=a.assister)?void 0:l.player_name)||"";s&&s.toLowerCase().trim()===e.toLowerCase().trim()&&i++,n&&n.toLowerCase().trim()===e.toLowerCase().trim()&&r++}}),l.forEach(e=>{"yellow"===e.card_type&&n++,"red"===e.card_type&&c++}),_({goalsScored:i,assists:r,yellowCards:n,redCards:c})}catch(e){_({goalsScored:0,assists:0,yellowCards:0,redCards:0})}finally{g(!1)}}else _(null)})()},[o]);const N=()=>{d(null)};if(!(f.length>0||j.length>0))return s.jsxs("div",{className:"match-formation-empty",children:[s.jsx("i",{className:"fas fa-users-slash"}),s.jsx("p",{children:"Formation not available"})]});const b=o?w(o):null,S=o?(e=>{if(!e)return null;const a=new Date(e),s=new Date;let t=s.getFullYear()-a.getFullYear();const l=s.getMonth()-a.getMonth();return(l<0||0===l&&s.getDate()<a.getDate())&&t--,t})(o.date_of_birth):null,C=null!==y?y:b;return s.jsxs("div",{className:"match-formation-field",children:[s.jsx("div",{className:"formation-field-wrapper",children:s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 74 111",className:"match-field-svg",children:[s.jsx("rect",{width:"74",height:"111",fill:"#0d1117"}),s.jsxs("g",{fill:"none",stroke:"rgba(255,255,255,0.35)",strokeWidth:"0.5",transform:"translate(3 3)",children:[s.jsx("path",{d:"M 0 0 h 68 v 105 h -68 Z"}),s.jsx("path",{d:"M 0 52.5 h 68"}),s.jsx("circle",{r:"9.15",cx:"34",cy:"52.5"}),s.jsx("circle",{r:"0.75",cx:"34",cy:"52.5",fill:"rgba(255,255,255,0.35)",stroke:"none"}),s.jsxs("g",{children:[s.jsx("path",{d:"M 13.84 0 v 16.5 h 40.32 v -16.5"}),s.jsx("path",{d:"M 24.84 0 v 5.5 h 18.32 v -5.5"}),s.jsx("circle",{r:"0.75",cx:"34",cy:"10.94",fill:"rgba(255,255,255,0.35)",stroke:"none"}),s.jsx("path",{d:"M 26.733027 16.5 a 9.15 9.15 0 0 0 14.533946 0"})]}),s.jsxs("g",{transform:"rotate(180,34,52.5)",children:[s.jsx("path",{d:"M 13.84 0 v 16.5 h 40.32 v -16.5"}),s.jsx("path",{d:"M 24.84 0 v 5.5 h 18.32 v -5.5"}),s.jsx("circle",{r:"0.75",cx:"34",cy:"10.94",fill:"rgba(255,255,255,0.35)",stroke:"none"}),s.jsx("path",{d:"M 26.733027 16.5 a 9.15 9.15 0 0 0 14.533946 0"})]}),s.jsx("path",{d:"M 0 2 a 2 2 0 0 0 2 -2M 66 0 a 2 2 0 0 0 2 2M 68 103 a 2 2 0 0 0 -2 2M 2 105 a 2 2 0 0 0 -2 -2"})]}),f.map(e=>{var a,t,l,i;const r=(e=>({x:"number"==typeof e.position_x?e.position_x:50,y:4+(100-("number"==typeof e.position_y?e.position_y:50))/100*44}))(e),n=3+r.x/100*68,c=3+r.y/100*105,o=w(e),d=o.goalsScored>0,m=o.yellowCards>0,h=o.redCards>0;return s.jsxs("g",{transform:`translate(${n}, ${c})`,style:{cursor:"pointer"},onClick:()=>v(e,!0),role:"button",tabIndex:0,onKeyDown:a=>{"Enter"!==a.key&&" "!==a.key||v(e,!0)},children:[s.jsx("circle",{r:"3.8",fill:"none",stroke:"#4a90e2",strokeWidth:"0.3"}),s.jsx("circle",{r:"3",fill:"#1e2a38",stroke:"none"}),e.player_image?s.jsxs(s.Fragment,{children:[s.jsx("defs",{children:s.jsx("clipPath",{id:`clip-home-${e.id}`,children:s.jsx("circle",{r:"3",cx:"0",cy:"0"})})}),s.jsx("image",{href:e.player_image,x:"-3",y:"-3",width:"6",height:"6",clipPath:`url(#clip-home-${e.id})`,preserveAspectRatio:"xMidYMid slice"})]}):s.jsx("text",{x:"0",y:"1",textAnchor:"middle",fill:"#4a90e2",fontSize:"2.2",fontWeight:"700",children:e.position||"?"}),s.jsx("text",{x:"0",y:"6.5",textAnchor:"middle",fill:"#4a90e2",fontSize:"1.8",fontWeight:"600",children:(null==(t=null==(a=e.name)?void 0:a.split(" ")[0])?void 0:t.substring(0,8))||(null==(i=null==(l=e.player_name)?void 0:l.split(" ")[0])?void 0:i.substring(0,8))||""}),d&&s.jsxs("g",{transform:"translate(2.7, -2.7)",children:[s.jsx("circle",{r:"1.2",fill:"#fff",opacity:"0.98"}),s.jsx("image",{href:"/assets/img/Muqawama/ball.svg",x:"-1.2",y:"-1.2",width:"2.4",height:"2.4",preserveAspectRatio:"xMidYMid meet"}),o.goalsScored>1&&s.jsxs("g",{children:[s.jsx("circle",{cx:"0.9",cy:"-0.9",r:"0.65",fill:"#fff",stroke:"#000",strokeWidth:"0.18"}),s.jsx("text",{x:"0.9",y:"-0.75",textAnchor:"middle",fontSize:"0.75",fill:"#000",fontWeight:"700",children:o.goalsScored})]})]}),m&&s.jsx("g",{transform:"translate(-2.7, -2.7)",children:s.jsx("image",{href:"/assets/img/Muqawama/Yellow_card.svg",x:"-1.2",y:"-1.2",width:"2.4",height:"2.4",preserveAspectRatio:"xMidYMid meet"})}),h&&s.jsx("g",{transform:"translate(2.7, 2.7)",children:s.jsx("image",{href:"/assets/img/Muqawama/Red_card.svg",x:"-1.2",y:"-1.2",width:"2.4",height:"2.4",preserveAspectRatio:"xMidYMid meet"})})]},`home-${e.id}`)}),j.map(e=>{var a,t,l,i;const r=(e=>({x:"number"==typeof e.position_x?e.position_x:50,y:52+("number"==typeof e.position_y?e.position_y:50)/100*44}))(e),n=3+r.x/100*68,c=3+r.y/100*105,o=w(e),d=o.goalsScored>0,m=o.yellowCards>0,h=o.redCards>0;return s.jsxs("g",{transform:`translate(${n}, ${c})`,style:{cursor:"pointer"},onClick:()=>v(e,!1),role:"button",tabIndex:0,onKeyDown:a=>{"Enter"!==a.key&&" "!==a.key||v(e,!1)},children:[s.jsx("circle",{r:"3.8",fill:"none",stroke:"#e63946",strokeWidth:"0.3"}),s.jsx("circle",{r:"3",fill:"#2a1e1e",stroke:"none"}),e.player_image?s.jsxs(s.Fragment,{children:[s.jsx("defs",{children:s.jsx("clipPath",{id:`clip-away-${e.id}`,children:s.jsx("circle",{r:"3",cx:"0",cy:"0"})})}),s.jsx("image",{href:e.player_image,x:"-3",y:"-3",width:"6",height:"6",clipPath:`url(#clip-away-${e.id})`,preserveAspectRatio:"xMidYMid slice"})]}):s.jsx("text",{x:"0",y:"1",textAnchor:"middle",fill:"#e63946",fontSize:"2.2",fontWeight:"700",children:e.position||"?"}),s.jsx("text",{x:"0",y:"6.5",textAnchor:"middle",fill:"#e63946",fontSize:"1.8",fontWeight:"600",children:(null==(t=null==(a=e.name)?void 0:a.split(" ")[0])?void 0:t.substring(0,8))||(null==(i=null==(l=e.player_name)?void 0:l.split(" ")[0])?void 0:i.substring(0,8))||""}),d&&s.jsxs("g",{transform:"translate(2.7, -2.7)",children:[s.jsx("circle",{r:"1.2",fill:"#fff",opacity:"0.98"}),s.jsx("image",{href:"/assets/img/Muqawama/ball.svg",x:"-1.2",y:"-1.2",width:"2.4",height:"2.4",preserveAspectRatio:"xMidYMid meet"}),o.goalsScored>1&&s.jsxs("g",{children:[s.jsx("circle",{cx:"0.9",cy:"-0.9",r:"0.65",fill:"#fff",stroke:"#000",strokeWidth:"0.18"}),s.jsx("text",{x:"0.9",y:"-0.75",textAnchor:"middle",fontSize:"0.75",fill:"#000",fontWeight:"700",children:o.goalsScored})]})]}),m&&s.jsx("g",{transform:"translate(-2.7, -2.7)",children:s.jsx("image",{href:"/assets/img/Muqawama/Yellow_card.svg",x:"-1.2",y:"-1.2",width:"2.4",height:"2.4",preserveAspectRatio:"xMidYMid meet"})}),h&&s.jsx("g",{transform:"translate(2.7, 2.7)",children:s.jsx("image",{href:"/assets/img/Muqawama/Red_card.svg",x:"-1.2",y:"-1.2",width:"2.4",height:"2.4",preserveAspectRatio:"xMidYMid meet"})})]},`away-${e.id}`)})]})}),s.jsxs("div",{className:"formation-legend",children:[s.jsxs("div",{className:"legend-item home",children:[s.jsx("span",{className:"legend-dot home"}),s.jsxs("span",{children:[i.name||"Home"," ",i.formation&&`(${i.formation})`]})]}),s.jsxs("div",{className:"legend-item away",children:[s.jsx("span",{className:"legend-dot away"}),s.jsxs("span",{children:[r.name||"Away"," ",r.formation&&`(${r.formation})`]})]})]}),o&&s.jsx("div",{className:"player-modal-overlay",onClick:N,children:s.jsxs("div",{className:"player-modal-card",onClick:e=>e.stopPropagation(),children:[s.jsx("button",{className:"player-modal-close",onClick:N,children:s.jsx("i",{className:"fas fa-times"})}),s.jsxs("div",{className:"player-modal-header "+(m?"home":"away"),children:[s.jsxs("div",{className:"player-modal-image",children:[o.player_image?s.jsx("img",{src:o.player_image,alt:o.name||o.player_name}):s.jsx("div",{className:"player-modal-placeholder",children:s.jsx("i",{className:"fas fa-user"})}),s.jsx("div",{className:"player-modal-ring "+(m?"home":"away")})]}),s.jsx("h3",{className:"player-modal-name",children:o.name||o.player_name}),s.jsx("p",{className:"player-modal-team",children:m?i.name:r.name})]}),s.jsx("div",{className:"player-modal-stats",children:s.jsx("table",{className:"player-stats-table-modal",children:s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{className:"stat-label",children:"Position"}),s.jsx("td",{className:"stat-value",children:o.position||"N/A"})]}),S&&s.jsxs("tr",{children:[s.jsx("td",{className:"stat-label",children:"Age"}),s.jsxs("td",{className:"stat-value",children:[S," years"]})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"stat-label",children:"Goals"}),s.jsx("td",{className:"stat-value stat-highlight goals",children:x?"...":(null==C?void 0:C.goalsScored)||0})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"stat-label",children:"Assists"}),s.jsx("td",{className:"stat-value stat-highlight assists",children:x?"...":(null==C?void 0:C.assists)||0})]})]})})}),s.jsx("button",{className:"player-modal-view-btn",disabled:p,onClick:async()=>{if(!p){u(!0);try{const e=window.location.pathname.includes("/u17/")?"u17":"open-age";window.location.href=`/muqawamah/2026/${e}/players/?player=${o.id}`}catch(e){u(!1)}}},children:p?"Loading...":"View Full Details"})]})})]})}function o({matchId:t,userIdentifier:l,initialLikeCount:i}){const[r,n]=e.useState(i||0),[c,o]=e.useState([]);e.useEffect(()=>{n(i||0)},[i]);const d=(e,a)=>{const s=Date.now()+Math.random()+e,t={id:s,horizontalOffset:e/a*20-10,delay:.15*e};o(e=>[...e,t]),setTimeout(()=>{o(e=>e.filter(e=>e.id!==s))},3e3)};return s.jsxs(s.Fragment,{children:[s.jsxs("button",{className:"match-like-button-sticky",onClick:async()=>{if(!t||!l)return;const e=3+Math.floor(3*Math.random());for(let a=0;a<e;a++)setTimeout(()=>{d(a,e)},80*a);n(e=>e+1);try{await a.from("match_likes").insert({match_id:t,user_identifier:l})}catch(s){}},title:"Show your support for this match",children:[s.jsx("i",{className:"fas fa-heart"}),r>0&&s.jsx("span",{className:"like-count-badge",children:r})]}),s.jsx("div",{className:"flying-hearts-container",children:c.map(e=>s.jsx("div",{className:"flying-heart",style:{"--horizontal-offset":`${e.horizontalOffset||0}px`,"--delay":`${e.delay||0}s`},children:s.jsx("i",{className:"fas fa-heart"})},e.id))})]})}function d({match:e}){var a,t,l,i,r,n,c,o;const d="completed"===e.status,m="live"===e.status,h=d||m,p="completed"===e.status?{label:"FULL TIME",className:"status-completed"}:"live"===e.status?{label:"LIVE",className:"status-live"}:"scheduled"===e.status?{label:"SCHEDULED",className:"status-scheduled"}:{label:"UPCOMING",className:"status-scheduled"};return s.jsx("section",{className:"match-header-section",children:s.jsxs("div",{className:"match-header-content",children:[s.jsxs("div",{className:"match-datetime",children:[s.jsx("p",{className:"match-date",children:(e=>{if(!e)return"TBD";return new Date(e).toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long"}).toUpperCase()})(e.match_date)}),s.jsx("p",{className:"match-time",children:(u=e.scheduled_time,u?u.substring(0,5):"TBD")})]}),s.jsxs("div",{className:"match-teams-header",children:[s.jsxs("div",{className:"header-team home",children:[s.jsx("div",{className:"team-logo-large",children:(null==(a=e.home_team)?void 0:a.crest_url)?s.jsx("img",{src:e.home_team.crest_url,alt:e.home_team.name,loading:"lazy"}):s.jsx("span",{children:(null==(l=null==(t=e.home_team)?void 0:t.name)?void 0:l.charAt(0))||"?"})}),s.jsx("h4",{className:"team-name-header",children:(null==(i=e.home_team)?void 0:i.name)||"TBD"})]}),s.jsxs("div",{className:"match-score-header",children:[h?s.jsxs("span",{className:"score-big "+(m?"live":""),children:[e.home_score??0," - ",e.away_score??0]}):s.jsx("span",{className:"score-vs",children:"VS"}),s.jsx("span",{className:"match-type-label",children:(()=>{var a;const s=null==(a=e.match_type)?void 0:a.toLowerCase();return s&&"group"!==s?"quarter-final"===s||"quarterfinal"===s?"Quarter Final":"semi-final"===s||"semifinal"===s?"Semi Final":"final"===s?"Final":"third-place"===s||"thirdplace"===s?"3rd Place":s.charAt(0).toUpperCase()+s.slice(1):"Group Stage"})()}),s.jsx("span",{className:`match-status-badge-detail ${p.className}`,children:p.label})]}),s.jsxs("div",{className:"header-team away",children:[s.jsx("div",{className:"team-logo-large",children:(null==(r=e.away_team)?void 0:r.crest_url)?s.jsx("img",{src:e.away_team.crest_url,alt:e.away_team.name,loading:"lazy"}):s.jsx("span",{children:(null==(c=null==(n=e.away_team)?void 0:n.name)?void 0:c.charAt(0))||"?"})}),s.jsx("h4",{className:"team-name-header",children:(null==(o=e.away_team)?void 0:o.name)||"TBD"})]})]}),s.jsxs("div",{className:"match-meta",children:[s.jsxs("p",{className:"matchday-label",children:["MATCHDAY ",e.match_number||1]}),e.venue&&s.jsx("p",{className:"venue-label",children:e.venue})]})]})});var u}function m({match:e,matchId:t,userIdentifier:l,userPrediction:i,userPredictionStats:r,onPredictionUpdate:n,onStatsUpdate:c}){var o,d,m,h,p,u;const y=async s=>{if(t&&l&&e)try{const{data:e}=await a.from("match_predictions").select("id, prediction").eq("match_id",t).eq("user_identifier",l).maybeSingle();if(e?e.prediction===s?(await a.from("match_predictions").delete().eq("id",e.id),n&&n(null)):(await a.from("match_predictions").update({prediction:s}).eq("id",e.id),n&&n(s)):(await a.from("match_predictions").insert({match_id:t,user_identifier:l,prediction:s}),n&&n(s)),c){const{data:e}=await a.from("match_predictions").select("prediction").eq("match_id",t);if(e){const a={home:e.filter(e=>"home"===e.prediction).length,draw:e.filter(e=>"draw"===e.prediction).length,away:e.filter(e=>"away"===e.prediction).length};c(a)}}}catch(i){}},_="completed"===e.status||"live"===e.status,x=r.home+r.draw+r.away,g=x>0?Math.round(r.home/x*100):0,f=x>0?Math.round(r.draw/x*100):0,j=x>0?Math.round(r.away/x*100):0;return s.jsxs("div",{className:"goals-panel-compact",children:[s.jsxs("h3",{className:"panel-title-compact",children:[s.jsx("i",{className:"fas fa-users"}),"Community Predictions"]}),s.jsx("div",{className:"prediction-content",children:s.jsx("div",{className:"prediction-bars-compact",children:s.jsxs("div",{className:"prediction-bar-item",children:[s.jsxs("div",{className:"user-prediction-probability-bar compact",children:[s.jsx("div",{className:"user-prob-segment home-win",style:{width:`${g}%`},title:`${(null==(o=e.home_team)?void 0:o.name)||"Home"} ${g}%${x>0?` (${r.home} votes)`:""}`,children:g>10&&s.jsxs("span",{className:"user-prob-label",children:[g,"%"]})}),s.jsx("div",{className:"user-prob-segment draw",style:{width:`${f}%`},title:`Draw ${f}%${x>0?` (${r.draw} votes)`:""}`,children:f>10&&s.jsxs("span",{className:"user-prob-label",children:[f,"%"]})}),s.jsx("div",{className:"user-prob-segment away-win",style:{width:`${j}%`},title:`${(null==(d=e.away_team)?void 0:d.name)||"Away"} ${j}%${x>0?` (${r.away} votes)`:""}`,children:j>10&&s.jsxs("span",{className:"user-prob-label",children:[j,"%"]})})]}),!i&&!_&&s.jsxs("div",{className:"user-prediction-buttons-compact",children:[s.jsxs("button",{className:"user-pred-btn-compact home",onClick:()=>y("home"),title:`${(null==(m=e.home_team)?void 0:m.name)||"Home"} to win`,children:[s.jsx("i",{className:"fas fa-trophy"}),s.jsx("span",{children:(null==(h=e.home_team)?void 0:h.name)||"Home"})]}),s.jsxs("button",{className:"user-pred-btn-compact draw",onClick:()=>y("draw"),title:"Draw",children:[s.jsx("i",{className:"fas fa-equals"}),s.jsx("span",{children:"Draw"})]}),s.jsxs("button",{className:"user-pred-btn-compact away",onClick:()=>y("away"),title:`${(null==(p=e.away_team)?void 0:p.name)||"Away"} to win`,children:[s.jsx("i",{className:"fas fa-trophy"}),s.jsx("span",{children:(null==(u=e.away_team)?void 0:u.name)||"Away"})]})]})]})})})]})}function h({goals:e,cards:a,match:t,isFinished:l}){const i=[...e.map(e=>({...e,type:"goal"})),...a.map(e=>({...e,type:"card"}))].sort((e,a)=>(e.minute||0)-(a.minute||0));return s.jsxs("div",{className:"goals-panel-compact",children:[s.jsxs("h3",{className:"panel-title-compact",children:[s.jsx("i",{className:"fas fa-futbol"}),"Goals & Highlights"]}),i.length>0?s.jsx("div",{className:"goals-list-compact",children:i.map((e,a)=>{var l,i,r,n,c,o,d;if("goal"===e.type){const c=e.team_id===t.home_team_id;return s.jsxs("div",{className:"goal-row-compact "+(c?"home":"away"),children:[s.jsxs("span",{className:"goal-minute-compact",children:[e.minute,"'"]}),s.jsx("span",{className:"goal-icon-compact",children:s.jsx("i",{className:"fas fa-futbol"})}),s.jsx("span",{className:"goal-scorer-compact",children:(null==(l=e.scorer)?void 0:l.player_name)||"Unknown"}),(null==(i=e.assister)?void 0:i.player_name)&&s.jsxs("span",{className:"goal-assist-compact",children:["(",e.assister.player_name,")"]}),s.jsx("span",{className:"goal-team-compact",children:c?null==(r=t.home_team)?void 0:r.name:null==(n=t.away_team)?void 0:n.name})]},`goal-${e.id||a}`)}{const l=e.team_id===t.home_team_id;return s.jsxs("div",{className:"card-row-compact "+(l?"home":"away"),children:[s.jsxs("span",{className:"goal-minute-compact",children:[e.minute,"'"]}),s.jsx("span",{className:`card-icon-compact ${e.card_type}`,children:"yellow"===e.card_type?s.jsx("i",{className:"fas fa-square",style:{color:"#ffd700"}}):s.jsx("i",{className:"fas fa-square",style:{color:"#ff0000"}})}),s.jsx("span",{className:"goal-scorer-compact",children:(null==(c=e.player)?void 0:c.player_name)||"Unknown"}),s.jsx("span",{className:"goal-team-compact",children:l?null==(o=t.home_team)?void 0:o.name:null==(d=t.away_team)?void 0:d.name})]},`card-${e.id||a}`)}})}):s.jsx("p",{className:"no-goals-compact",children:l?"No events":"Events will appear here"})]})}function p({homeTeamPlayers:e,awayTeamPlayers:a,match:t,goals:l,cards:i}){const r=e=>{const a=["GK","CB","LB","RB","CDM","CM","CAM","LM","RM","CF","ST","SUB"];return[...e].sort((e,s)=>{const t=a.indexOf(e.position),l=a.indexOf(s.position);return(-1===t?99:t)-(-1===l?99:l)})},n=(e,a,t)=>s.jsxs("div",{className:"squad-column "+(t?"home":"away"),children:[s.jsx("div",{className:"squad-header "+(t?"":"away"),children:t?s.jsxs(s.Fragment,{children:[(null==a?void 0:a.crest_url)&&s.jsx("img",{src:a.crest_url,alt:"",className:"squad-team-logo",loading:"lazy"}),s.jsx("span",{children:null==a?void 0:a.name})]}):s.jsxs(s.Fragment,{children:[s.jsx("span",{children:null==a?void 0:a.name}),(null==a?void 0:a.crest_url)&&s.jsx("img",{src:a.crest_url,alt:"",className:"squad-team-logo",loading:"lazy"})]})}),s.jsxs("div",{className:"squad-list",children:[r(e).map(e=>{const a=(e=>{if(!e)return{goalsScored:0,assists:0,yellowCards:0,redCards:0};let a=0,s=0,t=0,r=0;const n=e.name||e.player_name||"",c=e.registration_player_id;return l.forEach(e=>{var t,l;let i=!1,r=!1;if(c&&(e.scorer_id===c&&(i=!0),e.assister_id===c&&(r=!0)),!i&&!r){const a=(null==(t=e.scorer)?void 0:t.player_name)||"",s=(null==(l=e.assister)?void 0:l.player_name)||"";a&&n&&a.toLowerCase().trim()===n.toLowerCase().trim()&&(i=!0),s&&n&&s.toLowerCase().trim()===n.toLowerCase().trim()&&(r=!0)}i&&a++,r&&s++}),i&&i.length>0&&i.forEach(e=>{var a;let s=!1;if(c&&e.player_id===c&&(s=!0),!s){const t=(null==(a=e.player)?void 0:a.player_name)||"";t&&n&&t.toLowerCase().trim()===n.toLowerCase().trim()&&(s=!0)}s&&("yellow"===e.card_type&&t++,"red"===e.card_type&&r++)}),{goalsScored:a,assists:s,yellowCards:t,redCards:r}})(e);return s.jsxs("div",{className:"squad-player-row "+("SUB"===e.position||e.is_substitute?"substitute":""),children:[s.jsx("span",{className:"player-name",children:e.name||e.player_name||"Unknown"}),s.jsxs("div",{className:"player-stats-icons",children:[a.goalsScored>0&&s.jsxs("span",{className:"stat-icon goal-icon",title:`${a.goalsScored} goal${a.goalsScored>1?"s":""}`,children:[s.jsx("span",{className:"ball-icon-wrapper",children:s.jsx("img",{src:"/assets/img/Muqawama/ball.svg",alt:"Goal",style:{width:"16px",height:"16px"}})}),a.goalsScored>1&&s.jsx("span",{className:"stat-count-badge",children:a.goalsScored})]}),a.yellowCards>0&&s.jsxs("span",{className:"stat-icon yellow-card-icon",title:`${a.yellowCards} yellow card${a.yellowCards>1?"s":""}`,children:[s.jsx("img",{src:"/assets/img/Muqawama/Yellow_card.svg",alt:"Yellow Card",style:{width:"14px",height:"14px"}}),a.yellowCards>1&&s.jsx("span",{className:"stat-count-badge",children:a.yellowCards})]}),a.redCards>0&&s.jsxs("span",{className:"stat-icon red-card-icon",title:`${a.redCards} red card${a.redCards>1?"s":""}`,children:[s.jsx("img",{src:"/assets/img/Muqawama/Red_card.svg",alt:"Red Card",style:{width:"14px",height:"14px"}}),a.redCards>1&&s.jsx("span",{className:"stat-count-badge",children:a.redCards})]})]})]},e.id)}),0===e.length&&s.jsx("p",{className:"no-squad",children:"Squad not available"})]})]});return s.jsxs("div",{className:"squads-section",children:[s.jsx("h3",{className:"panel-title",children:"SQUADS"}),s.jsxs("div",{className:"squads-grid",children:[n(e,t.home_team,!0),n(a,t.away_team,!1)]})]})}function u({matchId:t,onBack:l}){const[n,u]=e.useState(null),[y,_]=e.useState([]),[x,g]=e.useState([]),[f,j]=e.useState([]),[w,v]=e.useState([]),[N,b]=e.useState(!0),[S,C]=e.useState(0),[M,k]=e.useState(null),[q,$]=e.useState(null),[L,A]=e.useState(!1),[E,P]=e.useState(null),[F,T]=e.useState({home:0,draw:0,away:0});e.useEffect(()=>{(()=>{let e=localStorage.getItem("user_identifier");if(!e){const a=document.createElement("canvas"),s=a.getContext("2d");s.textBaseline="top",s.font="14px Arial",s.fillText("Fingerprint",2,2);const t=a.toDataURL();e=btoa(navigator.userAgent+navigator.language+screen.width+screen.height+(new Date).getTimezoneOffset()+t).substring(0,32),localStorage.setItem("user_identifier",e)}k(e)})()},[]),e.useEffect(()=>{t&&D()},[t]),e.useEffect(()=>{t&&M&&n&&B()},[t,M,n]),e.useEffect(()=>{n&&"completed"!==n.status&&"live"!==n.status&&n.home_team_id&&n.away_team_id&&I()},[n]);const D=async()=>{var e,s;try{b(!0);const{data:l,error:i}=await a.from("matches").select("\n          id,\n          match_number,\n          match_date,\n          scheduled_time,\n          home_team_id,\n          away_team_id,\n          home_score,\n          away_score,\n          status,\n          category,\n          match_type,\n          venue,\n          home_team:teams!matches_home_team_id_fkey(id, name, crest_url, category),\n          away_team:teams!matches_away_team_id_fkey(id, name, crest_url, category)\n        ").eq("id",t).single();if(i)throw i;u(l);const[r,n]=await Promise.all([a.from("goals").select("\n            id,\n            match_id,\n            team_id,\n            scorer_id,\n            assister_id,\n            minute,\n            goal_type,\n            scorer:team_players!goals_scorer_id_fkey(id, player_name, player_image),\n            assister:team_players!goals_assister_id_fkey(id, player_name, player_image)\n          ").eq("match_id",t).order("minute",{ascending:!0}),a.from("cards").select("\n            id,\n            match_id,\n            team_id,\n            player_id,\n            card_type,\n            minute,\n            player:team_players!cards_player_id_fkey(id, player_name, player_image)\n          ").eq("match_id",t).order("minute",{ascending:!0})]),c=r.data,o=n.data;if(c){const e=new Set;c.forEach(a=>{var s,t;a.scorer_id&&!(null==(s=a.scorer)?void 0:s.player_name)&&e.add(a.scorer_id),a.assister_id&&!(null==(t=a.assister)?void 0:t.player_name)&&e.add(a.assister_id)});let s={};if(e.size>0){const{data:t}=await a.from("players").select("name, player_image, registration_player_id").in("registration_player_id",Array.from(e));t&&t.forEach(e=>{e.registration_player_id&&(s[e.registration_player_id]=e)})}const t=c.map(e=>{var a,t,l,i;let r=(null==(a=e.scorer)?void 0:a.player_name)||null,n=(null==(t=e.assister)?void 0:t.player_name)||null,c=(null==(l=e.scorer)?void 0:l.player_image)||null,o=(null==(i=e.assister)?void 0:i.player_image)||null;return e.scorer_id&&!r&&s[e.scorer_id]&&(r=s[e.scorer_id].name,c=s[e.scorer_id].player_image||c),e.assister_id&&!n&&s[e.assister_id]&&(n=s[e.assister_id].name,o=s[e.assister_id].player_image||o),{...e,scorer:r?{player_name:r,player_image:c}:null,assister:n?{player_name:n,player_image:o}:null}});j(t)}if(o){const e=new Set;o.forEach(a=>{var s;a.player_id&&!(null==(s=a.player)?void 0:s.player_name)&&e.add(a.player_id)});let s={};if(e.size>0){const{data:t}=await a.from("players").select("name, player_image, registration_player_id").in("registration_player_id",Array.from(e));t&&t.forEach(e=>{e.registration_player_id&&(s[e.registration_player_id]=e)})}const t=o.map(e=>{var a;let t=(null==(a=e.player)?void 0:a.player_name)||null;return e.player_id&&!t&&s[e.player_id]&&(t=s[e.player_id].name),{...e,player:t?{player_name:t}:null}});v(t)}if((null==(e=l.home_team)?void 0:e.id)&&(null==(s=l.away_team)?void 0:s.id)){const[e,s]=await Promise.all([a.from("players").select("id, name, player_image, position, position_x, position_y, is_substitute, team_id, registration_player_id").eq("team_id",l.home_team.id).order("position"),a.from("players").select("id, name, player_image, position, position_x, position_y, is_substitute, team_id, registration_player_id").eq("team_id",l.away_team.id).order("position")]);e.data&&_(e.data),s.data&&g(s.data)}}catch(l){}finally{b(!1)}},B=async()=>{if(t&&M&&n)try{const{data:e}=await a.from("match_likes").select("id").eq("match_id",t);C(e?e.length:0);const{data:s}=await a.from("match_predictions").select("prediction").eq("match_id",t);if(s){const e={home:s.filter(e=>"home"===e.prediction).length,draw:s.filter(e=>"draw"===e.prediction).length,away:s.filter(e=>"away"===e.prediction).length};T(e);const{data:l}=await a.from("match_predictions").select("prediction").eq("match_id",t).eq("user_identifier",M).maybeSingle();l&&P(l.prediction)}}catch(e){}},I=async()=>{if(n&&n.home_team_id&&n.away_team_id){A(!0);try{const{data:e}=await a.from("teams").select("*").eq("id",n.home_team_id).single(),{data:s}=await a.from("teams").select("*").eq("id",n.away_team_id).single();if(!e||!s)return void A(!1);const{data:t}=await a.from("matches").select("home_score, away_score, home_team_id, away_team_id").or(`home_team_id.eq.${n.home_team_id},away_team_id.eq.${n.home_team_id}`).eq("status","completed").order("match_date",{ascending:!1}).limit(2),{data:l}=await a.from("matches").select("home_score, away_score, home_team_id, away_team_id").or(`home_team_id.eq.${n.away_team_id},away_team_id.eq.${n.away_team_id}`).eq("status","completed").order("match_date",{ascending:!1}).limit(2);let i=0,r=0,c=0;t&&t.length>0&&t.forEach(e=>{e.home_team_id===n.home_team_id?(i+=e.home_score||0,r+=e.away_score||0,c++):(i+=e.away_score||0,r+=e.home_score||0,c++)});let o=0,d=0,m=0;l&&l.length>0&&l.forEach(e=>{e.home_team_id===n.away_team_id?(o+=e.home_score||0,d+=e.away_score||0,m++):(o+=e.away_score||0,d+=e.home_score||0,m++)});const{data:h}=await a.from("teams").select("goals_for, goals_against, played").eq("category",n.category||"open-age").gt("played",0);let p=1.5,u=1.5;if(h&&h.length>0){const e=h.reduce((e,a)=>e+(a.goals_for||0),0),a=h.reduce((e,a)=>e+(a.goals_against||0),0),s=h.reduce((e,a)=>e+(a.played||0),0);s>0&&(p=e/s,u=a/s)}const y=c>0?i/c:e.played>0?(e.goals_for||0)/e.played:p,_=c>0?r/c:e.played>0?(e.goals_against||0)/e.played:u,x=m>0?o/m:s.played>0?(s.goals_for||0)/s.played:p,g=m>0?d/m:s.played>0?(s.goals_against||0)/s.played:u,f=0===c&&0===e.played?1:p>0?y/p:1,j=0===c&&0===e.played?1:u>0?_/u:1,w=0===m&&0===s.played?1:p>0?x/p:1,v=0===m&&0===s.played?1:u>0?g/u:1,N=f*(1/v)*p*1.12,b=w*(1/j)*p,S=Math.round(N),C=Math.round(b),M=(e,a)=>{if(e<=0)return 0===a?1:0;let s=-e+a*Math.log(e);for(let t=2;t<=a;t++)s-=Math.log(t);return Math.exp(s)};let k=0,q=0,L=0;for(let a=0;a<=5;a++)for(let e=0;e<=5;e++){const s=M(N,a)*M(b,e);a>e?k+=s:a===e?q+=s:L+=s}const E=k+q+L;E>0?(k=k/E*100,q=q/E*100,L=L/E*100):(k=33.33,q=33.33,L=33.34),$({homeScore:Math.max(0,S),awayScore:Math.max(0,C),homeWinProb:Math.round(k),drawProb:Math.round(q),awayWinProb:Math.round(L),homeTeam:e.name,awayTeam:s.name})}catch(e){}finally{A(!1)}}};if(N)return s.jsxs(s.Fragment,{children:[s.jsx(i,{}),s.jsx("div",{className:"match-detail-loading",children:s.jsxs("div",{className:"fixtures-loading-content",children:[s.jsxs("div",{className:"logo-loader",children:[s.jsx("div",{className:"logo-ring"}),s.jsx("img",{src:"/assets/img/muq_invert.png",alt:"Muqawama",className:"logo-pulse"})]}),s.jsx("p",{children:"Loading match details..."})]})}),s.jsx(r,{edition:"2026"})]});if(!n)return s.jsxs(s.Fragment,{children:[s.jsx(i,{}),s.jsxs("div",{className:"match-detail-error",children:[s.jsx("i",{className:"fas fa-exclamation-triangle"}),s.jsx("p",{children:"Match not found"})]}),s.jsx(r,{edition:"2026"})]});const R="completed"===n.status;return s.jsxs(s.Fragment,{children:[s.jsx(i,{}),s.jsxs("div",{className:"match-detail-page",children:[s.jsx(o,{matchId:t,userIdentifier:M,initialLikeCount:S}),s.jsx(d,{match:n}),s.jsx("section",{className:"match-detail-content",children:s.jsxs("div",{className:"match-detail-single-column",children:[s.jsx(m,{match:n,matchId:t,userIdentifier:M,userPrediction:E,userPredictionStats:F,onPredictionUpdate:e=>{P(e)},onStatsUpdate:e=>{T(e)}}),s.jsx(h,{goals:f,cards:w,match:n,isFinished:R}),s.jsxs("div",{className:"formation-section",children:[s.jsx("h3",{className:"panel-title",children:"FORMATIONS"}),s.jsx(c,{homePlayers:y,awayPlayers:x,homeTeam:n.home_team,awayTeam:n.away_team,goals:f,cards:w})]}),s.jsx(p,{homeTeamPlayers:y,awayTeamPlayers:x,match:n,goals:f,cards:w})]})}),s.jsx("div",{className:"match-detail-footer"})]}),s.jsx(r,{edition:"2026"})]})}function y(){const[a,t]=e.useState("list"),[l,i]=e.useState(null);e.useEffect(()=>{const e=new URLSearchParams(window.location.search).get("match");return e&&(i(e),t("detail")),window.addEventListener("popstate",r),()=>window.removeEventListener("popstate",r)},[]);const r=()=>{const e=new URLSearchParams(window.location.search).get("match");e?(i(e),t("detail")):(t("list"),i(null))},c=()=>{const e=window.location.pathname;window.history.pushState({},"",e),t("list"),i(null)};return"detail"===a&&l?s.jsx(u,{matchId:l,onBack:c}):s.jsx(n,{onMatchClick:e=>{const a=`${window.location.pathname}?match=${e}`;window.history.pushState({matchId:e},"",a),i(e),t("detail"),window.scrollTo(0,0)}})}t.createRoot(document.getElementById("fixtures-root")).render(s.jsx(l.StrictMode,{children:s.jsx(y,{})}));
