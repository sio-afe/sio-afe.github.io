import{r as e,s as a,j as s,c as t,R as r}from"./supabaseClient-y7L7r4ir.js";import{u as i,T as n}from"./TournamentNavbar-DLqNlQUK.js";import{F as l}from"./Footer-Cjjkr2XU.js";import{S as o}from"./SmartImg-mv2gJrPZ.js";import{S as c,c as d,M as m}from"./ShareableCard-C7zwKhjr.js";import"./supabase-client-FID_-7ME.js";import"./index-3r6UxFjv.js";function h({onMatchClick:t}){const[r,c]=e.useState([]),[d,m]=e.useState(!0),[h,p]=e.useState(1),[u,x]=e.useState("list"),[y,g]=e.useState(""),[_]=e.useState(window.location.pathname.includes("/u17/")?"u17":"open-age"),f=e=>{if(!e)return null;const a=e.toLowerCase();return"group"===a?"Group Stage":"quarter-final"===a||"quarterfinal"===a?"Quarter Final":"semi-final"===a||"semifinal"===a?"Semi Final":"final"===a?"Final":"third-place"===a||"thirdplace"===a?"3rd Place":e.charAt(0).toUpperCase()+e.slice(1)};e.useEffect(()=>{v()},[_]);const j=e.useCallback(()=>{v()},[_]);i({enabled:!0,channelKey:`fixtures:${_}`,tables:["matches","teams"],filtersByTable:{matches:`category=eq.${_}`,teams:`category=eq.${_}`},debounceMs:600,pollIntervalMs:1e4,onUpdate:j});const v=async()=>{try{m(!0);const{data:e,error:s}=await a.from("matches").select("\n          *,\n          home_team:teams!matches_home_team_id_fkey(id, name, crest_url),\n          away_team:teams!matches_away_team_id_fkey(id, name, crest_url)\n        ").eq("category",_).order("match_number",{ascending:!0}).order("scheduled_time",{ascending:!0});if(s)throw s;if(c(e||[]),e&&e.length>0){const a=[...new Set(e.map(e=>e.match_number).filter(Boolean))],s=e.filter(e=>"completed"===e.status).map(e=>e.match_number).sort((e,a)=>a-e)[0];if(s){const e=a.some(e=>e>s);p(e?s+1:s)}else p(a[0]||1)}}catch(e){}finally{m(!1)}},w=e.useMemo(()=>{const e={};return r.forEach(a=>{const s=a.match_number||1;e[s]||(e[s]=[]),e[s].push(a)}),e},[r]),b=e.useMemo(()=>[...new Set(r.map(e=>e.match_number).filter(Boolean))].sort((e,a)=>e-a),[r]),N=w[h]||[],C=e.useMemo(()=>{if(!y.trim())return N;const e=y.toLowerCase().trim();return N.filter(a=>{var s,t,r,i;return(null==(t=null==(s=a.home_team)?void 0:s.name)?void 0:t.toLowerCase().includes(e))||(null==(i=null==(r=a.away_team)?void 0:r.name)?void 0:i.toLowerCase().includes(e))})},[N,y]),S=e.useMemo(()=>{if(!y.trim())return r;const e=y.toLowerCase().trim();return r.filter(a=>{var s,t,r,i;return(null==(t=null==(s=a.home_team)?void 0:s.name)?void 0:t.toLowerCase().includes(e))||(null==(i=null==(r=a.away_team)?void 0:r.name)?void 0:i.toLowerCase().includes(e))})},[r,y]);return d?s.jsxs(s.Fragment,{children:[s.jsx(n,{}),s.jsx("div",{className:"fixtures-loading",children:s.jsxs("div",{className:"fixtures-loading-content",children:[s.jsxs("div",{className:"logo-loader",children:[s.jsx("div",{className:"logo-ring"}),s.jsx("img",{src:"/assets/img/muq_invert.png",alt:"Muqawama",className:"logo-pulse"})]}),s.jsx("p",{children:"Loading fixtures..."})]})}),s.jsx(l,{edition:"2026"})]}):s.jsxs(s.Fragment,{children:[s.jsx(n,{}),s.jsx("div",{className:"fixtures-page-v2",children:s.jsxs("div",{className:"fixtures-container-v2",children:[s.jsxs("div",{className:"fixtures-header-v2",children:[s.jsx("h1",{children:"Fixtures & Results"}),s.jsx("hr",{className:"fixtures-divider"})]}),s.jsxs("div",{className:"fixtures-controls",children:[s.jsxs("div",{className:"view-toggle-fixtures",children:[s.jsxs("button",{className:"view-btn "+("list"===u?"active":""),onClick:()=>x("list"),title:"List View",children:[s.jsx("i",{className:"fas fa-list"}),s.jsx("span",{children:"Matchday"})]}),s.jsxs("button",{className:"view-btn "+("all"===u?"active":""),onClick:()=>x("all"),title:"All Matches",children:[s.jsx("i",{className:"fas fa-th-list"}),s.jsx("span",{children:"All"})]})]}),s.jsxs("div",{className:"fixtures-search",children:[s.jsx("i",{className:"fas fa-search"}),s.jsx("input",{type:"text",placeholder:"Search by team name...",value:y,onChange:e=>g(e.target.value)}),y&&s.jsx("button",{className:"clear-search",onClick:()=>g(""),children:s.jsx("i",{className:"fas fa-times"})})]})]}),"list"===u&&b.length>0&&s.jsx("div",{className:"matchday-tabs-v2",children:b.map(e=>s.jsx("button",{className:"matchday-tab-v2 "+(h===e?"active":""),onClick:()=>p(e),children:e},e))}),s.jsx("div",{className:"matches-list-v2",children:("all"===u?S:C).length>0?("all"===u?S:C).map(e=>{var a,r,i,n,l,c,d,m;const h="completed"===e.status,p="live"===e.status,u=h||p,x=e.home_score??0,y=e.away_score??0,g=(e=>{return"completed"===e.status?{label:"FT",className:"status-completed"}:"live"===e.status?{label:"LIVE",className:"status-live"}:"scheduled"===e.status?{label:(a=e.scheduled_time,a?a.length>=5?a.substring(0,5):a:"TBD"),className:"status-scheduled"}:{label:"TBD",className:"status-scheduled"};var a})(e);return s.jsxs("div",{className:"match-card-v2 clickable",onClick:()=>t&&t(e.id),style:{cursor:t?"pointer":"default"},children:[s.jsx("div",{className:"match-status-mobile",children:s.jsx("span",{className:`status-badge ${g.className}`,children:g.label})}),s.jsxs("div",{className:"match-row-v2",children:[s.jsx("div",{className:"match-status-desktop",children:s.jsx("span",{className:`status-badge ${g.className}`,children:g.label})}),s.jsxs("div",{className:"match-team-v2 home",children:[s.jsx("span",{className:"team-name-v2",children:(null==(a=e.home_team)?void 0:a.name)||"TBD"}),s.jsx("div",{className:"team-logo-v2",children:(null==(r=e.home_team)?void 0:r.crest_url)?s.jsx(o,{src:e.home_team.crest_url,preset:"crestSm",alt:e.home_team.name,loading:"lazy",decoding:"async"}):s.jsx("span",{children:(null==(n=null==(i=e.home_team)?void 0:i.name)?void 0:n.charAt(0))||"?"})})]}),s.jsx("div",{className:"match-score-v2",children:u?s.jsxs("span",{className:"score-display "+(p?"live":""),children:[x," - ",y]}):s.jsx("span",{className:"vs-display",children:"vs"})}),s.jsxs("div",{className:"match-team-v2 away",children:[s.jsx("div",{className:"team-logo-v2",children:(null==(l=e.away_team)?void 0:l.crest_url)?s.jsx(o,{src:e.away_team.crest_url,preset:"crestSm",alt:e.away_team.name,loading:"lazy",decoding:"async"}):s.jsx("span",{children:(null==(d=null==(c=e.away_team)?void 0:c.name)?void 0:d.charAt(0))||"?"})}),s.jsx("span",{className:"team-name-v2",children:(null==(m=e.away_team)?void 0:m.name)||"TBD"})]}),s.jsx("div",{className:"match-venue-desktop",children:s.jsxs("span",{children:[e.venue||"",e.venue&&f(e.match_type)&&" | ",f(e.match_type)]})})]}),s.jsx("div",{className:"match-venue-mobile",children:s.jsxs("span",{children:[e.venue||"",e.venue&&f(e.match_type)&&" | ",f(e.match_type)]})})]},e.id)}):s.jsxs("div",{className:"no-matches-v2",children:[s.jsx("i",{className:"fas fa-calendar-times"}),s.jsx("p",{children:y?`No matches found for "${y}"`:`No fixtures scheduled for Matchday ${h}`})]})})]})}),s.jsx(l,{edition:"2026"}),s.jsx("style",{children:"\n        .fixtures-controls {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          gap: 16px;\n          margin-bottom: 24px;\n          flex-wrap: wrap;\n        }\n\n        .view-toggle-fixtures {\n          display: flex;\n          gap: 4px;\n          background: rgba(255, 255, 255, 0.05);\n          padding: 4px;\n          border-radius: 10px;\n        }\n\n        .view-btn {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n          padding: 10px 16px;\n          background: transparent;\n          border: none;\n          color: rgba(255, 255, 255, 0.5);\n          cursor: pointer;\n          border-radius: 8px;\n          font-size: 13px;\n          font-weight: 500;\n          transition: all 0.2s;\n        }\n\n        .view-btn:hover {\n          color: rgba(255, 255, 255, 0.8);\n          background: rgba(255, 255, 255, 0.05);\n        }\n\n        .view-btn.active {\n          background: linear-gradient(135deg, #4f8cff, #6fb1fc);\n          color: #fff;\n        }\n\n        .view-btn i {\n          font-size: 14px;\n        }\n\n        .fixtures-search {\n          display: flex;\n          align-items: center;\n          gap: 10px;\n          background: rgba(255, 255, 255, 0.05);\n          border: 1px solid rgba(255, 255, 255, 0.1);\n          border-radius: 10px;\n          padding: 10px 16px;\n          min-width: 250px;\n          transition: all 0.2s;\n        }\n\n        .fixtures-search:focus-within {\n          border-color: #4f8cff;\n          background: rgba(79, 140, 255, 0.05);\n        }\n\n        .fixtures-search i {\n          color: rgba(255, 255, 255, 0.4);\n        }\n\n        .fixtures-search input {\n          flex: 1;\n          background: transparent;\n          border: none;\n          outline: none;\n          color: #fff;\n          font-size: 14px;\n        }\n\n        .fixtures-search input::placeholder {\n          color: rgba(255, 255, 255, 0.4);\n        }\n\n        .clear-search {\n          background: none;\n          border: none;\n          color: rgba(255, 255, 255, 0.4);\n          cursor: pointer;\n          padding: 4px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          transition: color 0.2s;\n        }\n\n        .clear-search:hover {\n          color: #fff;\n        }\n\n        @media (max-width: 768px) {\n          .fixtures-controls {\n            flex-direction: column;\n            align-items: stretch;\n          }\n\n          .view-toggle-fixtures {\n            justify-content: center;\n          }\n\n          .fixtures-search {\n            min-width: 100%;\n          }\n\n          .view-btn span {\n            display: none;\n          }\n\n          .view-btn {\n            padding: 10px 14px;\n          }\n        }\n      "})]})}function p({homePlayers:t=[],awayPlayers:r=[],homeTeam:i={},awayTeam:n={},goals:l=[],cards:o=[]}){const[c,d]=e.useState(null),[m,h]=e.useState(!0),[p,u]=e.useState(!1),[x,y]=e.useState(null),[g,_]=e.useState(!1),f=t.filter(e=>!e.is_substitute&&"SUB"!==e.position).slice(0,7),j=r.filter(e=>!e.is_substitute&&"SUB"!==e.position).slice(0,7),v=e=>{if(!e)return{goalsScored:0,assists:0,yellowCards:0,redCards:0};let a=0,s=0,t=0,r=0;const i=e.name||e.player_name||"",n=e.registration_player_id;return l.forEach(t=>{var r,l;let o=!1,c=!1;if(n&&(t.scorer_id===n&&(o=!0),t.assister_id===n&&(c=!0)),!o&&!c){const a=(null==(r=t.scorer)?void 0:r.player_name)||"",s=(null==(l=t.assister)?void 0:l.player_name)||"",n=e.team_id;a&&i&&a.toLowerCase().trim()===i.toLowerCase().trim()&&t.team_id===n&&(o=!0),s&&i&&s.toLowerCase().trim()===i.toLowerCase().trim()&&t.team_id===n&&(c=!0)}o&&a++,c&&s++}),o&&o.length>0&&o.forEach(a=>{var s;let l=!1;if(n&&a.player_id===n&&(l=!0),!l){const t=(null==(s=a.player)?void 0:s.player_name)||"",r=e.team_id;t&&i&&t.toLowerCase().trim()===i.toLowerCase().trim()&&a.team_id===r&&(l=!0)}l&&("yellow"===a.card_type&&t++,"red"===a.card_type&&r++)}),{goalsScored:a,assists:s,yellowCards:t,redCards:r}},w=(e,a)=>{d(e),h(a),y(null)};e.useEffect(()=>{(async()=>{if(c){_(!0);try{const e=c.name||c.player_name||"",s=c.registration_player_id;let t=[];if(s){const{data:e}=await a.from("goals").select("id, scorer_id, assister_id").eq("scorer_id",s),{data:r}=await a.from("goals").select("id, scorer_id, assister_id").eq("assister_id",s),i=new Map;(e||[]).forEach(e=>i.set(e.id,e)),(r||[]).forEach(e=>i.set(e.id,e)),t=Array.from(i.values())}if(e&&0===t.length){const{data:s}=await a.from("goals").select("\n              id,\n              scorer_id,\n              assister_id,\n              scorer:team_players!goals_scorer_id_fkey(player_name),\n              assister:team_players!goals_assister_id_fkey(player_name)\n            ");s&&(t=s.filter(a=>{var s,t;const r=(null==(s=a.scorer)?void 0:s.player_name)||"",i=(null==(t=a.assister)?void 0:t.player_name)||"";return r&&r.toLowerCase().trim()===e.toLowerCase().trim()||i&&i.toLowerCase().trim()===e.toLowerCase().trim()}))}let r=[];if(s){const{data:e}=await a.from("cards").select("id, player_id, card_type").eq("player_id",s);r=e||[]}if(e&&0===r.length){const{data:s}=await a.from("cards").select("\n              id,\n              player_id,\n              card_type,\n              player:team_players!cards_player_id_fkey(player_name)\n            ");s&&(r=s.filter(a=>{var s;const t=(null==(s=a.player)?void 0:s.player_name)||"";return t&&t.toLowerCase().trim()===e.toLowerCase().trim()}))}let i=0,n=0,l=0,o=0;t.forEach(a=>{var t,r;if(s)a.scorer_id===s&&i++,a.assister_id===s&&n++;else{const s=(null==(t=a.scorer)?void 0:t.player_name)||"",l=(null==(r=a.assister)?void 0:r.player_name)||"";s&&s.toLowerCase().trim()===e.toLowerCase().trim()&&i++,l&&l.toLowerCase().trim()===e.toLowerCase().trim()&&n++}}),r.forEach(e=>{"yellow"===e.card_type&&l++,"red"===e.card_type&&o++}),y({goalsScored:i,assists:n,yellowCards:l,redCards:o})}catch(e){y({goalsScored:0,assists:0,yellowCards:0,redCards:0})}finally{_(!1)}}else y(null)})()},[c]);const b=()=>{d(null)};if(!(f.length>0||j.length>0))return s.jsxs("div",{className:"match-formation-empty",children:[s.jsx("i",{className:"fas fa-users-slash"}),s.jsx("p",{children:"Formation not available"})]});const N=c?v(c):null,C=c?(e=>{if(!e)return null;const a=new Date(e),s=new Date;let t=s.getFullYear()-a.getFullYear();const r=s.getMonth()-a.getMonth();return(r<0||0===r&&s.getDate()<a.getDate())&&t--,t})(c.date_of_birth):null,S=null!==x?x:N;return s.jsxs("div",{className:"match-formation-field",children:[s.jsx("div",{className:"formation-field-wrapper",children:s.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 74 111",className:"match-field-svg",children:[s.jsx("rect",{width:"74",height:"111",fill:"#0d1117"}),s.jsxs("g",{fill:"none",stroke:"rgba(255,255,255,0.35)",strokeWidth:"0.5",transform:"translate(3 3)",children:[s.jsx("path",{d:"M 0 0 h 68 v 105 h -68 Z"}),s.jsx("path",{d:"M 0 52.5 h 68"}),s.jsx("circle",{r:"9.15",cx:"34",cy:"52.5"}),s.jsx("circle",{r:"0.75",cx:"34",cy:"52.5",fill:"rgba(255,255,255,0.35)",stroke:"none"}),s.jsxs("g",{children:[s.jsx("path",{d:"M 13.84 0 v 16.5 h 40.32 v -16.5"}),s.jsx("path",{d:"M 24.84 0 v 5.5 h 18.32 v -5.5"}),s.jsx("circle",{r:"0.75",cx:"34",cy:"10.94",fill:"rgba(255,255,255,0.35)",stroke:"none"}),s.jsx("path",{d:"M 26.733027 16.5 a 9.15 9.15 0 0 0 14.533946 0"})]}),s.jsxs("g",{transform:"rotate(180,34,52.5)",children:[s.jsx("path",{d:"M 13.84 0 v 16.5 h 40.32 v -16.5"}),s.jsx("path",{d:"M 24.84 0 v 5.5 h 18.32 v -5.5"}),s.jsx("circle",{r:"0.75",cx:"34",cy:"10.94",fill:"rgba(255,255,255,0.35)",stroke:"none"}),s.jsx("path",{d:"M 26.733027 16.5 a 9.15 9.15 0 0 0 14.533946 0"})]}),s.jsx("path",{d:"M 0 2 a 2 2 0 0 0 2 -2M 66 0 a 2 2 0 0 0 2 2M 68 103 a 2 2 0 0 0 -2 2M 2 105 a 2 2 0 0 0 -2 -2"})]}),f.map(e=>{var a,t,r,i;const n=(e=>({x:"number"==typeof e.position_x?e.position_x:50,y:4+(100-("number"==typeof e.position_y?e.position_y:50))/100*44}))(e),l=3+n.x/100*68,o=3+n.y/100*105,c=v(e),d=c.goalsScored>0,m=c.yellowCards>0,h=c.redCards>0;return s.jsxs("g",{transform:`translate(${l}, ${o})`,style:{cursor:"pointer"},onClick:()=>w(e,!0),role:"button",tabIndex:0,onKeyDown:a=>{"Enter"!==a.key&&" "!==a.key||w(e,!0)},children:[s.jsx("circle",{r:"3.8",fill:"none",stroke:"#4a90e2",strokeWidth:"0.3"}),s.jsx("circle",{r:"3",fill:"#1e2a38",stroke:"none"}),e.player_image?s.jsxs(s.Fragment,{children:[s.jsx("defs",{children:s.jsx("clipPath",{id:`clip-home-${e.id}`,children:s.jsx("circle",{r:"3",cx:"0",cy:"0"})})}),s.jsx("image",{href:e.player_image,x:"-3",y:"-3",width:"6",height:"6",clipPath:`url(#clip-home-${e.id})`,preserveAspectRatio:"xMidYMid slice"})]}):s.jsx("text",{x:"0",y:"1",textAnchor:"middle",fill:"#4a90e2",fontSize:"2.2",fontWeight:"700",children:e.position||"?"}),s.jsx("text",{x:"0",y:"6.5",textAnchor:"middle",fill:"#4a90e2",fontSize:"1.8",fontWeight:"600",children:(null==(t=null==(a=e.name)?void 0:a.split(" ")[0])?void 0:t.substring(0,8))||(null==(i=null==(r=e.player_name)?void 0:r.split(" ")[0])?void 0:i.substring(0,8))||""}),d&&s.jsxs("g",{transform:"translate(2.7, -2.7)",children:[s.jsx("circle",{r:"1.2",fill:"#fff",opacity:"0.98"}),s.jsx("image",{href:"/assets/img/Muqawama/ball.svg",x:"-1.2",y:"-1.2",width:"2.4",height:"2.4",preserveAspectRatio:"xMidYMid meet"}),c.goalsScored>1&&s.jsxs("g",{children:[s.jsx("circle",{cx:"0.9",cy:"-0.9",r:"0.65",fill:"#fff",stroke:"#000",strokeWidth:"0.18"}),s.jsx("text",{x:"0.9",y:"-0.75",textAnchor:"middle",fontSize:"0.75",fill:"#000",fontWeight:"700",children:c.goalsScored})]})]}),m&&s.jsx("g",{transform:"translate(-2.7, -2.7)",children:s.jsx("image",{href:"/assets/img/Muqawama/Yellow_card.svg",x:"-1.2",y:"-1.2",width:"2.4",height:"2.4",preserveAspectRatio:"xMidYMid meet"})}),h&&s.jsx("g",{transform:"translate(2.7, 2.7)",children:s.jsx("image",{href:"/assets/img/Muqawama/Red_card.svg",x:"-1.2",y:"-1.2",width:"2.4",height:"2.4",preserveAspectRatio:"xMidYMid meet"})})]},`home-${e.id}`)}),j.map(e=>{var a,t,r,i;const n=(e=>({x:"number"==typeof e.position_x?e.position_x:50,y:52+("number"==typeof e.position_y?e.position_y:50)/100*44}))(e),l=3+n.x/100*68,o=3+n.y/100*105,c=v(e),d=c.goalsScored>0,m=c.yellowCards>0,h=c.redCards>0;return s.jsxs("g",{transform:`translate(${l}, ${o})`,style:{cursor:"pointer"},onClick:()=>w(e,!1),role:"button",tabIndex:0,onKeyDown:a=>{"Enter"!==a.key&&" "!==a.key||w(e,!1)},children:[s.jsx("circle",{r:"3.8",fill:"none",stroke:"#e63946",strokeWidth:"0.3"}),s.jsx("circle",{r:"3",fill:"#2a1e1e",stroke:"none"}),e.player_image?s.jsxs(s.Fragment,{children:[s.jsx("defs",{children:s.jsx("clipPath",{id:`clip-away-${e.id}`,children:s.jsx("circle",{r:"3",cx:"0",cy:"0"})})}),s.jsx("image",{href:e.player_image,x:"-3",y:"-3",width:"6",height:"6",clipPath:`url(#clip-away-${e.id})`,preserveAspectRatio:"xMidYMid slice"})]}):s.jsx("text",{x:"0",y:"1",textAnchor:"middle",fill:"#e63946",fontSize:"2.2",fontWeight:"700",children:e.position||"?"}),s.jsx("text",{x:"0",y:"6.5",textAnchor:"middle",fill:"#e63946",fontSize:"1.8",fontWeight:"600",children:(null==(t=null==(a=e.name)?void 0:a.split(" ")[0])?void 0:t.substring(0,8))||(null==(i=null==(r=e.player_name)?void 0:r.split(" ")[0])?void 0:i.substring(0,8))||""}),d&&s.jsxs("g",{transform:"translate(2.7, -2.7)",children:[s.jsx("circle",{r:"1.2",fill:"#fff",opacity:"0.98"}),s.jsx("image",{href:"/assets/img/Muqawama/ball.svg",x:"-1.2",y:"-1.2",width:"2.4",height:"2.4",preserveAspectRatio:"xMidYMid meet"}),c.goalsScored>1&&s.jsxs("g",{children:[s.jsx("circle",{cx:"0.9",cy:"-0.9",r:"0.65",fill:"#fff",stroke:"#000",strokeWidth:"0.18"}),s.jsx("text",{x:"0.9",y:"-0.75",textAnchor:"middle",fontSize:"0.75",fill:"#000",fontWeight:"700",children:c.goalsScored})]})]}),m&&s.jsx("g",{transform:"translate(-2.7, -2.7)",children:s.jsx("image",{href:"/assets/img/Muqawama/Yellow_card.svg",x:"-1.2",y:"-1.2",width:"2.4",height:"2.4",preserveAspectRatio:"xMidYMid meet"})}),h&&s.jsx("g",{transform:"translate(2.7, 2.7)",children:s.jsx("image",{href:"/assets/img/Muqawama/Red_card.svg",x:"-1.2",y:"-1.2",width:"2.4",height:"2.4",preserveAspectRatio:"xMidYMid meet"})})]},`away-${e.id}`)})]})}),s.jsxs("div",{className:"formation-legend",children:[s.jsxs("div",{className:"legend-item home",children:[s.jsx("span",{className:"legend-dot home"}),s.jsxs("span",{children:[i.name||"Home"," ",i.formation&&`(${i.formation})`]})]}),s.jsxs("div",{className:"legend-item away",children:[s.jsx("span",{className:"legend-dot away"}),s.jsxs("span",{children:[n.name||"Away"," ",n.formation&&`(${n.formation})`]})]})]}),c&&s.jsx("div",{className:"player-modal-overlay",onClick:b,children:s.jsxs("div",{className:"player-modal-card",onClick:e=>e.stopPropagation(),children:[s.jsx("button",{className:"player-modal-close",onClick:b,children:s.jsx("i",{className:"fas fa-times"})}),s.jsxs("div",{className:"player-modal-header "+(m?"home":"away"),children:[s.jsxs("div",{className:"player-modal-image",children:[c.player_image?s.jsx("img",{src:c.player_image,alt:c.name||c.player_name}):s.jsx("div",{className:"player-modal-placeholder",children:s.jsx("i",{className:"fas fa-user"})}),s.jsx("div",{className:"player-modal-ring "+(m?"home":"away")})]}),s.jsx("h3",{className:"player-modal-name",children:c.name||c.player_name}),s.jsx("p",{className:"player-modal-team",children:m?i.name:n.name})]}),s.jsx("div",{className:"player-modal-stats",children:s.jsx("table",{className:"player-stats-table-modal",children:s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{className:"stat-label",children:"Position"}),s.jsx("td",{className:"stat-value",children:c.position||"N/A"})]}),C&&s.jsxs("tr",{children:[s.jsx("td",{className:"stat-label",children:"Age"}),s.jsxs("td",{className:"stat-value",children:[C," years"]})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"stat-label",children:"Goals"}),s.jsx("td",{className:"stat-value stat-highlight goals",children:g?"...":(null==S?void 0:S.goalsScored)||0})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"stat-label",children:"Assists"}),s.jsx("td",{className:"stat-value stat-highlight assists",children:g?"...":(null==S?void 0:S.assists)||0})]})]})})}),s.jsx("button",{className:"player-modal-view-btn",disabled:p,onClick:async()=>{if(!p){u(!0);try{const e=window.location.pathname.includes("/u17/")?"u17":"open-age";window.location.href=`/muqawamah/2026/${e}/players/?player=${c.id}`}catch(e){u(!1)}}},children:p?"Loading...":"View Full Details"})]})})]})}function u({matchId:t,userIdentifier:r,initialLikeCount:i}){const[n,l]=e.useState(i||0),[o,c]=e.useState([]);e.useEffect(()=>{l(i||0)},[i]);const d=(e,a)=>{const s=Date.now()+Math.random()+e,t={id:s,horizontalOffset:e/a*20-10,delay:.15*e};c(e=>[...e,t]),setTimeout(()=>{c(e=>e.filter(e=>e.id!==s))},3e3)};return s.jsxs(s.Fragment,{children:[s.jsxs("button",{className:"match-like-button-sticky",onClick:async()=>{if(!t||!r)return;const e=3+Math.floor(3*Math.random());for(let a=0;a<e;a++)setTimeout(()=>{d(a,e)},80*a);l(e=>e+1);try{await a.from("match_likes").insert({match_id:t,user_identifier:r})}catch(s){}},title:"Show your support for this match",children:[s.jsx("i",{className:"fas fa-heart"}),n>0&&s.jsx("span",{className:"like-count-badge",children:n})]}),s.jsx("div",{className:"flying-hearts-container",children:o.map(e=>s.jsx("div",{className:"flying-heart",style:{"--horizontal-offset":`${e.horizontalOffset||0}px`,"--delay":`${e.delay||0}s`},children:s.jsx("i",{className:"fas fa-heart"})},e.id))})]})}function x({match:e}){var a,t,r,i,n,l,c,d;const m="completed"===e.status,h="live"===e.status,p=m||h,u="completed"===e.status?{label:"FULL TIME",className:"status-completed"}:"live"===e.status?{label:"LIVE",className:"status-live"}:"scheduled"===e.status?{label:"SCHEDULED",className:"status-scheduled"}:{label:"UPCOMING",className:"status-scheduled"};return s.jsx("section",{className:"match-header-section",children:s.jsxs("div",{className:"match-header-content",children:[s.jsxs("div",{className:"match-datetime",children:[s.jsx("p",{className:"match-date",children:(e=>{if(!e)return"TBD";return new Date(e).toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long"}).toUpperCase()})(e.match_date)}),s.jsx("p",{className:"match-time",children:(x=e.scheduled_time,x?x.substring(0,5):"TBD")})]}),s.jsxs("div",{className:"match-teams-header",children:[s.jsxs("div",{className:"header-team home",children:[s.jsx("div",{className:"team-logo-large",children:(null==(a=e.home_team)?void 0:a.crest_url)?s.jsx(o,{src:e.home_team.crest_url,preset:"matchCrest",alt:e.home_team.name,loading:"eager",decoding:"async",fetchpriority:"high"}):s.jsx("span",{children:(null==(r=null==(t=e.home_team)?void 0:t.name)?void 0:r.charAt(0))||"?"})}),s.jsx("h4",{className:"team-name-header",children:(null==(i=e.home_team)?void 0:i.name)||"TBD"})]}),s.jsxs("div",{className:"match-score-header",children:[p?s.jsxs("span",{className:"score-big "+(h?"live":""),children:[e.home_score??0," - ",e.away_score??0]}):s.jsx("span",{className:"score-vs",children:"VS"}),s.jsx("span",{className:"match-type-label",children:(()=>{var a;const s=null==(a=e.match_type)?void 0:a.toLowerCase();return s&&"group"!==s?"quarter-final"===s||"quarterfinal"===s?"Quarter Final":"semi-final"===s||"semifinal"===s?"Semi Final":"final"===s?"Final":"third-place"===s||"thirdplace"===s?"3rd Place":s.charAt(0).toUpperCase()+s.slice(1):"Group Stage"})()}),s.jsx("span",{className:`match-status-badge-detail ${u.className}`,children:u.label})]}),s.jsxs("div",{className:"header-team away",children:[s.jsx("div",{className:"team-logo-large",children:(null==(n=e.away_team)?void 0:n.crest_url)?s.jsx(o,{src:e.away_team.crest_url,preset:"matchCrest",alt:e.away_team.name,loading:"eager",decoding:"async",fetchpriority:"high"}):s.jsx("span",{children:(null==(c=null==(l=e.away_team)?void 0:l.name)?void 0:c.charAt(0))||"?"})}),s.jsx("h4",{className:"team-name-header",children:(null==(d=e.away_team)?void 0:d.name)||"TBD"})]})]}),s.jsxs("div",{className:"match-meta",children:[s.jsxs("p",{className:"matchday-label",children:["MATCHDAY ",e.match_number||1]}),e.venue&&s.jsx("p",{className:"venue-label",children:e.venue})]})]})});var x}function y({match:e,matchId:t,userIdentifier:r,userPrediction:i,userPredictionStats:n,onPredictionUpdate:l,onStatsUpdate:o}){var c,d,m,h,p,u,x,y;const g=async s=>{if(t&&r&&e)try{const{data:e}=await a.from("match_predictions").select("id, prediction").eq("match_id",t).eq("user_identifier",r).maybeSingle();if(e?e.prediction===s?(await a.from("match_predictions").delete().eq("id",e.id),l&&l(null)):(await a.from("match_predictions").update({prediction:s}).eq("id",e.id),l&&l(s)):(await a.from("match_predictions").insert({match_id:t,user_identifier:r,prediction:s}),l&&l(s)),o){const{data:e}=await a.from("match_predictions").select("prediction").eq("match_id",t);if(e){const a={home:e.filter(e=>"home"===e.prediction).length,draw:e.filter(e=>"draw"===e.prediction).length,away:e.filter(e=>"away"===e.prediction).length};o(a)}}}catch(i){}},_="completed"===e.status,f=n.home+n.draw+n.away,j=f>0?Math.round(n.home/f*100):0,v=f>0?Math.round(n.draw/f*100):0,w=f>0?Math.round(n.away/f*100):0;return s.jsxs("div",{className:"goals-panel-compact",children:[s.jsxs("h3",{className:"panel-title-compact",children:[s.jsx("i",{className:"fas fa-users"}),"Community Predictions"]}),s.jsx("div",{className:"prediction-content",children:s.jsx("div",{className:"prediction-bars-compact",children:s.jsxs("div",{className:"prediction-bar-item",children:[s.jsxs("div",{className:"prediction-bar-directional",children:[s.jsx("div",{className:"pred-bar-home",style:{width:`${j}%`},title:`${(null==(c=e.home_team)?void 0:c.name)||"Home"} ${j}%${f>0?` (${n.home} votes)`:""}`,children:j>15&&s.jsxs("span",{className:"pred-bar-label",children:[j,"%"]})}),v>0&&s.jsx("div",{className:"pred-bar-draw",style:{width:`${v}%`},title:`Draw ${v}%${f>0?` (${n.draw} votes)`:""}`,children:v>15&&s.jsxs("span",{className:"pred-bar-label",children:[v,"%"]})}),s.jsx("div",{className:"pred-bar-away",style:{width:`${w}%`},title:`${(null==(d=e.away_team)?void 0:d.name)||"Away"} ${w}%${f>0?` (${n.away} votes)`:""}`,children:w>15&&s.jsxs("span",{className:"pred-bar-label",children:[w,"%"]})})]}),f>0&&s.jsxs("div",{className:"pred-bar-teams",children:[s.jsx("span",{className:"pred-team-label home",children:(null==(m=e.home_team)?void 0:m.name)||"Home"}),s.jsx("span",{className:"pred-team-label away",children:(null==(h=e.away_team)?void 0:h.name)||"Away"})]}),!i&&!_&&s.jsxs("div",{className:"user-prediction-buttons-compact",children:[s.jsxs("button",{className:"user-pred-btn-compact home "+("home"===i?"active":""),onClick:()=>g("home"),title:`${(null==(p=e.home_team)?void 0:p.name)||"Home"} to win`,children:[s.jsx("span",{children:(null==(u=e.home_team)?void 0:u.name)||"Home"}),s.jsx("i",{className:"fas fa-chevron-right"})]}),s.jsxs("button",{className:"user-pred-btn-compact draw "+("draw"===i?"active":""),onClick:()=>g("draw"),title:"Draw",children:[s.jsx("i",{className:"fas fa-equals"}),s.jsx("span",{children:"Draw"})]}),s.jsxs("button",{className:"user-pred-btn-compact away "+("away"===i?"active":""),onClick:()=>g("away"),title:`${(null==(x=e.away_team)?void 0:x.name)||"Away"} to win`,children:[s.jsx("i",{className:"fas fa-chevron-left"}),s.jsx("span",{children:(null==(y=e.away_team)?void 0:y.name)||"Away"})]})]})]})})}),s.jsx("style",{children:"\n        .prediction-bar-directional {\n          display: flex;\n          width: 100%;\n          height: 28px;\n          border-radius: 14px;\n          overflow: hidden;\n          background: rgba(255, 255, 255, 0.05);\n          border: 1px solid rgba(255, 255, 255, 0.1);\n          position: relative;\n        }\n\n        .pred-bar-home {\n          background: linear-gradient(90deg, #4a90e2 0%, #357abd 100%);\n          height: 100%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          transition: width 0.4s ease;\n          border-radius: 14px 0 0 14px;\n        }\n\n        .pred-bar-draw {\n          background: rgba(128, 128, 128, 0.6);\n          height: 100%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          transition: width 0.4s ease;\n        }\n\n        .pred-bar-away {\n          background: linear-gradient(90deg, #c1121f 0%, #e63946 100%);\n          height: 100%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          transition: width 0.4s ease;\n          margin-left: auto;\n          border-radius: 0 14px 14px 0;\n        }\n\n        .pred-bar-label {\n          font-size: 0.7rem;\n          font-weight: 700;\n          color: #fff;\n          text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);\n        }\n\n        .pred-bar-teams {\n          display: flex;\n          justify-content: space-between;\n          margin-top: 6px;\n          padding: 0 4px;\n        }\n\n        .pred-team-label {\n          font-size: 0.65rem;\n          font-weight: 600;\n          text-transform: uppercase;\n          letter-spacing: 0.5px;\n        }\n\n        .pred-team-label.home {\n          color: #4a90e2;\n        }\n\n        .pred-team-label.away {\n          color: #e63946;\n        }\n\n        .user-pred-btn-compact.active {\n          transform: scale(1.02);\n        }\n\n        .user-pred-btn-compact.home.active {\n          background: linear-gradient(135deg, rgba(74, 144, 226, 0.3) 0%, rgba(53, 122, 189, 0.2) 100%);\n          border-color: #4a90e2;\n          color: #4a90e2;\n        }\n\n        .user-pred-btn-compact.draw.active {\n          background: rgba(128, 128, 128, 0.3);\n          border-color: rgba(128, 128, 128, 0.8);\n          color: rgba(255, 255, 255, 0.9);\n        }\n\n        .user-pred-btn-compact.away.active {\n          background: linear-gradient(135deg, rgba(230, 57, 70, 0.3) 0%, rgba(193, 18, 31, 0.2) 100%);\n          border-color: #e63946;\n          color: #e63946;\n        }\n      "})]})}function g({goals:e,cards:a,match:t,isFinished:r}){const i=[...e.map(e=>({...e,type:"goal"})),...a.map(e=>({...e,type:"card"}))].sort((e,a)=>(e.minute||0)-(a.minute||0));return s.jsxs("div",{className:"goals-panel-compact",children:[s.jsxs("h3",{className:"panel-title-compact",children:[s.jsx("i",{className:"fas fa-futbol"}),"Goals & Highlights"]}),i.length>0?s.jsx("div",{className:"goals-list-compact",children:i.map((e,a)=>{var r,i,n,l,o,c,d;if("goal"===e.type){const o=e.team_id===t.home_team_id;return s.jsxs("div",{className:"goal-row-compact "+(o?"home":"away"),children:[s.jsxs("span",{className:"goal-minute-compact",children:[e.minute,"'"]}),s.jsx("span",{className:"goal-icon-compact",children:s.jsx("i",{className:"fas fa-futbol"})}),s.jsx("span",{className:"goal-scorer-compact",children:(null==(r=e.scorer)?void 0:r.player_name)||"Unknown"}),(null==(i=e.assister)?void 0:i.player_name)&&s.jsxs("span",{className:"goal-assist-compact",children:["(",e.assister.player_name,")"]}),s.jsx("span",{className:"goal-team-compact",children:o?null==(n=t.home_team)?void 0:n.name:null==(l=t.away_team)?void 0:l.name})]},`goal-${e.id||a}`)}{const r=e.team_id===t.home_team_id;return s.jsxs("div",{className:"card-row-compact "+(r?"home":"away"),children:[s.jsxs("span",{className:"goal-minute-compact",children:[e.minute,"'"]}),s.jsx("span",{className:`card-icon-compact ${e.card_type}`,children:"yellow"===e.card_type?s.jsx("i",{className:"fas fa-square",style:{color:"#ffd700"}}):s.jsx("i",{className:"fas fa-square",style:{color:"#ff0000"}})}),s.jsx("span",{className:"goal-scorer-compact",children:(null==(o=e.player)?void 0:o.player_name)||"Unknown"}),s.jsx("span",{className:"goal-team-compact",children:r?null==(c=t.home_team)?void 0:c.name:null==(d=t.away_team)?void 0:d.name})]},`card-${e.id||a}`)}})}):s.jsx("p",{className:"no-goals-compact",children:r?"No events":"Events will appear here"})]})}function _({homeTeamPlayers:e,awayTeamPlayers:a,match:t,goals:r,cards:i}){const n=e=>{const a=["GK","CB","LB","RB","CDM","CM","CAM","LM","RM","CF","ST","SUB"];return[...e].sort((e,s)=>{const t=a.indexOf(e.position),r=a.indexOf(s.position);return(-1===t?99:t)-(-1===r?99:r)})},l=(e,a,t)=>s.jsxs("div",{className:"squad-column "+(t?"home":"away"),children:[s.jsx("div",{className:"squad-header "+(t?"":"away"),children:t?s.jsxs(s.Fragment,{children:[(null==a?void 0:a.crest_url)&&s.jsx(o,{src:a.crest_url,preset:"crestSm",alt:"",className:"squad-team-logo",loading:"lazy",decoding:"async"}),s.jsx("span",{children:null==a?void 0:a.name})]}):s.jsxs(s.Fragment,{children:[s.jsx("span",{children:null==a?void 0:a.name}),(null==a?void 0:a.crest_url)&&s.jsx(o,{src:a.crest_url,preset:"crestSm",alt:"",className:"squad-team-logo",loading:"lazy",decoding:"async"})]})}),s.jsxs("div",{className:"squad-list",children:[n(e).map(e=>{const a=(e=>{if(!e)return{goalsScored:0,assists:0,yellowCards:0,redCards:0};let a=0,s=0,t=0,n=0;const l=e.name||e.player_name||"",o=e.registration_player_id;return r.forEach(t=>{var r,i;let n=!1,c=!1;if(o&&(t.scorer_id===o&&(n=!0),t.assister_id===o&&(c=!0)),!n&&!c){const a=(null==(r=t.scorer)?void 0:r.player_name)||"",s=(null==(i=t.assister)?void 0:i.player_name)||"",o=e.team_id;a&&l&&a.toLowerCase().trim()===l.toLowerCase().trim()&&t.team_id===o&&(n=!0),s&&l&&s.toLowerCase().trim()===l.toLowerCase().trim()&&t.team_id===o&&(c=!0)}n&&a++,c&&s++}),i&&i.length>0&&i.forEach(a=>{var s;let r=!1;if(o&&a.player_id===o&&(r=!0),!r){const t=(null==(s=a.player)?void 0:s.player_name)||"",i=e.team_id;t&&l&&t.toLowerCase().trim()===l.toLowerCase().trim()&&a.team_id===i&&(r=!0)}r&&("yellow"===a.card_type&&t++,"red"===a.card_type&&n++)}),{goalsScored:a,assists:s,yellowCards:t,redCards:n}})(e);return s.jsxs("div",{className:"squad-player-row "+("SUB"===e.position||e.is_substitute?"substitute":""),children:[s.jsx("span",{className:"player-name",children:e.name||e.player_name||"Unknown"}),s.jsxs("div",{className:"player-stats-icons",children:[a.goalsScored>0&&s.jsxs("span",{className:"stat-icon goal-icon",title:`${a.goalsScored} goal${a.goalsScored>1?"s":""}`,children:[s.jsx("span",{className:"ball-icon-wrapper",children:s.jsx("img",{src:"/assets/img/Muqawama/ball.svg",alt:"Goal",style:{width:"16px",height:"16px"}})}),a.goalsScored>1&&s.jsx("span",{className:"stat-count-badge",children:a.goalsScored})]}),a.yellowCards>0&&s.jsxs("span",{className:"stat-icon yellow-card-icon",title:`${a.yellowCards} yellow card${a.yellowCards>1?"s":""}`,children:[s.jsx("img",{src:"/assets/img/Muqawama/Yellow_card.svg",alt:"Yellow Card",style:{width:"14px",height:"14px"}}),a.yellowCards>1&&s.jsx("span",{className:"stat-count-badge",children:a.yellowCards})]}),a.redCards>0&&s.jsxs("span",{className:"stat-icon red-card-icon",title:`${a.redCards} red card${a.redCards>1?"s":""}`,children:[s.jsx("img",{src:"/assets/img/Muqawama/Red_card.svg",alt:"Red Card",style:{width:"14px",height:"14px"}}),a.redCards>1&&s.jsx("span",{className:"stat-count-badge",children:a.redCards})]})]})]},e.id)}),0===e.length&&s.jsx("p",{className:"no-squad",children:"Squad not available"})]})]});return s.jsxs("div",{className:"squads-section",children:[s.jsx("h3",{className:"panel-title",children:"SQUADS"}),s.jsxs("div",{className:"squads-grid",children:[l(e,t.home_team,!0),l(a,t.away_team,!1)]})]})}function f({matchId:t,onBack:r}){const[o,h]=e.useState(null),[f,j]=e.useState([]),[v,w]=e.useState([]),[b,N]=e.useState([]),[C,S]=e.useState([]),[M,k]=e.useState(!0),[q,$]=e.useState(0),[L,A]=e.useState(null),[E,P]=e.useState(!1),[T,F]=e.useState(null),[D,B]=e.useState(!1),[I,U]=e.useState(null),[z,R]=e.useState({home:0,draw:0,away:0});e.useEffect(()=>{(()=>{let e=localStorage.getItem("user_identifier");if(!e){const a=document.createElement("canvas"),s=a.getContext("2d");s.textBaseline="top",s.font="14px Arial",s.fillText("Fingerprint",2,2);const t=a.toDataURL();e=btoa(navigator.userAgent+navigator.language+screen.width+screen.height+(new Date).getTimezoneOffset()+t).substring(0,32),localStorage.setItem("user_identifier",e)}A(e)})()},[]),e.useEffect(()=>{t&&G()},[t]);const Y=e.useCallback(()=>{G()},[t]),W=e.useCallback(()=>{t&&L&&o&&H()},[t,L,null==o?void 0:o.id]);i({enabled:Boolean(t),channelKey:`match-detail:${t}`,tables:["matches","goals","cards","match_likes","match_predictions","players","teams"],debounceMs:700,pollIntervalMs:1e4,onUpdate:()=>{Y(),W()}}),e.useEffect(()=>{t&&L&&o&&H()},[t,L,o]),e.useEffect(()=>{o&&"completed"!==o.status&&"live"!==o.status&&o.home_team_id&&o.away_team_id&&O()},[o]);const G=async()=>{var e,s;try{k(!0);const{data:r,error:i}=await a.from("matches").select("\n          id,\n          match_number,\n          match_date,\n          scheduled_time,\n          home_team_id,\n          away_team_id,\n          home_score,\n          away_score,\n          status,\n          category,\n          match_type,\n          venue,\n          home_team:teams!matches_home_team_id_fkey(id, name, crest_url, category),\n          away_team:teams!matches_away_team_id_fkey(id, name, crest_url, category)\n        ").eq("id",t).single();if(i)throw i;h(r);const[n,l]=await Promise.all([a.from("goals").select("\n            id,\n            match_id,\n            team_id,\n            scorer_id,\n            assister_id,\n            minute,\n            goal_type,\n            scorer:team_players!goals_scorer_id_fkey(id, player_name, player_image),\n            assister:team_players!goals_assister_id_fkey(id, player_name, player_image)\n          ").eq("match_id",t).order("minute",{ascending:!0}),a.from("cards").select("\n            id,\n            match_id,\n            team_id,\n            player_id,\n            card_type,\n            minute,\n            player:team_players!cards_player_id_fkey(id, player_name, player_image)\n          ").eq("match_id",t).order("minute",{ascending:!0})]),o=n.data,c=l.data;if(o){const e=new Set;o.forEach(a=>{var s,t;a.scorer_id&&!(null==(s=a.scorer)?void 0:s.player_name)&&e.add(a.scorer_id),a.assister_id&&!(null==(t=a.assister)?void 0:t.player_name)&&e.add(a.assister_id)});let s={};if(e.size>0){const{data:t}=await a.from("players").select("name, player_image, registration_player_id").in("registration_player_id",Array.from(e));t&&t.forEach(e=>{e.registration_player_id&&(s[e.registration_player_id]=e)})}const t=o.map(e=>{var a,t,r,i;let n=(null==(a=e.scorer)?void 0:a.player_name)||null,l=(null==(t=e.assister)?void 0:t.player_name)||null,o=(null==(r=e.scorer)?void 0:r.player_image)||null,c=(null==(i=e.assister)?void 0:i.player_image)||null;return e.scorer_id&&!n&&s[e.scorer_id]&&(n=s[e.scorer_id].name,o=s[e.scorer_id].player_image||o),e.assister_id&&!l&&s[e.assister_id]&&(l=s[e.assister_id].name,c=s[e.assister_id].player_image||c),{...e,scorer:n?{player_name:n,player_image:o}:null,assister:l?{player_name:l,player_image:c}:null}});N(t)}if(c){const e=new Set;c.forEach(a=>{var s;a.player_id&&!(null==(s=a.player)?void 0:s.player_name)&&e.add(a.player_id)});let s={};if(e.size>0){const{data:t}=await a.from("players").select("name, player_image, registration_player_id").in("registration_player_id",Array.from(e));t&&t.forEach(e=>{e.registration_player_id&&(s[e.registration_player_id]=e)})}const t=c.map(e=>{var a;let t=(null==(a=e.player)?void 0:a.player_name)||null;return e.player_id&&!t&&s[e.player_id]&&(t=s[e.player_id].name),{...e,player:t?{player_name:t}:null}});S(t)}if((null==(e=r.home_team)?void 0:e.id)&&(null==(s=r.away_team)?void 0:s.id)){const[e,s]=await Promise.all([a.from("players").select("id, name, player_image, position, position_x, position_y, is_substitute, team_id, registration_player_id").eq("team_id",r.home_team.id).order("position"),a.from("players").select("id, name, player_image, position, position_x, position_y, is_substitute, team_id, registration_player_id").eq("team_id",r.away_team.id).order("position")]);e.data&&j(e.data),s.data&&w(s.data)}}catch(r){}finally{k(!1)}},H=async()=>{if(t&&L&&o)try{const{data:e}=await a.from("match_likes").select("id").eq("match_id",t);$(e?e.length:0);const{data:s}=await a.from("match_predictions").select("prediction").eq("match_id",t);if(s){const e={home:s.filter(e=>"home"===e.prediction).length,draw:s.filter(e=>"draw"===e.prediction).length,away:s.filter(e=>"away"===e.prediction).length};R(e);const{data:r}=await a.from("match_predictions").select("prediction").eq("match_id",t).eq("user_identifier",L).maybeSingle();r&&U(r.prediction)}}catch(e){}},O=async()=>{if(o&&o.home_team_id&&o.away_team_id){B(!0);try{const{data:e}=await a.from("teams").select("*").eq("id",o.home_team_id).single(),{data:s}=await a.from("teams").select("*").eq("id",o.away_team_id).single();if(!e||!s)return void B(!1);const{data:t}=await a.from("matches").select("home_score, away_score, home_team_id, away_team_id").or(`home_team_id.eq.${o.home_team_id},away_team_id.eq.${o.home_team_id}`).eq("status","completed").order("match_date",{ascending:!1}).limit(2),{data:r}=await a.from("matches").select("home_score, away_score, home_team_id, away_team_id").or(`home_team_id.eq.${o.away_team_id},away_team_id.eq.${o.away_team_id}`).eq("status","completed").order("match_date",{ascending:!1}).limit(2);let i=0,n=0,l=0;t&&t.length>0&&t.forEach(e=>{e.home_team_id===o.home_team_id?(i+=e.home_score||0,n+=e.away_score||0,l++):(i+=e.away_score||0,n+=e.home_score||0,l++)});let c=0,d=0,m=0;r&&r.length>0&&r.forEach(e=>{e.home_team_id===o.away_team_id?(c+=e.home_score||0,d+=e.away_score||0,m++):(c+=e.away_score||0,d+=e.home_score||0,m++)});const{data:h}=await a.from("teams").select("goals_for, goals_against, played").eq("category",o.category||"open-age").gt("played",0);let p=1.5,u=1.5;if(h&&h.length>0){const e=h.reduce((e,a)=>e+(a.goals_for||0),0),a=h.reduce((e,a)=>e+(a.goals_against||0),0),s=h.reduce((e,a)=>e+(a.played||0),0);s>0&&(p=e/s,u=a/s)}const x=l>0?i/l:e.played>0?(e.goals_for||0)/e.played:p,y=l>0?n/l:e.played>0?(e.goals_against||0)/e.played:u,g=m>0?c/m:s.played>0?(s.goals_for||0)/s.played:p,_=m>0?d/m:s.played>0?(s.goals_against||0)/s.played:u,f=0===l&&0===e.played?1:p>0?x/p:1,j=0===l&&0===e.played?1:u>0?y/u:1,v=0===m&&0===s.played?1:p>0?g/p:1,w=0===m&&0===s.played?1:u>0?_/u:1,b=f*(1/w)*p*1.12,N=v*(1/j)*p,C=Math.round(b),S=Math.round(N),M=(e,a)=>{if(e<=0)return 0===a?1:0;let s=-e+a*Math.log(e);for(let t=2;t<=a;t++)s-=Math.log(t);return Math.exp(s)};let k=0,q=0,$=0;for(let a=0;a<=5;a++)for(let e=0;e<=5;e++){const s=M(b,a)*M(N,e);a>e?k+=s:a===e?q+=s:$+=s}const L=k+q+$;L>0?(k=k/L*100,q=q/L*100,$=$/L*100):(k=33.33,q=33.33,$=33.34),F({homeScore:Math.max(0,C),awayScore:Math.max(0,S),homeWinProb:Math.round(k),drawProb:Math.round(q),awayWinProb:Math.round($),homeTeam:e.name,awayTeam:s.name})}catch(e){}finally{B(!1)}}};if(M)return s.jsxs(s.Fragment,{children:[s.jsx(n,{}),s.jsx("div",{className:"match-detail-loading",children:s.jsxs("div",{className:"fixtures-loading-content",children:[s.jsxs("div",{className:"logo-loader",children:[s.jsx("div",{className:"logo-ring"}),s.jsx("img",{src:"/assets/img/muq_invert.png",alt:"Muqawama",className:"logo-pulse"})]}),s.jsx("p",{children:"Loading match details..."})]})}),s.jsx(l,{edition:"2026"})]});if(!o)return s.jsxs(s.Fragment,{children:[s.jsx(n,{}),s.jsxs("div",{className:"match-detail-error",children:[s.jsx("i",{className:"fas fa-exclamation-triangle"}),s.jsx("p",{children:"Match not found"})]}),s.jsx(l,{edition:"2026"})]});const K="completed"===o.status;return s.jsxs(s.Fragment,{children:[s.jsx(n,{}),s.jsxs("div",{className:"match-detail-page",children:[s.jsxs("div",{className:"match-action-buttons",children:[s.jsx(u,{matchId:t,userIdentifier:L,initialLikeCount:q}),s.jsx(c,{onClick:()=>P(!0)})]}),s.jsx(x,{match:o}),s.jsx("section",{className:"match-detail-content",children:s.jsxs("div",{className:"match-detail-single-column",children:[s.jsx(y,{match:o,matchId:t,userIdentifier:L,userPrediction:I,userPredictionStats:z,onPredictionUpdate:e=>{U(e)},onStatsUpdate:e=>{R(e)}}),s.jsx(g,{goals:b,cards:C,match:o,isFinished:K}),s.jsxs("div",{className:"formation-section",children:[s.jsx("h3",{className:"panel-title",children:"FORMATIONS"}),s.jsx(p,{homePlayers:f,awayPlayers:v,homeTeam:o.home_team,awayTeam:o.away_team,goals:b,cards:C})]}),s.jsx(_,{homeTeamPlayers:f,awayTeamPlayers:v,match:o,goals:b,cards:C})]})}),s.jsx("div",{className:"match-detail-footer"})]}),s.jsx(l,{edition:"2026"}),o&&s.jsx(d,{match:o}),E&&s.jsx(m,{match:o,onClose:()=>P(!1)})]})}function j(){const[a,t]=e.useState("list"),[r,i]=e.useState(null);e.useEffect(()=>{const e=new URLSearchParams(window.location.search).get("match");return e&&(i(e),t("detail")),window.addEventListener("popstate",n),()=>window.removeEventListener("popstate",n)},[]);const n=()=>{const e=new URLSearchParams(window.location.search).get("match");e?(i(e),t("detail")):(t("list"),i(null))},l=()=>{const e=window.location.pathname;window.history.pushState({},"",e),t("list"),i(null)};return"detail"===a&&r?s.jsx(f,{matchId:r,onBack:l}):s.jsx(h,{onMatchClick:e=>{const a=`${window.location.pathname}?match=${e}`;window.history.pushState({matchId:e},"",a),i(e),t("detail"),window.scrollTo(0,0)}})}t.createRoot(document.getElementById("fixtures-root")).render(s.jsx(r.StrictMode,{children:s.jsx(j,{})}));
