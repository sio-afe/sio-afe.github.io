import{r as e,s as a,j as s,c as l,R as t}from"./supabaseClient-Bdusv2SU.js";import{F as r}from"./Footer-YZurjJeH.js";import{T as i}from"./TournamentNavbar-D2cgzQdF.js";const n={GK:"Goalkeeper",CB:"Defender",LB:"Defender",RB:"Defender",CDM:"Midfielder",CM:"Midfielder",CAM:"Midfielder",LM:"Midfielder",RM:"Midfielder",CF:"Forward",ST:"Forward",SUB:"Substitute"},c={Goalkeeper:"Goalkeepers",Defender:"Defenders",Midfielder:"Midfielders",Forward:"Forwards",Substitute:"Substitutes"};function d({playerId:l,onBack:t,onNavigateToPlayer:d,onNavigateToMatch:o}){var m;const[h,p]=e.useState(null),[u,x]=e.useState([]),[j,g]=e.useState([]),[y,_]=e.useState([]),[f,N]=e.useState(null),[v,b]=e.useState(!0),[w,S]=e.useState(1),[k,M]=e.useState("completed");e.useEffect(()=>{l&&C()},[l]);const C=async()=>{try{const{data:e,error:s}=await a.from("team_players").select("id, player_name, player_image, position, player_age, is_substitute, team_id, team_registrations(id, team_name, team_logo)").eq("id",l).single();if(s)throw s;if(p(e),null==e?void 0:e.team_id){const{data:s}=await a.from("team_players").select("id, player_name, player_image, position").eq("team_id",e.team_id).order("player_name",{ascending:!0});if(s){const e=s.findIndex(e=>e.id===l);S(e>=0?e+1:1),x(s.filter(e=>e.id!==l))}const{data:t}=await a.from("teams").select("id, name").eq("registration_id",e.team_id).single();if(t){N(t.id);const{data:s,error:l}=await a.from("matches").select("\n              id, \n              match_number,\n              match_date, \n              scheduled_time,\n              home_team_id, \n              away_team_id, \n              home_score, \n              away_score,\n              status,\n              home_team:teams!matches_home_team_id_fkey(id, name),\n              away_team:teams!matches_away_team_id_fkey(id, name)\n            ").or(`home_team_id.eq.${t.id},away_team_id.eq.${t.id}`).order("match_date",{ascending:!1});l||s&&g(s);const{data:r}=await a.from("match_goals").select("*").or(`scorer_name.eq.${e.player_name},assist_name.eq.${e.player_name}`).order("minute",{ascending:!0});r&&_(r)}}}catch(e){}finally{b(!1)}},L=e=>n[e]||e||"Unknown";if(v)return s.jsx("div",{className:"player-detail-loading",children:s.jsxs("div",{className:"players-loading-content",children:[s.jsxs("div",{className:"logo-loader",children:[s.jsx("div",{className:"logo-ring"}),s.jsx("img",{src:"/assets/img/MuqawamaLogo.png",alt:"Muqawama",className:"logo-pulse"})]}),s.jsx("p",{children:"Loading player..."})]})});if(!h)return s.jsxs("div",{className:"player-detail-error",children:[s.jsx("i",{className:"fas fa-exclamation-triangle"}),s.jsx("p",{children:"Player not found"}),s.jsxs("button",{onClick:t,className:"back-btn",children:[s.jsx("i",{className:"fas fa-arrow-left"})," Back to Players"]})]});const D=h.team_registrations,q=L(h.position),B=(()=>{const e={};return u.forEach(a=>{const s=L(a.position),l=c[s]||"Others";e[l]||(e[l]=[]),e[l].push(a)}),e})(),F={apps:j.filter(e=>"completed"===e.status).length,goals:y.filter(e=>e.scorer_name===h.player_name).length,assists:y.filter(e=>e.assist_name===h.player_name).length},T=j.map(e=>{var a,s;const l=e.home_team_id===f,t=l?null==(a=e.away_team)?void 0:a.name:null==(s=e.home_team)?void 0:s.name,r=l?e.home_score:e.away_score,i=l?e.away_score:e.home_score;let n="-";"completed"===e.status&&(n=r>i?"W":r<i?"L":"D");const c=y.filter(a=>a.match_id===e.id&&a.scorer_name===h.player_name).length;return{matchId:e.id,matchweek:e.match_number||"-",date:e.match_date?new Date(e.match_date).toLocaleDateString("en-GB",{day:"2-digit",month:"short"}):"-",opponent:t||"TBD",result:n,score:"completed"===e.status?`${r}-${i}`:"vs",minutes:"completed"===e.status?"90":"-",goals:c,status:e.status}}),$=T.filter(e=>"completed"===e.status),G=T.filter(e=>"completed"!==e.status);return s.jsxs(s.Fragment,{children:[s.jsx(i,{}),s.jsxs("div",{className:"bls-player-page",children:[s.jsxs("div",{className:"bls-hero-section",children:[s.jsxs("div",{className:"bls-hero-content",children:[s.jsx("div",{className:"bls-team-logo",children:(null==D?void 0:D.team_logo)?s.jsx("img",{src:D.team_logo,alt:null==D?void 0:D.team_name}):s.jsx("span",{children:(null==(m=null==D?void 0:D.team_name)?void 0:m.charAt(0))||"?"})}),s.jsx("div",{className:"bls-player-photo",children:h.player_image?s.jsx("img",{src:h.player_image,alt:h.player_name}):s.jsx("div",{className:"bls-photo-placeholder",children:s.jsx("i",{className:"fas fa-user"})})}),s.jsxs("div",{className:"bls-player-info",children:[s.jsx("h1",{children:h.player_name}),s.jsxs("p",{children:[s.jsx("b",{children:"Position:"})," ",q,"  ",s.jsx("b",{children:"Age:"})," ",h.player_age||"-"]})]}),s.jsxs("span",{className:"bls-player-number",children:["#",w]})]}),s.jsx("hr",{})]}),s.jsxs("div",{className:"bls-content-wrapper",children:[s.jsxs("div",{className:"bls-stats-grid",children:[s.jsxs("div",{className:"bls-main-stats",children:[s.jsxs("div",{className:"bls-quick-stats",children:[s.jsxs("div",{className:"bls-stat-box",children:[s.jsx("div",{className:"bls-stat-value",children:F.goals}),s.jsx("span",{children:"Goals"})]}),s.jsxs("div",{className:"bls-stat-box",children:[s.jsx("div",{className:"bls-stat-value",children:F.assists}),s.jsx("span",{children:"Assists"})]})]}),s.jsxs("div",{className:"bls-match-log",children:[s.jsx("h4",{children:"Match Log"}),s.jsx("div",{className:"match-log-toggle-container",children:s.jsxs("button",{className:"match-log-toggle-btn",onClick:()=>M("completed"===k?"scheduled":"completed"),children:[s.jsxs("span",{className:"toggle-option "+("completed"===k?"active":""),children:["Completed (",$.length,")"]}),s.jsxs("span",{className:"toggle-option "+("scheduled"===k?"active":""),children:["Scheduled (",G.length,")"]}),s.jsx("span",{className:"toggle-slider",style:{transform:"scheduled"===k?"translateX(100%)":"translateX(0)"}})]})}),"completed"===k&&s.jsx(s.Fragment,{children:$.length>0?s.jsx("div",{className:"match-log-table-wrapper",children:s.jsxs("table",{className:"bls-match-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Match"}),s.jsx("th",{children:"Score"}),s.jsx("th",{children:"G"})]})}),s.jsx("tbody",{children:$.map((e,a)=>s.jsxs("tr",{onClick:()=>o&&o(e.matchId),className:"match-row-clickable",children:[s.jsx("td",{children:e.opponent}),s.jsxs("td",{children:[s.jsx("span",{className:`bls-result bls-result-${e.result}`,children:e.result}),s.jsx("span",{children:e.score})]}),s.jsx("td",{children:e.goals})]},a))})]})}):s.jsx("p",{className:"bls-no-data",children:"No completed matches yet"})}),"scheduled"===k&&s.jsx(s.Fragment,{children:G.length>0?s.jsx("div",{className:"match-log-table-wrapper",children:s.jsxs("table",{className:"bls-match-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Match"}),s.jsx("th",{children:"Status"})]})}),s.jsx("tbody",{children:G.map((e,a)=>s.jsxs("tr",{onClick:()=>o&&o(e.matchId),className:"match-row-clickable",children:[s.jsx("td",{children:e.opponent}),s.jsx("td",{children:s.jsx("span",{className:"match-scheduled-badge",children:"VS"})})]},a))})]})}):s.jsx("p",{className:"bls-no-data",children:"No scheduled matches"})})]})]}),s.jsxs("div",{className:"bls-teammates",children:[s.jsx("h4",{children:"Teammates"}),Object.entries(B).map(([e,a])=>s.jsxs("div",{className:"bls-teammate-group",children:[s.jsx("h6",{children:e}),a.map((e,a)=>s.jsxs("a",{className:"bls-teammate-row",onClick:()=>d&&d(e.id,e.player_name),children:[s.jsx("div",{className:"bls-teammate-number",children:a+1}),s.jsx("div",{className:"bls-teammate-image",children:e.player_image?s.jsx("img",{src:e.player_image,alt:e.player_name}):s.jsx("i",{className:"fas fa-user"})}),s.jsx("div",{className:"bls-teammate-name",children:e.player_name})]},e.id))]},e))]})]}),s.jsx("div",{className:"bls-back-section",children:s.jsxs("button",{onClick:t,className:"bls-back-btn",children:[s.jsx("i",{className:"fas fa-arrow-left"})," Back to Players"]})})]}),s.jsx(r,{edition:"2026"})]})]})}const o={GK:"Goalkeeper",CB:"Defender",LB:"Defender",RB:"Defender",CDM:"Midfielder",CM:"Midfielder",CAM:"Midfielder",LM:"Midfielder",RM:"Midfielder",CF:"Striker",ST:"Striker",SUB:"Substitute"},m={Goalkeeper:"#4CAF50",Defender:"#2196F3",Midfielder:"#FF9800",Striker:"#f44336",Substitute:"#9e9e9e"};function h(){const[l,t]=e.useState([]),[n,c]=e.useState([]),[h,p]=e.useState(!0),[u,x]=e.useState(""),[j,g]=e.useState("all"),[y,_]=e.useState("all"),[f,N]=e.useState(null),[v,b]=e.useState("list"),[w]=e.useState(window.location.pathname.includes("/u17/")?"u17":"open-age");e.useEffect(()=>{const e=new URLSearchParams(window.location.search).get("player");return e?(N(e),b("detail"),p(!1)):k(),window.addEventListener("popstate",S),()=>window.removeEventListener("popstate",S)},[]);const S=()=>{const e=new URLSearchParams(window.location.search).get("player");e?(N(e),b("detail")):(b("list"),N(null))},k=async()=>{try{const{data:e,error:s}=await a.from("team_players").select("*, team_registrations(id, team_name, team_logo, category, status)").order("player_name",{ascending:!0});if(s)throw s;const l=(e||[]).filter(e=>{const a=e.team_registrations;return a&&"confirmed"===a.status&&a.category===w}),r=[],i=new Set;l.forEach(e=>{const a=e.team_registrations;a&&!i.has(a.id)&&(i.add(a.id),r.push({id:a.id,team_name:a.team_name,team_logo:a.team_logo,category:a.category}))}),c(r),t(l)}catch(e){}finally{p(!1)}},M=()=>{window.history.pushState({},"",`/muqawamah/2026/${w}/players/`),b("list"),N(null)},C=e=>o[e]||e,L=l.filter(e=>{var a;const s=null==(a=e.player_name)?void 0:a.toLowerCase().includes(u.toLowerCase()),l="all"===j||e.team_id===j,t=C(e.position);return s&&l&&("all"===y||t===y)});return h?s.jsx("div",{className:"players-loading",children:s.jsxs("div",{className:"players-loading-content",children:[s.jsxs("div",{className:"logo-loader",children:[s.jsx("div",{className:"logo-ring"}),s.jsx("img",{src:"/assets/img/MuqawamaLogo.png",alt:"Muqawama",className:"logo-pulse"})]}),s.jsx("p",{children:"Loading players..."})]})}):"detail"===v&&f?s.jsx(d,{playerId:f,onBack:M,onNavigateToPlayer:(e,a)=>{const s=`/muqawamah/2026/${w}/players/?player=${e}`;window.history.pushState({playerId:e},"",s),N(e),window.scrollTo(0,0)},onNavigateToMatch:e=>{window.location.href=`/muqawamah/2026/${w}/fixtures/?match=${e}`}}):s.jsxs(s.Fragment,{children:[s.jsx(i,{}),s.jsxs("div",{className:"player-database",children:[s.jsxs("div",{className:"player-database-header",children:[s.jsx("h1",{className:"player-database-title",children:"Player Database"}),s.jsxs("div",{className:"player-filters",children:[s.jsxs("div",{className:"search-box",children:[s.jsx("i",{className:"fas fa-search"}),s.jsx("input",{type:"text",placeholder:"Write a player name and hit enter...",value:u,onChange:e=>x(e.target.value)})]}),s.jsxs("div",{className:"filter-row",children:[s.jsxs("select",{value:j,onChange:e=>g(e.target.value),className:"filter-select",children:[s.jsx("option",{value:"all",children:"ALL TEAMS"}),n.map(e=>s.jsx("option",{value:e.id,children:e.team_name},e.id))]}),s.jsxs("select",{value:y,onChange:e=>_(e.target.value),className:"filter-select filter-select-wide",children:[s.jsx("option",{value:"all",children:"ALL POSITIONS"}),s.jsx("option",{value:"Goalkeeper",children:"Goalkeeper"}),s.jsx("option",{value:"Defender",children:"Defender"}),s.jsx("option",{value:"Midfielder",children:"Midfielder"}),s.jsx("option",{value:"Striker",children:"Striker"}),s.jsx("option",{value:"Substitute",children:"Substitute"})]}),s.jsx("button",{className:"reset-btn",onClick:()=>{x(""),g("all"),_("all")},children:"RESET"})]})]})]}),s.jsx("div",{className:"players-count",children:s.jsxs("span",{children:[L.length," players found"]})}),s.jsx("div",{className:"players-grid",children:L.map(e=>{var a;const l=C(e.position),t=m[l]||"#666",r=e.team_registrations;return s.jsxs("div",{className:"player-card-db",onClick:()=>(e=>{const a=`/muqawamah/2026/${w}/players/?player=${e.id}`;window.history.pushState({playerId:e.id},"",a),N(e.id),b("detail"),window.scrollTo(0,0)})(e),style:{cursor:"pointer"},children:[s.jsx("div",{className:"position-tag",style:{backgroundColor:t},children:l.toUpperCase()}),s.jsx("div",{className:"player-photo-container",children:e.player_image?s.jsx("img",{src:e.player_image,alt:e.player_name,className:"player-photo"}):s.jsx("div",{className:"player-photo-placeholder",children:s.jsx("i",{className:"fas fa-user"})})}),s.jsxs("div",{className:"player-info-bar",children:[s.jsx("div",{className:"team-logo-small",children:(null==r?void 0:r.team_logo)?s.jsx("img",{src:r.team_logo,alt:r.team_name}):s.jsx("span",{children:(null==(a=null==r?void 0:r.team_name)?void 0:a.charAt(0))||"?"})}),s.jsx("span",{className:"player-name-db",children:e.player_name})]})]},e.id)})}),0===L.length&&s.jsxs("div",{className:"no-players",children:[s.jsx("i",{className:"fas fa-users-slash"}),s.jsx("p",{children:"No players found matching your criteria"})]}),s.jsx("div",{className:"back-to-tournament",children:s.jsxs("a",{href:"/muqawamah/2026/",className:"back-link",children:[s.jsx("i",{className:"fas fa-arrow-left"})," Back to Tournament"]})}),s.jsx(r,{edition:"2026"})]})]})}l.createRoot(document.getElementById("players-root")).render(s.jsx(t.StrictMode,{children:s.jsx(h,{})}));
