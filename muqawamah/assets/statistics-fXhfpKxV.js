import{r as a,s,j as e,c as t,R as i}from"./supabaseClient-y7L7r4ir.js";import{u as l,T as r}from"./TournamentNavbar-DLqNlQUK.js";import{F as n}from"./Footer-Cjjkr2XU.js";import{S as c}from"./SmartImg-mv2gJrPZ.js";import{d as o,e as m}from"./ShareableCard-CBvPxSv-.js";import"./supabase-client-FID_-7ME.js";import"./index-3r6UxFjv.js";function d(){const[t,i]=a.useState("goals"),[d,g]=a.useState({goals:[],assists:[]}),[p,h]=a.useState([]),[_,v]=a.useState(!0),[j,x]=a.useState(!1),[u]=a.useState(window.location.pathname.includes("/u17/")?"u17":"open-age");a.useEffect(()=>{N()},[u]);const y=a.useCallback(()=>{N()},[u]);l({enabled:!0,channelKey:`statistics:${u}`,tables:["matches","goals","players","teams"],filtersByTable:{matches:`category=eq.${u}`,teams:`category=eq.${u}`},debounceMs:700,pollIntervalMs:1e4,onUpdate:y});const N=async()=>{try{v(!0);const{data:a}=await s.from("matches").select("id").eq("category",u),e=(a||[]).map(a=>a.id),{data:t}=await s.from("goals").select("\n          scorer_id,\n          assister_id,\n          team_id,\n          scorer:team_players!goals_scorer_id_fkey(id, player_name, player_image, team_id, team_registrations(team_name, team_logo)),\n          assister:team_players!goals_assister_id_fkey(id, player_name, player_image, team_id, team_registrations(team_name, team_logo))\n        ").in("match_id",e),{data:i}=await s.from("teams").select("id").eq("category",u),l=(null==i?void 0:i.map(a=>a.id))||[],{data:r}=await s.from("players").select("id, name, player_image, registration_player_id, team_id, team:teams(name, crest_url)").in("team_id",l),n={};(r||[]).forEach(a=>{a.registration_player_id&&(n[a.registration_player_id]=a)});const c={},o={};(t||[]).forEach(a=>{var s,e,t,i;if(a.scorer_id){const t=n[a.scorer_id],i=(null==t?void 0:t.id)||a.scorer_id;c[i]||(t?c[i]={id:t.id,player_name:t.name||t.player_name,player_image:t.player_image,team_registrations:{team_name:(null==(s=t.team)?void 0:s.name)||"Unknown",team_logo:(null==(e=t.team)?void 0:e.crest_url)||null},goals:0}:a.scorer&&(c[i]={id:a.scorer.id,player_name:a.scorer.player_name,player_image:a.scorer.player_image,team_registrations:a.scorer.team_registrations,goals:0})),c[i]&&(c[i].goals+=1)}if(a.assister_id){const s=n[a.assister_id],e=(null==s?void 0:s.id)||a.assister_id;o[e]||(s?o[e]={id:s.id,player_name:s.name||s.player_name,player_image:s.player_image,team_registrations:{team_name:(null==(t=s.team)?void 0:t.name)||"Unknown",team_logo:(null==(i=s.team)?void 0:i.crest_url)||null},assists:0}:a.assister&&(o[e]={id:a.assister.id,player_name:a.assister.player_name,player_image:a.assister.player_image,team_registrations:a.assister.team_registrations,assists:0})),o[e]&&(o[e].assists+=1)}});const m=Object.values(c).sort((a,s)=>s.goals-a.goals).slice(0,5),d=Object.values(o).sort((a,s)=>s.assists-a.assists).slice(0,5);g({goals:m,assists:d});const{data:p}=await s.from("teams").select("*").eq("category",u).order("goals_for",{ascending:!1});p&&h(p.slice(0,5))}catch(a){}finally{v(!1)}},f=()=>"goals"===t?d.goals.slice(0,3).map(a=>{var s;return{name:a.player_name,image:a.player_image,team_name:null==(s=a.team_registrations)?void 0:s.team_name,value:a.goals||0}}):"assists"===t?d.assists.slice(0,3).map(a=>{var s;return{name:a.player_name,image:a.player_image,team_name:null==(s=a.team_registrations)?void 0:s.team_name,value:a.assists||0}}):p.slice(0,3).map(a=>({name:a.name,crest_url:a.crest_url,value:a.goals_for||0}));if(_)return e.jsxs(e.Fragment,{children:[e.jsx(r,{}),e.jsx("div",{className:"stats-page-v2 stats-loading-v2",children:e.jsxs("div",{className:"stats-loading-content",children:[e.jsxs("div",{className:"logo-loader",children:[e.jsx("div",{className:"logo-ring"}),e.jsx("img",{src:"/assets/img/muq_invert.png",alt:"Muqawama",className:"logo-pulse"})]}),e.jsx("p",{children:"Loading statistics..."})]})}),e.jsx(n,{edition:"2026"})]});const b=[{id:"goals",label:"TOP SCORERS",icon:"fa-futbol"},{id:"assists",label:"TOP ASSISTS",icon:"fa-hands-helping"},{id:"teams",label:"TEAM STATS",icon:"fa-shield-alt"}],w=(a,t)=>e.jsx("div",{className:"leaderboard-v2",children:a.length>0?a.map((a,i)=>{var l,r;return e.jsxs("div",{className:"leaderboard-row-v2 "+(0===i?"top-player":""),onClick:()=>(async a=>{if(a)try{const{data:e,error:t}=await s.from("players").select("id").eq("id",a).single();if(!t&&e){const s="u17"===u?"/muqawamah/2026/u17":"/muqawamah/2026/open-age";return void(window.location.href=`${s}/players/?player=${a}`)}const{data:i,error:l}=await s.from("players").select("id").eq("registration_player_id",a).single();if(l||!i)return void alert("Player details not available");const r="u17"===u?"/muqawamah/2026/u17":"/muqawamah/2026/open-age";window.location.href=`${r}/players/?player=${i.id}`}catch(e){}})(a.id),children:[e.jsx("div",{className:"rank-cell-v2",children:e.jsx("span",{className:"rank-number "+(i<3?"rank-top":""),children:i+1})}),e.jsx("div",{className:"player-photo-v2",children:a.player_image?e.jsx(c,{src:a.player_image,preset:"playerAvatar",alt:a.player_name,loading:"lazy",decoding:"async"}):e.jsx("div",{className:"photo-placeholder",children:e.jsx("i",{className:"fas fa-user"})})}),e.jsxs("div",{className:"player-info-v2",children:[e.jsx("span",{className:"player-name-v2",children:a.player_name}),e.jsxs("div",{className:"team-info-v2",children:[(null==(l=a.team_registrations)?void 0:l.team_logo)&&e.jsx(c,{src:a.team_registrations.team_logo,preset:"crestSm",alt:"",className:"mini-team-logo",loading:"lazy",decoding:"async"}),e.jsx("span",{className:"team-name-mini",children:(null==(r=a.team_registrations)?void 0:r.team_name)||"N/A"})]})]}),e.jsx("div",{className:"stat-value-v2",children:e.jsx("span",{className:"stat-number",children:"goals"===t?a.goals||0:a.assists||0})})]},a.id)}):e.jsxs("div",{className:"no-data-v2",children:[e.jsx("i",{className:"fas fa-chart-bar"}),e.jsx("p",{children:"No statistics available yet"})]})});return e.jsxs(e.Fragment,{children:[e.jsx(r,{}),e.jsxs("div",{className:"stats-page-v2",children:[e.jsxs("div",{className:"stats-container-v2",children:[e.jsxs("div",{className:"stats-header-v2",children:[e.jsx("h1",{children:"Statistics"}),e.jsx("hr",{className:"stats-divider"})]}),e.jsx("div",{className:"stats-tabs-container",children:e.jsxs("div",{className:"stats-tabs-v2",children:[b.map((a,s)=>e.jsxs("button",{className:"stats-tab-v2 "+(t===a.id?"active":""),onClick:()=>i(a.id),children:[e.jsx("i",{className:`fas ${a.icon}`}),e.jsx("span",{children:a.label})]},a.id)),e.jsx("span",{className:"stats-tab-slider",style:{transform:`translateX(${100*b.findIndex(a=>a.id===t)}%)`}})]})}),e.jsxs("div",{className:"stats-content-v2",children:["goals"===t&&e.jsxs("div",{className:"stats-section-v2",children:[e.jsxs("div",{className:"section-header-v2",children:[e.jsx("h2",{children:"Top Scorers"}),e.jsx("span",{className:"section-subtitle",children:"Players with most goals"})]}),w(d.goals,"goals")]}),"assists"===t&&e.jsxs("div",{className:"stats-section-v2",children:[e.jsxs("div",{className:"section-header-v2",children:[e.jsx("h2",{children:"Top Assists"}),e.jsx("span",{className:"section-subtitle",children:"Players with most assists"})]}),w(d.assists,"assists")]}),"teams"===t&&e.jsxs("div",{className:"stats-section-v2",children:[e.jsxs("div",{className:"section-header-v2",children:[e.jsx("h2",{children:"Team Statistics"}),e.jsx("span",{className:"section-subtitle",children:"Goals scored and conceded"})]}),e.jsx("div",{className:"leaderboard-v2 team-leaderboard",children:p.length>0?p.map((a,s)=>{var t;return e.jsxs("div",{className:"leaderboard-row-v2 team-row "+(0===s?"top-team":""),onClick:()=>(a=>{const s="u17"===u?"/muqawamah/2026/u17":"/muqawamah/2026/open-age";window.location.href=`${s}/teams/?team=${a}`})(a.id),children:[e.jsx("div",{className:"rank-cell-v2",children:e.jsx("span",{className:"rank-number "+(s<3?"rank-top":""),children:s+1})}),e.jsx("div",{className:"team-info-main-v2",children:e.jsx("span",{className:"team-name-v2",children:a.name})}),e.jsx("div",{className:"team-logo-v2","aria-hidden":"true",children:a.crest_url?e.jsx(c,{src:a.crest_url,preset:"crestSm",alt:"",loading:"lazy",decoding:"async"}):e.jsx("div",{className:"logo-placeholder",children:e.jsx("span",{children:(null==(t=a.name)?void 0:t.charAt(0))||"?"})})}),e.jsxs("div",{className:"team-stats-row",children:[e.jsxs("div",{className:"team-stat-cell",children:[e.jsx("span",{className:"stat-label-mini",children:"GF"}),e.jsx("span",{className:"stat-num",children:a.goals_for||0})]}),e.jsxs("div",{className:"team-stat-cell",children:[e.jsx("span",{className:"stat-label-mini",children:"GA"}),e.jsx("span",{className:"stat-num",children:a.goals_against||0})]}),e.jsxs("div",{className:"team-stat-cell gd-cell",children:[e.jsx("span",{className:"stat-label-mini",children:"GD"}),e.jsxs("span",{className:"stat-num "+(a.goals_for-a.goals_against>=0?"positive":"negative"),children:[(a.goals_for||0)-(a.goals_against||0)>=0?"+":"",(a.goals_for||0)-(a.goals_against||0)]})]})]})]},a.id)}):e.jsxs("div",{className:"no-data-v2",children:[e.jsx("i",{className:"fas fa-shield-alt"}),e.jsx("p",{children:"No team statistics available yet"})]})})]})]})]}),e.jsx("button",{className:"stats-share-btn-fixed",onClick:()=>x(!0),title:"Share Top 3",children:e.jsx("i",{className:"fas fa-share-alt"})}),e.jsx(o,{statType:"teams"===t?"points":t,items:f()}),j&&e.jsx(m,{statType:"teams"===t?"points":t,items:f(),onClose:()=>x(!1)})]}),e.jsx(n,{edition:"2026"})]})}t.createRoot(document.getElementById("statistics-root")).render(e.jsx(i.StrictMode,{children:e.jsx(d,{})}));
