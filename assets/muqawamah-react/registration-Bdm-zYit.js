import{r as e,j as t,s as a,R as n,c as s}from"./App-ClKdzuI3.js";function i({onSuccess:n}){const[s,i]=e.useState(""),[r,o]=e.useState(!1);return t.jsx("div",{className:"auth-modal",children:t.jsxs("div",{className:"auth-card",children:[t.jsx("div",{className:"auth-logo",children:t.jsx("img",{src:"/assets/img/title.png",alt:"Muqawama 2026"})}),t.jsx("h2",{children:"Welcome to Muqawama 2026"}),t.jsx("p",{className:"auth-subtitle",children:"Sign in with your Google account to register your team and manage your registration."}),s&&t.jsx("p",{className:"auth-error",children:s}),t.jsx("div",{className:"auth-alternative",children:t.jsx("button",{type:"button",className:"auth-oauth-btn google-btn",onClick:async()=>{i(""),o(!0);try{const{data:e,error:t}=await a.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.origin+"/muqawamah/2026/register/"}});if(t)throw t}catch(e){i(`Google sign-in failed: ${e.message}. Please contact support.`),o(!1)}},disabled:r,children:r?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"spinner-small"})," Signing in..."]}):t.jsxs(t.Fragment,{children:[t.jsx("i",{className:"fab fa-google"})," Continue with Google"]})})}),t.jsxs("p",{className:"auth-note",children:[t.jsx("i",{className:"fas fa-info-circle"})," Your Google account will be used to authenticate and save your team registration."]})]})})}const r=e.createContext(null),o=()=>{const t=e.useContext(r);if(!t)throw new Error("useRegistration must be used within RegistrationProvider");return t},l=()=>[...["GK","CB","LB","RB","CM","LM","ST"].map((e,t)=>({id:`${e}-${t}`,name:"",position:e,isSubstitute:!1,image:null,x:50,y:50})),...["SUB1","SUB2","SUB3"].map((e,t)=>({id:`${e}-${t}`,name:"",position:"SUB",isSubstitute:!0,image:null,x:5+10*t,y:90}))],c={teamName:"",category:"open-age",teamLogo:null,captainName:"",captainEmail:"",captainPhone:"",formation:"1-3-2-1"},u=({children:a})=>{const[n,s]=e.useState(1),[i,o]=e.useState(c),[u,d]=e.useState(l()),[m,h]=e.useState(!1),[p,f]=e.useState(null),[g,x]=e.useState(null),[y,j]=e.useState(null),[b,w]=e.useState(!1),v=()=>{o(c),d(l()),x(null),j(null),s(1)},N=e.useMemo(()=>({step:n,setStep:s,teamData:i,setTeamData:o,players:u,setPlayers:d,loading:m,setLoading:h,error:p,setError:f,successTeamId:g,setSuccessTeamId:x,existingTeamId:y,setExistingTeamId:j,readOnlyMode:b,setReadOnlyMode:w,resetForm:v}),[n,i,u,m,p,g,y,b]);return t.jsx(r.Provider,{value:N,children:a})};const d=(()=>{let e=0;return()=>(e+=1,`u${`0000${(Math.random()*36**4|0).toString(36)}`.slice(-4)}${e}`)})();function m(e){const t=[];for(let a=0,n=e.length;a<n;a++)t.push(e[a]);return t}let h=null;function p(e={}){return h||(e.includeStyleProperties?(h=e.includeStyleProperties,h):(h=m(window.getComputedStyle(document.documentElement)),h))}function f(e,t){const a=(e.ownerDocument.defaultView||window).getComputedStyle(e).getPropertyValue(t);return a?parseFloat(a.replace("px","")):0}function g(e,t={}){return{width:t.width||function(e){const t=f(e,"border-left-width"),a=f(e,"border-right-width");return e.clientWidth+t+a}(e),height:t.height||function(e){const t=f(e,"border-top-width"),a=f(e,"border-bottom-width");return e.clientHeight+t+a}(e)}}const x=16384;function y(e){return new Promise((t,a)=>{const n=new Image;n.onload=()=>{n.decode().then(()=>{requestAnimationFrame(()=>t(n))})},n.onerror=a,n.crossOrigin="anonymous",n.decoding="async",n.src=e})}async function j(e,t,a){const n="http://www.w3.org/2000/svg",s=document.createElementNS(n,"svg"),i=document.createElementNS(n,"foreignObject");return s.setAttribute("width",`${t}`),s.setAttribute("height",`${a}`),s.setAttribute("viewBox",`0 0 ${t} ${a}`),i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("externalResourcesRequired","true"),s.appendChild(i),i.appendChild(e),async function(e){return Promise.resolve().then(()=>(new XMLSerializer).serializeToString(e)).then(encodeURIComponent).then(e=>`data:image/svg+xml;charset=utf-8,${e}`)}(s)}const b=(e,t)=>{if(e instanceof t)return!0;const a=Object.getPrototypeOf(e);return null!==a&&(a.constructor.name===t.name||b(a,t))};function w(e,t,a,n){const s=`.${e}:${t}`,i=a.cssText?function(e){const t=e.getPropertyValue("content");return`${e.cssText} content: '${t.replace(/'|"/g,"")}';`}(a):function(e,t){return p(t).map(t=>`${t}: ${e.getPropertyValue(t)}${e.getPropertyPriority(t)?" !important":""};`).join(" ")}(a,n);return document.createTextNode(`${s}{${i}}`)}function v(e,t,a,n){const s=window.getComputedStyle(e,a),i=s.getPropertyValue("content");if(""===i||"none"===i)return;const r=d();try{t.className=`${t.className} ${r}`}catch(l){return}const o=document.createElement("style");o.appendChild(w(r,a,s,n)),t.appendChild(o)}const N="application/font-woff",S="image/jpeg",C={woff:N,woff2:N,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:S,jpeg:S,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function P(e){const t=function(e){const t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""}(e).toLowerCase();return C[t]||""}function E(e){return-1!==e.search(/^(data:)/)}async function R(e,t,a){const n=await fetch(e,t);if(404===n.status)throw new Error(`Resource "${n.url}" not found`);const s=await n.blob();return new Promise((e,t)=>{const i=new FileReader;i.onerror=t,i.onloadend=()=>{try{e(a({res:n,result:i.result}))}catch(s){t(s)}},i.readAsDataURL(s)})}const T={};async function $(e,t,a){const n=function(e,t,a){let n=e.replace(/\?.*/,"");return a&&(n=e),/ttf|otf|eot|woff2?/i.test(n)&&(n=n.replace(/.*\//,"")),t?`[${t}]${n}`:n}(e,t,a.includeQueryParams);if(null!=T[n])return T[n];let s;a.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime());try{const n=await R(e,a.fetchRequestInit,({res:e,result:a})=>(t||(t=e.headers.get("Content-Type")||""),function(e){return e.split(/,/)[1]}(a)));s=function(e,t){return`data:${t};base64,${e}`}(n,t)}catch(i){s=a.imagePlaceholder||"";let t=`Failed to fetch resource: ${e}`;i&&(t="string"==typeof i?i:i.message)}return T[n]=s,s}async function D(e,t){return b(e,HTMLCanvasElement)?async function(e){const t=e.toDataURL();return"data:,"===t?e.cloneNode(!1):y(t)}(e):b(e,HTMLVideoElement)?async function(e,t){if(e.currentSrc){const t=document.createElement("canvas"),a=t.getContext("2d");return t.width=e.clientWidth,t.height=e.clientHeight,null==a||a.drawImage(e,0,0,t.width,t.height),y(t.toDataURL())}const a=e.poster,n=P(a);return y(await $(a,n,t))}(e,t):b(e,HTMLIFrameElement)?async function(e,t){var a;try{if(null===(a=null==e?void 0:e.contentDocument)||void 0===a?void 0:a.body)return await _(e.contentDocument.body,t,!0)}catch(n){}return e.cloneNode(!1)}(e,t):e.cloneNode(M(e))}const L=e=>null!=e.tagName&&"SLOT"===e.tagName.toUpperCase(),M=e=>null!=e.tagName&&"SVG"===e.tagName.toUpperCase();function I(e,t,a){return b(t,Element)&&(function(e,t,a){const n=t.style;if(!n)return;const s=window.getComputedStyle(e);s.cssText?(n.cssText=s.cssText,n.transformOrigin=s.transformOrigin):p(a).forEach(a=>{let i=s.getPropertyValue(a);if("font-size"===a&&i.endsWith("px")){const e=Math.floor(parseFloat(i.substring(0,i.length-2)))-.1;i=`${e}px`}b(e,HTMLIFrameElement)&&"display"===a&&"inline"===i&&(i="block"),"d"===a&&t.getAttribute("d")&&(i=`path(${t.getAttribute("d")})`),n.setProperty(a,i,s.getPropertyPriority(a))})}(e,t,a),function(e,t,a){v(e,t,":before",a),v(e,t,":after",a)}(e,t,a),function(e,t){b(e,HTMLTextAreaElement)&&(t.innerHTML=e.value),b(e,HTMLInputElement)&&t.setAttribute("value",e.value)}(e,t),function(e,t){if(b(e,HTMLSelectElement)){const a=t,n=Array.from(a.children).find(t=>e.value===t.getAttribute("value"));n&&n.setAttribute("selected","")}}(e,t)),t}async function _(e,t,a){return a||!t.filter||t.filter(e)?Promise.resolve(e).then(e=>D(e,t)).then(a=>async function(e,t,a){var n,s;if(M(t))return t;let i=[];return i=L(e)&&e.assignedNodes?m(e.assignedNodes()):b(e,HTMLIFrameElement)&&(null===(n=e.contentDocument)||void 0===n?void 0:n.body)?m(e.contentDocument.body.childNodes):m((null!==(s=e.shadowRoot)&&void 0!==s?s:e).childNodes),0===i.length||b(e,HTMLVideoElement)||await i.reduce((e,n)=>e.then(()=>_(n,a)).then(e=>{e&&t.appendChild(e)}),Promise.resolve()),t}(e,a,t)).then(a=>I(e,a,t)).then(e=>async function(e,t){const a=e.querySelectorAll?e.querySelectorAll("use"):[];if(0===a.length)return e;const n={};for(let i=0;i<a.length;i++){const s=a[i].getAttribute("xlink:href");if(s){const a=e.querySelector(s),i=document.querySelector(s);a||!i||n[s]||(n[s]=await _(i,t,!0))}}const s=Object.values(n);if(s.length){const t="http://www.w3.org/1999/xhtml",a=document.createElementNS(t,"svg");a.setAttribute("xmlns",t),a.style.position="absolute",a.style.width="0",a.style.height="0",a.style.overflow="hidden",a.style.display="none";const n=document.createElementNS(t,"defs");a.appendChild(n);for(let e=0;e<s.length;e++)n.appendChild(s[e]);e.appendChild(a)}return e}(e,t)):null}const k=/url\((['"]?)([^'"]+?)\1\)/g,A=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,F=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;async function U(e,t,a,n,s){try{const i=a?function(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;const a=document.implementation.createHTMLDocument(),n=a.createElement("base"),s=a.createElement("a");return a.head.appendChild(n),a.body.appendChild(s),t&&(n.href=t),s.href=e,s.href}(t,a):t,r=P(t);let o;return s||(o=await $(i,r,n)),e.replace(function(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}(t),`$1${o}$3`)}catch(i){}return e}function q(e){return-1!==e.search(k)}async function O(e,t,a){if(!q(e))return e;const n=function(e,{preferredFontFormat:t}){return t?e.replace(F,e=>{for(;;){const[a,,n]=A.exec(e)||[];if(!n)return"";if(n===t)return`src: ${a};`}}):e}(e,a),s=function(e){const t=[];return e.replace(k,(e,a,n)=>(t.push(n),e)),t.filter(e=>!E(e))}(n);return s.reduce((e,n)=>e.then(e=>U(e,n,t,a)),Promise.resolve(n))}async function B(e,t,a){var n;const s=null===(n=t.style)||void 0===n?void 0:n.getPropertyValue(e);if(s){const n=await O(s,null,a);return t.style.setProperty(e,n,t.style.getPropertyPriority(e)),!0}return!1}async function H(e,t){b(e,Element)&&(await async function(e,t){await B("background",e,t)||await B("background-image",e,t),await B("mask",e,t)||await B("-webkit-mask",e,t)||await B("mask-image",e,t)||await B("-webkit-mask-image",e,t)}(e,t),await async function(e,t){const a=b(e,HTMLImageElement);if((!a||E(e.src))&&(!b(e,SVGImageElement)||E(e.href.baseVal)))return;const n=a?e.src:e.href.baseVal,s=await $(n,P(n),t);await new Promise((n,i)=>{e.onload=n,e.onerror=t.onImageErrorHandler?(...e)=>{try{n(t.onImageErrorHandler(...e))}catch(a){i(a)}}:i;const r=e;r.decode&&(r.decode=n),"lazy"===r.loading&&(r.loading="eager"),a?(e.srcset="",e.src=s):e.href.baseVal=s})}(e,t),await async function(e,t){const a=m(e.childNodes).map(e=>H(e,t));await Promise.all(a).then(()=>e)}(e,t))}const V={};async function G(e){let t=V[e];if(null!=t)return t;const a=await fetch(e);return t={url:e,cssText:await a.text()},V[e]=t,t}async function z(e,t){let a=e.cssText;const n=/url\(["']?([^"')]+)["']?\)/g,s=(a.match(/url\([^)]+\)/g)||[]).map(async s=>{let i=s.replace(n,"$1");return i.startsWith("https://")||(i=new URL(i,e.url).href),R(i,t.fetchRequestInit,({result:e})=>(a=a.replace(s,`url(${e})`),[s,e]))});return Promise.all(s).then(()=>a)}function Y(e){if(null==e)return[];const t=[];let a=e.replace(/(\/\*[\s\S]*?\*\/)/gi,"");const n=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const e=n.exec(a);if(null===e)break;t.push(e[0])}a=a.replace(n,"");const s=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,i=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let e=s.exec(a);if(null===e){if(e=i.exec(a),null===e)break;s.lastIndex=i.lastIndex}else i.lastIndex=s.lastIndex;t.push(e[0])}return t}async function W(e,t){if(null==e.ownerDocument)throw new Error("Provided element is not within a Document");const a=m(e.ownerDocument.styleSheets),n=await async function(e,t){const a=[],n=[];return e.forEach(a=>{if("cssRules"in a)try{m(a.cssRules||[]).forEach((e,s)=>{if(e.type===CSSRule.IMPORT_RULE){let i=s+1;const r=G(e.href).then(e=>z(e,t)).then(e=>Y(e).forEach(e=>{try{a.insertRule(e,e.startsWith("@import")?i+=1:a.cssRules.length)}catch(t){}})).catch(e=>{});n.push(r)}})}catch(s){const i=e.find(e=>null==e.href)||document.styleSheets[0];null!=a.href&&n.push(G(a.href).then(e=>z(e,t)).then(e=>Y(e).forEach(e=>{i.insertRule(e,i.cssRules.length)})).catch(e=>{}))}}),Promise.all(n).then(()=>(e.forEach(e=>{if("cssRules"in e)try{m(e.cssRules||[]).forEach(e=>{a.push(e)})}catch(t){}}),a))}(a,t);return function(e){return e.filter(e=>e.type===CSSRule.FONT_FACE_RULE).filter(e=>q(e.style.getPropertyValue("src")))}(n)}function K(e){return e.trim().replace(/["']/g,"")}async function X(e,t){const a=await W(e,t),n=function(e){const t=new Set;return function e(a){(a.style.fontFamily||getComputedStyle(a).fontFamily).split(",").forEach(e=>{t.add(K(e))}),Array.from(a.children).forEach(t=>{t instanceof HTMLElement&&e(t)})}(e),t}(e);return(await Promise.all(a.filter(e=>n.has(K(e.style.fontFamily))).map(e=>{const a=e.parentStyleSheet?e.parentStyleSheet.href:null;return O(e.cssText,a,t)}))).join("\n")}async function J(e,t={}){const{width:a,height:n}=g(e,t),s=await _(e,t,!0);await async function(e,t){const a=null!=t.fontEmbedCSS?t.fontEmbedCSS:t.skipFonts?null:await X(e,t);if(a){const t=document.createElement("style"),n=document.createTextNode(a);t.appendChild(n),e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t)}}(s,t),await H(s,t),function(e,t){const{style:a}=e;t.backgroundColor&&(a.backgroundColor=t.backgroundColor),t.width&&(a.width=`${t.width}px`),t.height&&(a.height=`${t.height}px`);const n=t.style;null!=n&&Object.keys(n).forEach(e=>{a[e]=n[e]})}(s,t);return await j(s,a,n)}async function Q(e,t={}){const{width:a,height:n}=g(e,t),s=await J(e,t),i=await y(s),r=document.createElement("canvas"),o=r.getContext("2d"),l=t.pixelRatio||function(){let e,t;try{t=process}catch(n){}const a=t&&t.env?t.env.devicePixelRatio:null;return a&&(e=parseInt(a,10),Number.isNaN(e)&&(e=1)),e||window.devicePixelRatio||1}(),c=t.canvasWidth||a,u=t.canvasHeight||n;return r.width=c*l,r.height=u*l,t.skipAutoScale||function(e){(e.width>x||e.height>x)&&(e.width>x&&e.height>x?e.width>e.height?(e.height*=x/e.width,e.width=x):(e.width*=x/e.height,e.height=x):e.width>x?(e.height*=x/e.width,e.width=x):(e.width*=x/e.height,e.height=x))}(r),r.style.width=`${c}`,r.style.height=`${u}`,t.backgroundColor&&(o.fillStyle=t.backgroundColor,o.fillRect(0,0,r.width,r.height)),o.drawImage(i,0,0,r.width,r.height),r}function Z({players:a,editable:n=!1,onDragStart:s,onDrag:i,onDragEnd:r,showDownload:o=!1}){const l=e.useRef(null),[c,u]=e.useState(!1),d=e.useMemo(()=>`muqawamah-formation-${(new Date).toISOString().split("T")[0]}.png`,[]);return t.jsxs("div",{className:"formation-preview-wrapper",children:[t.jsxs("div",{className:"football-field",ref:l,children:[t.jsx("div",{className:"football-field-surface"}),t.jsx("div",{className:"formation-overlay",style:{pointerEvents:"none"},children:a.map(e=>t.jsxs("div",{className:"player-marker",style:{left:`${e.x}%`,top:`${e.y}%`},children:[t.jsx("div",{className:"player-circle "+(e.isSubstitute?"substitute":""),children:e.image?t.jsx("img",{src:e.image,alt:e.name||e.position}):t.jsx("span",{children:e.position})}),t.jsxs("div",{className:"player-label",children:[t.jsx("strong",{children:e.position}),t.jsx("span",{children:e.name||"Unnamed"})]})]},e.id))})]}),o&&t.jsxs("button",{type:"button",className:"download-formation-btn",onClick:async()=>{if(l.current)try{u(!0);const e=await async function(e,t={}){return(await Q(e,t)).toDataURL()}(l.current,{cacheBust:!0,pixelRatio:window.devicePixelRatio||2,backgroundColor:"#0f1b2c"}),t=document.createElement("a");t.download=d,t.href=e,t.click()}catch(e){alert("Unable to download formation right now. Please try again.")}finally{u(!1)}},disabled:c,children:[t.jsx("i",{className:"fas fa-download"}),t.jsx("span",{children:c?"Preparing...":"Download Formation"})]})]})}const ee=["1-3-2-1","1-2-3-1","1-2-2-2","1-3-1-2","1-4-1-1"],te=(e,t)=>{if(!t)return e;const a=t.split("-").map(e=>parseInt(e,10)).filter(Boolean);if(!a.length)return e;const n=[10,30,55,80],s=[...e],i=e.filter(e=>!e.isSubstitute);let r=0;for(a.forEach((t,a)=>{const o=100/(t+1);for(let l=0;l<t;l++)if(i[r]){const t=i[r],c=o*(l+1),u=n[a]??n[n.length-1];s[e.indexOf(t)]={...t,x:c,y:u},r+=1}});r<i.length;r++){const t=i[r];s[e.indexOf(t)]={...t,x:50,y:50}}return s};function ae(){const{players:a,setPlayers:n,teamData:s,setTeamData:i,setStep:r}=o(),l=e.useRef(null),[c,u]=e.useState(null),[d,m]=e.useState(!1),h=e.useCallback(e=>{const t=te(a,e);n(t),i(t=>({...t,formation:e}))},[a,n,i]);e.useEffect(()=>{if(!d&&s.formation){const e=te(a,s.formation);n(e),m(!0)}},[s.formation,a,n,d]);return t.jsxs("form",{className:"registration-form",onSubmit:e=>{e.preventDefault(),r(4)},children:[t.jsx("h3",{children:"Step 3 · Formation & Positions"}),t.jsx("p",{className:"step-description",children:"Drag players around the field or start from a preset."}),t.jsxs("label",{children:["Formation Label",t.jsx("input",{type:"text",value:s.formation,onChange:e=>i(t=>({...t,formation:e.target.value})),placeholder:"e.g., 1-3-2-1"})]}),t.jsxs("div",{className:"formation-presets",children:[ee.map(e=>t.jsx("button",{type:"button",onClick:()=>h(e),children:e},e)),t.jsx("button",{type:"button",onClick:()=>h(s.formation),children:"Apply Current"})]}),t.jsx("div",{ref:l,children:t.jsx(Z,{players:a.filter(e=>!e.isSubstitute),editable:!0,onDragStart:(e,t)=>{u(t)},onDrag:e=>{if(!c||!l.current)return;e.preventDefault();const t=l.current.getBoundingClientRect(),a=e.touches?e.touches[0].clientX:e.clientX,s=e.touches?e.touches[0].clientY:e.clientY,i=(a-t.left)/t.width*100,r=(s-t.top)/t.height*100;((e,t,a)=>{n(n=>n.map(n=>n.id===e?{...n,x:t,y:a}:n))})(c,Math.min(Math.max(i,0),100),Math.min(Math.max(r,0),100))},onDragEnd:()=>{u(null)}})}),t.jsxs("div",{className:"form-actions",children:[t.jsx("button",{type:"button",className:"secondary-btn",onClick:()=>r(2),children:"Back"}),t.jsx("button",{type:"submit",className:"primary-btn",children:"Review Registration"})]})]})}const ne=["GK","CB","LB","RB","CDM","CM","CAM","LM","RM","CF","ST"];function se(){const{players:e,setPlayers:a,setStep:n}=o(),s=(e,t,n)=>{a(a=>a.map((a,s)=>s===e?{...a,[t]:n}:a))},i=e.filter(e=>!e.isSubstitute),r=e.filter(e=>e.isSubstitute),l=e=>new Promise((t,a)=>{const n=new FileReader;n.onload=()=>t(n.result),n.onerror=a,n.readAsDataURL(e)}),c=(e,a)=>t.jsxs("div",{className:"player-card",children:[t.jsxs("label",{children:["Player Name",t.jsx("input",{type:"text",value:e.name,onChange:e=>s(a,"name",e.target.value),placeholder:e.isSubstitute?"Substitute Name":`${e.position} Player`,required:!0})]}),!e.isSubstitute&&t.jsxs("label",{children:["Position",t.jsx("select",{value:e.position,onChange:e=>s(a,"position",e.target.value),children:ne.map(e=>t.jsx("option",{value:e,children:e},e))})]}),t.jsxs("label",{className:"file-label",children:["Player Photo (optional)",t.jsx("input",{type:"file",accept:"image/*",onChange:e=>{var t;return(async(e,t)=>{if(!t)return;if(t.size>512e3)return void alert("Player photo must be under 500KB");const a=await l(t);s(e,"image",a)})(a,null==(t=e.target.files)?void 0:t[0])}})]})]},e.id);return t.jsxs("form",{className:"registration-form",onSubmit:e=>{e.preventDefault(),(()=>{const e=i.every(e=>e.name&&e.position),t=r.every(e=>e.name);return e&&t})()?n(3):alert("Please fill out all player names and positions (for main players).")},children:[t.jsx("h3",{children:"Step 2 · Players"}),t.jsx("p",{className:"step-description",children:"Provide 7 main players and 3 substitutes."}),t.jsx("h4",{children:"Main Players"}),t.jsx("div",{className:"players-grid",children:i.map((t,a)=>c(t,e.indexOf(t)))}),t.jsx("h4",{children:"Substitutes"}),t.jsx("div",{className:"players-grid",children:r.map(t=>c(t,e.indexOf(t)))}),t.jsxs("div",{className:"form-actions",children:[t.jsx("button",{type:"button",className:"secondary-btn",onClick:()=>n(1),children:"Back"}),t.jsx("button",{type:"submit",className:"primary-btn",children:"Continue to Formation"})]})]})}function ie({readOnly:n=!1}){const{teamData:s,players:i,setStep:r,setPlayers:l,loading:c,setLoading:u,error:d,setError:m,successTeamId:h,setSuccessTeamId:p,existingTeamId:f,setExistingTeamId:g}=o(),x=e.useRef(null),[y,j]=e.useState(null);return h&&!n?t.jsxs("div",{className:"registration-form",children:[t.jsx("h3",{children:f?"Registration Updated ✅":"Registration Submitted ✅"}),t.jsxs("p",{children:["Your team has been ",f?"updated":"registered",". Team ID: ",t.jsx("strong",{children:h}),".",!f&&` A confirmation email has been sent to ${s.captainEmail}.`]})]}):t.jsxs("div",{className:"registration-form",children:[t.jsxs("h3",{children:["Step 4 · Review & ",f?"Update":"Submit"]}),t.jsxs("p",{className:"step-description",children:["Verify everything looks good before ",f?"updating":"submitting"," your team."]}),t.jsxs("section",{className:"summary-section",children:[t.jsx("h4",{children:"Team Information"}),t.jsxs("div",{className:"team-info-card",children:[t.jsxs("div",{className:"team-info-header",children:[t.jsx("div",{className:"team-logo-large",children:s.teamLogo?t.jsx("img",{src:s.teamLogo,alt:`${s.teamName} logo`}):t.jsx("div",{className:"team-logo-placeholder-large",children:t.jsx("i",{className:"fas fa-shield-alt"})})}),t.jsxs("div",{className:"team-info-main",children:[t.jsx("h3",{className:"team-name-display",children:s.teamName}),t.jsxs("span",{className:"team-category-badge",children:[t.jsx("i",{className:"fas fa-trophy"})," ","open-age"===s.category?"Open Age":"Under 17"]})]})]}),t.jsxs("div",{className:"team-info-details",children:[t.jsxs("div",{className:"info-row",children:[t.jsxs("div",{className:"info-item",children:[t.jsx("i",{className:"fas fa-user-tie"}),t.jsxs("div",{className:"info-content",children:[t.jsx("span",{className:"info-label",children:"Captain"}),t.jsx("span",{className:"info-value",children:s.captainName})]})]}),t.jsxs("div",{className:"info-item",children:[t.jsx("i",{className:"fas fa-envelope"}),t.jsxs("div",{className:"info-content",children:[t.jsx("span",{className:"info-label",children:"Email"}),t.jsx("span",{className:"info-value",children:s.captainEmail})]})]})]}),s.captainPhone&&t.jsxs("div",{className:"info-row",children:[t.jsxs("div",{className:"info-item",children:[t.jsx("i",{className:"fas fa-phone"}),t.jsxs("div",{className:"info-content",children:[t.jsx("span",{className:"info-label",children:"Phone"}),t.jsx("span",{className:"info-value",children:s.captainPhone})]})]}),t.jsxs("div",{className:"info-item",children:[t.jsx("i",{className:"fas fa-futbol"}),t.jsxs("div",{className:"info-content",children:[t.jsx("span",{className:"info-label",children:"Formation"}),t.jsx("span",{className:"info-value",children:s.formation})]})]})]}),!s.captainPhone&&t.jsx("div",{className:"info-row",children:t.jsxs("div",{className:"info-item",children:[t.jsx("i",{className:"fas fa-futbol"}),t.jsxs("div",{className:"info-content",children:[t.jsx("span",{className:"info-label",children:"Formation"}),t.jsx("span",{className:"info-value",children:s.formation})]})]})})]})]})]}),t.jsxs("section",{className:"summary-section",children:[t.jsx("h4",{children:"Players"}),t.jsx("div",{className:"player-card-grid",children:i.map((e,a)=>{var n,i;return t.jsxs("div",{className:"player-card-badge simple "+(e.isSubstitute?"substitute":""),children:[t.jsxs("div",{className:"badge-header",children:[t.jsxs("div",{className:"badge-team",children:[t.jsx("div",{className:"team-logo",children:s.teamLogo?t.jsx("img",{src:s.teamLogo,alt:`${s.teamName} logo`}):t.jsx("div",{className:"team-logo-placeholder",children:(null==(i=null==(n=s.teamName)?void 0:n.charAt(0))?void 0:i.toUpperCase())||"T"})}),t.jsxs("div",{className:"team-meta",children:[t.jsx("span",{className:"team-name",children:s.teamName||"Team name"}),t.jsx("span",{className:"player-role",children:e.isSubstitute?"Substitute":e.position||"Player"})]})]}),t.jsx("div",{className:"muqawama-logo",children:t.jsx("img",{src:"/assets/img/MuqawamaLogo.png",alt:"Muqawama 2026"})})]}),t.jsx("div",{className:"badge-photo",children:e.image?t.jsx("img",{src:e.image,alt:e.name||e.position}):t.jsx("div",{className:"badge-photo-placeholder",children:t.jsx("i",{className:"fas fa-user"})})}),t.jsx("div",{className:"badge-player-info",children:t.jsx("span",{className:"player-name",children:e.name||"Unnamed Player"})})]},e.id||a)})})]}),t.jsxs("section",{className:"summary-section",children:[t.jsx("h4",{children:"Formation Preview"}),t.jsx("div",{ref:x,children:t.jsx(Z,{players:i.filter(e=>!e.isSubstitute),editable:!n,onDragStart:(e,t)=>{j(t)},onDrag:e=>{if(!y||!x.current)return;e.preventDefault();const t=x.current.getBoundingClientRect(),a=e.touches?e.touches[0].clientX:e.clientX,n=e.touches?e.touches[0].clientY:e.clientY,s=(a-t.left)/t.width*100,i=(n-t.top)/t.height*100;var r,o,c;r=y,o=Math.min(Math.max(s,0),100),c=Math.min(Math.max(i,0),100),l(e=>e.map(e=>e.id===r?{...e,x:o,y:c}:e))},onDragEnd:()=>{j(null)},showDownload:!0})})]}),d&&t.jsx("p",{className:"auth-error",children:d}),!n&&t.jsxs("div",{className:"form-actions",children:[t.jsx("button",{type:"button",className:"secondary-btn",onClick:()=>r(3),disabled:c,children:"Back"}),t.jsx("button",{type:"button",className:"primary-btn",onClick:async()=>{u(!0),m(null);try{if(n)return;const{data:{user:e}}=await a.auth.getUser();if(!e)throw new Error("You must be logged in to submit the registration.");let t=f;if(f){const{error:e}=await a.from("team_registrations").update({team_name:s.teamName,category:s.category,team_logo:s.teamLogo,captain_name:s.captainName,captain_email:s.captainEmail,captain_phone:s.captainPhone,formation:s.formation,submitted_at:(new Date).toISOString()}).eq("id",f);if(e)throw e;await a.from("team_players").delete().eq("team_id",f)}else{const{data:n,error:i}=await a.from("team_registrations").insert({user_id:e.id,team_name:s.teamName,category:s.category,team_logo:s.teamLogo,captain_name:s.captainName,captain_email:s.captainEmail,captain_phone:s.captainPhone,formation:s.formation,status:"submitted",submitted_at:(new Date).toISOString()}).select().single();if(i)throw i;t=n.id,g(t)}if(!t)throw new Error("Unable to determine team id.");const r=i.map(e=>({team_id:t,player_name:e.name,position:e.position,is_substitute:e.isSubstitute,player_image:e.image,position_x:e.x,position_y:e.y})),{error:o}=await a.from("team_players").insert(r);if(o)throw o;await a.functions.invoke("send-registration-email",{body:{teamId:t,email:s.captainEmail,teamName:s.teamName,category:s.category}}),p(t)}catch(e){m(e.message)}finally{u(!1)}},disabled:c,children:c?f?"Updating...":"Submitting...":f?"Update Registration":"Submit Registration"})]})]})}const re=[{value:"open-age",label:"Open Age"},{value:"u17",label:"Under 17"}];function oe(){const{teamData:a,setTeamData:n,setStep:s}=o(),i=e.useRef(null),r=e=>{const{name:t,value:a}=e.target;n(e=>({...e,[t]:a}))},l=e=>new Promise((t,a)=>{const n=new FileReader;n.onload=()=>t(n.result),n.onerror=a,n.readAsDataURL(e)});return t.jsxs("form",{className:"registration-form",onSubmit:e=>{e.preventDefault(),s(2)},children:[t.jsx("h3",{children:"Step 1 · Team Details"}),t.jsx("p",{className:"step-description",children:"Tell us about your team and captain information."}),t.jsxs("label",{children:["Team Name",t.jsx("input",{type:"text",name:"teamName",value:a.teamName,onChange:r,placeholder:"e.g., Rising Stars",required:!0})]}),t.jsxs("label",{children:["Category",t.jsx("select",{name:"category",value:a.category,onChange:r,children:re.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]}),t.jsxs("label",{children:["Team Logo (optional)",t.jsx("input",{type:"file",accept:"image/*",ref:i,onChange:async e=>{var t;const a=null==(t=e.target.files)?void 0:t[0];if(!a)return;if(a.size>512e3)return alert("Logo size must be under 500KB"),void(i.current.value="");const s=await l(a);n(e=>({...e,teamLogo:s}))}}),t.jsx("span",{className:"input-hint",children:"JPG/PNG up to 500KB. Displayed across the tournament site."})]}),t.jsxs("label",{children:["Preferred Formation",t.jsx("select",{name:"formation",value:a.formation,onChange:r,children:ee.map(e=>t.jsx("option",{value:e,children:e},e))}),t.jsx("span",{className:"input-hint",children:"This will be the starting layout in Step 3. You can still adjust players later."})]}),t.jsxs("div",{className:"grid-2",children:[t.jsxs("label",{children:["Captain Name",t.jsx("input",{type:"text",name:"captainName",value:a.captainName,onChange:r,required:!0})]}),t.jsxs("label",{children:["Captain Email",t.jsx("input",{type:"email",name:"captainEmail",value:a.captainEmail,onChange:r,required:!0})]})]}),t.jsxs("label",{children:["Captain Phone (optional)",t.jsx("input",{type:"tel",name:"captainPhone",value:a.captainPhone,onChange:r,placeholder:"+966 5x xxx xxxx"})]}),t.jsx("div",{className:"form-actions",children:t.jsx("button",{type:"submit",className:"primary-btn",children:"Continue to Players"})})]})}const le=[{id:1,label:"Team"},{id:2,label:"Players"},{id:3,label:"Formation"},{id:4,label:"Review"}];function ce(){const{step:e}=o();return t.jsx("div",{className:"registration-stepper",children:le.map((a,n)=>t.jsxs("div",{className:`step ${e===a.id?"active":""} ${e>a.id?"complete":""}`,children:[t.jsx("span",{className:"step-number",children:n+1}),t.jsx("span",{className:"step-label",children:a.label})]},a.id))})}function ue(){const{step:s,setStep:r,setTeamData:u,setPlayers:d,setExistingTeamId:m,readOnlyMode:h,setReadOnlyMode:p,resetForm:f,existingTeamId:g}=o(),[x,y]=e.useState(null),[j,b]=e.useState(!0),[w,v]=e.useState(""),[N,S]=e.useState(!1),C=n.useRef(!1);e.useEffect(()=>{let e=!0;v("");const t=setTimeout(()=>{e&&b(!1)},500);(async()=>{try{window.localStorage.getItem("sb-uzieoxfqkglcoistswxq-auth-token");const{data:n,error:s}=await Promise.race([a.auth.getUser(),new Promise((e,t)=>setTimeout(()=>t(new Error("getUser timeout")),2e3))]);if(!e)return;if(clearTimeout(t),s){if("getUser timeout"===s.message)return y(null),f(),void b(!1);if("Auth session missing!"!==s.message)throw s}const i=(null==n?void 0:n.user)??null;y(i),i?P(i,{force:!0}).catch(e=>{}):f()}catch(n){e&&(y(null),f())}finally{e&&b(!1)}})();const{data:n}=a.auth.onAuthStateChange(async(e,t)=>{const a=(null==t?void 0:t.user)??null;y(a),a?"SIGNED_IN"===e&&await P(a,{force:!0}):(f(),r(1),C.current=!1)});return()=>{e=!1,clearTimeout(t),n.subscription.unsubscribe()}},[]);const P=async(e,{force:t=!1}={})=>{var n;if(!C.current||t){C.current=!0,S(!0),v("");try{const{data:t,error:s}=await a.from("team_registrations").select("*, team_players(*)").eq("user_id",e.id).maybeSingle();if(s&&"PGRST116"!==s.code)throw s;if(t){m(t.id),p(!1),u({teamName:t.team_name||"",category:t.category||"open-age",teamLogo:t.team_logo,captainName:t.captain_name||"",captainEmail:t.captain_email||e.email||"",captainPhone:t.captain_phone||"",formation:t.formation||"1-3-2-1"});const a=(null==(n=t.team_players)?void 0:n.map((e,t)=>({id:e.id||`player-${t}`,name:e.player_name||"",position:e.position||"SUB",isSubstitute:e.is_substitute,image:e.player_image,x:e.position_x??50,y:e.position_y??50})))||l();d(a),r(4)}else m(null),p(!1),u({...c,captainEmail:e.email||""}),d(l()),r(1)}catch(s){v("Could not load your saved registration. You can continue and submitting will overwrite the previous data."),m(null),p(!1),u({...c,captainEmail:e.email||""}),d(l()),r(1)}finally{S(!1)}}};if(j)return t.jsx("div",{className:"loading-screen",children:t.jsxs("div",{className:"loading-content",children:[t.jsxs("div",{className:"logo-loader",children:[t.jsx("div",{className:"logo-ring"}),t.jsx("img",{src:"/assets/img/MuqawamaLogo.png",alt:"Muqawama",className:"logo-pulse"})]}),t.jsx("p",{children:"Loading your registration..."})]})});return x?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"header-actions",children:[t.jsx("span",{className:"user-email",children:x.email}),t.jsxs("button",{type:"button",className:"logout-btn",onClick:async()=>{await a.auth.signOut(),y(null),r(1)},children:[t.jsx("i",{className:"fas fa-sign-out-alt"})," Logout"]})]}),t.jsx("div",{className:"registration-header",children:t.jsxs("div",{className:"registration-header-logo",children:[t.jsx("img",{src:"/assets/img/title.png",alt:"Muqawama 2026"}),t.jsx("h2",{className:"registration-header-title",children:"Team Registration"}),t.jsx("p",{children:g?"Edit your team registration and update any details.":"Complete all steps to confirm your team registration."})]})}),N&&t.jsx("p",{className:"auth-message subtle",children:"Loading your saved registration…"}),w&&t.jsx("p",{className:"auth-error",children:w}),t.jsx(ce,{}),(()=>{switch(s){case 1:default:return t.jsx(oe,{});case 2:return t.jsx(se,{});case 3:return t.jsx(ae,{});case 4:return t.jsx(ie,{})}})()]}):t.jsx(i,{onSuccess:y})}function de(){return e.useEffect(()=>(document.body.classList.add("registration-body"),()=>document.body.classList.remove("registration-body")),[]),t.jsx(u,{children:t.jsx("div",{className:"registration-container",children:t.jsx(ue,{})})})}s.createRoot(document.getElementById("registration-root")).render(t.jsx(n.StrictMode,{children:t.jsx(de,{})}));
