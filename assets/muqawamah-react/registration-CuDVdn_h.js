import{r as e,j as a,s as t,R as s,c as n}from"./App-ClKdzuI3.js";function i({onSuccess:s}){const[n,i]=e.useState(""),[r,l]=e.useState(!1);return a.jsx("div",{className:"auth-modal",children:a.jsxs("div",{className:"auth-card",children:[a.jsx("div",{className:"auth-logo",children:a.jsx("img",{src:"/assets/img/title.png",alt:"Muqawama 2026"})}),a.jsx("h2",{children:"Welcome to Muqawama 2026"}),a.jsx("p",{className:"auth-subtitle",children:"Sign in with your Google account to register your team and manage your registration."}),n&&a.jsx("p",{className:"auth-error",children:n}),a.jsx("div",{className:"auth-alternative",children:a.jsx("button",{type:"button",className:"auth-oauth-btn google-btn",onClick:async()=>{i(""),l(!0);try{const{data:e,error:a}=await t.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.origin+"/muqawamah/2026/register/"}});if(a)throw a}catch(e){i(`Google sign-in failed: ${e.message}. Please contact support.`),l(!1)}},disabled:r,children:r?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"spinner-small"})," Signing in..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fab fa-google"})," Continue with Google"]})})}),a.jsxs("p",{className:"auth-note",children:[a.jsx("i",{className:"fas fa-info-circle"})," Your Google account will be used to authenticate and save your team registration."]})]})})}const r=e.createContext(null),l=()=>{const a=e.useContext(r);if(!a)throw new Error("useRegistration must be used within RegistrationProvider");return a},o=()=>[...["GK","CB","LB","RB","CM","LM","ST"].map((e,a)=>({id:`${e}-${a}`,name:"",position:e,isSubstitute:!1,image:null,x:50,y:50})),...["SUB1","SUB2","SUB3","SUB4"].map((e,a)=>({id:`${e}-${a}`,name:"",position:"SUB",isSubstitute:!0,image:null,x:10+20*a,y:90}))],c={teamName:"",category:"open-age",teamLogo:null,teamLogoFileName:null,captainName:"",captainEmail:"",captainPhone:"",formation:"1-3-2-1"},m=({children:s})=>{const[n,i]=e.useState(1),[l,m]=e.useState(c),[d,u]=e.useState(o()),[h,p]=e.useState(!1),[f,g]=e.useState(!1),[x,y]=e.useState(null),[j,N]=e.useState(null),[v,w]=e.useState(null),[b,S]=e.useState(!1),[P,C]=e.useState(null),[E,_]=e.useState(null),[T,k]=e.useState(0),R=()=>{m(c),u(o()),N(null),w(null),C(null),_(null),k(0),i(1)},L=e.useCallback(async e=>{g(!0),y(null);try{const{data:{user:a}}=await t.auth.getUser();if(!a)throw new Error("You must be logged in to save your progress.");let s=v;const n={user_id:a.id,team_name:l.teamName||"Draft Team",category:l.category,team_logo:l.teamLogo,captain_name:l.captainName,captain_email:l.captainEmail||a.email,captain_phone:l.captainPhone,formation:l.formation,status:"submitted",last_saved_step:e,submitted_at:(new Date).toISOString()};if(v){const{error:e}=await t.from("team_registrations").update(n).eq("id",v);if(e)throw e}else{const{data:e,error:a}=await t.from("team_registrations").insert(n).select().single();if(a)throw a;s=e.id,w(s)}if(d.filter(e=>e.name||e.image).length>0&&s){await t.from("team_players").delete().eq("team_id",s);const e=d.map(e=>({team_id:s,player_name:e.name,position:e.position,is_substitute:e.isSubstitute,player_image:e.image,position_x:e.x,position_y:e.y})),{error:a}=await t.from("team_players").insert(e);if(a)throw a}return k(e),{success:!0,teamId:s}}catch(a){return y(a.message),{success:!1,error:a.message}}finally{g(!1)}},[v,l,d]),D=e.useMemo(()=>({step:n,setStep:i,teamData:l,setTeamData:m,players:d,setPlayers:u,loading:h,setLoading:p,saving:f,setSaving:g,error:x,setError:y,successTeamId:j,setSuccessTeamId:N,existingTeamId:v,setExistingTeamId:w,readOnlyMode:b,setReadOnlyMode:S,paymentStatus:P,setPaymentStatus:C,transactionId:E,setTransactionId:_,lastSavedStep:T,setLastSavedStep:k,resetForm:R,saveProgress:L}),[n,l,d,h,f,x,j,v,b,P,E,T,L]);return a.jsx(r.Provider,{value:D,children:s})};const d=(()=>{let e=0;return()=>(e+=1,`u${`0000${(Math.random()*36**4|0).toString(36)}`.slice(-4)}${e}`)})();function u(e){const a=[];for(let t=0,s=e.length;t<s;t++)a.push(e[t]);return a}let h=null;function p(e={}){return h||(e.includeStyleProperties?(h=e.includeStyleProperties,h):(h=u(window.getComputedStyle(document.documentElement)),h))}function f(e,a){const t=(e.ownerDocument.defaultView||window).getComputedStyle(e).getPropertyValue(a);return t?parseFloat(t.replace("px","")):0}function g(e,a={}){return{width:a.width||function(e){const a=f(e,"border-left-width"),t=f(e,"border-right-width");return e.clientWidth+a+t}(e),height:a.height||function(e){const a=f(e,"border-top-width"),t=f(e,"border-bottom-width");return e.clientHeight+a+t}(e)}}const x=16384;function y(e){return new Promise((a,t)=>{const s=new Image;s.onload=()=>{s.decode().then(()=>{requestAnimationFrame(()=>a(s))})},s.onerror=t,s.crossOrigin="anonymous",s.decoding="async",s.src=e})}async function j(e,a,t){const s="http://www.w3.org/2000/svg",n=document.createElementNS(s,"svg"),i=document.createElementNS(s,"foreignObject");return n.setAttribute("width",`${a}`),n.setAttribute("height",`${t}`),n.setAttribute("viewBox",`0 0 ${a} ${t}`),i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("externalResourcesRequired","true"),n.appendChild(i),i.appendChild(e),async function(e){return Promise.resolve().then(()=>(new XMLSerializer).serializeToString(e)).then(encodeURIComponent).then(e=>`data:image/svg+xml;charset=utf-8,${e}`)}(n)}const N=(e,a)=>{if(e instanceof a)return!0;const t=Object.getPrototypeOf(e);return null!==t&&(t.constructor.name===a.name||N(t,a))};function v(e,a,t,s){const n=`.${e}:${a}`,i=t.cssText?function(e){const a=e.getPropertyValue("content");return`${e.cssText} content: '${a.replace(/'|"/g,"")}';`}(t):function(e,a){return p(a).map(a=>`${a}: ${e.getPropertyValue(a)}${e.getPropertyPriority(a)?" !important":""};`).join(" ")}(t,s);return document.createTextNode(`${n}{${i}}`)}function w(e,a,t,s){const n=window.getComputedStyle(e,t),i=n.getPropertyValue("content");if(""===i||"none"===i)return;const r=d();try{a.className=`${a.className} ${r}`}catch(o){return}const l=document.createElement("style");l.appendChild(v(r,t,n,s)),a.appendChild(l)}const b="application/font-woff",S="image/jpeg",P={woff:b,woff2:b,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:S,jpeg:S,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function C(e){const a=function(e){const a=/\.([^./]*?)$/g.exec(e);return a?a[1]:""}(e).toLowerCase();return P[a]||""}function E(e){return-1!==e.search(/^(data:)/)}async function _(e,a,t){const s=await fetch(e,a);if(404===s.status)throw new Error(`Resource "${s.url}" not found`);const n=await s.blob();return new Promise((e,a)=>{const i=new FileReader;i.onerror=a,i.onloadend=()=>{try{e(t({res:s,result:i.result}))}catch(n){a(n)}},i.readAsDataURL(n)})}const T={};async function k(e,a,t){const s=function(e,a,t){let s=e.replace(/\?.*/,"");return t&&(s=e),/ttf|otf|eot|woff2?/i.test(s)&&(s=s.replace(/.*\//,"")),a?`[${a}]${s}`:s}(e,a,t.includeQueryParams);if(null!=T[s])return T[s];let n;t.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime());try{const s=await _(e,t.fetchRequestInit,({res:e,result:t})=>(a||(a=e.headers.get("Content-Type")||""),function(e){return e.split(/,/)[1]}(t)));n=function(e,a){return`data:${a};base64,${e}`}(s,a)}catch(i){n=t.imagePlaceholder||"";let a=`Failed to fetch resource: ${e}`;i&&(a="string"==typeof i?i:i.message)}return T[s]=n,n}async function R(e,a){return N(e,HTMLCanvasElement)?async function(e){const a=e.toDataURL();return"data:,"===a?e.cloneNode(!1):y(a)}(e):N(e,HTMLVideoElement)?async function(e,a){if(e.currentSrc){const a=document.createElement("canvas"),t=a.getContext("2d");return a.width=e.clientWidth,a.height=e.clientHeight,null==t||t.drawImage(e,0,0,a.width,a.height),y(a.toDataURL())}const t=e.poster,s=C(t);return y(await k(t,s,a))}(e,a):N(e,HTMLIFrameElement)?async function(e,a){var t;try{if(null===(t=null==e?void 0:e.contentDocument)||void 0===t?void 0:t.body)return await M(e.contentDocument.body,a,!0)}catch(s){}return e.cloneNode(!1)}(e,a):e.cloneNode(D(e))}const L=e=>null!=e.tagName&&"SLOT"===e.tagName.toUpperCase(),D=e=>null!=e.tagName&&"SVG"===e.tagName.toUpperCase();function $(e,a,t){return N(a,Element)&&(function(e,a,t){const s=a.style;if(!s)return;const n=window.getComputedStyle(e);n.cssText?(s.cssText=n.cssText,s.transformOrigin=n.transformOrigin):p(t).forEach(t=>{let i=n.getPropertyValue(t);if("font-size"===t&&i.endsWith("px")){const e=Math.floor(parseFloat(i.substring(0,i.length-2)))-.1;i=`${e}px`}N(e,HTMLIFrameElement)&&"display"===t&&"inline"===i&&(i="block"),"d"===t&&a.getAttribute("d")&&(i=`path(${a.getAttribute("d")})`),s.setProperty(t,i,n.getPropertyPriority(t))})}(e,a,t),function(e,a,t){w(e,a,":before",t),w(e,a,":after",t)}(e,a,t),function(e,a){N(e,HTMLTextAreaElement)&&(a.innerHTML=e.value),N(e,HTMLInputElement)&&a.setAttribute("value",e.value)}(e,a),function(e,a){if(N(e,HTMLSelectElement)){const t=a,s=Array.from(t.children).find(a=>e.value===a.getAttribute("value"));s&&s.setAttribute("selected","")}}(e,a)),a}async function M(e,a,t){return t||!a.filter||a.filter(e)?Promise.resolve(e).then(e=>R(e,a)).then(t=>async function(e,a,t){var s,n;if(D(a))return a;let i=[];return i=L(e)&&e.assignedNodes?u(e.assignedNodes()):N(e,HTMLIFrameElement)&&(null===(s=e.contentDocument)||void 0===s?void 0:s.body)?u(e.contentDocument.body.childNodes):u((null!==(n=e.shadowRoot)&&void 0!==n?n:e).childNodes),0===i.length||N(e,HTMLVideoElement)||await i.reduce((e,s)=>e.then(()=>M(s,t)).then(e=>{e&&a.appendChild(e)}),Promise.resolve()),a}(e,t,a)).then(t=>$(e,t,a)).then(e=>async function(e,a){const t=e.querySelectorAll?e.querySelectorAll("use"):[];if(0===t.length)return e;const s={};for(let i=0;i<t.length;i++){const n=t[i].getAttribute("xlink:href");if(n){const t=e.querySelector(n),i=document.querySelector(n);t||!i||s[n]||(s[n]=await M(i,a,!0))}}const n=Object.values(s);if(n.length){const a="http://www.w3.org/1999/xhtml",t=document.createElementNS(a,"svg");t.setAttribute("xmlns",a),t.style.position="absolute",t.style.width="0",t.style.height="0",t.style.overflow="hidden",t.style.display="none";const s=document.createElementNS(a,"defs");t.appendChild(s);for(let e=0;e<n.length;e++)s.appendChild(n[e]);e.appendChild(t)}return e}(e,a)):null}const F=/url\((['"]?)([^'"]+?)\1\)/g,I=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,B=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;async function U(e,a,t,s,n){try{const i=t?function(e,a){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;const t=document.implementation.createHTMLDocument(),s=t.createElement("base"),n=t.createElement("a");return t.head.appendChild(s),t.body.appendChild(n),a&&(s.href=a),n.href=e,n.href}(a,t):a,r=C(a);let l;return n||(l=await k(i,r,s)),e.replace(function(e){const a=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${a})(['"]?\\))`,"g")}(a),`$1${l}$3`)}catch(i){}return e}function q(e){return-1!==e.search(F)}async function A(e,a,t){if(!q(e))return e;const s=function(e,{preferredFontFormat:a}){return a?e.replace(B,e=>{for(;;){const[t,,s]=I.exec(e)||[];if(!s)return"";if(s===a)return`src: ${t};`}}):e}(e,t),n=function(e){const a=[];return e.replace(F,(e,t,s)=>(a.push(s),e)),a.filter(e=>!E(e))}(s);return n.reduce((e,s)=>e.then(e=>U(e,s,a,t)),Promise.resolve(s))}async function O(e,a,t){var s;const n=null===(s=a.style)||void 0===s?void 0:s.getPropertyValue(e);if(n){const s=await A(n,null,t);return a.style.setProperty(e,s,a.style.getPropertyPriority(e)),!0}return!1}async function V(e,a){N(e,Element)&&(await async function(e,a){await O("background",e,a)||await O("background-image",e,a),await O("mask",e,a)||await O("-webkit-mask",e,a)||await O("mask-image",e,a)||await O("-webkit-mask-image",e,a)}(e,a),await async function(e,a){const t=N(e,HTMLImageElement);if((!t||E(e.src))&&(!N(e,SVGImageElement)||E(e.href.baseVal)))return;const s=t?e.src:e.href.baseVal,n=await k(s,C(s),a);await new Promise((s,i)=>{e.onload=s,e.onerror=a.onImageErrorHandler?(...e)=>{try{s(a.onImageErrorHandler(...e))}catch(t){i(t)}}:i;const r=e;r.decode&&(r.decode=s),"lazy"===r.loading&&(r.loading="eager"),t?(e.srcset="",e.src=n):e.href.baseVal=n})}(e,a),await async function(e,a){const t=u(e.childNodes).map(e=>V(e,a));await Promise.all(t).then(()=>e)}(e,a))}const H={};async function z(e){let a=H[e];if(null!=a)return a;const t=await fetch(e);return a={url:e,cssText:await t.text()},H[e]=a,a}async function G(e,a){let t=e.cssText;const s=/url\(["']?([^"')]+)["']?\)/g,n=(t.match(/url\([^)]+\)/g)||[]).map(async n=>{let i=n.replace(s,"$1");return i.startsWith("https://")||(i=new URL(i,e.url).href),_(i,a.fetchRequestInit,({result:e})=>(t=t.replace(n,`url(${e})`),[n,e]))});return Promise.all(n).then(()=>t)}function Y(e){if(null==e)return[];const a=[];let t=e.replace(/(\/\*[\s\S]*?\*\/)/gi,"");const s=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const e=s.exec(t);if(null===e)break;a.push(e[0])}t=t.replace(s,"");const n=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,i=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let e=n.exec(t);if(null===e){if(e=i.exec(t),null===e)break;n.lastIndex=i.lastIndex}else i.lastIndex=n.lastIndex;a.push(e[0])}return a}async function W(e,a){if(null==e.ownerDocument)throw new Error("Provided element is not within a Document");const t=u(e.ownerDocument.styleSheets),s=await async function(e,a){const t=[],s=[];return e.forEach(t=>{if("cssRules"in t)try{u(t.cssRules||[]).forEach((e,n)=>{if(e.type===CSSRule.IMPORT_RULE){let i=n+1;const r=z(e.href).then(e=>G(e,a)).then(e=>Y(e).forEach(e=>{try{t.insertRule(e,e.startsWith("@import")?i+=1:t.cssRules.length)}catch(a){}})).catch(e=>{});s.push(r)}})}catch(n){const i=e.find(e=>null==e.href)||document.styleSheets[0];null!=t.href&&s.push(z(t.href).then(e=>G(e,a)).then(e=>Y(e).forEach(e=>{i.insertRule(e,i.cssRules.length)})).catch(e=>{}))}}),Promise.all(s).then(()=>(e.forEach(e=>{if("cssRules"in e)try{u(e.cssRules||[]).forEach(e=>{t.push(e)})}catch(a){}}),t))}(t,a);return function(e){return e.filter(e=>e.type===CSSRule.FONT_FACE_RULE).filter(e=>q(e.style.getPropertyValue("src")))}(s)}function X(e){return e.trim().replace(/["']/g,"")}async function Q(e,a){const t=await W(e,a),s=function(e){const a=new Set;return function e(t){(t.style.fontFamily||getComputedStyle(t).fontFamily).split(",").forEach(e=>{a.add(X(e))}),Array.from(t.children).forEach(a=>{a instanceof HTMLElement&&e(a)})}(e),a}(e);return(await Promise.all(t.filter(e=>s.has(X(e.style.fontFamily))).map(e=>{const t=e.parentStyleSheet?e.parentStyleSheet.href:null;return A(e.cssText,t,a)}))).join("\n")}async function J(e,a={}){const{width:t,height:s}=g(e,a),n=await M(e,a,!0);await async function(e,a){const t=null!=a.fontEmbedCSS?a.fontEmbedCSS:a.skipFonts?null:await Q(e,a);if(t){const a=document.createElement("style"),s=document.createTextNode(t);a.appendChild(s),e.firstChild?e.insertBefore(a,e.firstChild):e.appendChild(a)}}(n,a),await V(n,a),function(e,a){const{style:t}=e;a.backgroundColor&&(t.backgroundColor=a.backgroundColor),a.width&&(t.width=`${a.width}px`),a.height&&(t.height=`${a.height}px`);const s=a.style;null!=s&&Object.keys(s).forEach(e=>{t[e]=s[e]})}(n,a);return await j(n,t,s)}async function K(e,a={}){const{width:t,height:s}=g(e,a),n=await J(e,a),i=await y(n),r=document.createElement("canvas"),l=r.getContext("2d"),o=a.pixelRatio||function(){let e,a;try{a=process}catch(s){}const t=a&&a.env?a.env.devicePixelRatio:null;return t&&(e=parseInt(t,10),Number.isNaN(e)&&(e=1)),e||window.devicePixelRatio||1}(),c=a.canvasWidth||t,m=a.canvasHeight||s;return r.width=c*o,r.height=m*o,a.skipAutoScale||function(e){(e.width>x||e.height>x)&&(e.width>x&&e.height>x?e.width>e.height?(e.height*=x/e.width,e.width=x):(e.width*=x/e.height,e.height=x):e.width>x?(e.height*=x/e.width,e.width=x):(e.width*=x/e.height,e.height=x))}(r),r.style.width=`${c}`,r.style.height=`${m}`,a.backgroundColor&&(l.fillStyle=a.backgroundColor,l.fillRect(0,0,r.width,r.height)),l.drawImage(i,0,0,r.width,r.height),r}function Z({players:t,editable:s=!1,onDragStart:n,onDrag:i,onDragEnd:r,showDownload:l=!1}){const o=e.useRef(null),[c,m]=e.useState(!1),d=e.useMemo(()=>`muqawamah-formation-${(new Date).toISOString().split("T")[0]}.png`,[]);return a.jsxs("div",{className:"formation-preview-wrapper",children:[a.jsxs("div",{className:"football-field",ref:o,children:[a.jsx("div",{className:"football-field-surface"}),a.jsx("div",{className:"formation-overlay",style:{pointerEvents:"none"},children:t.map(e=>a.jsxs("div",{className:"player-marker",style:{left:`${e.x}%`,top:`${e.y}%`},children:[a.jsx("div",{className:"player-circle "+(e.isSubstitute?"substitute":""),children:e.image?a.jsx("img",{src:e.image,alt:e.name||e.position}):a.jsx("span",{children:e.position})}),a.jsxs("div",{className:"player-label",children:[a.jsx("strong",{children:e.position}),a.jsx("span",{children:e.name||"Unnamed"})]})]},e.id))})]}),l&&a.jsxs("button",{type:"button",className:"download-formation-btn",onClick:async()=>{if(o.current)try{m(!0);const e=await async function(e,a={}){return(await K(e,a)).toDataURL()}(o.current,{cacheBust:!0,pixelRatio:window.devicePixelRatio||2,backgroundColor:"#0f1b2c"}),a=document.createElement("a");a.download=d,a.href=e,a.click()}catch(e){alert("Unable to download formation right now. Please try again.")}finally{m(!1)}},disabled:c,children:[a.jsx("i",{className:"fas fa-download"}),a.jsx("span",{children:c?"Preparing...":"Download Formation"})]})]})}const ee=["1-3-2-1","1-2-3-1","1-2-2-2","1-3-1-2","1-4-1-1"],ae=(e,a)=>{if(!a)return e;const t=a.split("-").map(e=>parseInt(e,10)).filter(Boolean);if(!t.length)return e;const s=[10,30,55,80],n=[...e],i=e.filter(e=>!e.isSubstitute);let r=0;for(t.forEach((a,t)=>{const l=100/(a+1);for(let o=0;o<a;o++)if(i[r]){const a=i[r],c=l*(o+1),m=s[t]??s[s.length-1];n[e.indexOf(a)]={...a,x:c,y:m},r+=1}});r<i.length;r++){const a=i[r];n[e.indexOf(a)]={...a,x:50,y:50}}return n};function te(){const{players:t,setPlayers:s,teamData:n,setTeamData:i,setStep:r,saveProgress:o,saving:c,error:m}=l(),d=e.useRef(null),[u,h]=e.useState(null),[p,f]=e.useState(!1),g=e.useCallback(e=>{const a=ae(t,e);s(a),i(a=>({...a,formation:e}))},[t,s,i]);e.useEffect(()=>{if(!p&&n.formation){const e=ae(t,n.formation);s(e),f(!0)}},[n.formation,t,s,p]);return a.jsxs("form",{className:"registration-form",onSubmit:async e=>{e.preventDefault();(await o(3)).success&&r(4)},children:[a.jsx("h3",{children:"Step 3 Â· Formation & Positions"}),a.jsx("p",{className:"step-description",children:"Drag players around the field or start from a preset."}),a.jsxs("label",{children:["Formation Label",a.jsx("input",{type:"text",value:n.formation,onChange:e=>i(a=>({...a,formation:e.target.value})),placeholder:"e.g., 1-3-2-1"})]}),a.jsxs("div",{className:"formation-presets",children:[ee.map(e=>a.jsx("button",{type:"button",onClick:()=>g(e),children:e},e)),a.jsx("button",{type:"button",onClick:()=>g(n.formation),children:"Apply Current"})]}),a.jsx("div",{ref:d,children:a.jsx(Z,{players:t.filter(e=>!e.isSubstitute),editable:!0,onDragStart:(e,a)=>{h(a)},onDrag:e=>{if(!u||!d.current)return;e.preventDefault();const a=d.current.getBoundingClientRect(),t=e.touches?e.touches[0].clientX:e.clientX,n=e.touches?e.touches[0].clientY:e.clientY,i=(t-a.left)/a.width*100,r=(n-a.top)/a.height*100;((e,a,t)=>{s(s=>s.map(s=>s.id===e?{...s,x:a,y:t}:s))})(u,Math.min(Math.max(i,0),100),Math.min(Math.max(r,0),100))},onDragEnd:()=>{h(null)}})}),m&&a.jsx("p",{className:"auth-error",children:m}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"secondary-btn",onClick:()=>r(2),disabled:c,children:"Back"}),a.jsx("button",{type:"submit",className:"primary-btn",disabled:c,children:c?a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-spinner fa-spin"})," Saving..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-save"})," Save & Review"]})})]})]})}function se(){const{teamData:e,resetForm:t}=l();return a.jsx("div",{className:"registration-form registration-complete",children:a.jsxs("div",{className:"complete-container",children:[a.jsx("div",{className:"complete-icon",children:a.jsx("div",{className:"icon-circle success",children:a.jsx("i",{className:"fas fa-check"})})}),a.jsx("h2",{children:"Thank You for Registering!"}),a.jsxs("div",{className:"complete-team-info",children:[e.teamLogo&&a.jsx("img",{src:e.teamLogo,alt:e.teamName,className:"complete-team-logo"}),a.jsx("h3",{children:e.teamName}),a.jsxs("span",{className:"complete-category",children:["open-age"===e.category?"Open Age":"Under 17"," Category"]})]}),a.jsxs("div",{className:"complete-message",children:[a.jsxs("p",{className:"main-message",children:["Your registration for ",a.jsx("strong",{children:"Muqawama 2026"})," has been successfully submitted!"]}),a.jsx("p",{className:"sub-message",children:"Our team will shortly get in touch with you to follow up with the next steps. Please keep an eye on your email and phone for updates."})]}),a.jsxs("div",{className:"complete-details",children:[a.jsx("h4",{children:"What Happens Next?"}),a.jsxs("ul",{className:"next-steps-list",children:[a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-envelope"}),a.jsxs("span",{children:["You'll receive a confirmation email at ",a.jsx("strong",{children:e.captainEmail})]})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-phone"}),a.jsx("span",{children:"Our team will contact you within 24-48 hours"})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-calendar-check"}),a.jsx("span",{children:"Fixture details will be shared before the tournament"})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-id-card"}),a.jsx("span",{children:"Player ID cards will be issued at the venue"})]})]})]}),a.jsxs("div",{className:"complete-contact",children:[a.jsx("p",{children:"Questions? Reach out to us:"}),a.jsxs("div",{className:"contact-links",children:[a.jsxs("a",{href:"mailto:info@sio-abulfazal.org",children:[a.jsx("i",{className:"fas fa-envelope"})," info@sio-abulfazal.org"]}),a.jsxs("a",{href:"https://instagram.com/muqawama2026",target:"_blank",rel:"noopener noreferrer",children:[a.jsx("i",{className:"fab fa-instagram"})," @muqawama2026"]})]})]}),a.jsx("div",{className:"complete-actions",children:a.jsxs("button",{type:"button",className:"primary-btn",onClick:()=>{t(),window.location.href="/muqawamah/2026/"},children:[a.jsx("i",{className:"fas fa-home"})," Back to Tournament Page"]})})]})})}const ne={"open-age":{label:"Open Age",amount:2500,earlyBird:2200,earlyBirdDeadline:"2025-12-15"},u17:{label:"Under 17",amount:2300,earlyBird:2e3,earlyBirdDeadline:"2025-12-15"}};function ie(){const{teamData:e,players:s,setStep:n,loading:i,setLoading:r,error:o,setError:c,existingTeamId:m,setExistingTeamId:d,setSuccessTeamId:u,paymentStatus:h,setPaymentStatus:p}=l(),f=e.category||"open-age",g=ne[f],x=new Date<new Date(g.earlyBirdDeadline),y=x?g.earlyBird:g.amount,j=Math.round(2.5*y/100),N=y+j;return"success"===h?a.jsx(se,{}):a.jsxs("div",{className:"registration-form payment-checkout",children:[a.jsx("h3",{children:"Step 5 Â· Payment"}),a.jsx("p",{className:"step-description",children:"Complete your registration by making the payment."}),a.jsxs("section",{className:"checkout-section",children:[a.jsxs("h4",{children:[a.jsx("i",{className:"fas fa-receipt"})," Order Summary"]}),a.jsxs("div",{className:"order-summary-card",children:[a.jsxs("div",{className:"order-item",children:[a.jsxs("div",{className:"order-item-info",children:[a.jsx("span",{className:"item-name",children:"Team Registration"}),a.jsxs("span",{className:"item-detail",children:[e.teamName," â€¢ ",g.label]})]}),a.jsxs("span",{className:"item-price",children:["â‚¹",g.amount]})]}),x&&a.jsxs("div",{className:"order-item discount",children:[a.jsxs("div",{className:"order-item-info",children:[a.jsx("span",{className:"item-name",children:"ðŸŽ Early Bird Discount"}),a.jsxs("span",{className:"item-detail",children:["Valid until ",new Date(g.earlyBirdDeadline).toLocaleDateString()]})]}),a.jsxs("span",{className:"item-price",children:["-â‚¹",g.amount-g.earlyBird]})]}),a.jsxs("div",{className:"order-item subtotal",children:[a.jsx("span",{className:"item-name",children:"Subtotal"}),a.jsxs("span",{className:"item-price",children:["â‚¹",y]})]}),a.jsxs("div",{className:"order-item fee",children:[a.jsxs("div",{className:"order-item-info",children:[a.jsx("span",{className:"item-name",children:"Payment Gateway Fee"}),a.jsxs("span",{className:"item-detail",children:[2.5,"%"]})]}),a.jsxs("span",{className:"item-price",children:["â‚¹",j]})]}),a.jsxs("div",{className:"order-total",children:[a.jsx("span",{children:"Total Amount"}),a.jsxs("span",{className:"total-price",children:["â‚¹",N]})]})]})]}),a.jsxs("section",{className:"checkout-section",children:[a.jsxs("h4",{children:[a.jsx("i",{className:"fas fa-users"})," Registration Details"]}),a.jsxs("div",{className:"checkout-team-summary",children:[a.jsxs("div",{className:"team-mini-card",children:[e.teamLogo&&a.jsx("img",{src:e.teamLogo,alt:e.teamName,className:"team-mini-logo"}),a.jsxs("div",{className:"team-mini-info",children:[a.jsx("span",{className:"team-mini-name",children:e.teamName}),a.jsxs("span",{className:"team-mini-category",children:[g.label," â€¢ ",s.length," Players"]})]})]}),a.jsxs("div",{className:"captain-info",children:[a.jsxs("span",{children:[a.jsx("i",{className:"fas fa-user"})," ",e.captainName]}),a.jsxs("span",{children:[a.jsx("i",{className:"fas fa-envelope"})," ",e.captainEmail]})]})]})]}),a.jsxs("section",{className:"checkout-section",children:[a.jsxs("h4",{children:[a.jsx("i",{className:"fas fa-credit-card"})," Payment Methods"]}),a.jsxs("div",{className:"payment-methods",children:[a.jsxs("div",{className:"payment-method",children:[a.jsx("i",{className:"fas fa-mobile-alt"}),a.jsx("span",{children:"UPI"})]}),a.jsxs("div",{className:"payment-method",children:[a.jsx("i",{className:"fas fa-credit-card"}),a.jsx("span",{children:"Cards"})]}),a.jsxs("div",{className:"payment-method",children:[a.jsx("i",{className:"fas fa-university"}),a.jsx("span",{children:"Net Banking"})]}),a.jsxs("div",{className:"payment-method",children:[a.jsx("i",{className:"fas fa-wallet"}),a.jsx("span",{children:"Wallets"})]})]}),a.jsxs("p",{className:"payment-secure-note",children:[a.jsx("i",{className:"fas fa-lock"})," Secured by Easebuzz Payment Gateway"]})]}),o&&a.jsx("p",{className:"auth-error",children:o}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"secondary-btn",onClick:()=>n(4),disabled:i,children:"Back to Review"}),a.jsx("button",{type:"button",className:"primary-btn pay-btn",onClick:async()=>{r(!0),c(null);try{const{data:{user:a}}=await t.auth.getUser();if(!a)throw new Error("You must be logged in to proceed with payment.");let n=m;if(m){const{error:a}=await t.from("team_registrations").update({team_name:e.teamName,category:e.category,team_logo:e.teamLogo,captain_name:e.captainName,captain_email:e.captainEmail,captain_phone:e.captainPhone,formation:e.formation,status:"pending_payment",payment_amount:N,submitted_at:(new Date).toISOString()}).eq("id",m);if(a)throw a}else{const{data:s,error:i}=await t.from("team_registrations").insert({user_id:a.id,team_name:e.teamName,category:e.category,team_logo:e.teamLogo,captain_name:e.captainName,captain_email:e.captainEmail,captain_phone:e.captainPhone,formation:e.formation,status:"pending_payment",payment_amount:N,submitted_at:(new Date).toISOString()}).select().single();if(i)throw i;n=s.id,d(n)}await t.from("team_players").delete().eq("team_id",n);const i=s.map(e=>({team_id:n,player_name:e.name,position:e.position,is_substitute:e.isSubstitute,player_image:e.image,position_x:e.x,position_y:e.y})),{error:r}=await t.from("team_players").insert(i);if(r)throw r;const l=`MUQ${Date.now()}${n}`,{data:o,error:c}=await t.functions.invoke("easebuzz-initiate",{body:{txnid:l,amount:N,productinfo:`Muqawama 2026 - ${g.label} Registration`,firstname:e.captainName,email:e.captainEmail,phone:e.captainPhone||"9999999999",teamId:n,category:f}});if(c)throw new Error(c.message||"Failed to initiate payment");if(1!==o.status||!o.payUrl)throw new Error(o.error||"Payment initiation failed");window.location.href=o.payUrl}catch(a){c(a.message)}finally{r(!1)}},disabled:i,children:i?a.jsx(a.Fragment,{children:"Processing..."}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-lock"})," Pay â‚¹",N]})})]}),a.jsxs("p",{className:"terms-note",children:["By proceeding, you agree to our"," ",a.jsx("a",{href:"/muqawamah/terms-and-conditions/",target:"_blank",rel:"noreferrer",children:"Terms & Conditions"})," ","and"," ",a.jsx("a",{href:"/muqawamah/refund-policy/",target:"_blank",rel:"noreferrer",children:"Refund Policy"})]})]})}const re=["GK","CB","LB","RB","CDM","CM","CAM","LM","RM","CF","ST"];function le(){const{players:e,setPlayers:t,setStep:s,saveProgress:n,saving:i,error:r}=l(),o=(e,a,s)=>{t(t=>t.map((t,n)=>n===e?{...t,[a]:s}:t))},c=e.filter(e=>!e.isSubstitute),m=e.filter(e=>e.isSubstitute),d=(e,t)=>a.jsxs("div",{className:"player-card",children:[a.jsxs("label",{children:["Player Name",a.jsx("input",{type:"text",value:e.name,onChange:e=>o(t,"name",e.target.value),placeholder:e.isSubstitute?"Substitute Name":`${e.position} Player`,required:!0})]}),!e.isSubstitute&&a.jsxs("label",{children:["Position",a.jsx("select",{value:e.position,onChange:e=>o(t,"position",e.target.value),children:re.map(e=>a.jsx("option",{value:e,children:e},e))})]}),a.jsxs("label",{className:"file-label",children:["Player Photo",e.image&&a.jsxs("div",{className:"uploaded-photo-preview",children:[a.jsxs("div",{className:"photo-preview-container",children:[a.jsx("img",{src:e.image,alt:"Player photo",className:"photo-preview"}),a.jsx("div",{className:"photo-overlay",children:a.jsx("i",{className:"fas fa-check-circle"})})]}),a.jsxs("div",{className:"uploaded-file-info",children:[a.jsx("i",{className:"fas fa-check-circle"}),a.jsx("span",{children:e.imageFileName?`Uploaded: ${e.imageFileName}`:"Photo uploaded"}),a.jsx("span",{className:"file-change-hint",children:"(Click to change)"})]})]}),a.jsx("input",{type:"file",accept:"image/*",onChange:e=>{var a;return((e,a)=>{if(!a)return;if(a.size>2097152)return void alert("Player photo must be under 2MB");const t=new FileReader;t.onload=t=>{o(e,"image",t.target.result),o(e,"imageFileName",a.name)},t.readAsDataURL(a)})(t,null==(a=e.target.files)?void 0:a[0])}}),!e.image&&a.jsx("span",{className:"input-hint",children:"JPG/PNG up to 2MB. Required."})]})]},e.id);return a.jsxs("form",{className:"registration-form",onSubmit:async e=>{if(e.preventDefault(),!(()=>{const e=c.every(e=>e.name&&e.position&&e.image),a=m.every(e=>e.name&&e.image);return e&&a})())return void alert("Please fill out all player names and upload photos for all players.");(await n(2)).success&&s(3)},children:[a.jsx("h3",{children:"Step 2 Â· Players"}),a.jsx("p",{className:"step-description",children:"Provide 7 main players and 4 substitutes."}),a.jsx("h4",{children:"Main Players"}),a.jsx("div",{className:"players-grid",children:c.map((a,t)=>d(a,e.indexOf(a)))}),a.jsx("h4",{children:"Substitutes"}),a.jsx("div",{className:"players-grid",children:m.map(a=>d(a,e.indexOf(a)))}),r&&a.jsx("p",{className:"auth-error",children:r}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"secondary-btn",onClick:()=>s(1),disabled:i,children:"Back"}),a.jsx("button",{type:"submit",className:"primary-btn",disabled:i,children:i?a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-spinner fa-spin"})," Saving..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-save"})," Save & Continue"]})})]})]})}function oe({readOnly:t=!1}){const{teamData:s,players:n,setStep:i,setPlayers:r,existingTeamId:o}=l(),c=e.useRef(null),[m,d]=e.useState(null);return a.jsxs("div",{className:"registration-form",children:[a.jsxs("h3",{children:["Step 4 Â· Review & ",o?"Update":"Submit"]}),a.jsxs("p",{className:"step-description",children:["Verify everything looks good before ",o?"updating":"submitting"," your team."]}),a.jsxs("section",{className:"summary-section",children:[a.jsx("h4",{children:"Team Information"}),a.jsxs("div",{className:"team-info-card",children:[a.jsxs("div",{className:"team-info-header",children:[a.jsx("div",{className:"team-logo-large",children:s.teamLogo?a.jsx("img",{src:s.teamLogo,alt:`${s.teamName} logo`}):a.jsx("div",{className:"team-logo-placeholder-large",children:a.jsx("i",{className:"fas fa-shield-alt"})})}),a.jsxs("div",{className:"team-info-main",children:[a.jsx("h3",{className:"team-name-display",children:s.teamName}),a.jsxs("span",{className:"team-category-badge",children:[a.jsx("i",{className:"fas fa-trophy"})," ","open-age"===s.category?"Open Age":"Under 17"]})]})]}),a.jsxs("div",{className:"team-info-details",children:[a.jsxs("div",{className:"info-row",children:[a.jsxs("div",{className:"info-item",children:[a.jsx("i",{className:"fas fa-user-tie"}),a.jsxs("div",{className:"info-content",children:[a.jsx("span",{className:"info-label",children:"Captain"}),a.jsx("span",{className:"info-value",children:s.captainName})]})]}),a.jsxs("div",{className:"info-item",children:[a.jsx("i",{className:"fas fa-envelope"}),a.jsxs("div",{className:"info-content",children:[a.jsx("span",{className:"info-label",children:"Email"}),a.jsx("span",{className:"info-value",children:s.captainEmail})]})]})]}),s.captainPhone&&a.jsxs("div",{className:"info-row",children:[a.jsxs("div",{className:"info-item",children:[a.jsx("i",{className:"fas fa-phone"}),a.jsxs("div",{className:"info-content",children:[a.jsx("span",{className:"info-label",children:"Phone"}),a.jsx("span",{className:"info-value",children:s.captainPhone})]})]}),a.jsxs("div",{className:"info-item",children:[a.jsx("i",{className:"fas fa-futbol"}),a.jsxs("div",{className:"info-content",children:[a.jsx("span",{className:"info-label",children:"Formation"}),a.jsx("span",{className:"info-value",children:s.formation})]})]})]}),!s.captainPhone&&a.jsx("div",{className:"info-row",children:a.jsxs("div",{className:"info-item",children:[a.jsx("i",{className:"fas fa-futbol"}),a.jsxs("div",{className:"info-content",children:[a.jsx("span",{className:"info-label",children:"Formation"}),a.jsx("span",{className:"info-value",children:s.formation})]})]})})]})]})]}),a.jsxs("section",{className:"summary-section",children:[a.jsx("h4",{children:"Players"}),a.jsx("div",{className:"player-card-grid",children:n.map((e,t)=>{var n,i;return a.jsxs("div",{className:"player-card-badge simple "+(e.isSubstitute?"substitute":""),children:[a.jsxs("div",{className:"badge-header",children:[a.jsxs("div",{className:"badge-team",children:[a.jsx("div",{className:"team-logo",children:s.teamLogo?a.jsx("img",{src:s.teamLogo,alt:`${s.teamName} logo`}):a.jsx("div",{className:"team-logo-placeholder",children:(null==(i=null==(n=s.teamName)?void 0:n.charAt(0))?void 0:i.toUpperCase())||"T"})}),a.jsxs("div",{className:"team-meta",children:[a.jsx("span",{className:"team-name",children:s.teamName||"Team name"}),a.jsx("span",{className:"player-role",children:e.isSubstitute?"Substitute":e.position||"Player"})]})]}),a.jsx("div",{className:"muqawama-logo",children:a.jsx("img",{src:"/assets/img/MuqawamaLogo.png",alt:"Muqawama 2026"})})]}),a.jsx("div",{className:"badge-photo",children:e.image?a.jsx("img",{src:e.image,alt:e.name||e.position}):a.jsx("div",{className:"badge-photo-placeholder",children:a.jsx("i",{className:"fas fa-user"})})}),a.jsx("div",{className:"badge-player-info",children:a.jsx("span",{className:"player-name",children:e.name||"Unnamed Player"})})]},e.id||t)})})]}),a.jsxs("section",{className:"summary-section",children:[a.jsx("h4",{children:"Formation Preview"}),a.jsx("div",{ref:c,children:a.jsx(Z,{players:n.filter(e=>!e.isSubstitute),editable:!t,onDragStart:(e,a)=>{d(a)},onDrag:e=>{if(!m||!c.current)return;e.preventDefault();const a=c.current.getBoundingClientRect(),t=e.touches?e.touches[0].clientX:e.clientX,s=e.touches?e.touches[0].clientY:e.clientY,n=(t-a.left)/a.width*100,i=(s-a.top)/a.height*100;var l,o,d;l=m,o=Math.min(Math.max(n,0),100),d=Math.min(Math.max(i,0),100),r(e=>e.map(e=>e.id===l?{...e,x:o,y:d}:e))},onDragEnd:()=>{d(null)},showDownload:!0})})]}),!t&&a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"secondary-btn",onClick:()=>i(3),children:"Back"}),a.jsx("button",{type:"button",className:"primary-btn",onClick:()=>{i(5)},children:"Proceed to Payment"})]})]})}const ce=[{value:"open-age",label:"Open Age"},{value:"u17",label:"Under 17"}];function me(){const{teamData:t,setTeamData:s,setStep:n,saveProgress:i,saving:r,error:o}=l(),c=e.useRef(null),m=e=>{const{name:a,value:t}=e.target;s(e=>({...e,[a]:t}))};return a.jsxs("form",{className:"registration-form",onSubmit:async e=>{var a;if(e.preventDefault(),!t.teamLogo)return void alert("Please upload a team logo");if(10!==((null==(a=t.captainPhone)?void 0:a.replace(/\s/g,""))||"").length)return void alert("Please enter a valid 10-digit mobile number");(await i(1)).success&&n(2)},children:[a.jsx("h3",{children:"Step 1 Â· Team Details"}),a.jsx("p",{className:"step-description",children:"Tell us about your team and captain information."}),a.jsxs("label",{children:["Team Name",a.jsx("input",{type:"text",name:"teamName",value:t.teamName,onChange:m,placeholder:"e.g., Rising Stars",required:!0})]}),a.jsxs("label",{children:["Category",a.jsx("select",{name:"category",value:t.category,onChange:m,children:ce.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))})]}),a.jsxs("label",{className:"file-label",children:["Team Logo",t.teamLogo&&a.jsxs("div",{className:"uploaded-photo-preview",children:[a.jsxs("div",{className:"photo-preview-container",children:[a.jsx("img",{src:t.teamLogo,alt:"Team logo",className:"photo-preview"}),a.jsx("div",{className:"photo-overlay",children:a.jsx("i",{className:"fas fa-check-circle"})})]}),a.jsxs("div",{className:"uploaded-file-info",children:[a.jsx("i",{className:"fas fa-check-circle"}),a.jsx("span",{children:t.teamLogoFileName?`Uploaded: ${t.teamLogoFileName}`:"Logo uploaded"}),a.jsx("span",{className:"file-change-hint",children:"(Click to change)"})]})]}),a.jsx("input",{type:"file",accept:"image/*",ref:c,onChange:e=>{var a;const t=null==(a=e.target.files)?void 0:a[0];if(!t)return;if(t.size>2097152)return alert("Logo size must be under 2MB"),void(c.current.value="");const n=new FileReader;n.onload=e=>{s(a=>({...a,teamLogo:e.target.result,teamLogoFileName:t.name}))},n.readAsDataURL(t)}}),!t.teamLogo&&a.jsx("span",{className:"input-hint",children:"JPG/PNG up to 2MB. Displayed across the tournament site."})]}),a.jsxs("label",{children:["Preferred Formation",a.jsx("select",{name:"formation",value:t.formation,onChange:m,children:ee.map(e=>a.jsx("option",{value:e,children:e},e))}),a.jsx("span",{className:"input-hint",children:"This will be the starting layout in Step 3. You can still adjust players later."})]}),a.jsxs("div",{className:"grid-2",children:[a.jsxs("label",{children:["Captain Name",a.jsx("input",{type:"text",name:"captainName",value:t.captainName,onChange:m,required:!0})]}),a.jsxs("label",{children:["Captain Email",a.jsx("input",{type:"email",name:"captainEmail",value:t.captainEmail,onChange:m,required:!0})]})]}),a.jsxs("label",{children:["Captain Phone",a.jsx("input",{type:"tel",name:"captainPhone",value:t.captainPhone||"",onChange:e=>{const a=e.target.value.replace(/\D/g,"");let t="";a&&(t=a.length<=5?a:`${a.slice(0,5)} ${a.slice(5,10)}`),s(e=>({...e,captainPhone:t}))},placeholder:"98765 43210",pattern:"[0-9\\s]{10,12}",maxLength:11,onInvalid:e=>{var a;const s=e.target;((null==(a=t.captainPhone)?void 0:a.replace(/\s/g,""))||"").length<10?s.setCustomValidity("Please enter a valid 10-digit mobile number"):s.setCustomValidity("")},onInput:e=>{e.target.setCustomValidity("")},required:!0}),a.jsxs("span",{className:"input-hint",children:[a.jsx("i",{className:"fas fa-info-circle"})," 10-digit mobile number (e.g., 98765 43210)"]})]}),o&&a.jsx("p",{className:"auth-error",children:o}),a.jsx("div",{className:"form-actions",children:a.jsx("button",{type:"submit",className:"primary-btn",disabled:r,children:r?a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-spinner fa-spin"})," Saving..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-save"})," Save & Continue"]})})})]})}const de=[{id:1,label:"Team"},{id:2,label:"Players"},{id:3,label:"Formation"},{id:4,label:"Review"},{id:5,label:"Payment"},{id:6,label:"Complete"}];function ue(){const{step:e}=l(),t=de.slice(0,5);return 6===e?null:a.jsx("div",{className:"registration-stepper",children:t.map((t,s)=>a.jsxs("div",{className:`step ${e===t.id?"active":""} ${e>t.id?"complete":""}`,children:[a.jsx("span",{className:"step-number",children:s+1}),a.jsx("span",{className:"step-label",children:t.label})]},t.id))})}function he(){const{step:n,setStep:r,setTeamData:m,setPlayers:d,setExistingTeamId:u,readOnlyMode:h,setReadOnlyMode:p,resetForm:f,existingTeamId:g,setPaymentStatus:x,setLastSavedStep:y}=l(),[j,N]=e.useState(null),[v,w]=e.useState(!0),[b,S]=e.useState(""),[P,C]=e.useState(!1),E=s.useRef(!1);e.useEffect(()=>{const e=new URLSearchParams(window.location.search).get("payment");"success"===e?(x("success"),r(5),window.history.replaceState({},"",window.location.pathname)):"failed"===e&&(x("failed"),r(5),window.history.replaceState({},"",window.location.pathname))},[]),e.useEffect(()=>{let e=!0;S("");const a=setTimeout(()=>{e&&w(!1)},500);(async()=>{try{window.localStorage.getItem("sb-uzieoxfqkglcoistswxq-auth-token");const{data:s,error:n}=await Promise.race([t.auth.getUser(),new Promise((e,a)=>setTimeout(()=>a(new Error("getUser timeout")),2e3))]);if(!e)return;if(clearTimeout(a),n){if("getUser timeout"===n.message)return N(null),f(),void w(!1);if("Auth session missing!"!==n.message)throw n}const i=(null==s?void 0:s.user)??null;N(i),i?_(i,{force:!0}).catch(e=>{}):f()}catch(s){e&&(N(null),f())}finally{e&&w(!1)}})();const{data:s}=t.auth.onAuthStateChange(async(e,a)=>{const t=(null==a?void 0:a.user)??null;N(t),t?"SIGNED_IN"===e&&await _(t,{force:!0}):(f(),r(1),E.current=!1)});return()=>{e=!1,clearTimeout(a),s.subscription.unsubscribe()}},[]);const _=async(e,{force:a=!1}={})=>{if(!E.current||a){E.current=!0,C(!0),S("");try{const{data:a,error:s}=await t.from("team_registrations").select("*, team_players(*)").eq("user_id",e.id).maybeSingle();if(s&&"PGRST116"!==s.code)throw s;if(a){u(a.id),p(!1),m({teamName:a.team_name||"",category:a.category||"open-age",teamLogo:a.team_logo,captainName:a.captain_name||"",captainEmail:a.captain_email||e.email||"",captainPhone:a.captain_phone?a.captain_phone.replace(/^\+91\s?/,"").trim():"",formation:a.formation||"1-3-2-1"});const t=a.team_players&&a.team_players.length>0?a.team_players.map((e,a)=>({id:e.id||`player-${a}`,name:e.player_name||"",position:e.position||"SUB",isSubstitute:e.is_substitute,image:e.player_image,x:e.position_x??50,y:e.position_y??50})):o();if(d(t),"confirmed"===a.status)x("success"),r(6);else if("pending_payment"===a.status)r(4);else{const e=a.last_saved_step||1;y(e);r(e>=3?4:e+1)}}else u(null),p(!1),m({...c,captainEmail:e.email||""}),d(o()),r(1)}catch(s){S("Could not load your saved registration. You can continue and submitting will overwrite the previous data."),u(null),p(!1),m({...c,captainEmail:e.email||""}),d(o()),r(1)}finally{C(!1)}}};if(v)return a.jsx("div",{className:"loading-screen",children:a.jsxs("div",{className:"loading-content",children:[a.jsxs("div",{className:"logo-loader",children:[a.jsx("div",{className:"logo-ring"}),a.jsx("img",{src:"/assets/img/MuqawamaLogo.png",alt:"Muqawama",className:"logo-pulse"})]}),a.jsx("p",{children:"Loading your registration..."})]})});return j?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"header-actions",children:[a.jsx("span",{className:"user-email",children:j.email}),a.jsxs("button",{type:"button",className:"logout-btn",onClick:async()=>{await t.auth.signOut(),N(null),r(1)},children:[a.jsx("i",{className:"fas fa-sign-out-alt"})," Logout"]})]}),a.jsx("div",{className:"registration-header",children:a.jsxs("div",{className:"registration-header-logo",children:[a.jsx("img",{src:"/assets/img/title.png",alt:"Muqawama 2026"}),a.jsx("h2",{className:"registration-header-title",children:"Team Registration"}),a.jsx("p",{children:g?"Edit your team registration and update any details.":"Complete all steps to confirm your team registration."})]})}),P&&a.jsx("p",{className:"auth-message subtle",children:"Loading your saved registrationâ€¦"}),b&&a.jsx("p",{className:"auth-error",children:b}),a.jsx(ue,{}),(()=>{switch(n){case 1:default:return a.jsx(me,{});case 2:return a.jsx(le,{});case 3:return a.jsx(te,{});case 4:return a.jsx(oe,{});case 5:return a.jsx(ie,{});case 6:return a.jsx(se,{})}})()]}):a.jsx(i,{onSuccess:N})}function pe(){return e.useEffect(()=>(document.body.classList.add("registration-body"),()=>document.body.classList.remove("registration-body")),[]),a.jsx(m,{children:a.jsx("div",{className:"registration-container",children:a.jsx(he,{})})})}n.createRoot(document.getElementById("registration-root")).render(a.jsx(s.StrictMode,{children:a.jsx(pe,{})}));
