import{R as e,j as t,r as i}from"./supabaseClient-y7L7r4ir.js";import{t as a}from"./index-cwrHH8V6.js";const o=e.forwardRef(({children:e,...i},a)=>t.jsxs("svg",{ref:a,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 74 111",className:"field-svg",...i,children:[t.jsx("rect",{width:"74",height:"111",fill:"#ffffff"}),t.jsxs("g",{fill:"none",stroke:"#000",strokeWidth:"0.5",transform:"translate(3 3)",children:[t.jsx("path",{d:"M 0 0 h 68 v 105 h -68 Z"}),t.jsx("path",{d:"M 0 52.5 h 68"}),t.jsx("circle",{r:"9.15",cx:"34",cy:"52.5"}),t.jsx("circle",{r:"0.75",cx:"34",cy:"52.5",fill:"#000",stroke:"none"}),t.jsxs("g",{children:[t.jsx("path",{d:"M 13.84 0 v 16.5 h 40.32 v -16.5"}),t.jsx("path",{d:"M 24.84 0 v 5.5 h 18.32 v -5.5"}),t.jsx("circle",{r:"0.75",cx:"34",cy:"10.94",fill:"#000",stroke:"none"}),t.jsx("path",{d:"M 26.733027 16.5 a 9.15 9.15 0 0 0 14.533946 0"})]}),t.jsxs("g",{transform:"rotate(180,34,52.5)",children:[t.jsx("path",{d:"M 13.84 0 v 16.5 h 40.32 v -16.5"}),t.jsx("path",{d:"M 24.84 0 v 5.5 h 18.32 v -5.5"}),t.jsx("circle",{r:"0.75",cx:"34",cy:"10.94",fill:"#000",stroke:"none"}),t.jsx("path",{d:"M 26.733027 16.5 a 9.15 9.15 0 0 0 14.533946 0"})]}),t.jsx("path",{d:"M 0 2 a 2 2 0 0 0 2 -2M 66 0 a 2 2 0 0 0 2 2M 68 103 a 2 2 0 0 0 -2 2M 2 105 a 2 2 0 0 0 -2 -2"})]}),e]}));function n({players:e,editable:n=!1,onDragStart:r,onDrag:s,onDragEnd:l,showDownload:c=!1}){const d=i.useRef(null),h=i.useRef(null),[f,x]=i.useState(!1),[m,p]=i.useState(null),u=i.useMemo(()=>`muqawamah-formation-${(new Date).toISOString().split("T")[0]}.png`,[]),g=()=>{m&&(p(null),l&&l())};return t.jsxs("div",{className:"formation-preview-wrapper",children:[t.jsx("div",{className:"football-field-svg",ref:d,onMouseMove:e=>{m&&n&&d.current&&(e.preventDefault(),s&&s(e))},onMouseUp:g,onMouseLeave:g,onTouchMove:e=>{m&&n&&d.current&&(e.preventDefault(),s&&s(e))},onTouchEnd:()=>{m&&(p(null),l&&l())},children:t.jsxs(o,{ref:h,style:{width:"100%",height:"auto",maxWidth:"400px",display:"block",margin:"0 auto"},children:[t.jsx("defs",{children:e.map(e=>t.jsx("clipPath",{id:`player-clip-${e.id}`,children:t.jsx("circle",{r:"3.3",cx:"0",cy:"0"})},`clip-${e.id}`))}),e.map(e=>{const i=3+("number"!=typeof e.x||isNaN(e.x)?50:e.x)/100*68,a=3+("number"!=typeof e.y||isNaN(e.y)?50:e.y)/100*105,o="GK"===e.position,s=n&&!o;return t.jsxs("g",{transform:`translate(${i}, ${a})`,className:s?"player-marker-draggable":"player-marker-static",style:{cursor:s?"move":"default"},onMouseDown:t=>((e,t)=>{n&&"GK"!==t.position&&(e.preventDefault(),p(t.id),r&&r(e,t.id))})(t,e),onTouchStart:t=>((e,t)=>{n&&"GK"!==t.position&&(p(t.id),r&&r(e,t.id))})(t,e),children:[t.jsx("circle",{r:"3.3",fill:o?"#2d5a27":"#4a90e2",stroke:o?"#4a8c3f":"#fff",strokeWidth:"0.5"}),o&&t.jsx("text",{x:"0",y:"-4.5",textAnchor:"middle",fill:"#4a8c3f",fontSize:"2",children:"ðŸ”’"}),e.image?t.jsx("image",{href:e.image,x:"-3.3",y:"-3.3",width:"6.6",height:"6.6",clipPath:`url(#player-clip-${e.id})`,preserveAspectRatio:"xMidYMid slice"}):t.jsx("text",{x:"0",y:"1.1",textAnchor:"middle",fill:"#fff",fontSize:"2.75",fontWeight:"600",children:e.position}),t.jsx("text",{x:"0",y:"6",textAnchor:"middle",fill:"#000",fontSize:"2",fontWeight:"600",children:e.name||"Player"}),t.jsx("text",{x:"0",y:"8.2",textAnchor:"middle",fill:"#666",fontSize:"1.65",fontWeight:"400",children:e.position})]},e.id)})]})}),c&&t.jsxs("button",{type:"button",className:"download-formation-btn",onClick:async()=>{if(d.current)try{x(!0);const e=await a(d.current,{cacheBust:!0,pixelRatio:window.devicePixelRatio||2,backgroundColor:"#ffffff"}),t=document.createElement("a");t.download=u,t.href=e,t.click()}catch(e){alert("Unable to download formation right now. Please try again.")}finally{x(!1)}},disabled:f,children:[t.jsx("i",{className:"fas fa-download"}),t.jsx("span",{children:f?"Preparing...":"Download Formation"})]})]})}o.displayName="FootballFieldSVG";const r=["1-3-2-1","1-2-3-1","1-2-2-2","1-3-1-2","1-4-1-1"],s=85,l=100,c=(e,t)=>"GK"===e?Math.max(s,Math.min(l,t)):Math.max(0,Math.min(100,t)),d={GK:50,CB:50,LB:25,RB:75,CDM:50,CM:50,CAM:50,LM:20,RM:80,CF:50,ST:50},h={GK:92,CB:78,LB:78,RB:78,CDM:65,CM:55,CAM:45,LM:55,RM:55,CF:30,ST:25},f=e=>{const t=[...e],i=e.filter(e=>!e.isSubstitute),a={};return i.forEach(i=>{const o=i.position,n=a[o]||0;let r=d[o]||50,s=h[o]||50;n>0&&("CB"===o||"CM"===o||"ST"===o||"CF"===o?r=1===n?30:2===n?70:50:"LB"===o?r=20-5*n:"RB"===o&&(r=80+5*n)),a[o]=n+1;const l=e.indexOf(i);t[l]={...i,x:r,y:s}}),t},x=(e,t)=>{if(!t)return f(e);const i=t.split("-").map(e=>parseInt(e,10)).filter(e=>!isNaN(e));if(0===i.length)return f(e);const a=[...e],o=[...e.filter(e=>!e.isSubstitute)].sort((e,t)=>"GK"===e.position?-1:"GK"===t.position?1:0),n=[92,78,55,35,15];let r=0;return i.forEach((t,i)=>{const s=n[i]||50;for(let n=0;n<t&&!(r>=o.length);n++){const i=o[r];let l;if(1===t)l=50;else if(2===t)l=0===n?30:70;else if(3===t)l=0===n?20:1===n?50:80;else if(4===t)l=[15,35,65,85][n];else if(5===t)l=[10,27.5,50,72.5,90][n];else{l=100/(t+1)*(n+1)}const d=c(i.position,s),h=e.indexOf(i);a[h]={...i,x:l,y:d},r++}}),a};async function m(e,t={}){const{maxWidth:i=800,maxHeight:a=800,quality:o=.8,outputFormat:n="image/webp"}=t;return new Promise((t,r)=>{const s=new FileReader;s.onerror=()=>r(new Error("Failed to read file")),s.onload=s=>{const l=new Image;l.onerror=()=>r(new Error("Failed to load image")),l.onload=()=>{try{let{width:r,height:s}=l;if(r>i||s>a){const e=Math.min(i/r,a/s);r=Math.floor(r*e),s=Math.floor(s*e)}const c=document.createElement("canvas");c.width=r,c.height=s;const d=c.getContext("2d");d.imageSmoothingEnabled=!0,d.imageSmoothingQuality="high",d.drawImage(l,0,0,r,s);const h=c.toDataURL(n,o);Math.round(e.size/1024),p(h);t(h)}catch(s){r(new Error("Failed to compress image: "+s.message))}},l.src=s.target.result},s.readAsDataURL(e)})}function p(e){const t=e.length-(e.indexOf(",")+1);return Math.round(.75*t/1024)}export{n as F,x as a,m as c,p as g,r as p};
