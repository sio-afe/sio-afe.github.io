import{r as e,j as a,s,R as t,c as n}from"./supabaseClient-BTiblPWy.js";import{c as i,g as r}from"./imageCompression-_fTZQlz7.js";/* empty css            */import"./supabase-client-DmFmBHmJ.js";function l({onSuccess:t}){const[n,i]=e.useState(""),[r,l]=e.useState(!1);return a.jsx("div",{className:"auth-modal",children:a.jsxs("div",{className:"auth-card",children:[a.jsx("div",{className:"auth-logo",children:a.jsx("img",{src:"/assets/img/title.png",alt:"Muqawama 2026"})}),a.jsx("h2",{children:"Welcome to Muqawama 2026"}),a.jsx("p",{className:"auth-subtitle",children:"Sign in with your Google account to register your team and manage your registration."}),n&&a.jsx("p",{className:"auth-error",children:n}),a.jsx("div",{className:"auth-alternative",children:a.jsx("button",{type:"button",className:"auth-oauth-btn google-btn",onClick:async()=>{i(""),l(!0);try{const{data:e,error:a}=await s.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.origin+"/muqawamah/2026/register/"}});if(a)throw a}catch(e){i(`Google sign-in failed: ${e.message}. Please contact support.`),l(!1)}},disabled:r,children:r?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"spinner-small"})," Signing in..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fab fa-google"})," Continue with Google"]})})}),a.jsxs("p",{className:"auth-note",children:[a.jsx("i",{className:"fas fa-info-circle"})," Your Google account will be used to authenticate and save your team registration."]})]})})}const o=e.createContext(null),c=()=>{const a=e.useContext(o);if(!a)throw new Error("useRegistration must be used within RegistrationProvider");return a},m=()=>[...["GK","CB","LB","RB","CM","LM","ST"].map((e,a)=>({id:`${e}-${a}`,name:"",age:"",aadhar_no:"",position:e,isSubstitute:!1,image:null,x:50,y:50})),...["SUB1","SUB2","SUB3","SUB4"].map((e,a)=>({id:`${e}-${a}`,name:"",age:"",aadhar_no:"",position:"SUB",isSubstitute:!0,image:null,x:10+20*a,y:90}))],d={teamName:"",category:"open-age",teamLogo:null,teamLogoFileName:null,captainName:"",captainEmail:"",captainPhone:"",formation:"1-3-2-1"},u=({children:t})=>{const[n,i]=e.useState(1),[r,l]=e.useState(d),[c,u]=e.useState(m()),[h,p]=e.useState(!1),[f,g]=e.useState(!1),[x,j]=e.useState(null),[y,N]=e.useState(null),[v,b]=e.useState(null),[w,S]=e.useState(!1),[P,C]=e.useState(null),[_,k]=e.useState(null),[E,M]=e.useState(0),T=()=>{l(d),u(m()),N(null),b(null),C(null),k(null),M(0),i(1)},R=e.useCallback(async e=>{g(!0),j(null);try{const{data:{user:a}}=await s.auth.getUser();if(!a)throw new Error("You must be logged in to save your progress.");let t=v;const n={user_id:a.id,team_name:r.teamName||"Draft Team",category:r.category,team_logo:r.teamLogo,captain_name:r.captainName,captain_email:r.captainEmail||a.email,captain_phone:r.captainPhone,formation:r.formation,status:"submitted",last_saved_step:e,submitted_at:(new Date).toISOString()};if(v){const{error:e}=await s.from("team_registrations").update(n).eq("id",v);if(e)throw e}else{const{data:e,error:a}=await s.from("team_registrations").insert(n).select().single();if(a)throw a;t=e.id,b(t)}const i=c.filter(e=>e.name&&""!==e.name.trim());if(i.length>0&&t){await s.from("team_players").delete().eq("team_id",t);const e=i.map(e=>({team_id:t,player_name:e.name,player_age:e.age?parseInt(e.age):null,aadhar_no:e.aadhar_no||null,position:e.position||"SUB",is_substitute:e.isSubstitute||!1,player_image:e.image||null,position_x:"number"!=typeof e.x||isNaN(e.x)?50:e.x,position_y:"number"!=typeof e.y||isNaN(e.y)?50:e.y})),{error:a}=await s.from("team_players").insert(e);if(a)throw a}return M(e),{success:!0,teamId:t}}catch(a){return j(a.message),{success:!1,error:a.message}}finally{g(!1)}},[v,r,c]),L=e.useMemo(()=>({step:n,setStep:i,teamData:r,setTeamData:l,players:c,setPlayers:u,loading:h,setLoading:p,saving:f,setSaving:g,error:x,setError:j,successTeamId:y,setSuccessTeamId:N,existingTeamId:v,setExistingTeamId:b,readOnlyMode:w,setReadOnlyMode:S,paymentStatus:P,setPaymentStatus:C,transactionId:_,setTransactionId:k,lastSavedStep:E,setLastSavedStep:M,resetForm:T,saveProgress:R}),[n,r,c,h,f,x,y,v,w,P,_,E,R]);return a.jsx(o.Provider,{value:L,children:t})};const h=(()=>{let e=0;return()=>(e+=1,`u${`0000${(Math.random()*36**4|0).toString(36)}`.slice(-4)}${e}`)})();function p(e){const a=[];for(let s=0,t=e.length;s<t;s++)a.push(e[s]);return a}let f=null;function g(e={}){return f||(e.includeStyleProperties?(f=e.includeStyleProperties,f):(f=p(window.getComputedStyle(document.documentElement)),f))}function x(e,a){const s=(e.ownerDocument.defaultView||window).getComputedStyle(e).getPropertyValue(a);return s?parseFloat(s.replace("px","")):0}function j(e,a={}){return{width:a.width||function(e){const a=x(e,"border-left-width"),s=x(e,"border-right-width");return e.clientWidth+a+s}(e),height:a.height||function(e){const a=x(e,"border-top-width"),s=x(e,"border-bottom-width");return e.clientHeight+a+s}(e)}}const y=16384;function N(e){return new Promise((a,s)=>{const t=new Image;t.onload=()=>{t.decode().then(()=>{requestAnimationFrame(()=>a(t))})},t.onerror=s,t.crossOrigin="anonymous",t.decoding="async",t.src=e})}async function v(e,a,s){const t="http://www.w3.org/2000/svg",n=document.createElementNS(t,"svg"),i=document.createElementNS(t,"foreignObject");return n.setAttribute("width",`${a}`),n.setAttribute("height",`${s}`),n.setAttribute("viewBox",`0 0 ${a} ${s}`),i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("externalResourcesRequired","true"),n.appendChild(i),i.appendChild(e),async function(e){return Promise.resolve().then(()=>(new XMLSerializer).serializeToString(e)).then(encodeURIComponent).then(e=>`data:image/svg+xml;charset=utf-8,${e}`)}(n)}const b=(e,a)=>{if(e instanceof a)return!0;const s=Object.getPrototypeOf(e);return null!==s&&(s.constructor.name===a.name||b(s,a))};function w(e,a,s,t){const n=`.${e}:${a}`,i=s.cssText?function(e){const a=e.getPropertyValue("content");return`${e.cssText} content: '${a.replace(/'|"/g,"")}';`}(s):function(e,a){return g(a).map(a=>`${a}: ${e.getPropertyValue(a)}${e.getPropertyPriority(a)?" !important":""};`).join(" ")}(s,t);return document.createTextNode(`${n}{${i}}`)}function S(e,a,s,t){const n=window.getComputedStyle(e,s),i=n.getPropertyValue("content");if(""===i||"none"===i)return;const r=h();try{a.className=`${a.className} ${r}`}catch(o){return}const l=document.createElement("style");l.appendChild(w(r,s,n,t)),a.appendChild(l)}const P="application/font-woff",C="image/jpeg",_={woff:P,woff2:P,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:C,jpeg:C,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function k(e){const a=function(e){const a=/\.([^./]*?)$/g.exec(e);return a?a[1]:""}(e).toLowerCase();return _[a]||""}function E(e){return-1!==e.search(/^(data:)/)}async function M(e,a,s){const t=await fetch(e,a);if(404===t.status)throw new Error(`Resource "${t.url}" not found`);const n=await t.blob();return new Promise((e,a)=>{const i=new FileReader;i.onerror=a,i.onloadend=()=>{try{e(s({res:t,result:i.result}))}catch(n){a(n)}},i.readAsDataURL(n)})}const T={};async function R(e,a,s){const t=function(e,a,s){let t=e.replace(/\?.*/,"");return s&&(t=e),/ttf|otf|eot|woff2?/i.test(t)&&(t=t.replace(/.*\//,"")),a?`[${a}]${t}`:t}(e,a,s.includeQueryParams);if(null!=T[t])return T[t];let n;s.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime());try{const t=await M(e,s.fetchRequestInit,({res:e,result:s})=>(a||(a=e.headers.get("Content-Type")||""),function(e){return e.split(/,/)[1]}(s)));n=function(e,a){return`data:${a};base64,${e}`}(t,a)}catch(i){n=s.imagePlaceholder||"";let a=`Failed to fetch resource: ${e}`;i&&(a="string"==typeof i?i:i.message)}return T[t]=n,n}async function L(e,a){return b(e,HTMLCanvasElement)?async function(e){const a=e.toDataURL();return"data:,"===a?e.cloneNode(!1):N(a)}(e):b(e,HTMLVideoElement)?async function(e,a){if(e.currentSrc){const a=document.createElement("canvas"),s=a.getContext("2d");return a.width=e.clientWidth,a.height=e.clientHeight,null==s||s.drawImage(e,0,0,a.width,a.height),N(a.toDataURL())}const s=e.poster,t=k(s);return N(await R(s,t,a))}(e,a):b(e,HTMLIFrameElement)?async function(e,a){var s;try{if(null===(s=null==e?void 0:e.contentDocument)||void 0===s?void 0:s.body)return await D(e.contentDocument.body,a,!0)}catch(t){}return e.cloneNode(!1)}(e,a):e.cloneNode(q(e))}const $=e=>null!=e.tagName&&"SLOT"===e.tagName.toUpperCase(),q=e=>null!=e.tagName&&"SVG"===e.tagName.toUpperCase();function F(e,a,s){return b(a,Element)&&(function(e,a,s){const t=a.style;if(!t)return;const n=window.getComputedStyle(e);n.cssText?(t.cssText=n.cssText,t.transformOrigin=n.transformOrigin):g(s).forEach(s=>{let i=n.getPropertyValue(s);if("font-size"===s&&i.endsWith("px")){const e=Math.floor(parseFloat(i.substring(0,i.length-2)))-.1;i=`${e}px`}b(e,HTMLIFrameElement)&&"display"===s&&"inline"===i&&(i="block"),"d"===s&&a.getAttribute("d")&&(i=`path(${a.getAttribute("d")})`),t.setProperty(s,i,n.getPropertyPriority(s))})}(e,a,s),function(e,a,s){S(e,a,":before",s),S(e,a,":after",s)}(e,a,s),function(e,a){b(e,HTMLTextAreaElement)&&(a.innerHTML=e.value),b(e,HTMLInputElement)&&a.setAttribute("value",e.value)}(e,a),function(e,a){if(b(e,HTMLSelectElement)){const s=a,t=Array.from(s.children).find(a=>e.value===a.getAttribute("value"));t&&t.setAttribute("selected","")}}(e,a)),a}async function D(e,a,s){return s||!a.filter||a.filter(e)?Promise.resolve(e).then(e=>L(e,a)).then(s=>async function(e,a,s){var t,n;if(q(a))return a;let i=[];return i=$(e)&&e.assignedNodes?p(e.assignedNodes()):b(e,HTMLIFrameElement)&&(null===(t=e.contentDocument)||void 0===t?void 0:t.body)?p(e.contentDocument.body.childNodes):p((null!==(n=e.shadowRoot)&&void 0!==n?n:e).childNodes),0===i.length||b(e,HTMLVideoElement)||await i.reduce((e,t)=>e.then(()=>D(t,s)).then(e=>{e&&a.appendChild(e)}),Promise.resolve()),a}(e,s,a)).then(s=>F(e,s,a)).then(e=>async function(e,a){const s=e.querySelectorAll?e.querySelectorAll("use"):[];if(0===s.length)return e;const t={};for(let i=0;i<s.length;i++){const n=s[i].getAttribute("xlink:href");if(n){const s=e.querySelector(n),i=document.querySelector(n);s||!i||t[n]||(t[n]=await D(i,a,!0))}}const n=Object.values(t);if(n.length){const a="http://www.w3.org/1999/xhtml",s=document.createElementNS(a,"svg");s.setAttribute("xmlns",a),s.style.position="absolute",s.style.width="0",s.style.height="0",s.style.overflow="hidden",s.style.display="none";const t=document.createElementNS(a,"defs");s.appendChild(t);for(let e=0;e<n.length;e++)t.appendChild(n[e]);e.appendChild(s)}return e}(e,a)):null}const I=/url\((['"]?)([^'"]+?)\1\)/g,A=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,U=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;async function O(e,a,s,t,n){try{const i=s?function(e,a){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;const s=document.implementation.createHTMLDocument(),t=s.createElement("base"),n=s.createElement("a");return s.head.appendChild(t),s.body.appendChild(n),a&&(t.href=a),n.href=e,n.href}(a,s):a,r=k(a);let l;return n||(l=await R(i,r,t)),e.replace(function(e){const a=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${a})(['"]?\\))`,"g")}(a),`$1${l}$3`)}catch(i){}return e}function B(e){return-1!==e.search(I)}async function G(e,a,s){if(!B(e))return e;const t=function(e,{preferredFontFormat:a}){return a?e.replace(U,e=>{for(;;){const[s,,t]=A.exec(e)||[];if(!t)return"";if(t===a)return`src: ${s};`}}):e}(e,s),n=function(e){const a=[];return e.replace(I,(e,s,t)=>(a.push(t),e)),a.filter(e=>!E(e))}(t);return n.reduce((e,t)=>e.then(e=>O(e,t,a,s)),Promise.resolve(t))}async function H(e,a,s){var t;const n=null===(t=a.style)||void 0===t?void 0:t.getPropertyValue(e);if(n){const t=await G(n,null,s);return a.style.setProperty(e,t,a.style.getPropertyPriority(e)),!0}return!1}async function z(e,a){b(e,Element)&&(await async function(e,a){await H("background",e,a)||await H("background-image",e,a),await H("mask",e,a)||await H("-webkit-mask",e,a)||await H("mask-image",e,a)||await H("-webkit-mask-image",e,a)}(e,a),await async function(e,a){const s=b(e,HTMLImageElement);if((!s||E(e.src))&&(!b(e,SVGImageElement)||E(e.href.baseVal)))return;const t=s?e.src:e.href.baseVal,n=await R(t,k(t),a);await new Promise((t,i)=>{e.onload=t,e.onerror=a.onImageErrorHandler?(...e)=>{try{t(a.onImageErrorHandler(...e))}catch(s){i(s)}}:i;const r=e;r.decode&&(r.decode=t),"lazy"===r.loading&&(r.loading="eager"),s?(e.srcset="",e.src=n):e.href.baseVal=n})}(e,a),await async function(e,a){const s=p(e.childNodes).map(e=>z(e,a));await Promise.all(s).then(()=>e)}(e,a))}const V={};async function W(e){let a=V[e];if(null!=a)return a;const s=await fetch(e);return a={url:e,cssText:await s.text()},V[e]=a,a}async function Y(e,a){let s=e.cssText;const t=/url\(["']?([^"')]+)["']?\)/g,n=(s.match(/url\([^)]+\)/g)||[]).map(async n=>{let i=n.replace(t,"$1");return i.startsWith("https://")||(i=new URL(i,e.url).href),M(i,a.fetchRequestInit,({result:e})=>(s=s.replace(n,`url(${e})`),[n,e]))});return Promise.all(n).then(()=>s)}function K(e){if(null==e)return[];const a=[];let s=e.replace(/(\/\*[\s\S]*?\*\/)/gi,"");const t=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const e=t.exec(s);if(null===e)break;a.push(e[0])}s=s.replace(t,"");const n=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,i=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let e=n.exec(s);if(null===e){if(e=i.exec(s),null===e)break;n.lastIndex=i.lastIndex}else i.lastIndex=n.lastIndex;a.push(e[0])}return a}async function J(e,a){if(null==e.ownerDocument)throw new Error("Provided element is not within a Document");const s=p(e.ownerDocument.styleSheets),t=await async function(e,a){const s=[],t=[];return e.forEach(s=>{if("cssRules"in s)try{p(s.cssRules||[]).forEach((e,n)=>{if(e.type===CSSRule.IMPORT_RULE){let i=n+1;const r=W(e.href).then(e=>Y(e,a)).then(e=>K(e).forEach(e=>{try{s.insertRule(e,e.startsWith("@import")?i+=1:s.cssRules.length)}catch(a){}})).catch(e=>{});t.push(r)}})}catch(n){const i=e.find(e=>null==e.href)||document.styleSheets[0];null!=s.href&&t.push(W(s.href).then(e=>Y(e,a)).then(e=>K(e).forEach(e=>{i.insertRule(e,i.cssRules.length)})).catch(e=>{}))}}),Promise.all(t).then(()=>(e.forEach(e=>{if("cssRules"in e)try{p(e.cssRules||[]).forEach(e=>{s.push(e)})}catch(a){}}),s))}(s,a);return function(e){return e.filter(e=>e.type===CSSRule.FONT_FACE_RULE).filter(e=>B(e.style.getPropertyValue("src")))}(t)}function Q(e){return e.trim().replace(/["']/g,"")}async function X(e,a){const s=await J(e,a),t=function(e){const a=new Set;return function e(s){(s.style.fontFamily||getComputedStyle(s).fontFamily).split(",").forEach(e=>{a.add(Q(e))}),Array.from(s.children).forEach(a=>{a instanceof HTMLElement&&e(a)})}(e),a}(e);return(await Promise.all(s.filter(e=>t.has(Q(e.style.fontFamily))).map(e=>{const s=e.parentStyleSheet?e.parentStyleSheet.href:null;return G(e.cssText,s,a)}))).join("\n")}async function Z(e,a={}){const{width:s,height:t}=j(e,a),n=await D(e,a,!0);await async function(e,a){const s=null!=a.fontEmbedCSS?a.fontEmbedCSS:a.skipFonts?null:await X(e,a);if(s){const a=document.createElement("style"),t=document.createTextNode(s);a.appendChild(t),e.firstChild?e.insertBefore(a,e.firstChild):e.appendChild(a)}}(n,a),await z(n,a),function(e,a){const{style:s}=e;a.backgroundColor&&(s.backgroundColor=a.backgroundColor),a.width&&(s.width=`${a.width}px`),a.height&&(s.height=`${a.height}px`);const t=a.style;null!=t&&Object.keys(t).forEach(e=>{s[e]=t[e]})}(n,a);return await v(n,s,t)}async function ee(e,a={}){const{width:s,height:t}=j(e,a),n=await Z(e,a),i=await N(n),r=document.createElement("canvas"),l=r.getContext("2d"),o=a.pixelRatio||function(){let e,a;try{a=process}catch(t){}const s=a&&a.env?a.env.devicePixelRatio:null;return s&&(e=parseInt(s,10),Number.isNaN(e)&&(e=1)),e||window.devicePixelRatio||1}(),c=a.canvasWidth||s,m=a.canvasHeight||t;return r.width=c*o,r.height=m*o,a.skipAutoScale||function(e){(e.width>y||e.height>y)&&(e.width>y&&e.height>y?e.width>e.height?(e.height*=y/e.width,e.width=y):(e.width*=y/e.height,e.height=y):e.width>y?(e.height*=y/e.width,e.width=y):(e.width*=y/e.height,e.height=y))}(r),r.style.width=`${c}`,r.style.height=`${m}`,a.backgroundColor&&(l.fillStyle=a.backgroundColor,l.fillRect(0,0,r.width,r.height)),l.drawImage(i,0,0,r.width,r.height),r}const ae=t.forwardRef(({children:e,...s},t)=>a.jsxs("svg",{ref:t,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 74 111",className:"field-svg",...s,children:[a.jsx("rect",{width:"74",height:"111",fill:"#ffffff"}),a.jsxs("g",{fill:"none",stroke:"#000",strokeWidth:"0.5",transform:"translate(3 3)",children:[a.jsx("path",{d:"M 0 0 h 68 v 105 h -68 Z"}),a.jsx("path",{d:"M 0 52.5 h 68"}),a.jsx("circle",{r:"9.15",cx:"34",cy:"52.5"}),a.jsx("circle",{r:"0.75",cx:"34",cy:"52.5",fill:"#000",stroke:"none"}),a.jsxs("g",{children:[a.jsx("path",{d:"M 13.84 0 v 16.5 h 40.32 v -16.5"}),a.jsx("path",{d:"M 24.84 0 v 5.5 h 18.32 v -5.5"}),a.jsx("circle",{r:"0.75",cx:"34",cy:"10.94",fill:"#000",stroke:"none"}),a.jsx("path",{d:"M 26.733027 16.5 a 9.15 9.15 0 0 0 14.533946 0"})]}),a.jsxs("g",{transform:"rotate(180,34,52.5)",children:[a.jsx("path",{d:"M 13.84 0 v 16.5 h 40.32 v -16.5"}),a.jsx("path",{d:"M 24.84 0 v 5.5 h 18.32 v -5.5"}),a.jsx("circle",{r:"0.75",cx:"34",cy:"10.94",fill:"#000",stroke:"none"}),a.jsx("path",{d:"M 26.733027 16.5 a 9.15 9.15 0 0 0 14.533946 0"})]}),a.jsx("path",{d:"M 0 2 a 2 2 0 0 0 2 -2M 66 0 a 2 2 0 0 0 2 2M 68 103 a 2 2 0 0 0 -2 2M 2 105 a 2 2 0 0 0 -2 -2"})]}),e]}));function se({players:s,editable:t=!1,onDragStart:n,onDrag:i,onDragEnd:r,showDownload:l=!1}){const o=e.useRef(null),c=e.useRef(null),[m,d]=e.useState(!1),[u,h]=e.useState(null),p=e.useMemo(()=>`muqawamah-formation-${(new Date).toISOString().split("T")[0]}.png`,[]),f=()=>{u&&(h(null),r&&r())};return a.jsxs("div",{className:"formation-preview-wrapper",children:[a.jsx("div",{className:"football-field-svg",ref:o,onMouseMove:e=>{u&&t&&o.current&&(e.preventDefault(),i&&i(e))},onMouseUp:f,onMouseLeave:f,onTouchMove:e=>{u&&t&&o.current&&(e.preventDefault(),i&&i(e))},onTouchEnd:()=>{u&&(h(null),r&&r())},children:a.jsxs(ae,{ref:c,style:{width:"100%",height:"auto",maxWidth:"400px",display:"block",margin:"0 auto"},children:[a.jsx("defs",{children:s.map(e=>a.jsx("clipPath",{id:`player-clip-${e.id}`,children:a.jsx("circle",{r:"3.3",cx:"0",cy:"0"})},`clip-${e.id}`))}),s.map(e=>{const s=3+("number"!=typeof e.x||isNaN(e.x)?50:e.x)/100*68,i=3+("number"!=typeof e.y||isNaN(e.y)?50:e.y)/100*105,r="GK"===e.position,l=t&&!r;return a.jsxs("g",{transform:`translate(${s}, ${i})`,className:l?"player-marker-draggable":"player-marker-static",style:{cursor:l?"move":"default"},onMouseDown:a=>((e,a)=>{t&&"GK"!==a.position&&(e.preventDefault(),h(a.id),n&&n(e,a.id))})(a,e),onTouchStart:a=>((e,a)=>{t&&"GK"!==a.position&&(h(a.id),n&&n(e,a.id))})(a,e),children:[a.jsx("circle",{r:"3.3",fill:r?"#2d5a27":"#4a90e2",stroke:r?"#4a8c3f":"#fff",strokeWidth:"0.5"}),r&&a.jsx("text",{x:"0",y:"-4.5",textAnchor:"middle",fill:"#4a8c3f",fontSize:"2",children:"ðŸ”’"}),e.image?a.jsx("image",{href:e.image,x:"-3.3",y:"-3.3",width:"6.6",height:"6.6",clipPath:`url(#player-clip-${e.id})`,preserveAspectRatio:"xMidYMid slice"}):a.jsx("text",{x:"0",y:"1.1",textAnchor:"middle",fill:"#fff",fontSize:"2.75",fontWeight:"600",children:e.position}),a.jsx("text",{x:"0",y:"6",textAnchor:"middle",fill:"#000",fontSize:"2",fontWeight:"600",children:e.name||"Player"}),a.jsx("text",{x:"0",y:"8.2",textAnchor:"middle",fill:"#666",fontSize:"1.65",fontWeight:"400",children:e.position})]},e.id)})]})}),l&&a.jsxs("button",{type:"button",className:"download-formation-btn",onClick:async()=>{if(o.current)try{d(!0);const e=await async function(e,a={}){return(await ee(e,a)).toDataURL()}(o.current,{cacheBust:!0,pixelRatio:window.devicePixelRatio||2,backgroundColor:"#ffffff"}),a=document.createElement("a");a.download=p,a.href=e,a.click()}catch(e){alert("Unable to download formation right now. Please try again.")}finally{d(!1)}},disabled:m,children:[a.jsx("i",{className:"fas fa-download"}),a.jsx("span",{children:m?"Preparing...":"Download Formation"})]})]})}ae.displayName="FootballFieldSVG";const te=["1-3-2-1","1-2-3-1","1-2-2-2","1-3-1-2","1-4-1-1"],ne=85,ie=100,re=(e,a)=>"GK"===e?Math.max(ne,Math.min(ie,a)):Math.max(0,Math.min(100,a)),le={GK:50,CB:50,LB:25,RB:75,CDM:50,CM:50,CAM:50,LM:20,RM:80,CF:50,ST:50},oe=e=>{const a=[...e],s=e.filter(e=>!e.isSubstitute),t={};return s.forEach(s=>{const n=s.position,i=t[n]||0;let r=le[n]||50,l=POSITION_Y_MAP[n]||50;i>0&&("CB"===n||"CM"===n||"ST"===n||"CF"===n?r=1===i?30:2===i?70:50:"LB"===n?r=20-5*i:"RB"===n&&(r=80+5*i)),t[n]=i+1;const o=e.indexOf(s);a[o]={...s,x:r,y:l}}),a},ce=(e,a)=>{if(!a)return oe(e);const s=a.split("-").map(e=>parseInt(e,10)).filter(e=>!isNaN(e));if(0===s.length)return oe(e);const t=[...e],n=[...e.filter(e=>!e.isSubstitute)].sort((e,a)=>"GK"===e.position?-1:"GK"===a.position?1:0),i=[92,78,55,35,15];let r=0;return s.forEach((a,s)=>{const l=i[s]||50;for(let i=0;i<a&&!(r>=n.length);i++){const s=n[r];let o;if(1===a)o=50;else if(2===a)o=0===i?30:70;else if(3===a)o=0===i?20:1===i?50:80;else if(4===a)o=[15,35,65,85][i];else if(5===a)o=[10,27.5,50,72.5,90][i];else{o=100/(a+1)*(i+1)}const c=re(s.position,l),m=e.indexOf(s);t[m]={...s,x:o,y:c},r++}}),t};function me(){const{players:s,setPlayers:t,teamData:n,setTeamData:i,setStep:r,saveProgress:l,saving:o,error:m}=c(),d=e.useRef(null),[u,h]=e.useState(null),[p,f]=e.useState(!1),g=e.useCallback((e,a,n)=>{const i="number"!=typeof a||isNaN(a)?50:a,r="number"!=typeof n||isNaN(n)?50:n,l=s.find(a=>a.id===e);"GK"!==(null==l?void 0:l.position)&&t(a=>a.map(a=>a.id===e?{...a,x:i,y:r}:a))},[t,s]),x=e.useCallback((e,a)=>{const t=s.find(e=>e.id===a);"GK"!==(null==t?void 0:t.position)&&h(a)},[s]),j=e.useCallback(e=>{const a=d.current;if(!u||!a)return;e.preventDefault();const s=a.querySelector("svg");if(!s)return;const t=s.getBoundingClientRect(),n=e.touches?e.touches[0].clientX:e.clientX,i=e.touches?e.touches[0].clientY:e.clientY,r=(n-t.left)/t.width*100,l=(i-t.top)/t.height*100,o=Math.min(Math.max(r,0),100),c=Math.min(Math.max(l,0),100);g(u,o,c)},[u,g]),y=e.useCallback(()=>{h(null)},[]);e.useEffect(()=>{if(!p&&n.formation&&s.length>0){const e=ce(s,n.formation);t(e),f(!0)}},[]);return a.jsxs("form",{className:"registration-form",onSubmit:async e=>{e.preventDefault();(await l(3)).success&&r(4)},children:[a.jsx("h3",{children:"Step 3 Â· Formation & Positions"}),a.jsx("p",{className:"step-description",children:"Choose a preset formation below, then drag players to customize positions."}),a.jsxs("div",{className:"formation-instruction-box",children:[a.jsx("div",{className:"instruction-icon",children:a.jsx("i",{className:"fas fa-hand-pointer"})}),a.jsxs("div",{className:"instruction-content",children:[a.jsx("strong",{className:"instruction-title",children:"Interactive Field"}),a.jsx("p",{className:"instruction-text",children:"Click and drag any player to reposition them (GK is locked)"})]})]}),a.jsxs("div",{className:"formation-presets-section",children:[a.jsxs("div",{className:"presets-header",children:[a.jsx("i",{className:"fas fa-chess-board"}),a.jsx("span",{className:"presets-title",children:"Choose Formation"})]}),a.jsx("div",{className:"formation-buttons-grid",children:te.map(e=>a.jsx("button",{type:"button",className:"formation-preset-btn "+(n.formation===e?"active":""),onClick:()=>(e=>{t(a=>ce(a,e)),i(a=>({...a,formation:e}))})(e),children:a.jsx("span",{className:"formation-name",children:e})},e))})]}),a.jsx("div",{ref:d,className:"formation-field-container",children:a.jsx(se,{players:s.filter(e=>!e.isSubstitute),editable:!0,onDragStart:x,onDrag:j,onDragEnd:y})}),m&&a.jsx("p",{className:"auth-error",children:m}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"secondary-btn",onClick:()=>r(2),disabled:o,children:"Back"}),a.jsx("button",{type:"submit",className:"primary-btn",disabled:o,children:o?a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-spinner fa-spin"})," Saving..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-save"})," Save & Review"]})})]})]})}function de(){const{teamData:t,resetForm:n,paymentStatus:i,successTeamId:r,setPaymentStatus:l}=c(),[o,m]=e.useState(!0);e.useEffect(()=>{(async()=>{if(r)try{const{data:e,error:a}=await s.from("team_registrations").select("status, payment_status").eq("id",r).single();if(a)throw a;e&&("confirmed"===e.status||"confirmed"===e.payment_status?l("confirmed"):e.payment_status&&l(e.payment_status))}catch(e){}finally{m(!1)}else m(!1)})()},[r,l]);const d="confirmed"===i;return o?a.jsx("div",{className:"registration-form registration-complete",children:a.jsx("div",{className:"complete-container",children:a.jsxs("div",{className:"loading-content",children:[a.jsx("div",{className:"spinner"}),a.jsx("p",{children:"Loading registration status..."})]})})}):a.jsx("div",{className:"registration-form registration-complete",children:a.jsxs("div",{className:"complete-container",children:[a.jsx("div",{className:"complete-icon",children:a.jsx("div",{className:"icon-circle "+(d?"confirmed":"pending"),children:a.jsx("i",{className:"fas "+(d?"fa-check":"fa-clock")})})}),a.jsx("h2",{children:d?"Registration Confirmed!":"Registration Submitted!"}),a.jsxs("div",{className:"complete-team-info",children:[t.teamLogo&&a.jsx("img",{src:t.teamLogo,alt:t.teamName,className:"complete-team-logo"}),a.jsx("h3",{children:t.teamName}),a.jsxs("span",{className:"complete-category",children:["open-age"===t.category?"Open Age":"Under 17"," Category"]})]}),a.jsx("div",{className:"complete-message",children:d?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"confirmation-badge",children:[a.jsx("i",{className:"fas fa-check-circle"}),a.jsx("span",{children:"Payment Verified"})]}),a.jsxs("p",{className:"main-message",children:["Your registration for ",a.jsx("strong",{children:"Muqawama 2026"})," has been confirmed!"]}),a.jsx("p",{className:"sub-message",children:"Welcome to the tournament! Your team is now officially registered."})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"verification-badge",children:[a.jsx("i",{className:"fas fa-hourglass-half"}),a.jsx("span",{children:"Payment Verification Pending"})]}),a.jsxs("p",{className:"main-message",children:["Your registration for ",a.jsx("strong",{children:"Muqawama 2026"})," has been submitted successfully!"]}),a.jsxs("p",{className:"sub-message",children:["We have received your payment screenshot and it is being verified by our team. You will receive confirmation within ",a.jsx("strong",{children:"24 hours"}),"."]})]})}),a.jsxs("div",{className:"complete-details",children:[a.jsx("h4",{children:"What Happens Next?"}),a.jsxs("ul",{className:"next-steps-list",children:[!d&&a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-search-dollar"}),a.jsx("span",{children:"Our team will verify your payment within 24 hours"})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-phone"}),a.jsx("span",{children:"The organisers will get in touch with you soon"})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-calendar-check"}),a.jsx("span",{children:"Fixture details will be shared before the tournament"})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-id-card"}),a.jsx("span",{children:"Player ID cards will be issued at the venue"})]})]})]}),a.jsxs("div",{className:"complete-contact",children:[a.jsx("p",{children:"Questions? Reach out to us:"}),a.jsxs("div",{className:"contact-links",children:[a.jsxs("a",{href:"mailto:muqawamah@sio-abulfazal.org",children:[a.jsx("i",{className:"fas fa-envelope"})," muqawamah@sio-abulfazal.org"]}),a.jsxs("a",{href:"https://instagram.com/muqawama2026",target:"_blank",rel:"noopener noreferrer",children:[a.jsx("i",{className:"fab fa-instagram"})," @muqawama2026"]})]})]}),a.jsx("div",{className:"complete-actions",children:a.jsxs("button",{type:"button",className:"primary-btn",onClick:()=>{n(),window.location.href="/muqawamah/2026/"},children:[a.jsx("i",{className:"fas fa-home"})," Back to Tournament Page"]})})]})})}const ue={"open-age":{label:"Open Age",amount:2e3,qrCode:"/assets/img/Muqawama/qr-2000.svg"},u17:{label:"Under 17",amount:1800,qrCode:"/assets/img/Muqawama/qr-1800.svg"}};function he(){const{teamData:t,players:n,setStep:l,loading:o,setLoading:m,error:d,setError:u,existingTeamId:h,setExistingTeamId:p,setSuccessTeamId:f,paymentStatus:g,setPaymentStatus:x}=c(),[j,y]=e.useState(null),[N,v]=e.useState(null),[b,w]=e.useState(0),[S,P]=e.useState(!1),[C,_]=e.useState(!1),k=e.useRef(null),E=t.category||"open-age",M=ue[E],T=M.amount;return"success"===g||"pending_verification"===g||"confirmed"===g?a.jsx(de,{}):a.jsxs("div",{className:"registration-form payment-checkout",children:[a.jsx("h3",{children:"Step 5 Â· Payment"}),a.jsx("p",{className:"step-description",children:"Scan the QR code, pay and upload the screenshot."}),a.jsxs("section",{className:"checkout-section",children:[a.jsxs("h4",{children:[a.jsx("i",{className:"fas fa-receipt"})," Order Summary"]}),a.jsxs("div",{className:"order-summary-card",children:[a.jsxs("div",{className:"order-item",children:[a.jsxs("div",{className:"order-item-info",children:[a.jsx("span",{className:"item-name",children:"Team Registration"}),a.jsxs("span",{className:"item-detail",children:[t.teamName," â€¢ ",M.label]})]}),a.jsxs("span",{className:"item-price",children:["â‚¹",M.amount]})]}),a.jsxs("div",{className:"order-total",children:[a.jsx("span",{children:"Total Amount"}),a.jsxs("span",{className:"total-price",children:["â‚¹",T]})]})]})]}),a.jsxs("section",{className:"checkout-section qr-section",children:[a.jsxs("h4",{children:[a.jsx("i",{className:"fas fa-qrcode"})," Scan & Pay"]}),a.jsxs("div",{className:"qr-payment-container",children:[a.jsx("div",{className:"qr-code-wrapper",children:a.jsx("img",{src:M.qrCode,alt:`Pay â‚¹${T} via UPI`,className:"qr-code-image"})}),a.jsxs("a",{href:M.qrCode,download:`muqawama-payment-qr-${T}.svg`,className:"download-qr-btn",children:[a.jsx("i",{className:"fas fa-download"})," Download QR Code"]}),a.jsxs("div",{className:"qr-instructions",children:[a.jsxs("div",{className:"instruction-step",children:[a.jsx("span",{className:"step-number",children:"1"}),a.jsx("span",{children:"Open any UPI app (GPay, PhonePe, Paytm, etc.)"})]}),a.jsxs("div",{className:"instruction-step",children:[a.jsx("span",{className:"step-number",children:"2"}),a.jsxs("span",{children:["Scan the QR code and pay ",a.jsxs("strong",{children:["â‚¹",T]})]})]}),a.jsxs("div",{className:"instruction-step",children:[a.jsx("span",{className:"step-number",children:"3"}),a.jsx("span",{children:"Take a screenshot of the payment confirmation"})]}),a.jsxs("div",{className:"instruction-step",children:[a.jsx("span",{className:"step-number",children:"4"}),a.jsx("span",{children:"Upload the screenshot below"})]})]})]})]}),a.jsxs("section",{className:"checkout-section",children:[a.jsxs("h4",{children:[a.jsx("i",{className:"fas fa-upload"})," Upload Payment Screenshot"]}),a.jsxs("div",{className:"screenshot-upload-container",children:[a.jsx("input",{type:"file",ref:k,onChange:async e=>{const a=e.target.files[0];if(a)if(a.type.startsWith("image/"))if(a.size>5242880)u("Image size should be less than 5MB");else try{u(null);const e=await i(a,{maxWidth:1200,maxHeight:1200,quality:.85,outputFormat:"image/webp"});r(e),Math.round(a.size/1024);y(e),v(e)}catch(s){u("Failed to process image. Please try another file.")}else u("Please upload an image file (JPG, PNG, etc.)")},accept:"image/*",style:{display:"none"}}),N?a.jsxs("div",{className:"screenshot-preview",children:[a.jsx("img",{src:N,alt:"Payment Screenshot"}),a.jsxs("button",{type:"button",className:"remove-screenshot-btn",onClick:()=>{y(null),v(null),k.current&&(k.current.value="")},children:[a.jsx("i",{className:"fas fa-times"})," Remove"]})]}):a.jsxs("div",{className:"screenshot-dropzone",onClick:()=>{var e;return null==(e=k.current)?void 0:e.click()},children:[a.jsx("i",{className:"fas fa-cloud-upload-alt"}),a.jsx("p",{children:"Click to upload payment screenshot"}),a.jsx("span",{children:"JPG, PNG up to 5MB"})]})]}),b>0&&b<100&&a.jsxs("div",{className:"upload-progress",children:[a.jsx("div",{className:"progress-bar",children:a.jsx("div",{className:"progress-fill",style:{width:`${b}%`}})}),a.jsxs("span",{children:["Uploading... ",b,"%"]})]})]}),a.jsxs("section",{className:"checkout-section",children:[a.jsxs("h4",{children:[a.jsx("i",{className:"fas fa-users"})," Registration Details"]}),a.jsxs("div",{className:"checkout-team-summary",children:[a.jsxs("div",{className:"team-mini-card",children:[t.teamLogo&&a.jsx("img",{src:t.teamLogo,alt:t.teamName,className:"team-mini-logo"}),a.jsxs("div",{className:"team-mini-info",children:[a.jsx("span",{className:"team-mini-name",children:t.teamName}),a.jsxs("span",{className:"team-mini-category",children:[M.label," â€¢ ",n.length," Players"]})]})]}),a.jsxs("div",{className:"captain-info",children:[a.jsxs("span",{children:[a.jsx("i",{className:"fas fa-user"})," ",t.captainName]}),a.jsxs("span",{children:[a.jsx("i",{className:"fas fa-envelope"})," ",t.captainEmail]})]})]})]}),d&&a.jsxs("p",{className:"auth-error",children:[a.jsx("i",{className:"fas fa-exclamation-circle"})," ",d]}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"secondary-btn",onClick:()=>l(4),disabled:o,children:"Back to Review"}),a.jsx("button",{type:"button",className:"primary-btn pay-btn",onClick:()=>P(!0),disabled:o||!j,children:o?a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-spinner fa-spin"})," Submitting..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-check-circle"})," Submit Registration"]})})]}),a.jsxs("p",{className:"terms-note",children:[a.jsx("i",{className:"fas fa-info-circle"})," Your registration will be verified within 24 hours after payment confirmation."]}),S&&a.jsx("div",{className:"terms-modal-overlay",onClick:()=>P(!1),children:a.jsxs("div",{className:"terms-modal",onClick:e=>e.stopPropagation(),children:[a.jsxs("div",{className:"terms-modal-header",children:[a.jsx("i",{className:"fas fa-file-contract"}),a.jsx("h3",{children:"Confirm Registration"})]}),a.jsxs("div",{className:"terms-modal-content",children:[a.jsx("p",{children:"By submitting this registration, you confirm that:"}),a.jsxs("ul",{className:"terms-checklist",children:[a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-check"}),a.jsx("span",{children:"All information provided is accurate and complete"})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-check"}),a.jsxs("span",{children:["You agree to the ",a.jsx("a",{href:"/muqawamah/terms-and-conditions/",target:"_blank",rel:"noopener noreferrer",children:"Terms & Conditions"})]})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-check"}),a.jsxs("span",{children:["You agree to the ",a.jsx("a",{href:"/muqawamah/privacy-policy/",target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})]})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-check"}),a.jsx("span",{children:"You consent to AI-enhanced player images"})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-check"}),a.jsxs("span",{children:["You understand the ",a.jsx("a",{href:"/muqawamah/refund-policy/",target:"_blank",rel:"noopener noreferrer",children:"Refund Policy"})]})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-check"}),a.jsx("span",{children:"All players meet the category age requirements"})]})]}),a.jsxs("div",{className:"terms-checkbox-label "+(C?"checked":""),onClick:()=>_(!C),children:[a.jsx("div",{className:"custom-checkbox",children:C&&a.jsx("i",{className:"fas fa-check"})}),a.jsx("span",{children:"I accept all the above terms and conditions"})]})]}),a.jsxs("div",{className:"terms-modal-actions",children:[a.jsx("button",{type:"button",className:"secondary-btn",onClick:()=>{P(!1),_(!1)},children:"Cancel"}),a.jsx("button",{type:"button",className:"primary-btn",disabled:!C||o,onClick:()=>{P(!1),(async()=>{if(j){m(!0),u(null),w(10);try{const{data:{user:e}}=await s.auth.getUser();if(!e)throw new Error("You must be logged in to proceed.");w(20);const a=j;w(40);let i=h;if(h){const{error:e}=await s.from("team_registrations").update({team_name:t.teamName,category:t.category,team_logo:t.teamLogo,captain_name:t.captainName,captain_email:t.captainEmail,captain_phone:t.captainPhone,formation:t.formation,status:"pending_verification",payment_amount:T,payment_screenshot:a,payment_status:"pending_verification",submitted_at:(new Date).toISOString()}).eq("id",h);if(e)throw e}else{const{data:n,error:r}=await s.from("team_registrations").insert({user_id:e.id,team_name:t.teamName,category:t.category,team_logo:t.teamLogo,captain_name:t.captainName,captain_email:t.captainEmail,captain_phone:t.captainPhone,formation:t.formation,status:"pending_verification",payment_amount:T,payment_screenshot:a,payment_status:"pending_verification",submitted_at:(new Date).toISOString()}).select().single();if(r)throw r;i=n.id,p(i)}w(60),await s.from("team_players").delete().eq("team_id",i);const r=n.map(e=>({team_id:i,player_name:e.name||"",player_age:e.age?parseInt(e.age):null,aadhar_no:e.aadhar_no||null,position:e.position||"SUB",is_substitute:e.isSubstitute||!1,player_image:e.image||null,position_x:"number"!=typeof e.x||isNaN(e.x)?50:e.x,position_y:"number"!=typeof e.y||isNaN(e.y)?50:e.y}));w(80);const{error:o}=await s.from("team_players").insert(r);if(o)throw o;w(100),f(i),x("pending_verification"),l(6)}catch(e){u(e.message)}finally{m(!1),w(0)}}else u("Please upload the payment screenshot")})()},children:o?a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-spinner fa-spin"})," Submitting..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-check-circle"})," Confirm & Submit"]})})]})]})})]})}const pe=["GK","CB","LB","RB","CDM","CM","CAM","LM","RM","CF","ST"];function fe(){const{players:s,setPlayers:t,setStep:n,saveProgress:l,saving:o,error:m,teamData:d}=c(),[u,h]=e.useState(null),p="open-age"===d.category;e.useEffect(()=>{d.captainName&&s[0]&&!s[0].name&&t(e=>e.map((e,a)=>0===a?{...e,name:d.captainName}:e))},[d.captainName,t]);const f=(e,a,s)=>{t(t=>t.map((t,n)=>n===e?{...t,[a]:s}:t))},g=s.filter(e=>!e.isSubstitute),x=s.filter(e=>e.isSubstitute),j=g[0],y=g.slice(1),N=(e,s,t=!1)=>{const n=e.isSubstitute,l=n&&e.name,o=!n||l;return a.jsxs("div",{className:`player-card ${t?"captain-card":""} ${n?"substitute-card":""}`,children:[t&&a.jsxs("div",{className:"captain-badge",children:[a.jsx("i",{className:"fas fa-star"})," Team Captain"]}),n&&!l&&a.jsxs("div",{className:"optional-badge",children:[a.jsx("i",{className:"fas fa-plus-circle"})," Optional"]}),a.jsxs("label",{children:[t?"Captain Name":"Player Name",a.jsx("input",{type:"text",value:e.name,onChange:e=>f(s,"name",e.target.value),placeholder:t?d.captainName||"Captain Name":n?"Substitute Name (optional)":`${e.position} Player`,required:!n})]}),a.jsxs("label",{children:["Age",a.jsx("input",{type:"number",value:e.age||"",onChange:e=>f(s,"age",e.target.value),placeholder:"e.g., 22",min:"10",max:"60",required:o})]}),!p&&a.jsxs("label",{children:["Aadhar Number",a.jsx("input",{type:"text",value:e.aadhar_no||"",onChange:e=>{const a=e.target.value.replace(/\D/g,"");a.length<=12&&f(s,"aadhar_no",a)},placeholder:"12-digit Aadhar number",maxLength:"12",pattern:"[0-9]{12}",required:o}),a.jsx("span",{className:"input-hint",children:"Enter 12-digit Aadhar number (required for U17)"})]}),!e.isSubstitute&&a.jsxs("label",{children:["Position",a.jsx("select",{value:e.position,onChange:e=>f(s,"position",e.target.value),children:pe.map(e=>a.jsx("option",{value:e,children:e},e))})]}),a.jsxs("label",{className:"file-label",children:["Player Photo",u===s&&a.jsxs("div",{className:"compressing-indicator",children:[a.jsx("i",{className:"fas fa-spinner fa-spin"}),a.jsx("span",{children:"Compressing image..."})]}),e.image&&u!==s&&a.jsxs("div",{className:"uploaded-photo-preview",children:[a.jsxs("div",{className:"photo-preview-container",children:[a.jsx("img",{src:e.image,alt:"Player photo",className:"photo-preview"}),a.jsx("div",{className:"photo-overlay",children:a.jsx("i",{className:"fas fa-check-circle"})})]}),a.jsxs("div",{className:"uploaded-file-info",children:[a.jsx("i",{className:"fas fa-check-circle"}),a.jsxs("span",{className:"file-name-text",children:[a.jsx("strong",{children:"Uploaded:"})," ",e.imageFileName||"Photo uploaded"]}),a.jsx("span",{className:"file-change-hint",children:"(Click to change)"})]})]}),a.jsx("input",{type:"file",accept:"image/*",onChange:e=>{var a;return(async(e,a)=>{if(a)if(a.size>2097152)alert("Player photo must be under 2MB");else try{h(e);const s=await i(a,{maxWidth:600,maxHeight:600,quality:.85,outputFormat:"image/webp"});r(s),Math.round(a.size/1024),f(e,"image",s),f(e,"imageFileName",a.name.replace(/\.(jpg|jpeg|png)$/i,".webp"))}catch(s){alert("Failed to process image. Please try another file.")}finally{h(null)}})(s,null==(a=e.target.files)?void 0:a[0])},disabled:u===s}),!e.image&&u!==s&&a.jsx("span",{className:"input-hint",children:n?"JPG/PNG up to 2MB. Optional.":"JPG/PNG up to 2MB. Required."})]})]},e.id)};return a.jsxs("form",{className:"registration-form",onSubmit:async e=>{if(e.preventDefault(),!(()=>{const e=g.every(e=>{const a=e.name&&e.age&&e.position&&e.image;return p?a:a&&e.aadhar_no&&12===e.aadhar_no.length}),a=x.filter(e=>e.name).every(e=>{const a=e.name&&e.age&&e.image;return p?a:a&&e.aadhar_no&&12===e.aadhar_no.length});return e&&a})()){return void alert(`Please fill out all required fields including name, age${p?"":", Aadhar number,"} and photo for all main players. Substitutes are optional.`)}(await l(2)).success&&n(3)},children:[a.jsx("h3",{children:"Step 2 Â· Players"}),a.jsx("p",{className:"step-description",children:"Start with the captain, then add 6 more players and 4 substitutes."}),a.jsx("h4",{children:"Captain"}),a.jsx("div",{className:"captain-section",children:j&&N(j,s.indexOf(j),!0)}),a.jsx("h4",{children:"Other Main Players"}),a.jsx("div",{className:"players-grid",children:y.map(e=>N(e,s.indexOf(e)))}),a.jsxs("h4",{children:["Substitutes ",a.jsx("span",{className:"optional-label",children:"(Optional)"})]}),a.jsx("p",{className:"step-description",style:{marginTop:"-10px",marginBottom:"15px"},children:"Add 1-4 substitutes as needed. You can leave any substitute cards empty if you don't have players."}),a.jsx("div",{className:"players-grid",children:x.map(e=>N(e,s.indexOf(e)))}),m&&a.jsx("p",{className:"auth-error",children:m}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"secondary-btn",onClick:()=>n(1),disabled:o,children:"Back"}),a.jsx("button",{type:"submit",className:"primary-btn",disabled:o,children:o?a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-spinner fa-spin"})," Saving..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-save"})," Save & Continue"]})})]})]})}function ge({readOnly:e=!1}){const{teamData:s,players:t,setStep:n,existingTeamId:i}=c();return a.jsxs("div",{className:"registration-form",children:[a.jsxs("h3",{children:["Step 4 Â· Review & ",i?"Update":"Submit"]}),a.jsxs("p",{className:"step-description",children:["Verify everything looks good before ",i?"updating":"submitting"," your team."]}),a.jsxs("section",{className:"summary-section",children:[a.jsx("h4",{children:"Team Information"}),a.jsxs("div",{className:"team-info-card",children:[a.jsxs("div",{className:"team-info-header",children:[a.jsx("div",{className:"team-logo-large",children:s.teamLogo?a.jsx("img",{src:s.teamLogo,alt:`${s.teamName} logo`}):a.jsx("div",{className:"team-logo-placeholder-large",children:a.jsx("i",{className:"fas fa-shield-alt"})})}),a.jsxs("div",{className:"team-info-main",children:[a.jsx("h3",{className:"team-name-display",children:s.teamName}),a.jsxs("span",{className:"team-category-badge",children:[a.jsx("i",{className:"fas fa-trophy"})," ","open-age"===s.category?"Open Age":"Under 17"]})]})]}),a.jsxs("div",{className:"team-info-details",children:[a.jsxs("div",{className:"info-row",children:[a.jsxs("div",{className:"info-item",children:[a.jsx("i",{className:"fas fa-user-tie"}),a.jsxs("div",{className:"info-content",children:[a.jsx("span",{className:"info-label",children:"Captain"}),a.jsx("span",{className:"info-value",children:s.captainName})]})]}),a.jsxs("div",{className:"info-item",children:[a.jsx("i",{className:"fas fa-envelope"}),a.jsxs("div",{className:"info-content",children:[a.jsx("span",{className:"info-label",children:"Email"}),a.jsx("span",{className:"info-value",children:s.captainEmail})]})]})]}),s.captainPhone&&a.jsxs("div",{className:"info-row",children:[a.jsxs("div",{className:"info-item",children:[a.jsx("i",{className:"fas fa-phone"}),a.jsxs("div",{className:"info-content",children:[a.jsx("span",{className:"info-label",children:"Phone"}),a.jsx("span",{className:"info-value",children:s.captainPhone})]})]}),a.jsxs("div",{className:"info-item",children:[a.jsx("i",{className:"fas fa-futbol"}),a.jsxs("div",{className:"info-content",children:[a.jsx("span",{className:"info-label",children:"Formation"}),a.jsx("span",{className:"info-value",children:s.formation})]})]})]}),!s.captainPhone&&a.jsx("div",{className:"info-row",children:a.jsxs("div",{className:"info-item",children:[a.jsx("i",{className:"fas fa-futbol"}),a.jsxs("div",{className:"info-content",children:[a.jsx("span",{className:"info-label",children:"Formation"}),a.jsx("span",{className:"info-value",children:s.formation})]})]})})]})]})]}),a.jsxs("section",{className:"summary-section",children:[a.jsx("h4",{children:"Players"}),a.jsx("div",{className:"player-card-grid",children:t.filter(e=>e.name&&""!==e.name.trim()).map((e,t)=>{var n,i;return a.jsxs("div",{className:"player-card-badge simple "+(e.isSubstitute?"substitute":""),children:[a.jsxs("div",{className:"badge-header",children:[a.jsxs("div",{className:"badge-team",children:[a.jsx("div",{className:"team-logo",children:s.teamLogo?a.jsx("img",{src:s.teamLogo,alt:`${s.teamName} logo`}):a.jsx("div",{className:"team-logo-placeholder",children:(null==(i=null==(n=s.teamName)?void 0:n.charAt(0))?void 0:i.toUpperCase())||"T"})}),a.jsxs("div",{className:"team-meta",children:[a.jsx("span",{className:"team-name",children:s.teamName||"Team name"}),a.jsx("span",{className:"player-role",children:e.isSubstitute?"Substitute":e.position||"Player"})]})]}),a.jsx("div",{className:"muqawama-logo",children:a.jsx("img",{src:"/assets/img/MuqawamaLogo.png",alt:"Muqawama 2026"})})]}),a.jsx("div",{className:"badge-photo",children:e.image?a.jsx("img",{src:e.image,alt:e.name||e.position}):a.jsx("div",{className:"badge-photo-placeholder",children:a.jsx("i",{className:"fas fa-user"})})}),a.jsx("div",{className:"badge-player-info",children:a.jsx("span",{className:"player-name",children:e.name})})]},e.id||t)})})]}),a.jsxs("section",{className:"summary-section",children:[a.jsx("h4",{children:"Formation Preview"}),a.jsx("div",{children:a.jsx(se,{players:t.filter(e=>!e.isSubstitute),editable:!1,showDownload:!0})})]}),!e&&a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"secondary-btn",onClick:()=>n(3),children:"Back"}),a.jsx("button",{type:"button",className:"primary-btn",onClick:()=>{n(5)},children:"Proceed to Payment"})]})]})}const xe=[{value:"open-age",label:"Open Age"},{value:"u17",label:"Under 17"}];function je(){const{teamData:s,setTeamData:t,setStep:n,saveProgress:l,saving:o,error:m}=c(),d=e.useRef(null),[u,h]=e.useState(!1),p=e=>{const{name:a,value:s}=e.target;t(e=>({...e,[a]:s}))};return a.jsxs("form",{className:"registration-form",onSubmit:async e=>{var a;if(e.preventDefault(),!s.teamLogo)return void alert("Please upload a team logo");if(10!==((null==(a=s.captainPhone)?void 0:a.replace(/\s/g,""))||"").length)return void alert("Please enter a valid 10-digit mobile number");(await l(1)).success&&n(2)},children:[a.jsx("h3",{children:"Step 1 Â· Team Details"}),a.jsx("p",{className:"step-description",children:"Tell us about your team and captain information."}),a.jsxs("label",{children:["Team Name",a.jsx("input",{type:"text",name:"teamName",value:s.teamName,onChange:p,placeholder:"e.g., Rising Stars",required:!0})]}),a.jsxs("label",{children:["Category",a.jsx("select",{name:"category",value:s.category,onChange:p,children:xe.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))})]}),a.jsxs("label",{className:"file-label",children:["Team Logo",u&&a.jsxs("div",{className:"compressing-indicator",children:[a.jsx("i",{className:"fas fa-spinner fa-spin"}),a.jsx("span",{children:"Compressing image..."})]}),s.teamLogo&&!u&&a.jsxs("div",{className:"uploaded-photo-preview",children:[a.jsxs("div",{className:"photo-preview-container",children:[a.jsx("img",{src:s.teamLogo,alt:"Team logo",className:"photo-preview"}),a.jsx("div",{className:"photo-overlay",children:a.jsx("i",{className:"fas fa-check-circle"})})]}),a.jsxs("div",{className:"uploaded-file-info",children:[a.jsx("i",{className:"fas fa-check-circle"}),a.jsx("span",{children:s.teamLogoFileName?`Uploaded: ${s.teamLogoFileName}`:"Logo uploaded"}),a.jsx("span",{className:"file-change-hint",children:"(Click to change)"})]})]}),a.jsx("input",{type:"file",accept:"image/*",ref:d,onChange:async e=>{var a;const s=null==(a=e.target.files)?void 0:a[0];if(s){if(s.size>2097152)return alert("Logo size must be under 2MB"),void(d.current.value="");try{h(!0);const e=await i(s,{maxWidth:800,maxHeight:800,quality:.85,outputFormat:"image/webp"});r(e),Math.round(s.size/1024);t(a=>({...a,teamLogo:e,teamLogoFileName:s.name.replace(/\.(jpg|jpeg|png)$/i,".webp")}))}catch(n){alert("Failed to process image. Please try another file."),d.current.value=""}finally{h(!1)}}},disabled:u}),!s.teamLogo&&!u&&a.jsx("span",{className:"input-hint",children:"JPG/PNG up to 2MB. Displayed across the tournament site."})]}),a.jsxs("label",{children:["Preferred Formation",a.jsx("select",{name:"formation",value:s.formation,onChange:p,children:te.map(e=>a.jsx("option",{value:e,children:e},e))}),a.jsx("span",{className:"input-hint",children:"This will be the starting layout in Step 3. You can still adjust players later."})]}),a.jsxs("div",{className:"grid-2",children:[a.jsxs("label",{children:["Captain Name",a.jsx("input",{type:"text",name:"captainName",value:s.captainName,onChange:p,required:!0})]}),a.jsxs("label",{children:["Captain Email",a.jsx("input",{type:"email",name:"captainEmail",value:s.captainEmail,onChange:p,required:!0})]})]}),a.jsxs("label",{children:["Captain Phone",a.jsx("input",{type:"tel",name:"captainPhone",value:s.captainPhone||"",onChange:e=>{const a=e.target.value.replace(/\D/g,"");let s="";a&&(s=a.length<=5?a:`${a.slice(0,5)} ${a.slice(5,10)}`),t(e=>({...e,captainPhone:s}))},placeholder:"98765 43210",pattern:"[0-9\\s]{10,12}",maxLength:11,onInvalid:e=>{var a;const t=e.target;((null==(a=s.captainPhone)?void 0:a.replace(/\s/g,""))||"").length<10?t.setCustomValidity("Please enter a valid 10-digit mobile number"):t.setCustomValidity("")},onInput:e=>{e.target.setCustomValidity("")},required:!0}),a.jsxs("span",{className:"input-hint",children:[a.jsx("i",{className:"fas fa-info-circle"})," 10-digit mobile number (e.g., 98765 43210)"]})]}),m&&a.jsx("p",{className:"auth-error",children:m}),a.jsx("div",{className:"form-actions",children:a.jsx("button",{type:"submit",className:"primary-btn",disabled:o,children:o?a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-spinner fa-spin"})," Saving..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-save"})," Save & Continue"]})})})]})}const ye=[{id:1,label:"Team"},{id:2,label:"Players"},{id:3,label:"Formation"},{id:4,label:"Review"},{id:5,label:"Payment"},{id:6,label:"Complete"}];function Ne(){const{step:e}=c(),s=ye.slice(0,5);return 6===e?null:a.jsx("div",{className:"registration-stepper",children:s.map((s,t)=>a.jsxs("div",{className:`step ${e===s.id?"active":""} ${e>s.id?"complete":""}`,children:[a.jsx("span",{className:"step-number",children:t+1}),a.jsx("span",{className:"step-label",children:s.label})]},s.id))})}function ve(){const{step:n,setStep:i,setTeamData:r,setPlayers:o,setExistingTeamId:u,readOnlyMode:h,setReadOnlyMode:p,resetForm:f,existingTeamId:g,setPaymentStatus:x,setLastSavedStep:j}=c(),[y,N]=e.useState(null),[v,b]=e.useState(!0),[w,S]=e.useState(""),[P,C]=e.useState(!1),_=t.useRef(!1);e.useEffect(()=>{const e=new URLSearchParams(window.location.search).get("payment");"success"===e?(x("success"),i(5),window.history.replaceState({},"",window.location.pathname)):"failed"===e&&(x("failed"),i(5),window.history.replaceState({},"",window.location.pathname))},[]),e.useEffect(()=>{let e=!0;S("");(async()=>{try{const{data:a,error:t}=await Promise.race([s.auth.getUser(),new Promise((e,a)=>setTimeout(()=>a(new Error("getUser timeout")),3e3))]);if(!e)return;if(t){if("getUser timeout"===t.message)return N(null),f(),void b(!1);if("Auth session missing!"!==t.message)throw t}const n=(null==a?void 0:a.user)??null;n?(N(n),await k(n,{force:!0})):(N(null),f())}catch(a){e&&(N(null),f())}finally{e&&b(!1)}})();const{data:a}=s.auth.onAuthStateChange(async(a,s)=>{if(!e)return;["TOKEN_REFRESHED","USER_UPDATED"].includes(a)||("SIGNED_OUT"!==a&&(null==s?void 0:s.user)?"SIGNED_IN"===a&&(null==s?void 0:s.user)&&(_.current||(N(s.user),b(!0),await k(s.user,{force:!0}),b(!1))):(N(null),f(),i(1),_.current=!1))});return()=>{e=!1,a.subscription.unsubscribe()}},[]);const k=async(e,{force:a=!1}={})=>{if(!_.current||a){_.current=!0,C(!0),S("");try{const{data:a,error:t}=await s.from("team_registrations").select("*, team_players(*)").eq("user_id",e.id).maybeSingle();if(t&&"PGRST116"!==t.code)throw t;if(a){u(a.id),p(!1),r({teamName:a.team_name||"",category:a.category||"open-age",teamLogo:a.team_logo,captainName:a.captain_name||"",captainEmail:a.captain_email||e.email||"",captainPhone:a.captain_phone?a.captain_phone.replace(/^\+91\s?/,"").trim():"",formation:a.formation||"1-3-2-1"});const s=a.team_players&&a.team_players.length>0?a.team_players.map((e,a)=>({id:e.id||`player-${a}`,name:e.player_name||"",age:e.player_age||"",aadhar_no:e.aadhar_no||"",position:e.position||"SUB",isSubstitute:e.is_substitute,image:e.player_image,x:e.position_x??50,y:e.position_y??50})):m();if(o(s),"confirmed"===a.status)x("confirmed"),i(6);else if("pending_verification"===a.status)x("pending_verification"),i(6);else if("pending_payment"===a.status)i(4);else{const e=a.last_saved_step||1;j(e);i(e>=3?4:e+1)}}else u(null),p(!1),r({...d,captainEmail:e.email||""}),o(m()),i(1)}catch(t){S("Could not load your saved registration. You can continue and submitting will overwrite the previous data."),u(null),p(!1),r({...d,captainEmail:e.email||""}),o(m()),i(1)}finally{C(!1)}}};return v?a.jsx("div",{className:"loading-screen",children:a.jsxs("div",{className:"loading-content",children:[a.jsxs("div",{className:"logo-loader",children:[a.jsx("div",{className:"logo-ring"}),a.jsx("img",{src:"/assets/img/MuqawamaLogo.png",alt:"Muqawama",className:"logo-pulse"})]}),a.jsx("p",{children:"Loading your registration..."})]})}):y?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"header-actions",children:[a.jsx("span",{className:"user-email",children:y.email}),a.jsxs("button",{type:"button",className:"logout-btn",onClick:async()=>{await s.auth.signOut(),N(null),i(1)},children:[a.jsx("i",{className:"fas fa-sign-out-alt"})," Logout"]})]}),a.jsx("div",{className:"registration-header",children:a.jsxs("div",{className:"registration-header-logo",children:[a.jsx("img",{src:"/assets/img/title.png",alt:"Muqawama 2026"}),a.jsx("h2",{className:"registration-header-title",children:"Team Registration"}),a.jsx("p",{children:g?"Edit your team registration and update any details.":"Complete all steps to confirm your team registration."})]})}),w&&a.jsx("p",{className:"auth-error",children:w}),a.jsx(Ne,{}),(()=>{switch(n){case 1:default:return a.jsx(je,{});case 2:return a.jsx(fe,{});case 3:return a.jsx(me,{});case 4:return a.jsx(ge,{});case 5:return a.jsx(he,{});case 6:return a.jsx(de,{})}})()]}):a.jsx(l,{onSuccess:N})}function be(){return e.useEffect(()=>(document.body.classList.add("registration-body"),()=>document.body.classList.remove("registration-body")),[]),a.jsx(u,{children:a.jsx("div",{className:"registration-container",children:a.jsx(ve,{})})})}n.createRoot(document.getElementById("registration-root")).render(a.jsx(t.StrictMode,{children:a.jsx(be,{})}));
