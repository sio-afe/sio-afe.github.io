import{r as e,s,j as a,c as t,R as l}from"./supabaseClient-Bdusv2SU.js";import{T as i}from"./TournamentNavbar-D2cgzQdF.js";import{F as n}from"./Footer-YZurjJeH.js";function r({onMatchClick:t}){const[l,r]=e.useState([]),[c,d]=e.useState(!0),[o,m]=e.useState(1),[h]=e.useState(window.location.pathname.includes("/u17/")?"u17":"open-age");e.useEffect(()=>{x()},[h]);const x=async()=>{try{d(!0);const{data:e,error:a}=await s.from("matches").select("\n          *,\n          home_team:teams!matches_home_team_id_fkey(id, name, crest_url),\n          away_team:teams!matches_away_team_id_fkey(id, name, crest_url)\n        ").eq("category",h).order("match_number",{ascending:!0}).order("scheduled_time",{ascending:!0});if(a)throw a;if(r(e||[]),e&&e.length>0){const s=[...new Set(e.map(e=>e.match_number).filter(Boolean))],a=e.filter(e=>"completed"===e.status).map(e=>e.match_number).sort((e,s)=>s-e)[0];if(a){const e=s.some(e=>e>a);m(e?a+1:a)}else m(s[0]||1)}}catch(e){}finally{d(!1)}},j=e.useMemo(()=>{const e={};return l.forEach(s=>{const a=s.match_number||1;e[a]||(e[a]=[]),e[a].push(s)}),e},[l]),u=e.useMemo(()=>[...new Set(l.map(e=>e.match_number).filter(Boolean))].sort((e,s)=>e-s),[l]),p=e=>e?e.length>=5?e.substring(0,5):e:"TBD";if(c)return a.jsxs(a.Fragment,{children:[a.jsx(i,{}),a.jsx("div",{className:"fixtures-loading",children:a.jsxs("div",{className:"fixtures-loading-content",children:[a.jsxs("div",{className:"logo-loader",children:[a.jsx("div",{className:"logo-ring"}),a.jsx("img",{src:"/assets/img/MuqawamaLogo.png",alt:"Muqawama",className:"logo-pulse"})]}),a.jsx("p",{children:"Loading fixtures..."})]})}),a.jsx(n,{edition:"2026"})]});const v=j[o]||[];return a.jsxs(a.Fragment,{children:[a.jsx(i,{}),a.jsx("div",{className:"fixtures-page-v2",children:a.jsxs("div",{className:"fixtures-container-v2",children:[a.jsxs("div",{className:"fixtures-header-v2",children:[a.jsx("h1",{children:"Fixtures & Results"}),a.jsx("hr",{className:"fixtures-divider"})]}),u.length>0&&a.jsx("div",{className:"matchday-tabs-v2",children:u.map(e=>a.jsx("button",{className:"matchday-tab-v2 "+(o===e?"active":""),onClick:()=>m(e),children:e},e))}),a.jsx("div",{className:"matches-list-v2",children:v.length>0?v.map(e=>{var s,l,i,n,r,c,d,o;const m="completed"===e.status,h=e.home_score??0,x=e.away_score??0;return a.jsxs("div",{className:"match-card-v2 clickable",onClick:()=>t&&t(e.id),style:{cursor:t?"pointer":"default"},children:[a.jsx("div",{className:"match-time-mobile",children:a.jsx("span",{className:"time-text",children:p(e.scheduled_time)})}),a.jsxs("div",{className:"match-row-v2",children:[a.jsx("div",{className:"match-time-desktop",children:a.jsx("span",{className:"time-text",children:p(e.scheduled_time)})}),a.jsxs("div",{className:"match-team-v2 home",children:[a.jsx("span",{className:"team-name-v2",children:(null==(s=e.home_team)?void 0:s.name)||"TBD"}),a.jsx("div",{className:"team-logo-v2",children:(null==(l=e.home_team)?void 0:l.crest_url)?a.jsx("img",{src:e.home_team.crest_url,alt:e.home_team.name}):a.jsx("span",{children:(null==(n=null==(i=e.home_team)?void 0:i.name)?void 0:n.charAt(0))||"?"})})]}),a.jsx("div",{className:"match-score-v2",children:m?a.jsxs("span",{className:"score-display",children:[h," - ",x]}):a.jsx("span",{className:"vs-display",children:"vs"})}),a.jsxs("div",{className:"match-team-v2 away",children:[a.jsx("div",{className:"team-logo-v2",children:(null==(r=e.away_team)?void 0:r.crest_url)?a.jsx("img",{src:e.away_team.crest_url,alt:e.away_team.name}):a.jsx("span",{children:(null==(d=null==(c=e.away_team)?void 0:c.name)?void 0:d.charAt(0))||"?"})}),a.jsx("span",{className:"team-name-v2",children:(null==(o=e.away_team)?void 0:o.name)||"TBD"})]}),e.venue&&a.jsx("div",{className:"match-venue-desktop",children:a.jsx("span",{children:e.venue})})]}),e.venue&&a.jsx("div",{className:"match-venue-mobile",children:a.jsx("span",{children:e.venue})})]},e.id)}):a.jsxs("div",{className:"no-matches-v2",children:[a.jsx("i",{className:"fas fa-calendar-times"}),a.jsxs("p",{children:["No fixtures scheduled for Matchday ",o]})]})})]})}),a.jsx(n,{edition:"2026"})]})}function c({homePlayers:s=[],awayPlayers:t=[],homeTeam:l={},awayTeam:i={},goals:n=[]}){const[r,c]=e.useState(null),[d,o]=e.useState(!0),m=s.filter(e=>!e.is_substitute&&"SUB"!==e.position).slice(0,7),h=t.filter(e=>!e.is_substitute&&"SUB"!==e.position).slice(0,7),x=(e,s)=>{c(e),o(s)},j=()=>{c(null)};if(!(m.length>0||h.length>0))return a.jsxs("div",{className:"match-formation-empty",children:[a.jsx("i",{className:"fas fa-users-slash"}),a.jsx("p",{children:"Formation not available"})]});const u=r?(e=>{let s=0,a=0;return n.forEach(t=>{t.scorer_name===e&&s++,t.assist_name===e&&a++}),{goalsScored:s,assists:a}})(r.player_name):null,p=r?(e=>{if(!e)return null;const s=new Date(e),a=new Date;let t=a.getFullYear()-s.getFullYear();const l=a.getMonth()-s.getMonth();return(l<0||0===l&&a.getDate()<s.getDate())&&t--,t})(r.date_of_birth):null;return a.jsxs("div",{className:"match-formation-field",children:[a.jsx("div",{className:"formation-field-wrapper",children:a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 74 111",className:"match-field-svg",children:[a.jsx("rect",{width:"74",height:"111",fill:"#0d1117"}),a.jsxs("g",{fill:"none",stroke:"rgba(255,255,255,0.35)",strokeWidth:"0.5",transform:"translate(3 3)",children:[a.jsx("path",{d:"M 0 0 h 68 v 105 h -68 Z"}),a.jsx("path",{d:"M 0 52.5 h 68"}),a.jsx("circle",{r:"9.15",cx:"34",cy:"52.5"}),a.jsx("circle",{r:"0.75",cx:"34",cy:"52.5",fill:"rgba(255,255,255,0.35)",stroke:"none"}),a.jsxs("g",{children:[a.jsx("path",{d:"M 13.84 0 v 16.5 h 40.32 v -16.5"}),a.jsx("path",{d:"M 24.84 0 v 5.5 h 18.32 v -5.5"}),a.jsx("circle",{r:"0.75",cx:"34",cy:"10.94",fill:"rgba(255,255,255,0.35)",stroke:"none"}),a.jsx("path",{d:"M 26.733027 16.5 a 9.15 9.15 0 0 0 14.533946 0"})]}),a.jsxs("g",{transform:"rotate(180,34,52.5)",children:[a.jsx("path",{d:"M 13.84 0 v 16.5 h 40.32 v -16.5"}),a.jsx("path",{d:"M 24.84 0 v 5.5 h 18.32 v -5.5"}),a.jsx("circle",{r:"0.75",cx:"34",cy:"10.94",fill:"rgba(255,255,255,0.35)",stroke:"none"}),a.jsx("path",{d:"M 26.733027 16.5 a 9.15 9.15 0 0 0 14.533946 0"})]}),a.jsx("path",{d:"M 0 2 a 2 2 0 0 0 2 -2M 66 0 a 2 2 0 0 0 2 2M 68 103 a 2 2 0 0 0 -2 2M 2 105 a 2 2 0 0 0 -2 -2"})]}),m.map(e=>{var s,t;const l=(e=>({x:"number"==typeof e.position_x?e.position_x:50,y:4+(100-("number"==typeof e.position_y?e.position_y:50))/100*44}))(e),i=3+l.x/100*68,n=3+l.y/100*105;return a.jsxs("g",{transform:`translate(${i}, ${n})`,style:{cursor:"pointer"},onClick:()=>x(e,!0),onPointerDown:()=>x(e,!0),role:"button",tabIndex:0,onKeyDown:s=>{"Enter"!==s.key&&" "!==s.key||x(e,!0)},children:[a.jsx("circle",{r:"3.8",fill:"none",stroke:"#4a90e2",strokeWidth:"0.3"}),a.jsx("circle",{r:"3",fill:"#1e2a38",stroke:"none"}),e.player_image?a.jsxs(a.Fragment,{children:[a.jsx("defs",{children:a.jsx("clipPath",{id:`clip-home-${e.id}`,children:a.jsx("circle",{r:"3",cx:"0",cy:"0"})})}),a.jsx("image",{href:e.player_image,x:"-3",y:"-3",width:"6",height:"6",clipPath:`url(#clip-home-${e.id})`,preserveAspectRatio:"xMidYMid slice"})]}):a.jsx("text",{x:"0",y:"1",textAnchor:"middle",fill:"#4a90e2",fontSize:"2.2",fontWeight:"700",children:e.position||"?"}),a.jsx("text",{x:"0",y:"6.5",textAnchor:"middle",fill:"#4a90e2",fontSize:"1.8",fontWeight:"600",children:(null==(t=null==(s=e.player_name)?void 0:s.split(" ")[0])?void 0:t.substring(0,8))||""})]},`home-${e.id}`)}),h.map(e=>{var s,t;const l=(e=>({x:"number"==typeof e.position_x?e.position_x:50,y:52+("number"==typeof e.position_y?e.position_y:50)/100*44}))(e),i=3+l.x/100*68,n=3+l.y/100*105;return a.jsxs("g",{transform:`translate(${i}, ${n})`,style:{cursor:"pointer"},onClick:()=>x(e,!1),onPointerDown:()=>x(e,!1),role:"button",tabIndex:0,onKeyDown:s=>{"Enter"!==s.key&&" "!==s.key||x(e,!1)},children:[a.jsx("circle",{r:"3.8",fill:"none",stroke:"#e63946",strokeWidth:"0.3"}),a.jsx("circle",{r:"3",fill:"#2a1e1e",stroke:"none"}),e.player_image?a.jsxs(a.Fragment,{children:[a.jsx("defs",{children:a.jsx("clipPath",{id:`clip-away-${e.id}`,children:a.jsx("circle",{r:"3",cx:"0",cy:"0"})})}),a.jsx("image",{href:e.player_image,x:"-3",y:"-3",width:"6",height:"6",clipPath:`url(#clip-away-${e.id})`,preserveAspectRatio:"xMidYMid slice"})]}):a.jsx("text",{x:"0",y:"1",textAnchor:"middle",fill:"#e63946",fontSize:"2.2",fontWeight:"700",children:e.position||"?"}),a.jsx("text",{x:"0",y:"6.5",textAnchor:"middle",fill:"#e63946",fontSize:"1.8",fontWeight:"600",children:(null==(t=null==(s=e.player_name)?void 0:s.split(" ")[0])?void 0:t.substring(0,8))||""})]},`away-${e.id}`)})]})}),a.jsxs("div",{className:"formation-legend",children:[a.jsxs("div",{className:"legend-item home",children:[a.jsx("span",{className:"legend-dot home"}),a.jsxs("span",{children:[l.name||"Home"," ",l.formation&&`(${l.formation})`]})]}),a.jsxs("div",{className:"legend-item away",children:[a.jsx("span",{className:"legend-dot away"}),a.jsxs("span",{children:[i.name||"Away"," ",i.formation&&`(${i.formation})`]})]})]}),r&&a.jsx("div",{className:"player-modal-overlay",onClick:j,children:a.jsxs("div",{className:"player-modal-card",onClick:e=>e.stopPropagation(),children:[a.jsx("button",{className:"player-modal-close",onClick:j,children:a.jsx("i",{className:"fas fa-times"})}),a.jsxs("div",{className:"player-modal-header "+(d?"home":"away"),children:[a.jsxs("div",{className:"player-modal-image",children:[r.player_image?a.jsx("img",{src:r.player_image,alt:r.player_name}):a.jsx("div",{className:"player-modal-placeholder",children:a.jsx("i",{className:"fas fa-user"})}),a.jsx("div",{className:"player-modal-ring "+(d?"home":"away")})]}),a.jsx("h3",{className:"player-modal-name",children:r.player_name}),a.jsx("p",{className:"player-modal-team",children:d?l.name:i.name})]}),a.jsx("div",{className:"player-modal-stats",children:a.jsx("table",{className:"player-stats-table-modal",children:a.jsxs("tbody",{children:[a.jsxs("tr",{children:[a.jsx("td",{className:"stat-label",children:"Position"}),a.jsx("td",{className:"stat-value",children:r.position||"N/A"})]}),p&&a.jsxs("tr",{children:[a.jsx("td",{className:"stat-label",children:"Age"}),a.jsxs("td",{className:"stat-value",children:[p," years"]})]}),a.jsxs("tr",{children:[a.jsx("td",{className:"stat-label",children:"Goals"}),a.jsx("td",{className:"stat-value stat-highlight goals",children:(null==u?void 0:u.goalsScored)||0})]}),a.jsxs("tr",{children:[a.jsx("td",{className:"stat-label",children:"Assists"}),a.jsx("td",{className:"stat-value stat-highlight assists",children:(null==u?void 0:u.assists)||0})]})]})})}),a.jsx("button",{className:"player-modal-view-btn",onClick:()=>{const e=window.location.pathname.includes("/u17/")?"u17":"open-age";window.location.href=`/muqawamah/2026/${e}/players/?player=${r.id}`},children:"View Full Details"})]})})]})}function d({matchId:t,onBack:l}){var r,d,o,m,h,x,j,u,p,v,y,g;const[_,N]=e.useState(null),[f,w]=e.useState([]),[b,M]=e.useState([]),[S,k]=e.useState([]),[B,q]=e.useState(!0);e.useEffect(()=>{t&&C()},[t]);const C=async()=>{var e,a;try{q(!0);const{data:l,error:i}=await s.from("matches").select("\n          *,\n          home_team:teams!matches_home_team_id_fkey(*),\n          away_team:teams!matches_away_team_id_fkey(*)\n        ").eq("id",t).single();if(i)throw i;N(l);const{data:n}=await s.from("match_goals").select("*").eq("match_id",t).order("minute",{ascending:!0});if(n&&k(n),null==(e=l.home_team)?void 0:e.registration_id){const{data:e}=await s.from("team_players").select("*").eq("team_id",l.home_team.registration_id).order("position");e&&w(e)}if(null==(a=l.away_team)?void 0:a.registration_id){const{data:e}=await s.from("team_players").select("*").eq("team_id",l.away_team.registration_id).order("position");e&&M(e)}}catch(l){}finally{q(!1)}},D=e=>({GK:"Goalkeeper",CB:"Defender",LB:"Defender",RB:"Defender",CDM:"Midfielder",CM:"Midfielder",CAM:"Midfielder",LM:"Midfielder",RM:"Midfielder",CF:"Forward",ST:"Forward",SUB:"Substitute"}[e]||e||"Player"),A=e=>{const s=["GK","CB","LB","RB","CDM","CM","CAM","LM","RM","CF","ST","SUB"];return[...e].sort((e,a)=>{const t=s.indexOf(e.position),l=s.indexOf(a.position);return(-1===t?99:t)-(-1===l?99:l)})};if(B)return a.jsxs(a.Fragment,{children:[a.jsx(i,{}),a.jsx("div",{className:"match-detail-loading",children:a.jsxs("div",{className:"fixtures-loading-content",children:[a.jsxs("div",{className:"logo-loader",children:[a.jsx("div",{className:"logo-ring"}),a.jsx("img",{src:"/assets/img/MuqawamaLogo.png",alt:"Muqawama",className:"logo-pulse"})]}),a.jsx("p",{children:"Loading match details..."})]})}),a.jsx(n,{edition:"2026"})]});if(!_)return a.jsxs(a.Fragment,{children:[a.jsx(i,{}),a.jsxs("div",{className:"match-detail-error",children:[a.jsx("i",{className:"fas fa-exclamation-triangle"}),a.jsx("p",{children:"Match not found"}),a.jsxs("button",{onClick:l,className:"back-btn",children:[a.jsx("i",{className:"fas fa-arrow-left"})," Back to Fixtures"]})]}),a.jsx(n,{edition:"2026"})]});const F="completed"===_.status,T=(()=>{const e={};return S.forEach(s=>{s.scorer_name&&(e[s.scorer_name]||(e[s.scorer_name]={name:s.scorer_name,goals:0,assists:0,team_id:s.team_id}),e[s.scorer_name].goals+=1),s.assist_name&&(e[s.assist_name]||(e[s.assist_name]={name:s.assist_name,goals:0,assists:0,team_id:s.team_id}),e[s.assist_name].assists+=1)}),Object.values(e).sort((e,s)=>s.goals!==e.goals?s.goals-e.goals:s.assists-e.assists)})();return a.jsxs(a.Fragment,{children:[a.jsx(i,{}),a.jsxs("div",{className:"match-detail-page",children:[a.jsx("section",{className:"match-header-section",children:a.jsxs("div",{className:"match-header-content",children:[a.jsxs("div",{className:"match-datetime",children:[a.jsx("p",{className:"match-date",children:(e=>{if(!e)return"TBD";return new Date(e).toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long"}).toUpperCase()})(_.match_date)}),a.jsx("p",{className:"match-time",children:(P=_.scheduled_time,P?P.substring(0,5):"TBD")})]}),a.jsxs("div",{className:"match-teams-header",children:[a.jsxs("div",{className:"header-team home",children:[a.jsx("div",{className:"team-logo-large",children:(null==(r=_.home_team)?void 0:r.crest_url)?a.jsx("img",{src:_.home_team.crest_url,alt:_.home_team.name}):a.jsx("span",{children:(null==(o=null==(d=_.home_team)?void 0:d.name)?void 0:o.charAt(0))||"?"})}),a.jsx("h4",{className:"team-name-header",children:(null==(m=_.home_team)?void 0:m.name)||"TBD"})]}),a.jsx("div",{className:"match-score-header",children:F?a.jsxs("span",{className:"score-big",children:[_.home_score," - ",_.away_score]}):a.jsx("span",{className:"score-vs",children:"VS"})}),a.jsxs("div",{className:"header-team away",children:[a.jsx("div",{className:"team-logo-large",children:(null==(h=_.away_team)?void 0:h.crest_url)?a.jsx("img",{src:_.away_team.crest_url,alt:_.away_team.name}):a.jsx("span",{children:(null==(j=null==(x=_.away_team)?void 0:x.name)?void 0:j.charAt(0))||"?"})}),a.jsx("h4",{className:"team-name-header",children:(null==(u=_.away_team)?void 0:u.name)||"TBD"})]})]}),a.jsxs("div",{className:"match-meta",children:[a.jsxs("p",{className:"matchday-label",children:["MATCHDAY ",_.match_number||1]}),_.venue&&a.jsx("p",{className:"venue-label",children:_.venue})]})]})}),a.jsx("section",{className:"match-detail-content",children:a.jsxs("div",{className:"match-detail-single-column",children:[a.jsxs("div",{className:"stats-panel",children:[a.jsx("h3",{className:"panel-title",children:"PLAYER STATS"}),T.length>0?a.jsxs("div",{className:"player-stats-list",children:[a.jsxs("div",{className:"player-stats-header",children:[a.jsx("span",{className:"ps-player",children:"Player"}),a.jsx("span",{className:"ps-team",children:"Team"}),a.jsx("span",{className:"ps-goals",children:"Goals"}),a.jsx("span",{className:"ps-assists",children:"Assists"})]}),T.map((e,s)=>{var t,l;return a.jsxs("div",{className:"player-stats-row",children:[a.jsx("span",{className:"ps-player",children:e.name}),a.jsx("span",{className:"ps-team",children:e.team_id===_.home_team_id?null==(t=_.home_team)?void 0:t.name:null==(l=_.away_team)?void 0:l.name}),a.jsx("span",{className:"ps-goals",children:e.goals}),a.jsx("span",{className:"ps-assists",children:e.assists})]},s)})]}):a.jsxs("div",{className:"no-stats-message",children:[a.jsx("i",{className:"fas fa-futbol"}),a.jsx("p",{children:F?"No player stats recorded":"Player stats will appear here after the match"})]})]}),a.jsxs("div",{className:"formation-section",children:[a.jsx("h3",{className:"panel-title",children:"FORMATIONS"}),a.jsx(c,{homePlayers:f,awayPlayers:b,homeTeam:_.home_team,awayTeam:_.away_team,goals:S})]}),a.jsxs("div",{className:"squads-section",children:[a.jsx("h3",{className:"panel-title",children:"SQUADS"}),a.jsxs("div",{className:"squads-grid",children:[a.jsxs("div",{className:"squad-column home",children:[a.jsxs("div",{className:"squad-header",children:[(null==(p=_.home_team)?void 0:p.crest_url)&&a.jsx("img",{src:_.home_team.crest_url,alt:"",className:"squad-team-logo"}),a.jsx("span",{children:null==(v=_.home_team)?void 0:v.name})]}),a.jsxs("div",{className:"squad-list",children:[A(f).map((e,s)=>a.jsxs("div",{className:"squad-player-row "+("SUB"===e.position||e.is_substitute?"substitute":""),children:[a.jsx("span",{className:"player-name",children:e.player_name}),a.jsx("span",{className:"player-position",children:D(e.position)})]},e.id)),0===f.length&&a.jsx("p",{className:"no-squad",children:"Squad not available"})]})]}),a.jsxs("div",{className:"squad-column away",children:[a.jsxs("div",{className:"squad-header away",children:[a.jsx("span",{children:null==(y=_.away_team)?void 0:y.name}),(null==(g=_.away_team)?void 0:g.crest_url)&&a.jsx("img",{src:_.away_team.crest_url,alt:"",className:"squad-team-logo"})]}),a.jsxs("div",{className:"squad-list",children:[A(b).map((e,s)=>a.jsxs("div",{className:"squad-player-row "+("SUB"===e.position||e.is_substitute?"substitute":""),children:[a.jsx("span",{className:"player-name",children:e.player_name}),a.jsx("span",{className:"player-position",children:D(e.position)})]},e.id)),0===b.length&&a.jsx("p",{className:"no-squad",children:"Squad not available"})]})]})]})]})]})}),a.jsx("div",{className:"match-detail-footer",children:a.jsxs("button",{onClick:l,className:"back-btn",children:[a.jsx("i",{className:"fas fa-arrow-left"})," Back to Fixtures"]})})]}),a.jsx(n,{edition:"2026"})]});var P}function o(){const[s,t]=e.useState("list"),[l,i]=e.useState(null);e.useEffect(()=>{const e=new URLSearchParams(window.location.search).get("match");return e&&(i(e),t("detail")),window.addEventListener("popstate",n),()=>window.removeEventListener("popstate",n)},[]);const n=()=>{const e=new URLSearchParams(window.location.search).get("match");e?(i(e),t("detail")):(t("list"),i(null))},c=()=>{const e=window.location.pathname;window.history.pushState({},"",e),t("list"),i(null)};return"detail"===s&&l?a.jsx(d,{matchId:l,onBack:c}):a.jsx(r,{onMatchClick:e=>{const s=`${window.location.pathname}?match=${e}`;window.history.pushState({matchId:e},"",s),i(e),t("detail"),window.scrollTo(0,0)}})}t.createRoot(document.getElementById("fixtures-root")).render(a.jsx(l.StrictMode,{children:a.jsx(o,{})}));
