import{r as e,j as a,s as t,R as s,c as n}from"./supabaseClient-Bdusv2SU.js";/* empty css            */function i({onSuccess:s}){const[n,i]=e.useState(""),[r,l]=e.useState(!1);return a.jsx("div",{className:"auth-modal",children:a.jsxs("div",{className:"auth-card",children:[a.jsx("div",{className:"auth-logo",children:a.jsx("img",{src:"/assets/img/title.png",alt:"Muqawama 2026"})}),a.jsx("h2",{children:"Welcome to Muqawama 2026"}),a.jsx("p",{className:"auth-subtitle",children:"Sign in with your Google account to register your team and manage your registration."}),n&&a.jsx("p",{className:"auth-error",children:n}),a.jsx("div",{className:"auth-alternative",children:a.jsx("button",{type:"button",className:"auth-oauth-btn google-btn",onClick:async()=>{i(""),l(!0);try{const{data:e,error:a}=await t.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.origin+"/muqawamah/2026/register/"}});if(a)throw a}catch(e){i(`Google sign-in failed: ${e.message}. Please contact support.`),l(!1)}},disabled:r,children:r?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"spinner-small"})," Signing in..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fab fa-google"})," Continue with Google"]})})}),a.jsxs("p",{className:"auth-note",children:[a.jsx("i",{className:"fas fa-info-circle"})," Your Google account will be used to authenticate and save your team registration."]})]})})}const r=e.createContext(null),l=()=>{const a=e.useContext(r);if(!a)throw new Error("useRegistration must be used within RegistrationProvider");return a},o=()=>[...["GK","CB","LB","RB","CM","LM","ST"].map((e,a)=>({id:`${e}-${a}`,name:"",age:"",aadhar_no:"",position:e,isSubstitute:!1,image:null,x:50,y:50})),...["SUB1","SUB2","SUB3","SUB4"].map((e,a)=>({id:`${e}-${a}`,name:"",age:"",aadhar_no:"",position:"SUB",isSubstitute:!0,image:null,x:10+20*a,y:90}))],c={teamName:"",category:"open-age",teamLogo:null,teamLogoFileName:null,captainName:"",captainEmail:"",captainPhone:"",formation:"1-3-2-1"},d=({children:s})=>{const[n,i]=e.useState(1),[l,d]=e.useState(c),[m,u]=e.useState(o()),[h,p]=e.useState(!1),[f,g]=e.useState(!1),[x,j]=e.useState(null),[y,N]=e.useState(null),[v,b]=e.useState(null),[w,S]=e.useState(!1),[P,C]=e.useState(null),[_,k]=e.useState(null),[M,E]=e.useState(0),R=()=>{d(c),u(o()),N(null),b(null),C(null),k(null),E(0),i(1)},T=e.useCallback(async e=>{g(!0),j(null);try{const{data:{user:a}}=await t.auth.getUser();if(!a)throw new Error("You must be logged in to save your progress.");let s=v;const n={user_id:a.id,team_name:l.teamName||"Draft Team",category:l.category,team_logo:l.teamLogo,captain_name:l.captainName,captain_email:l.captainEmail||a.email,captain_phone:l.captainPhone,formation:l.formation,status:"submitted",last_saved_step:e,submitted_at:(new Date).toISOString()};if(v){const{error:e}=await t.from("team_registrations").update(n).eq("id",v);if(e)throw e}else{const{data:e,error:a}=await t.from("team_registrations").insert(n).select().single();if(a)throw a;s=e.id,b(s)}if(m.filter(e=>e.name||e.image).length>0&&s){await t.from("team_players").delete().eq("team_id",s);const e=m.map(e=>({team_id:s,player_name:e.name||"",player_age:e.age?parseInt(e.age):null,aadhar_no:e.aadhar_no||null,position:e.position||"SUB",is_substitute:e.isSubstitute||!1,player_image:e.image||null,position_x:"number"!=typeof e.x||isNaN(e.x)?50:e.x,position_y:"number"!=typeof e.y||isNaN(e.y)?50:e.y})),{error:a}=await t.from("team_players").insert(e);if(a)throw a}return E(e),{success:!0,teamId:s}}catch(a){return j(a.message),{success:!1,error:a.message}}finally{g(!1)}},[v,l,m]),L=e.useMemo(()=>({step:n,setStep:i,teamData:l,setTeamData:d,players:m,setPlayers:u,loading:h,setLoading:p,saving:f,setSaving:g,error:x,setError:j,successTeamId:y,setSuccessTeamId:N,existingTeamId:v,setExistingTeamId:b,readOnlyMode:w,setReadOnlyMode:S,paymentStatus:P,setPaymentStatus:C,transactionId:_,setTransactionId:k,lastSavedStep:M,setLastSavedStep:E,resetForm:R,saveProgress:T}),[n,l,m,h,f,x,y,v,w,P,_,M,T]);return a.jsx(r.Provider,{value:L,children:s})};const m=(()=>{let e=0;return()=>(e+=1,`u${`0000${(Math.random()*36**4|0).toString(36)}`.slice(-4)}${e}`)})();function u(e){const a=[];for(let t=0,s=e.length;t<s;t++)a.push(e[t]);return a}let h=null;function p(e={}){return h||(e.includeStyleProperties?(h=e.includeStyleProperties,h):(h=u(window.getComputedStyle(document.documentElement)),h))}function f(e,a){const t=(e.ownerDocument.defaultView||window).getComputedStyle(e).getPropertyValue(a);return t?parseFloat(t.replace("px","")):0}function g(e,a={}){return{width:a.width||function(e){const a=f(e,"border-left-width"),t=f(e,"border-right-width");return e.clientWidth+a+t}(e),height:a.height||function(e){const a=f(e,"border-top-width"),t=f(e,"border-bottom-width");return e.clientHeight+a+t}(e)}}const x=16384;function j(e){return new Promise((a,t)=>{const s=new Image;s.onload=()=>{s.decode().then(()=>{requestAnimationFrame(()=>a(s))})},s.onerror=t,s.crossOrigin="anonymous",s.decoding="async",s.src=e})}async function y(e,a,t){const s="http://www.w3.org/2000/svg",n=document.createElementNS(s,"svg"),i=document.createElementNS(s,"foreignObject");return n.setAttribute("width",`${a}`),n.setAttribute("height",`${t}`),n.setAttribute("viewBox",`0 0 ${a} ${t}`),i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("externalResourcesRequired","true"),n.appendChild(i),i.appendChild(e),async function(e){return Promise.resolve().then(()=>(new XMLSerializer).serializeToString(e)).then(encodeURIComponent).then(e=>`data:image/svg+xml;charset=utf-8,${e}`)}(n)}const N=(e,a)=>{if(e instanceof a)return!0;const t=Object.getPrototypeOf(e);return null!==t&&(t.constructor.name===a.name||N(t,a))};function v(e,a,t,s){const n=`.${e}:${a}`,i=t.cssText?function(e){const a=e.getPropertyValue("content");return`${e.cssText} content: '${a.replace(/'|"/g,"")}';`}(t):function(e,a){return p(a).map(a=>`${a}: ${e.getPropertyValue(a)}${e.getPropertyPriority(a)?" !important":""};`).join(" ")}(t,s);return document.createTextNode(`${n}{${i}}`)}function b(e,a,t,s){const n=window.getComputedStyle(e,t),i=n.getPropertyValue("content");if(""===i||"none"===i)return;const r=m();try{a.className=`${a.className} ${r}`}catch(o){return}const l=document.createElement("style");l.appendChild(v(r,t,n,s)),a.appendChild(l)}const w="application/font-woff",S="image/jpeg",P={woff:w,woff2:w,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:S,jpeg:S,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function C(e){const a=function(e){const a=/\.([^./]*?)$/g.exec(e);return a?a[1]:""}(e).toLowerCase();return P[a]||""}function _(e){return-1!==e.search(/^(data:)/)}async function k(e,a,t){const s=await fetch(e,a);if(404===s.status)throw new Error(`Resource "${s.url}" not found`);const n=await s.blob();return new Promise((e,a)=>{const i=new FileReader;i.onerror=a,i.onloadend=()=>{try{e(t({res:s,result:i.result}))}catch(n){a(n)}},i.readAsDataURL(n)})}const M={};async function E(e,a,t){const s=function(e,a,t){let s=e.replace(/\?.*/,"");return t&&(s=e),/ttf|otf|eot|woff2?/i.test(s)&&(s=s.replace(/.*\//,"")),a?`[${a}]${s}`:s}(e,a,t.includeQueryParams);if(null!=M[s])return M[s];let n;t.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime());try{const s=await k(e,t.fetchRequestInit,({res:e,result:t})=>(a||(a=e.headers.get("Content-Type")||""),function(e){return e.split(/,/)[1]}(t)));n=function(e,a){return`data:${a};base64,${e}`}(s,a)}catch(i){n=t.imagePlaceholder||"";let a=`Failed to fetch resource: ${e}`;i&&(a="string"==typeof i?i:i.message)}return M[s]=n,n}async function R(e,a){return N(e,HTMLCanvasElement)?async function(e){const a=e.toDataURL();return"data:,"===a?e.cloneNode(!1):j(a)}(e):N(e,HTMLVideoElement)?async function(e,a){if(e.currentSrc){const a=document.createElement("canvas"),t=a.getContext("2d");return a.width=e.clientWidth,a.height=e.clientHeight,null==t||t.drawImage(e,0,0,a.width,a.height),j(a.toDataURL())}const t=e.poster,s=C(t);return j(await E(t,s,a))}(e,a):N(e,HTMLIFrameElement)?async function(e,a){var t;try{if(null===(t=null==e?void 0:e.contentDocument)||void 0===t?void 0:t.body)return await q(e.contentDocument.body,a,!0)}catch(s){}return e.cloneNode(!1)}(e,a):e.cloneNode(L(e))}const T=e=>null!=e.tagName&&"SLOT"===e.tagName.toUpperCase(),L=e=>null!=e.tagName&&"SVG"===e.tagName.toUpperCase();function $(e,a,t){return N(a,Element)&&(function(e,a,t){const s=a.style;if(!s)return;const n=window.getComputedStyle(e);n.cssText?(s.cssText=n.cssText,s.transformOrigin=n.transformOrigin):p(t).forEach(t=>{let i=n.getPropertyValue(t);if("font-size"===t&&i.endsWith("px")){const e=Math.floor(parseFloat(i.substring(0,i.length-2)))-.1;i=`${e}px`}N(e,HTMLIFrameElement)&&"display"===t&&"inline"===i&&(i="block"),"d"===t&&a.getAttribute("d")&&(i=`path(${a.getAttribute("d")})`),s.setProperty(t,i,n.getPropertyPriority(t))})}(e,a,t),function(e,a,t){b(e,a,":before",t),b(e,a,":after",t)}(e,a,t),function(e,a){N(e,HTMLTextAreaElement)&&(a.innerHTML=e.value),N(e,HTMLInputElement)&&a.setAttribute("value",e.value)}(e,a),function(e,a){if(N(e,HTMLSelectElement)){const t=a,s=Array.from(t.children).find(a=>e.value===a.getAttribute("value"));s&&s.setAttribute("selected","")}}(e,a)),a}async function q(e,a,t){return t||!a.filter||a.filter(e)?Promise.resolve(e).then(e=>R(e,a)).then(t=>async function(e,a,t){var s,n;if(L(a))return a;let i=[];return i=T(e)&&e.assignedNodes?u(e.assignedNodes()):N(e,HTMLIFrameElement)&&(null===(s=e.contentDocument)||void 0===s?void 0:s.body)?u(e.contentDocument.body.childNodes):u((null!==(n=e.shadowRoot)&&void 0!==n?n:e).childNodes),0===i.length||N(e,HTMLVideoElement)||await i.reduce((e,s)=>e.then(()=>q(s,t)).then(e=>{e&&a.appendChild(e)}),Promise.resolve()),a}(e,t,a)).then(t=>$(e,t,a)).then(e=>async function(e,a){const t=e.querySelectorAll?e.querySelectorAll("use"):[];if(0===t.length)return e;const s={};for(let i=0;i<t.length;i++){const n=t[i].getAttribute("xlink:href");if(n){const t=e.querySelector(n),i=document.querySelector(n);t||!i||s[n]||(s[n]=await q(i,a,!0))}}const n=Object.values(s);if(n.length){const a="http://www.w3.org/1999/xhtml",t=document.createElementNS(a,"svg");t.setAttribute("xmlns",a),t.style.position="absolute",t.style.width="0",t.style.height="0",t.style.overflow="hidden",t.style.display="none";const s=document.createElementNS(a,"defs");t.appendChild(s);for(let e=0;e<n.length;e++)s.appendChild(n[e]);e.appendChild(t)}return e}(e,a)):null}const F=/url\((['"]?)([^'"]+?)\1\)/g,D=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,I=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;async function A(e,a,t,s,n){try{const i=t?function(e,a){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;const t=document.implementation.createHTMLDocument(),s=t.createElement("base"),n=t.createElement("a");return t.head.appendChild(s),t.body.appendChild(n),a&&(s.href=a),n.href=e,n.href}(a,t):a,r=C(a);let l;return n||(l=await E(i,r,s)),e.replace(function(e){const a=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${a})(['"]?\\))`,"g")}(a),`$1${l}$3`)}catch(i){}return e}function U(e){return-1!==e.search(F)}async function B(e,a,t){if(!U(e))return e;const s=function(e,{preferredFontFormat:a}){return a?e.replace(I,e=>{for(;;){const[t,,s]=D.exec(e)||[];if(!s)return"";if(s===a)return`src: ${t};`}}):e}(e,t),n=function(e){const a=[];return e.replace(F,(e,t,s)=>(a.push(s),e)),a.filter(e=>!_(e))}(s);return n.reduce((e,s)=>e.then(e=>A(e,s,a,t)),Promise.resolve(s))}async function O(e,a,t){var s;const n=null===(s=a.style)||void 0===s?void 0:s.getPropertyValue(e);if(n){const s=await B(n,null,t);return a.style.setProperty(e,s,a.style.getPropertyPriority(e)),!0}return!1}async function G(e,a){N(e,Element)&&(await async function(e,a){await O("background",e,a)||await O("background-image",e,a),await O("mask",e,a)||await O("-webkit-mask",e,a)||await O("mask-image",e,a)||await O("-webkit-mask-image",e,a)}(e,a),await async function(e,a){const t=N(e,HTMLImageElement);if((!t||_(e.src))&&(!N(e,SVGImageElement)||_(e.href.baseVal)))return;const s=t?e.src:e.href.baseVal,n=await E(s,C(s),a);await new Promise((s,i)=>{e.onload=s,e.onerror=a.onImageErrorHandler?(...e)=>{try{s(a.onImageErrorHandler(...e))}catch(t){i(t)}}:i;const r=e;r.decode&&(r.decode=s),"lazy"===r.loading&&(r.loading="eager"),t?(e.srcset="",e.src=n):e.href.baseVal=n})}(e,a),await async function(e,a){const t=u(e.childNodes).map(e=>G(e,a));await Promise.all(t).then(()=>e)}(e,a))}const z={};async function H(e){let a=z[e];if(null!=a)return a;const t=await fetch(e);return a={url:e,cssText:await t.text()},z[e]=a,a}async function V(e,a){let t=e.cssText;const s=/url\(["']?([^"')]+)["']?\)/g,n=(t.match(/url\([^)]+\)/g)||[]).map(async n=>{let i=n.replace(s,"$1");return i.startsWith("https://")||(i=new URL(i,e.url).href),k(i,a.fetchRequestInit,({result:e})=>(t=t.replace(n,`url(${e})`),[n,e]))});return Promise.all(n).then(()=>t)}function W(e){if(null==e)return[];const a=[];let t=e.replace(/(\/\*[\s\S]*?\*\/)/gi,"");const s=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const e=s.exec(t);if(null===e)break;a.push(e[0])}t=t.replace(s,"");const n=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,i=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let e=n.exec(t);if(null===e){if(e=i.exec(t),null===e)break;n.lastIndex=i.lastIndex}else i.lastIndex=n.lastIndex;a.push(e[0])}return a}async function Y(e,a){if(null==e.ownerDocument)throw new Error("Provided element is not within a Document");const t=u(e.ownerDocument.styleSheets),s=await async function(e,a){const t=[],s=[];return e.forEach(t=>{if("cssRules"in t)try{u(t.cssRules||[]).forEach((e,n)=>{if(e.type===CSSRule.IMPORT_RULE){let i=n+1;const r=H(e.href).then(e=>V(e,a)).then(e=>W(e).forEach(e=>{try{t.insertRule(e,e.startsWith("@import")?i+=1:t.cssRules.length)}catch(a){}})).catch(e=>{});s.push(r)}})}catch(n){const i=e.find(e=>null==e.href)||document.styleSheets[0];null!=t.href&&s.push(H(t.href).then(e=>V(e,a)).then(e=>W(e).forEach(e=>{i.insertRule(e,i.cssRules.length)})).catch(e=>{}))}}),Promise.all(s).then(()=>(e.forEach(e=>{if("cssRules"in e)try{u(e.cssRules||[]).forEach(e=>{t.push(e)})}catch(a){}}),t))}(t,a);return function(e){return e.filter(e=>e.type===CSSRule.FONT_FACE_RULE).filter(e=>U(e.style.getPropertyValue("src")))}(s)}function K(e){return e.trim().replace(/["']/g,"")}async function Q(e,a){const t=await Y(e,a),s=function(e){const a=new Set;return function e(t){(t.style.fontFamily||getComputedStyle(t).fontFamily).split(",").forEach(e=>{a.add(K(e))}),Array.from(t.children).forEach(a=>{a instanceof HTMLElement&&e(a)})}(e),a}(e);return(await Promise.all(t.filter(e=>s.has(K(e.style.fontFamily))).map(e=>{const t=e.parentStyleSheet?e.parentStyleSheet.href:null;return B(e.cssText,t,a)}))).join("\n")}async function J(e,a={}){const{width:t,height:s}=g(e,a),n=await q(e,a,!0);await async function(e,a){const t=null!=a.fontEmbedCSS?a.fontEmbedCSS:a.skipFonts?null:await Q(e,a);if(t){const a=document.createElement("style"),s=document.createTextNode(t);a.appendChild(s),e.firstChild?e.insertBefore(a,e.firstChild):e.appendChild(a)}}(n,a),await G(n,a),function(e,a){const{style:t}=e;a.backgroundColor&&(t.backgroundColor=a.backgroundColor),a.width&&(t.width=`${a.width}px`),a.height&&(t.height=`${a.height}px`);const s=a.style;null!=s&&Object.keys(s).forEach(e=>{t[e]=s[e]})}(n,a);return await y(n,t,s)}async function X(e,a={}){const{width:t,height:s}=g(e,a),n=await J(e,a),i=await j(n),r=document.createElement("canvas"),l=r.getContext("2d"),o=a.pixelRatio||function(){let e,a;try{a=process}catch(s){}const t=a&&a.env?a.env.devicePixelRatio:null;return t&&(e=parseInt(t,10),Number.isNaN(e)&&(e=1)),e||window.devicePixelRatio||1}(),c=a.canvasWidth||t,d=a.canvasHeight||s;return r.width=c*o,r.height=d*o,a.skipAutoScale||function(e){(e.width>x||e.height>x)&&(e.width>x&&e.height>x?e.width>e.height?(e.height*=x/e.width,e.width=x):(e.width*=x/e.height,e.height=x):e.width>x?(e.height*=x/e.width,e.width=x):(e.width*=x/e.height,e.height=x))}(r),r.style.width=`${c}`,r.style.height=`${d}`,a.backgroundColor&&(l.fillStyle=a.backgroundColor,l.fillRect(0,0,r.width,r.height)),l.drawImage(i,0,0,r.width,r.height),r}const Z=s.forwardRef(({children:e,...t},s)=>a.jsxs("svg",{ref:s,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 74 111",className:"field-svg",...t,children:[a.jsx("rect",{width:"74",height:"111",fill:"#ffffff"}),a.jsxs("g",{fill:"none",stroke:"#000",strokeWidth:"0.5",transform:"translate(3 3)",children:[a.jsx("path",{d:"M 0 0 h 68 v 105 h -68 Z"}),a.jsx("path",{d:"M 0 52.5 h 68"}),a.jsx("circle",{r:"9.15",cx:"34",cy:"52.5"}),a.jsx("circle",{r:"0.75",cx:"34",cy:"52.5",fill:"#000",stroke:"none"}),a.jsxs("g",{children:[a.jsx("path",{d:"M 13.84 0 v 16.5 h 40.32 v -16.5"}),a.jsx("path",{d:"M 24.84 0 v 5.5 h 18.32 v -5.5"}),a.jsx("circle",{r:"0.75",cx:"34",cy:"10.94",fill:"#000",stroke:"none"}),a.jsx("path",{d:"M 26.733027 16.5 a 9.15 9.15 0 0 0 14.533946 0"})]}),a.jsxs("g",{transform:"rotate(180,34,52.5)",children:[a.jsx("path",{d:"M 13.84 0 v 16.5 h 40.32 v -16.5"}),a.jsx("path",{d:"M 24.84 0 v 5.5 h 18.32 v -5.5"}),a.jsx("circle",{r:"0.75",cx:"34",cy:"10.94",fill:"#000",stroke:"none"}),a.jsx("path",{d:"M 26.733027 16.5 a 9.15 9.15 0 0 0 14.533946 0"})]}),a.jsx("path",{d:"M 0 2 a 2 2 0 0 0 2 -2M 66 0 a 2 2 0 0 0 2 2M 68 103 a 2 2 0 0 0 -2 2M 2 105 a 2 2 0 0 0 -2 -2"})]}),e]}));function ee({players:t,editable:s=!1,onDragStart:n,onDrag:i,onDragEnd:r,showDownload:l=!1}){const o=e.useRef(null),c=e.useRef(null),[d,m]=e.useState(!1),[u,h]=e.useState(null),p=e.useMemo(()=>`muqawamah-formation-${(new Date).toISOString().split("T")[0]}.png`,[]),f=()=>{u&&(h(null),r&&r())};return a.jsxs("div",{className:"formation-preview-wrapper",children:[a.jsx("div",{className:"football-field-svg",ref:o,onMouseMove:e=>{u&&s&&o.current&&(e.preventDefault(),i&&i(e))},onMouseUp:f,onMouseLeave:f,onTouchMove:e=>{u&&s&&o.current&&(e.preventDefault(),i&&i(e))},onTouchEnd:()=>{u&&(h(null),r&&r())},children:a.jsxs(Z,{ref:c,style:{width:"100%",height:"auto",maxWidth:"400px",display:"block",margin:"0 auto"},children:[a.jsx("defs",{children:t.map(e=>a.jsx("clipPath",{id:`player-clip-${e.id}`,children:a.jsx("circle",{r:"3.3",cx:"0",cy:"0"})},`clip-${e.id}`))}),t.map(e=>{const t=3+("number"!=typeof e.x||isNaN(e.x)?50:e.x)/100*68,i=3+("number"!=typeof e.y||isNaN(e.y)?50:e.y)/100*105,r="GK"===e.position,l=s&&!r;return a.jsxs("g",{transform:`translate(${t}, ${i})`,className:l?"player-marker-draggable":"player-marker-static",style:{cursor:l?"move":"default"},onMouseDown:a=>((e,a)=>{s&&"GK"!==a.position&&(e.preventDefault(),h(a.id),n&&n(e,a.id))})(a,e),onTouchStart:a=>((e,a)=>{s&&"GK"!==a.position&&(h(a.id),n&&n(e,a.id))})(a,e),children:[a.jsx("circle",{r:"3.3",fill:r?"#2d5a27":"#4a90e2",stroke:r?"#4a8c3f":"#fff",strokeWidth:"0.5"}),r&&a.jsx("text",{x:"0",y:"-4.5",textAnchor:"middle",fill:"#4a8c3f",fontSize:"2",children:"ðŸ”’"}),e.image?a.jsx("image",{href:e.image,x:"-3.3",y:"-3.3",width:"6.6",height:"6.6",clipPath:`url(#player-clip-${e.id})`,preserveAspectRatio:"xMidYMid slice"}):a.jsx("text",{x:"0",y:"1.1",textAnchor:"middle",fill:"#fff",fontSize:"2.75",fontWeight:"600",children:e.position}),a.jsx("text",{x:"0",y:"6",textAnchor:"middle",fill:"#000",fontSize:"2",fontWeight:"600",children:e.name||"Player"}),a.jsx("text",{x:"0",y:"8.2",textAnchor:"middle",fill:"#666",fontSize:"1.65",fontWeight:"400",children:e.position})]},e.id)})]})}),l&&a.jsxs("button",{type:"button",className:"download-formation-btn",onClick:async()=>{if(o.current)try{m(!0);const e=await async function(e,a={}){return(await X(e,a)).toDataURL()}(o.current,{cacheBust:!0,pixelRatio:window.devicePixelRatio||2,backgroundColor:"#ffffff"}),a=document.createElement("a");a.download=p,a.href=e,a.click()}catch(e){alert("Unable to download formation right now. Please try again.")}finally{m(!1)}},disabled:d,children:[a.jsx("i",{className:"fas fa-download"}),a.jsx("span",{children:d?"Preparing...":"Download Formation"})]})]})}Z.displayName="FootballFieldSVG";const ae=["1-3-2-1","1-2-3-1","1-2-2-2","1-3-1-2","1-4-1-1"],te=85,se=100,ne=(e,a)=>"GK"===e?Math.max(te,Math.min(se,a)):Math.max(0,Math.min(100,a)),ie={GK:50,CB:50,LB:25,RB:75,CDM:50,CM:50,CAM:50,LM:20,RM:80,CF:50,ST:50},re=e=>{const a=[...e],t=e.filter(e=>!e.isSubstitute),s={};return t.forEach(t=>{const n=t.position,i=s[n]||0;let r=ie[n]||50,l=POSITION_Y_MAP[n]||50;i>0&&("CB"===n||"CM"===n||"ST"===n||"CF"===n?r=1===i?30:2===i?70:50:"LB"===n?r=20-5*i:"RB"===n&&(r=80+5*i)),s[n]=i+1;const o=e.indexOf(t);a[o]={...t,x:r,y:l}}),a},le=(e,a)=>{if(!a)return re(e);const t=a.split("-").map(e=>parseInt(e,10)).filter(e=>!isNaN(e));if(0===t.length)return re(e);const s=[...e],n=[...e.filter(e=>!e.isSubstitute)].sort((e,a)=>"GK"===e.position?-1:"GK"===a.position?1:0),i=[92,78,55,35,15];let r=0;return t.forEach((a,t)=>{const l=i[t]||50;for(let i=0;i<a&&!(r>=n.length);i++){const t=n[r];let o;if(1===a)o=50;else if(2===a)o=0===i?30:70;else if(3===a)o=0===i?20:1===i?50:80;else if(4===a)o=[15,35,65,85][i];else if(5===a)o=[10,27.5,50,72.5,90][i];else{o=100/(a+1)*(i+1)}const c=ne(t.position,l),d=e.indexOf(t);s[d]={...t,x:o,y:c},r++}}),s};function oe(){const{players:t,setPlayers:s,teamData:n,setTeamData:i,setStep:r,saveProgress:o,saving:c,error:d}=l(),m=e.useRef(null),[u,h]=e.useState(null),[p,f]=e.useState(!1),g=e.useCallback((e,a,n)=>{const i="number"!=typeof a||isNaN(a)?50:a,r="number"!=typeof n||isNaN(n)?50:n,l=t.find(a=>a.id===e);"GK"!==(null==l?void 0:l.position)&&s(a=>a.map(a=>a.id===e?{...a,x:i,y:r}:a))},[s,t]),x=e.useCallback((e,a)=>{const s=t.find(e=>e.id===a);"GK"!==(null==s?void 0:s.position)&&h(a)},[t]),j=e.useCallback(e=>{const a=m.current;if(!u||!a)return;e.preventDefault();const t=a.querySelector("svg");if(!t)return;const s=t.getBoundingClientRect(),n=e.touches?e.touches[0].clientX:e.clientX,i=e.touches?e.touches[0].clientY:e.clientY,r=(n-s.left)/s.width*100,l=(i-s.top)/s.height*100,o=Math.min(Math.max(r,0),100),c=Math.min(Math.max(l,0),100);g(u,o,c)},[u,g]),y=e.useCallback(()=>{h(null)},[]);e.useEffect(()=>{if(!p&&n.formation&&t.length>0){const e=le(t,n.formation);s(e),f(!0)}},[]);return a.jsxs("form",{className:"registration-form",onSubmit:async e=>{e.preventDefault();(await o(3)).success&&r(4)},children:[a.jsx("h3",{children:"Step 3 Â· Formation & Positions"}),a.jsx("p",{className:"step-description",children:"Choose a preset formation below, then drag players to customize positions."}),a.jsxs("div",{className:"formation-instruction-box",children:[a.jsx("div",{className:"instruction-icon",children:a.jsx("i",{className:"fas fa-hand-pointer"})}),a.jsxs("div",{className:"instruction-content",children:[a.jsx("strong",{className:"instruction-title",children:"Interactive Field"}),a.jsx("p",{className:"instruction-text",children:"Click and drag any player to reposition them (GK is locked)"})]})]}),a.jsxs("div",{className:"formation-presets-section",children:[a.jsxs("div",{className:"presets-header",children:[a.jsx("i",{className:"fas fa-chess-board"}),a.jsx("span",{className:"presets-title",children:"Choose Formation"})]}),a.jsx("div",{className:"formation-buttons-grid",children:ae.map(e=>a.jsx("button",{type:"button",className:"formation-preset-btn "+(n.formation===e?"active":""),onClick:()=>(e=>{s(a=>le(a,e)),i(a=>({...a,formation:e}))})(e),children:a.jsx("span",{className:"formation-name",children:e})},e))})]}),a.jsx("div",{ref:m,className:"formation-field-container",children:a.jsx(ee,{players:t.filter(e=>!e.isSubstitute),editable:!0,onDragStart:x,onDrag:j,onDragEnd:y})}),d&&a.jsx("p",{className:"auth-error",children:d}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"secondary-btn",onClick:()=>r(2),disabled:c,children:"Back"}),a.jsx("button",{type:"submit",className:"primary-btn",disabled:c,children:c?a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-spinner fa-spin"})," Saving..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-save"})," Save & Review"]})})]})]})}function ce(){const{teamData:s,resetForm:n,paymentStatus:i,successTeamId:r,setPaymentStatus:o}=l(),[c,d]=e.useState(!0);e.useEffect(()=>{(async()=>{if(r)try{const{data:e,error:a}=await t.from("team_registrations").select("status, payment_status").eq("id",r).single();if(a)throw a;e&&("confirmed"===e.status||"confirmed"===e.payment_status?o("confirmed"):e.payment_status&&o(e.payment_status))}catch(e){}finally{d(!1)}else d(!1)})()},[r,o]);const m="confirmed"===i;return c?a.jsx("div",{className:"registration-form registration-complete",children:a.jsx("div",{className:"complete-container",children:a.jsxs("div",{className:"loading-content",children:[a.jsx("div",{className:"spinner"}),a.jsx("p",{children:"Loading registration status..."})]})})}):a.jsx("div",{className:"registration-form registration-complete",children:a.jsxs("div",{className:"complete-container",children:[a.jsx("div",{className:"complete-icon",children:a.jsx("div",{className:"icon-circle "+(m?"confirmed":"pending"),children:a.jsx("i",{className:"fas "+(m?"fa-check":"fa-clock")})})}),a.jsx("h2",{children:m?"Registration Confirmed!":"Registration Submitted!"}),a.jsxs("div",{className:"complete-team-info",children:[s.teamLogo&&a.jsx("img",{src:s.teamLogo,alt:s.teamName,className:"complete-team-logo"}),a.jsx("h3",{children:s.teamName}),a.jsxs("span",{className:"complete-category",children:["open-age"===s.category?"Open Age":"Under 17"," Category"]})]}),a.jsx("div",{className:"complete-message",children:m?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"confirmation-badge",children:[a.jsx("i",{className:"fas fa-check-circle"}),a.jsx("span",{children:"Payment Verified"})]}),a.jsxs("p",{className:"main-message",children:["Your registration for ",a.jsx("strong",{children:"Muqawama 2026"})," has been confirmed!"]}),a.jsx("p",{className:"sub-message",children:"Welcome to the tournament! Your team is now officially registered."})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"verification-badge",children:[a.jsx("i",{className:"fas fa-hourglass-half"}),a.jsx("span",{children:"Payment Verification Pending"})]}),a.jsxs("p",{className:"main-message",children:["Your registration for ",a.jsx("strong",{children:"Muqawama 2026"})," has been submitted successfully!"]}),a.jsxs("p",{className:"sub-message",children:["We have received your payment screenshot and it is being verified by our team. You will receive confirmation within ",a.jsx("strong",{children:"24 hours"}),"."]})]})}),a.jsxs("div",{className:"complete-details",children:[a.jsx("h4",{children:"What Happens Next?"}),a.jsxs("ul",{className:"next-steps-list",children:[!m&&a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-search-dollar"}),a.jsx("span",{children:"Our team will verify your payment within 24 hours"})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-phone"}),a.jsx("span",{children:"The organisers will get in touch with you soon"})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-calendar-check"}),a.jsx("span",{children:"Fixture details will be shared before the tournament"})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-id-card"}),a.jsx("span",{children:"Player ID cards will be issued at the venue"})]})]})]}),a.jsxs("div",{className:"complete-contact",children:[a.jsx("p",{children:"Questions? Reach out to us:"}),a.jsxs("div",{className:"contact-links",children:[a.jsxs("a",{href:"mailto:muqawamah@sio-abulfazal.org",children:[a.jsx("i",{className:"fas fa-envelope"})," muqawamah@sio-abulfazal.org"]}),a.jsxs("a",{href:"https://instagram.com/muqawama2026",target:"_blank",rel:"noopener noreferrer",children:[a.jsx("i",{className:"fab fa-instagram"})," @muqawama2026"]})]})]}),a.jsx("div",{className:"complete-actions",children:a.jsxs("button",{type:"button",className:"primary-btn",onClick:()=>{n(),window.location.href="/muqawamah/2026/"},children:[a.jsx("i",{className:"fas fa-home"})," Back to Tournament Page"]})})]})})}async function de(e,a={}){const{maxWidth:t=800,maxHeight:s=800,quality:n=.8,outputFormat:i="image/webp"}=a;return new Promise((a,r)=>{const l=new FileReader;l.onerror=()=>r(new Error("Failed to read file")),l.onload=l=>{const o=new Image;o.onerror=()=>r(new Error("Failed to load image")),o.onload=()=>{try{let{width:r,height:l}=o;if(r>t||l>s){const e=Math.min(t/r,s/l);r=Math.floor(r*e),l=Math.floor(l*e)}const c=document.createElement("canvas");c.width=r,c.height=l;const d=c.getContext("2d");d.imageSmoothingEnabled=!0,d.imageSmoothingQuality="high",d.drawImage(o,0,0,r,l);const m=c.toDataURL(i,n);Math.round(e.size/1024),me(m);a(m)}catch(l){r(new Error("Failed to compress image: "+l.message))}},o.src=l.target.result},l.readAsDataURL(e)})}function me(e){const a=e.length-(e.indexOf(",")+1);return Math.round(.75*a/1024)}const ue={"open-age":{label:"Open Age",amount:2e3,qrCode:"/assets/img/Muqawama/qr-2000.svg"},u17:{label:"Under 17",amount:1800,qrCode:"/assets/img/Muqawama/qr-1800.svg"}};function he(){const{teamData:s,players:n,setStep:i,loading:r,setLoading:o,error:c,setError:d,existingTeamId:m,setExistingTeamId:u,setSuccessTeamId:h,paymentStatus:p,setPaymentStatus:f}=l(),[g,x]=e.useState(null),[j,y]=e.useState(null),[N,v]=e.useState(0),[b,w]=e.useState(!1),[S,P]=e.useState(!1),C=e.useRef(null),_=s.category||"open-age",k=ue[_],M=k.amount;return"success"===p||"pending_verification"===p||"confirmed"===p?a.jsx(ce,{}):a.jsxs("div",{className:"registration-form payment-checkout",children:[a.jsx("h3",{children:"Step 5 Â· Payment"}),a.jsx("p",{className:"step-description",children:"Scan the QR code, pay and upload the screenshot."}),a.jsxs("section",{className:"checkout-section",children:[a.jsxs("h4",{children:[a.jsx("i",{className:"fas fa-receipt"})," Order Summary"]}),a.jsxs("div",{className:"order-summary-card",children:[a.jsxs("div",{className:"order-item",children:[a.jsxs("div",{className:"order-item-info",children:[a.jsx("span",{className:"item-name",children:"Team Registration"}),a.jsxs("span",{className:"item-detail",children:[s.teamName," â€¢ ",k.label]})]}),a.jsxs("span",{className:"item-price",children:["â‚¹",k.amount]})]}),a.jsxs("div",{className:"order-total",children:[a.jsx("span",{children:"Total Amount"}),a.jsxs("span",{className:"total-price",children:["â‚¹",M]})]})]})]}),a.jsxs("section",{className:"checkout-section qr-section",children:[a.jsxs("h4",{children:[a.jsx("i",{className:"fas fa-qrcode"})," Scan & Pay"]}),a.jsxs("div",{className:"qr-payment-container",children:[a.jsx("div",{className:"qr-code-wrapper",children:a.jsx("img",{src:k.qrCode,alt:`Pay â‚¹${M} via UPI`,className:"qr-code-image"})}),a.jsxs("a",{href:k.qrCode,download:`muqawama-payment-qr-${M}.svg`,className:"download-qr-btn",children:[a.jsx("i",{className:"fas fa-download"})," Download QR Code"]}),a.jsxs("div",{className:"qr-instructions",children:[a.jsxs("div",{className:"instruction-step",children:[a.jsx("span",{className:"step-number",children:"1"}),a.jsx("span",{children:"Open any UPI app (GPay, PhonePe, Paytm, etc.)"})]}),a.jsxs("div",{className:"instruction-step",children:[a.jsx("span",{className:"step-number",children:"2"}),a.jsxs("span",{children:["Scan the QR code and pay ",a.jsxs("strong",{children:["â‚¹",M]})]})]}),a.jsxs("div",{className:"instruction-step",children:[a.jsx("span",{className:"step-number",children:"3"}),a.jsx("span",{children:"Take a screenshot of the payment confirmation"})]}),a.jsxs("div",{className:"instruction-step",children:[a.jsx("span",{className:"step-number",children:"4"}),a.jsx("span",{children:"Upload the screenshot below"})]})]})]})]}),a.jsxs("section",{className:"checkout-section",children:[a.jsxs("h4",{children:[a.jsx("i",{className:"fas fa-upload"})," Upload Payment Screenshot"]}),a.jsxs("div",{className:"screenshot-upload-container",children:[a.jsx("input",{type:"file",ref:C,onChange:async e=>{const a=e.target.files[0];if(a)if(a.type.startsWith("image/"))if(a.size>5242880)d("Image size should be less than 5MB");else try{d(null);const e=await de(a,{maxWidth:1200,maxHeight:1200,quality:.85,outputFormat:"image/webp"});me(e),Math.round(a.size/1024);x(e),y(e)}catch(t){d("Failed to process image. Please try another file.")}else d("Please upload an image file (JPG, PNG, etc.)")},accept:"image/*",style:{display:"none"}}),j?a.jsxs("div",{className:"screenshot-preview",children:[a.jsx("img",{src:j,alt:"Payment Screenshot"}),a.jsxs("button",{type:"button",className:"remove-screenshot-btn",onClick:()=>{x(null),y(null),C.current&&(C.current.value="")},children:[a.jsx("i",{className:"fas fa-times"})," Remove"]})]}):a.jsxs("div",{className:"screenshot-dropzone",onClick:()=>{var e;return null==(e=C.current)?void 0:e.click()},children:[a.jsx("i",{className:"fas fa-cloud-upload-alt"}),a.jsx("p",{children:"Click to upload payment screenshot"}),a.jsx("span",{children:"JPG, PNG up to 5MB"})]})]}),N>0&&N<100&&a.jsxs("div",{className:"upload-progress",children:[a.jsx("div",{className:"progress-bar",children:a.jsx("div",{className:"progress-fill",style:{width:`${N}%`}})}),a.jsxs("span",{children:["Uploading... ",N,"%"]})]})]}),a.jsxs("section",{className:"checkout-section",children:[a.jsxs("h4",{children:[a.jsx("i",{className:"fas fa-users"})," Registration Details"]}),a.jsxs("div",{className:"checkout-team-summary",children:[a.jsxs("div",{className:"team-mini-card",children:[s.teamLogo&&a.jsx("img",{src:s.teamLogo,alt:s.teamName,className:"team-mini-logo"}),a.jsxs("div",{className:"team-mini-info",children:[a.jsx("span",{className:"team-mini-name",children:s.teamName}),a.jsxs("span",{className:"team-mini-category",children:[k.label," â€¢ ",n.length," Players"]})]})]}),a.jsxs("div",{className:"captain-info",children:[a.jsxs("span",{children:[a.jsx("i",{className:"fas fa-user"})," ",s.captainName]}),a.jsxs("span",{children:[a.jsx("i",{className:"fas fa-envelope"})," ",s.captainEmail]})]})]})]}),c&&a.jsxs("p",{className:"auth-error",children:[a.jsx("i",{className:"fas fa-exclamation-circle"})," ",c]}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"secondary-btn",onClick:()=>i(4),disabled:r,children:"Back to Review"}),a.jsx("button",{type:"button",className:"primary-btn pay-btn",onClick:()=>w(!0),disabled:r||!g,children:r?a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-spinner fa-spin"})," Submitting..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-check-circle"})," Submit Registration"]})})]}),a.jsxs("p",{className:"terms-note",children:[a.jsx("i",{className:"fas fa-info-circle"})," Your registration will be verified within 24 hours after payment confirmation."]}),b&&a.jsx("div",{className:"terms-modal-overlay",onClick:()=>w(!1),children:a.jsxs("div",{className:"terms-modal",onClick:e=>e.stopPropagation(),children:[a.jsxs("div",{className:"terms-modal-header",children:[a.jsx("i",{className:"fas fa-file-contract"}),a.jsx("h3",{children:"Confirm Registration"})]}),a.jsxs("div",{className:"terms-modal-content",children:[a.jsx("p",{children:"By submitting this registration, you confirm that:"}),a.jsxs("ul",{className:"terms-checklist",children:[a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-check"}),a.jsx("span",{children:"All information provided is accurate and complete"})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-check"}),a.jsxs("span",{children:["You agree to the ",a.jsx("a",{href:"/muqawamah/terms-and-conditions/",target:"_blank",rel:"noopener noreferrer",children:"Terms & Conditions"})]})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-check"}),a.jsxs("span",{children:["You agree to the ",a.jsx("a",{href:"/muqawamah/privacy-policy/",target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})]})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-check"}),a.jsx("span",{children:"You consent to AI-enhanced player images"})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-check"}),a.jsxs("span",{children:["You understand the ",a.jsx("a",{href:"/muqawamah/refund-policy/",target:"_blank",rel:"noopener noreferrer",children:"Refund Policy"})]})]}),a.jsxs("li",{children:[a.jsx("i",{className:"fas fa-check"}),a.jsx("span",{children:"All players meet the category age requirements"})]})]}),a.jsxs("div",{className:"terms-checkbox-label "+(S?"checked":""),onClick:()=>P(!S),children:[a.jsx("div",{className:"custom-checkbox",children:S&&a.jsx("i",{className:"fas fa-check"})}),a.jsx("span",{children:"I accept all the above terms and conditions"})]})]}),a.jsxs("div",{className:"terms-modal-actions",children:[a.jsx("button",{type:"button",className:"secondary-btn",onClick:()=>{w(!1),P(!1)},children:"Cancel"}),a.jsx("button",{type:"button",className:"primary-btn",disabled:!S||r,onClick:()=>{w(!1),(async()=>{if(g){o(!0),d(null),v(10);try{const{data:{user:e}}=await t.auth.getUser();if(!e)throw new Error("You must be logged in to proceed.");v(20);const a=g;v(40);let r=m;if(m){const{error:e}=await t.from("team_registrations").update({team_name:s.teamName,category:s.category,team_logo:s.teamLogo,captain_name:s.captainName,captain_email:s.captainEmail,captain_phone:s.captainPhone,formation:s.formation,status:"pending_verification",payment_amount:M,payment_screenshot:a,payment_status:"pending_verification",submitted_at:(new Date).toISOString()}).eq("id",m);if(e)throw e}else{const{data:n,error:i}=await t.from("team_registrations").insert({user_id:e.id,team_name:s.teamName,category:s.category,team_logo:s.teamLogo,captain_name:s.captainName,captain_email:s.captainEmail,captain_phone:s.captainPhone,formation:s.formation,status:"pending_verification",payment_amount:M,payment_screenshot:a,payment_status:"pending_verification",submitted_at:(new Date).toISOString()}).select().single();if(i)throw i;r=n.id,u(r)}v(60),await t.from("team_players").delete().eq("team_id",r);const l=n.map(e=>({team_id:r,player_name:e.name||"",player_age:e.age?parseInt(e.age):null,aadhar_no:e.aadhar_no||null,position:e.position||"SUB",is_substitute:e.isSubstitute||!1,player_image:e.image||null,position_x:"number"!=typeof e.x||isNaN(e.x)?50:e.x,position_y:"number"!=typeof e.y||isNaN(e.y)?50:e.y}));v(80);const{error:o}=await t.from("team_players").insert(l);if(o)throw o;v(100),h(r),f("pending_verification"),i(6)}catch(e){d(e.message)}finally{o(!1),v(0)}}else d("Please upload the payment screenshot")})()},children:r?a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-spinner fa-spin"})," Submitting..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-check-circle"})," Confirm & Submit"]})})]})]})})]})}const pe=["GK","CB","LB","RB","CDM","CM","CAM","LM","RM","CF","ST"];function fe(){const{players:t,setPlayers:s,setStep:n,saveProgress:i,saving:r,error:o,teamData:c}=l(),[d,m]=e.useState(null),u="open-age"===c.category;e.useEffect(()=>{c.captainName&&t[0]&&!t[0].name&&s(e=>e.map((e,a)=>0===a?{...e,name:c.captainName}:e))},[c.captainName,s]);const h=(e,a,t)=>{s(s=>s.map((s,n)=>n===e?{...s,[a]:t}:s))},p=t.filter(e=>!e.isSubstitute),f=t.filter(e=>e.isSubstitute),g=p[0],x=p.slice(1),j=(e,t,s=!1)=>{const n=e.isSubstitute,i=n&&e.name,r=!n||i;return a.jsxs("div",{className:`player-card ${s?"captain-card":""} ${n?"substitute-card":""}`,children:[s&&a.jsxs("div",{className:"captain-badge",children:[a.jsx("i",{className:"fas fa-star"})," Team Captain"]}),n&&!i&&a.jsxs("div",{className:"optional-badge",children:[a.jsx("i",{className:"fas fa-plus-circle"})," Optional"]}),a.jsxs("label",{children:[s?"Captain Name":"Player Name",a.jsx("input",{type:"text",value:e.name,onChange:e=>h(t,"name",e.target.value),placeholder:s?c.captainName||"Captain Name":n?"Substitute Name (optional)":`${e.position} Player`,required:!n})]}),a.jsxs("label",{children:["Age",a.jsx("input",{type:"number",value:e.age||"",onChange:e=>h(t,"age",e.target.value),placeholder:"e.g., 22",min:"10",max:"60",required:r})]}),!u&&a.jsxs("label",{children:["Aadhar Number",a.jsx("input",{type:"text",value:e.aadhar_no||"",onChange:e=>{const a=e.target.value.replace(/\D/g,"");a.length<=12&&h(t,"aadhar_no",a)},placeholder:"12-digit Aadhar number",maxLength:"12",pattern:"[0-9]{12}",required:r}),a.jsx("span",{className:"input-hint",children:"Enter 12-digit Aadhar number (required for U17)"})]}),!e.isSubstitute&&a.jsxs("label",{children:["Position",a.jsx("select",{value:e.position,onChange:e=>h(t,"position",e.target.value),children:pe.map(e=>a.jsx("option",{value:e,children:e},e))})]}),a.jsxs("label",{className:"file-label",children:["Player Photo",d===t&&a.jsxs("div",{className:"compressing-indicator",children:[a.jsx("i",{className:"fas fa-spinner fa-spin"}),a.jsx("span",{children:"Compressing image..."})]}),e.image&&d!==t&&a.jsxs("div",{className:"uploaded-photo-preview",children:[a.jsxs("div",{className:"photo-preview-container",children:[a.jsx("img",{src:e.image,alt:"Player photo",className:"photo-preview"}),a.jsx("div",{className:"photo-overlay",children:a.jsx("i",{className:"fas fa-check-circle"})})]}),a.jsxs("div",{className:"uploaded-file-info",children:[a.jsx("i",{className:"fas fa-check-circle"}),a.jsxs("span",{className:"file-name-text",children:[a.jsx("strong",{children:"Uploaded:"})," ",e.imageFileName||"Photo uploaded"]}),a.jsx("span",{className:"file-change-hint",children:"(Click to change)"})]})]}),a.jsx("input",{type:"file",accept:"image/*",onChange:e=>{var a;return(async(e,a)=>{if(a)if(a.size>2097152)alert("Player photo must be under 2MB");else try{m(e);const t=await de(a,{maxWidth:600,maxHeight:600,quality:.85,outputFormat:"image/webp"});me(t),Math.round(a.size/1024),h(e,"image",t),h(e,"imageFileName",a.name.replace(/\.(jpg|jpeg|png)$/i,".webp"))}catch(t){alert("Failed to process image. Please try another file.")}finally{m(null)}})(t,null==(a=e.target.files)?void 0:a[0])},disabled:d===t}),!e.image&&d!==t&&a.jsx("span",{className:"input-hint",children:n?"JPG/PNG up to 2MB. Optional.":"JPG/PNG up to 2MB. Required."})]})]},e.id)};return a.jsxs("form",{className:"registration-form",onSubmit:async e=>{if(e.preventDefault(),!(()=>{const e=p.every(e=>{const a=e.name&&e.age&&e.position&&e.image;return u?a:a&&e.aadhar_no&&12===e.aadhar_no.length}),a=f.filter(e=>e.name).every(e=>{const a=e.name&&e.age&&e.image;return u?a:a&&e.aadhar_no&&12===e.aadhar_no.length});return e&&a})()){return void alert(`Please fill out all required fields including name, age${u?"":", Aadhar number,"} and photo for all main players. Substitutes are optional.`)}(await i(2)).success&&n(3)},children:[a.jsx("h3",{children:"Step 2 Â· Players"}),a.jsx("p",{className:"step-description",children:"Start with the captain, then add 6 more players and 4 substitutes."}),a.jsx("h4",{children:"Captain"}),a.jsx("div",{className:"captain-section",children:g&&j(g,t.indexOf(g),!0)}),a.jsx("h4",{children:"Other Main Players"}),a.jsx("div",{className:"players-grid",children:x.map(e=>j(e,t.indexOf(e)))}),a.jsxs("h4",{children:["Substitutes ",a.jsx("span",{className:"optional-label",children:"(Optional)"})]}),a.jsx("p",{className:"step-description",style:{marginTop:"-10px",marginBottom:"15px"},children:"Add up to 4 substitutes. You can skip this section if you don't have substitutes."}),a.jsx("div",{className:"players-grid",children:f.map(e=>j(e,t.indexOf(e)))}),o&&a.jsx("p",{className:"auth-error",children:o}),a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"secondary-btn",onClick:()=>n(1),disabled:r,children:"Back"}),a.jsx("button",{type:"submit",className:"primary-btn",disabled:r,children:r?a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-spinner fa-spin"})," Saving..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-save"})," Save & Continue"]})})]})]})}function ge({readOnly:e=!1}){const{teamData:t,players:s,setStep:n,existingTeamId:i}=l();return a.jsxs("div",{className:"registration-form",children:[a.jsxs("h3",{children:["Step 4 Â· Review & ",i?"Update":"Submit"]}),a.jsxs("p",{className:"step-description",children:["Verify everything looks good before ",i?"updating":"submitting"," your team."]}),a.jsxs("section",{className:"summary-section",children:[a.jsx("h4",{children:"Team Information"}),a.jsxs("div",{className:"team-info-card",children:[a.jsxs("div",{className:"team-info-header",children:[a.jsx("div",{className:"team-logo-large",children:t.teamLogo?a.jsx("img",{src:t.teamLogo,alt:`${t.teamName} logo`}):a.jsx("div",{className:"team-logo-placeholder-large",children:a.jsx("i",{className:"fas fa-shield-alt"})})}),a.jsxs("div",{className:"team-info-main",children:[a.jsx("h3",{className:"team-name-display",children:t.teamName}),a.jsxs("span",{className:"team-category-badge",children:[a.jsx("i",{className:"fas fa-trophy"})," ","open-age"===t.category?"Open Age":"Under 17"]})]})]}),a.jsxs("div",{className:"team-info-details",children:[a.jsxs("div",{className:"info-row",children:[a.jsxs("div",{className:"info-item",children:[a.jsx("i",{className:"fas fa-user-tie"}),a.jsxs("div",{className:"info-content",children:[a.jsx("span",{className:"info-label",children:"Captain"}),a.jsx("span",{className:"info-value",children:t.captainName})]})]}),a.jsxs("div",{className:"info-item",children:[a.jsx("i",{className:"fas fa-envelope"}),a.jsxs("div",{className:"info-content",children:[a.jsx("span",{className:"info-label",children:"Email"}),a.jsx("span",{className:"info-value",children:t.captainEmail})]})]})]}),t.captainPhone&&a.jsxs("div",{className:"info-row",children:[a.jsxs("div",{className:"info-item",children:[a.jsx("i",{className:"fas fa-phone"}),a.jsxs("div",{className:"info-content",children:[a.jsx("span",{className:"info-label",children:"Phone"}),a.jsx("span",{className:"info-value",children:t.captainPhone})]})]}),a.jsxs("div",{className:"info-item",children:[a.jsx("i",{className:"fas fa-futbol"}),a.jsxs("div",{className:"info-content",children:[a.jsx("span",{className:"info-label",children:"Formation"}),a.jsx("span",{className:"info-value",children:t.formation})]})]})]}),!t.captainPhone&&a.jsx("div",{className:"info-row",children:a.jsxs("div",{className:"info-item",children:[a.jsx("i",{className:"fas fa-futbol"}),a.jsxs("div",{className:"info-content",children:[a.jsx("span",{className:"info-label",children:"Formation"}),a.jsx("span",{className:"info-value",children:t.formation})]})]})})]})]})]}),a.jsxs("section",{className:"summary-section",children:[a.jsx("h4",{children:"Players"}),a.jsx("div",{className:"player-card-grid",children:s.map((e,s)=>{var n,i;return a.jsxs("div",{className:"player-card-badge simple "+(e.isSubstitute?"substitute":""),children:[a.jsxs("div",{className:"badge-header",children:[a.jsxs("div",{className:"badge-team",children:[a.jsx("div",{className:"team-logo",children:t.teamLogo?a.jsx("img",{src:t.teamLogo,alt:`${t.teamName} logo`}):a.jsx("div",{className:"team-logo-placeholder",children:(null==(i=null==(n=t.teamName)?void 0:n.charAt(0))?void 0:i.toUpperCase())||"T"})}),a.jsxs("div",{className:"team-meta",children:[a.jsx("span",{className:"team-name",children:t.teamName||"Team name"}),a.jsx("span",{className:"player-role",children:e.isSubstitute?"Substitute":e.position||"Player"})]})]}),a.jsx("div",{className:"muqawama-logo",children:a.jsx("img",{src:"/assets/img/MuqawamaLogo.png",alt:"Muqawama 2026"})})]}),a.jsx("div",{className:"badge-photo",children:e.image?a.jsx("img",{src:e.image,alt:e.name||e.position}):a.jsx("div",{className:"badge-photo-placeholder",children:a.jsx("i",{className:"fas fa-user"})})}),a.jsx("div",{className:"badge-player-info",children:a.jsx("span",{className:"player-name",children:e.name||"Unnamed Player"})})]},e.id||s)})})]}),a.jsxs("section",{className:"summary-section",children:[a.jsx("h4",{children:"Formation Preview"}),a.jsx("div",{children:a.jsx(ee,{players:s.filter(e=>!e.isSubstitute),editable:!1,showDownload:!0})})]}),!e&&a.jsxs("div",{className:"form-actions",children:[a.jsx("button",{type:"button",className:"secondary-btn",onClick:()=>n(3),children:"Back"}),a.jsx("button",{type:"button",className:"primary-btn",onClick:()=>{n(5)},children:"Proceed to Payment"})]})]})}const xe=[{value:"open-age",label:"Open Age"},{value:"u17",label:"Under 17"}];function je(){const{teamData:t,setTeamData:s,setStep:n,saveProgress:i,saving:r,error:o}=l(),c=e.useRef(null),[d,m]=e.useState(!1),u=e=>{const{name:a,value:t}=e.target;s(e=>({...e,[a]:t}))};return a.jsxs("form",{className:"registration-form",onSubmit:async e=>{var a;if(e.preventDefault(),!t.teamLogo)return void alert("Please upload a team logo");if(10!==((null==(a=t.captainPhone)?void 0:a.replace(/\s/g,""))||"").length)return void alert("Please enter a valid 10-digit mobile number");(await i(1)).success&&n(2)},children:[a.jsx("h3",{children:"Step 1 Â· Team Details"}),a.jsx("p",{className:"step-description",children:"Tell us about your team and captain information."}),a.jsxs("label",{children:["Team Name",a.jsx("input",{type:"text",name:"teamName",value:t.teamName,onChange:u,placeholder:"e.g., Rising Stars",required:!0})]}),a.jsxs("label",{children:["Category",a.jsx("select",{name:"category",value:t.category,onChange:u,children:xe.map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))})]}),a.jsxs("label",{className:"file-label",children:["Team Logo",d&&a.jsxs("div",{className:"compressing-indicator",children:[a.jsx("i",{className:"fas fa-spinner fa-spin"}),a.jsx("span",{children:"Compressing image..."})]}),t.teamLogo&&!d&&a.jsxs("div",{className:"uploaded-photo-preview",children:[a.jsxs("div",{className:"photo-preview-container",children:[a.jsx("img",{src:t.teamLogo,alt:"Team logo",className:"photo-preview"}),a.jsx("div",{className:"photo-overlay",children:a.jsx("i",{className:"fas fa-check-circle"})})]}),a.jsxs("div",{className:"uploaded-file-info",children:[a.jsx("i",{className:"fas fa-check-circle"}),a.jsx("span",{children:t.teamLogoFileName?`Uploaded: ${t.teamLogoFileName}`:"Logo uploaded"}),a.jsx("span",{className:"file-change-hint",children:"(Click to change)"})]})]}),a.jsx("input",{type:"file",accept:"image/*",ref:c,onChange:async e=>{var a;const t=null==(a=e.target.files)?void 0:a[0];if(t){if(t.size>2097152)return alert("Logo size must be under 2MB"),void(c.current.value="");try{m(!0);const e=await de(t,{maxWidth:800,maxHeight:800,quality:.85,outputFormat:"image/webp"});me(e),Math.round(t.size/1024);s(a=>({...a,teamLogo:e,teamLogoFileName:t.name.replace(/\.(jpg|jpeg|png)$/i,".webp")}))}catch(n){alert("Failed to process image. Please try another file."),c.current.value=""}finally{m(!1)}}},disabled:d}),!t.teamLogo&&!d&&a.jsx("span",{className:"input-hint",children:"JPG/PNG up to 2MB. Displayed across the tournament site."})]}),a.jsxs("label",{children:["Preferred Formation",a.jsx("select",{name:"formation",value:t.formation,onChange:u,children:ae.map(e=>a.jsx("option",{value:e,children:e},e))}),a.jsx("span",{className:"input-hint",children:"This will be the starting layout in Step 3. You can still adjust players later."})]}),a.jsxs("div",{className:"grid-2",children:[a.jsxs("label",{children:["Captain Name",a.jsx("input",{type:"text",name:"captainName",value:t.captainName,onChange:u,required:!0})]}),a.jsxs("label",{children:["Captain Email",a.jsx("input",{type:"email",name:"captainEmail",value:t.captainEmail,onChange:u,required:!0})]})]}),a.jsxs("label",{children:["Captain Phone",a.jsx("input",{type:"tel",name:"captainPhone",value:t.captainPhone||"",onChange:e=>{const a=e.target.value.replace(/\D/g,"");let t="";a&&(t=a.length<=5?a:`${a.slice(0,5)} ${a.slice(5,10)}`),s(e=>({...e,captainPhone:t}))},placeholder:"98765 43210",pattern:"[0-9\\s]{10,12}",maxLength:11,onInvalid:e=>{var a;const s=e.target;((null==(a=t.captainPhone)?void 0:a.replace(/\s/g,""))||"").length<10?s.setCustomValidity("Please enter a valid 10-digit mobile number"):s.setCustomValidity("")},onInput:e=>{e.target.setCustomValidity("")},required:!0}),a.jsxs("span",{className:"input-hint",children:[a.jsx("i",{className:"fas fa-info-circle"})," 10-digit mobile number (e.g., 98765 43210)"]})]}),o&&a.jsx("p",{className:"auth-error",children:o}),a.jsx("div",{className:"form-actions",children:a.jsx("button",{type:"submit",className:"primary-btn",disabled:r,children:r?a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-spinner fa-spin"})," Saving..."]}):a.jsxs(a.Fragment,{children:[a.jsx("i",{className:"fas fa-save"})," Save & Continue"]})})})]})}const ye=[{id:1,label:"Team"},{id:2,label:"Players"},{id:3,label:"Formation"},{id:4,label:"Review"},{id:5,label:"Payment"},{id:6,label:"Complete"}];function Ne(){const{step:e}=l(),t=ye.slice(0,5);return 6===e?null:a.jsx("div",{className:"registration-stepper",children:t.map((t,s)=>a.jsxs("div",{className:`step ${e===t.id?"active":""} ${e>t.id?"complete":""}`,children:[a.jsx("span",{className:"step-number",children:s+1}),a.jsx("span",{className:"step-label",children:t.label})]},t.id))})}function ve(){const{step:n,setStep:r,setTeamData:d,setPlayers:m,setExistingTeamId:u,readOnlyMode:h,setReadOnlyMode:p,resetForm:f,existingTeamId:g,setPaymentStatus:x,setLastSavedStep:j}=l(),[y,N]=e.useState(null),[v,b]=e.useState(!0),[w,S]=e.useState(""),[P,C]=e.useState(!1),_=s.useRef(!1);e.useEffect(()=>{const e=new URLSearchParams(window.location.search).get("payment");"success"===e?(x("success"),r(5),window.history.replaceState({},"",window.location.pathname)):"failed"===e&&(x("failed"),r(5),window.history.replaceState({},"",window.location.pathname))},[]),e.useEffect(()=>{let e=!0;S("");(async()=>{try{const{data:a,error:s}=await Promise.race([t.auth.getUser(),new Promise((e,a)=>setTimeout(()=>a(new Error("getUser timeout")),3e3))]);if(!e)return;if(s){if("getUser timeout"===s.message)return N(null),f(),void b(!1);if("Auth session missing!"!==s.message)throw s}const n=(null==a?void 0:a.user)??null;n?(N(n),await k(n,{force:!0})):(N(null),f())}catch(a){e&&(N(null),f())}finally{e&&b(!1)}})();const{data:a}=t.auth.onAuthStateChange(async(e,a)=>{const t=(null==a?void 0:a.user)??null;t?"SIGNED_IN"===e&&(N(t),b(!0),await k(t,{force:!0}),b(!1)):(N(null),f(),r(1),_.current=!1)});return()=>{e=!1,a.subscription.unsubscribe()}},[]);const k=async(e,{force:a=!1}={})=>{if(!_.current||a){_.current=!0,C(!0),S("");try{const{data:a,error:s}=await t.from("team_registrations").select("*, team_players(*)").eq("user_id",e.id).maybeSingle();if(s&&"PGRST116"!==s.code)throw s;if(a){u(a.id),p(!1),d({teamName:a.team_name||"",category:a.category||"open-age",teamLogo:a.team_logo,captainName:a.captain_name||"",captainEmail:a.captain_email||e.email||"",captainPhone:a.captain_phone?a.captain_phone.replace(/^\+91\s?/,"").trim():"",formation:a.formation||"1-3-2-1"});const t=a.team_players&&a.team_players.length>0?a.team_players.map((e,a)=>({id:e.id||`player-${a}`,name:e.player_name||"",age:e.player_age||"",aadhar_no:e.aadhar_no||"",position:e.position||"SUB",isSubstitute:e.is_substitute,image:e.player_image,x:e.position_x??50,y:e.position_y??50})):o();if(m(t),"confirmed"===a.status)x("confirmed"),r(6);else if("pending_verification"===a.status)x("pending_verification"),r(6);else if("pending_payment"===a.status)r(4);else{const e=a.last_saved_step||1;j(e);r(e>=3?4:e+1)}}else u(null),p(!1),d({...c,captainEmail:e.email||""}),m(o()),r(1)}catch(s){S("Could not load your saved registration. You can continue and submitting will overwrite the previous data."),u(null),p(!1),d({...c,captainEmail:e.email||""}),m(o()),r(1)}finally{C(!1)}}};return v?a.jsx("div",{className:"loading-screen",children:a.jsxs("div",{className:"loading-content",children:[a.jsxs("div",{className:"logo-loader",children:[a.jsx("div",{className:"logo-ring"}),a.jsx("img",{src:"/assets/img/MuqawamaLogo.png",alt:"Muqawama",className:"logo-pulse"})]}),a.jsx("p",{children:"Loading your registration..."})]})}):y?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"header-actions",children:[a.jsx("span",{className:"user-email",children:y.email}),a.jsxs("button",{type:"button",className:"logout-btn",onClick:async()=>{await t.auth.signOut(),N(null),r(1)},children:[a.jsx("i",{className:"fas fa-sign-out-alt"})," Logout"]})]}),a.jsx("div",{className:"registration-header",children:a.jsxs("div",{className:"registration-header-logo",children:[a.jsx("img",{src:"/assets/img/title.png",alt:"Muqawama 2026"}),a.jsx("h2",{className:"registration-header-title",children:"Team Registration"}),a.jsx("p",{children:g?"Edit your team registration and update any details.":"Complete all steps to confirm your team registration."})]})}),w&&a.jsx("p",{className:"auth-error",children:w}),a.jsx(Ne,{}),(()=>{switch(n){case 1:default:return a.jsx(je,{});case 2:return a.jsx(fe,{});case 3:return a.jsx(oe,{});case 4:return a.jsx(ge,{});case 5:return a.jsx(he,{});case 6:return a.jsx(ce,{})}})()]}):a.jsx(i,{onSuccess:N})}function be(){return e.useEffect(()=>(document.body.classList.add("registration-body"),()=>document.body.classList.remove("registration-body")),[]),a.jsx(d,{children:a.jsx("div",{className:"registration-container",children:a.jsx(ve,{})})})}n.createRoot(document.getElementById("registration-root")).render(a.jsx(s.StrictMode,{children:a.jsx(be,{})}));
