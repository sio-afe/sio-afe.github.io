import{s as t,R as e,j as r,r as n}from"./supabaseClient-y7L7r4ir.js";import{a as o}from"./index-3r6UxFjv.js";const a="muqawamah-media";function i(t){return String(t).trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"_").replace(/^_+|_+$/g,"").slice(0,80)}async function s({value:e,bucket:r=a,path:n,cacheControl:o="31536000",upsert:i=!0}){if(!e)return null;if(!function(t){return function(t){return"string"==typeof t&&t.startsWith("data:")}(t)&&t.startsWith("data:image/")}(e))return e;if(!n)throw new Error("ensurePublicImageUrl requires a storage path");const{blob:s,contentType:l}=function(t){const[e,r]=String(t).split(",");if(!e||!r)throw new Error("Invalid data URL");const n=e.match(/^data:([^;]+);base64$/),o=(null==n?void 0:n[1])||"application/octet-stream",a=atob(r),i=new Uint8Array(a.length);for(let s=0;s<a.length;s++)i[s]=a.charCodeAt(s);return{blob:new Blob([i],{type:o}),contentType:o}}(e),c=await t.storage.from(r).upload(n,s,{contentType:l,cacheControl:o,upsert:i});if(c.error)throw c.error;const{data:d}=t.storage.from(r).getPublicUrl(n);return(null==d?void 0:d.publicUrl)||null}function l(t,{width:e,height:r,quality:n=80,format:o="webp"}={}){if(!t||"string"!=typeof t)return t;if(!function(){var t,e;try{const r=null==(e=null==(t=import.meta)?void 0:t.env)?void 0:e.VITE_SUPABASE_IMAGE_TRANSFORMS;return"true"===String(r).toLowerCase()}catch{return!1}}())return t;const a="/storage/v1/object/public/",i=t.indexOf(a);if(-1===i)return t;const s=t.slice(i+26),[l,...c]=s.split("/"),d=c.join("/");if(!l||!d)return t;const f=`${t.slice(0,i)}/storage/v1/render/image/public/${l}/${d.split("/").map(t=>encodeURIComponent(t)).join("/")}`,h=new URLSearchParams;e&&h.set("width",String(e)),r&&h.set("height",String(r)),n&&h.set("quality",String(n)),o&&h.set("format",String(o));const u=h.toString();return u?`${f}?${u}`:f}const c=e.forwardRef(({children:t,...e},n)=>r.jsxs("svg",{ref:n,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 74 111",className:"field-svg",...e,children:[r.jsx("rect",{width:"74",height:"111",fill:"#ffffff"}),r.jsxs("g",{fill:"none",stroke:"#000",strokeWidth:"0.5",transform:"translate(3 3)",children:[r.jsx("path",{d:"M 0 0 h 68 v 105 h -68 Z"}),r.jsx("path",{d:"M 0 52.5 h 68"}),r.jsx("circle",{r:"9.15",cx:"34",cy:"52.5"}),r.jsx("circle",{r:"0.75",cx:"34",cy:"52.5",fill:"#000",stroke:"none"}),r.jsxs("g",{children:[r.jsx("path",{d:"M 13.84 0 v 16.5 h 40.32 v -16.5"}),r.jsx("path",{d:"M 24.84 0 v 5.5 h 18.32 v -5.5"}),r.jsx("circle",{r:"0.75",cx:"34",cy:"10.94",fill:"#000",stroke:"none"}),r.jsx("path",{d:"M 26.733027 16.5 a 9.15 9.15 0 0 0 14.533946 0"})]}),r.jsxs("g",{transform:"rotate(180,34,52.5)",children:[r.jsx("path",{d:"M 13.84 0 v 16.5 h 40.32 v -16.5"}),r.jsx("path",{d:"M 24.84 0 v 5.5 h 18.32 v -5.5"}),r.jsx("circle",{r:"0.75",cx:"34",cy:"10.94",fill:"#000",stroke:"none"}),r.jsx("path",{d:"M 26.733027 16.5 a 9.15 9.15 0 0 0 14.533946 0"})]}),r.jsx("path",{d:"M 0 2 a 2 2 0 0 0 2 -2M 66 0 a 2 2 0 0 0 2 2M 68 103 a 2 2 0 0 0 -2 2M 2 105 a 2 2 0 0 0 -2 -2"})]}),t]}));function d({players:t,editable:e=!1,onDragStart:a,onDrag:i,onDragEnd:s,showDownload:l=!1}){const d=n.useRef(null),f=n.useRef(null),[h,u]=n.useState(!1),[p,m]=n.useState(null),g=n.useMemo(()=>`muqawamah-formation-${(new Date).toISOString().split("T")[0]}.png`,[]),x=()=>{p&&(m(null),s&&s())};return r.jsxs("div",{className:"formation-preview-wrapper",children:[r.jsx("div",{className:"football-field-svg",ref:d,onMouseMove:t=>{p&&e&&d.current&&(t.preventDefault(),i&&i(t))},onMouseUp:x,onMouseLeave:x,onTouchMove:t=>{p&&e&&d.current&&(t.preventDefault(),i&&i(t))},onTouchEnd:()=>{p&&(m(null),s&&s())},children:r.jsxs(c,{ref:f,style:{width:"100%",height:"auto",maxWidth:"400px",display:"block",margin:"0 auto"},children:[r.jsx("defs",{children:t.map(t=>r.jsx("clipPath",{id:`player-clip-${t.id}`,children:r.jsx("circle",{r:"3.3",cx:"0",cy:"0"})},`clip-${t.id}`))}),t.map(t=>{const n=3+("number"!=typeof t.x||isNaN(t.x)?50:t.x)/100*68,o=3+("number"!=typeof t.y||isNaN(t.y)?50:t.y)/100*105,i="GK"===t.position,s=e&&!i;return r.jsxs("g",{transform:`translate(${n}, ${o})`,className:s?"player-marker-draggable":"player-marker-static",style:{cursor:s?"move":"default"},onMouseDown:r=>((t,r)=>{e&&"GK"!==r.position&&(t.preventDefault(),m(r.id),a&&a(t,r.id))})(r,t),onTouchStart:r=>((t,r)=>{e&&"GK"!==r.position&&(m(r.id),a&&a(t,r.id))})(r,t),children:[r.jsx("circle",{r:"3.3",fill:i?"#2d5a27":"#4a90e2",stroke:i?"#4a8c3f":"#fff",strokeWidth:"0.5"}),i&&r.jsx("text",{x:"0",y:"-4.5",textAnchor:"middle",fill:"#4a8c3f",fontSize:"2",children:"ðŸ”’"}),t.image?r.jsx("image",{href:t.image,x:"-3.3",y:"-3.3",width:"6.6",height:"6.6",clipPath:`url(#player-clip-${t.id})`,preserveAspectRatio:"xMidYMid slice"}):r.jsx("text",{x:"0",y:"1.1",textAnchor:"middle",fill:"#fff",fontSize:"2.75",fontWeight:"600",children:t.position}),r.jsx("text",{x:"0",y:"6",textAnchor:"middle",fill:"#000",fontSize:"2",fontWeight:"600",children:t.name||"Player"}),r.jsx("text",{x:"0",y:"8.2",textAnchor:"middle",fill:"#666",fontSize:"1.65",fontWeight:"400",children:t.position})]},t.id)})]})}),l&&r.jsxs("button",{type:"button",className:"download-formation-btn",onClick:async()=>{if(d.current)try{u(!0);const t=await o(d.current,{cacheBust:!0,pixelRatio:window.devicePixelRatio||2,backgroundColor:"#ffffff"}),e=document.createElement("a");e.download=g,e.href=t,e.click()}catch(t){alert("Unable to download formation right now. Please try again.")}finally{u(!1)}},disabled:h,children:[r.jsx("i",{className:"fas fa-download"}),r.jsx("span",{children:h?"Preparing...":"Download Formation"})]})]})}c.displayName="FootballFieldSVG";const f=["1-3-2-1","1-2-3-1","1-2-2-2","1-3-1-2","1-4-1-1"],h=85,u=100,p=(t,e)=>"GK"===t?Math.max(h,Math.min(u,e)):Math.max(0,Math.min(100,e)),m={GK:50,CB:50,LB:25,RB:75,CDM:50,CM:50,CAM:50,LM:20,RM:80,CF:50,ST:50},g={GK:92,CB:78,LB:78,RB:78,CDM:65,CM:55,CAM:45,LM:55,RM:55,CF:30,ST:25},x=t=>{const e=[...t],r=t.filter(t=>!t.isSubstitute),n={};return r.forEach(r=>{const o=r.position,a=n[o]||0;let i=m[o]||50,s=g[o]||50;a>0&&("CB"===o||"CM"===o||"ST"===o||"CF"===o?i=1===a?30:2===a?70:50:"LB"===o?i=20-5*a:"RB"===o&&(i=80+5*a)),n[o]=a+1;const l=t.indexOf(r);e[l]={...r,x:i,y:s}}),e},w=(t,e)=>{if(!e)return x(t);const r=e.split("-").map(t=>parseInt(t,10)).filter(t=>!isNaN(t));if(0===r.length)return x(t);const n=[...t],o=[...t.filter(t=>!t.isSubstitute)].sort((t,e)=>"GK"===t.position?-1:"GK"===e.position?1:0),a=[92,78,55,35,15];let i=0;return r.forEach((e,r)=>{const s=a[r]||50;for(let a=0;a<e&&!(i>=o.length);a++){const r=o[i];let l;if(1===e)l=50;else if(2===e)l=0===a?30:70;else if(3===e)l=0===a?20:1===a?50:80;else if(4===e)l=[15,35,65,85][a];else if(5===e)l=[10,27.5,50,72.5,90][a];else{l=100/(e+1)*(a+1)}const c=p(r.position,s),d=t.indexOf(r);n[d]={...r,x:l,y:c},i++}}),n};async function y(t,e={}){const{maxWidth:r=800,maxHeight:n=800,quality:o=.8,outputFormat:a="image/webp"}=e;return new Promise((e,i)=>{const s=new FileReader;s.onerror=()=>i(new Error("Failed to read file")),s.onload=s=>{const l=new Image;l.onerror=()=>i(new Error("Failed to load image")),l.onload=()=>{try{let{width:i,height:s}=l;if(i>r||s>n){const t=Math.min(r/i,n/s);i=Math.floor(i*t),s=Math.floor(s*t)}const c=document.createElement("canvas");c.width=i,c.height=s;const d=c.getContext("2d");d.imageSmoothingEnabled=!0,d.imageSmoothingQuality="high",d.drawImage(l,0,0,i,s);const f=c.toDataURL(a,o);Math.round(t.size/1024),M(f);e(f)}catch(s){i(new Error("Failed to compress image: "+s.message))}},l.src=s.target.result},s.readAsDataURL(t)})}function M(t){const e=t.length-(t.indexOf(",")+1);return Math.round(.75*e/1024)}export{d as F,a as M,w as a,y as c,s as e,M as g,f as p,i as s,l as t};
